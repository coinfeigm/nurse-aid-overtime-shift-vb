Imports System
Imports System.IO

Public Class frmNSC0000HA
    Inherits General.FormBase

    ' 既存のプロセスオブジェクトのハンドルを取得する関数の宣言
    Private Declare Function OpenProcess Lib "kernel32.dll" (ByVal dwDesiredAccess As Integer, ByVal bInheritHandle As Integer, ByVal dwProcessId As Integer) As Integer
    ' 指定されたプロセスの終了状態を取得する関数の宣言
    Private Declare Function GetExitCodeProcess Lib "kernel32.dll" (ByVal hProcess As Integer, ByRef lpExitCode As Integer) As Integer
    ' オープンされているオブジェクトハンドルを' クローズする関数の宣言
    Private Declare Function CloseHandle Lib "kernel32.dll" (ByVal hObject As Integer) As Integer
    Private Const PROCESS_QUERY_INFORMATION As Integer = &H400
    Private Const STATUS_PENDING As Integer = &H103
    Private Const STILL_ACTIVE As Integer = STATUS_PENDING

#Region "定数・変数"
    '[ﾌｧｲﾙﾒﾆｭｰ]
    Private Const M_SelectMonth As Integer = 0 '超勤選択月変更
    Private Const M_PRINT As Integer = 1 '印刷
    Private Const M_LOGOFF As Integer = 3 'ログオフ   
    Private Const M_END As Integer = 4 '終了

    '+------------------------------------------------------------------------------------
    '|ListBar関連の固定値宣言
    '+------------------------------------------------------------------------------------
    Private Const M_PERSONAL_RESCD As String = "NSC0000HA01" '個人
    Private Const M_DEPT_RESCD As String = "NSC0000HA02" '部署
    Private Const M_APPROVE_RESCD As String = "NSC0000HA03" '未承認
    Private Const M_DAKOKU_RESCD As String = "NSC0000HA04" '出退勤
    Private Const M_DUTY_RESCD As String = "NSC0000HA05" '日当直
    Private Const M_ZAIIN_RESCD As String = "NSC0000HA06" '在院照会
    Private Const M_OVERKINMU_RESCD As String = "NSC0000HA07" '時間外

    Private Const M_ERRORUSERDATECHECK_RESCD As String = "NSC0000HA08"
    Private Const M_COMMONINFO_RESCD As String = "NSC0000HA11" '共通情報設定(DLL)
    Private Const M_SECURITY_RESCD As String = "NSC0000HA12" 'セキュリティ(DLL)
    Private Const M_NEWSTAFF_RESCD As String = "NSC0000HA13" '新規職員登録(DLL)
    Private Const M_MASTER_RESCD As String = "NSC0000HA14" 'マスタ設定画面(EXE)
    Private Const M_STAFFIDO_RESCD As String = "NSC0000HA15" '異動情報画面
    Private Const M_SUMMANTE_RESCD As String = "NSC0000HA16" '集計メンテナンス(DLL)
    Private Const M_YAKANKANGO_RESCD As String = "NSC0000HA17" '夜間看護加算
    Private Const M_APPROCLASS_RESCD As String = "NSC0000HA18" '承認階層設定(DLL)
    Private Const M_LIMIT_RESCD As String = "NSC0000HA19" '締切設定(DLL)
    Private Const M_DUTYSTAFF_RESCD As String = "NSC0000HA21" '日当直職員登録(DLL)
    Private Const M_KOUMOKUSET_RESCD As String = "NSC0000HA22" '項目設定(EXE)
    Private Const M_STUDY_RESCD As String = "NSC0000HA24" '研修登録画面
    Private Const M_INFORMATION_RESCD As String = "NSC0000HA25" 'お知らせ設定画面
    Private Const M_LADDER_RESCD As String = "NSC0000HA26" '評価項目設定画面
    Private Const M_FDOUTPUT_RESCD As String = "NSC0000HA27" 'ＦＤ出力設定画面
    Private Const M_ACCESSLOG_RESCD As String = "NSC0000HA28" 'アクセスログ画面
    Private Const M_SETCOLOR_RESCD As String = "NSC0000HA29" '色設定画面
    '+------------------------------------------------------------------------------------
    '|ToolBar関連の固定値宣言
    '+------------------------------------------------------------------------------------
    'メイン画面
    Private Const M_Separate1 As String = "Space1" '区切りスペース１
    Private Const M_END_TOOL As String = "End" 'システム終了
    Private Const M_PRINT_TOOL As String = "Print" '印刷
    Private Const M_LOGOFF_TOOL As String = "LogOff" 'ログオフ

    Private Const G_ToolBar_Parsonal As String = "Parsonal" '個人別画面への遷移
    Private Const G_ToolBar_List As String = "List" '一覧画面への遷移
    Private Const G_ToolBar_DataAdd As String = "DataAdd" '追加
    Private Const G_ToolBar_DataUpd As String = "DataUpd" '変更
    Private Const G_ToolBar_DataDel As String = "DataDel" '削除
    Private Const G_ToolBar_Kihon As String = "Kihon" '基本情報
    Private Const G_ToolBar_NewStaff As String = "NewStaff" '職員新規
    Private Const G_ToolBar_Search As String = "Search" '検索
    Private Const G_ToolBar_FileOutPut As String = "FileOutPut" 'ファイル出力
    Private Const G_ToolBar_Import As String = "Import" '取り込み
    Private Const G_ToolBar_Study As String = "Study" '研修申込

    '個人業務
    Private Const M_PER_JISSEKI_DSP As String = "NSC0000HA50" '実績状況
    Private Const M_PER_JISSEKI_CHG As String = "NSC0000HA51" '実績変更
    Private Const M_PER_APPLI_DSP As String = "NSC0000HA52" '届出状況
    Private Const M_PER_APPLI_CHG As String = "NSC0000HA53" '届出詳細
    Private Const M_PER_APPLI_NEW As String = "NSC0000HA54" '届出入力
    Private Const M_PER_HOLIDAY_DSP As String = "NSC0000HA55" '休暇情報
    Private Const M_PER_STAFFINFO_DSP As String = "NSC0000HA56" '基本情報
    Private Const M_PER_MAKEKINMU_HOPE As String = "NSC0000HA57" '計画画面[希望勤務] 
    Private Const M_PER_STUDY As String = "NSC0000HA58" '研修申込

    '勤務部署
    Private Const M_DEPT_JISSEKI_CHG As String = "NSC0000HA60" '実績詳細
    Private Const M_DEPT_MAKEKINMU_NEW As String = "NSC0000HA61" '計画画面[計画新規]
    Private Const M_DEPT_MAKEKINMU_CHG As String = "NSC0000HA62" '計画画面[計画変更]
    Private Const M_DEPT_MAKEKINMU_RESULT As String = "NSC0000HA63" '計画画面[実績変更]
    Private Const M_DEPT_OVERTIME As String = "NSC0000HA64" '時間外状況
    Private Const M_DEPT_NENKYU As String = "NSC0000HA65" '年休状況
    Private Const M_DEPT_STAFFINFO As String = "NSC0000HA66" '職員情報設定
    Private Const M_DEPT_DEPTINFO As String = "NSC0000HA67" '勤務部署設定
    Private Const M_DEPT_KINMUINFO As String = "NSC0000HA68" '勤務状況
    Private Const M_DEPT_MAKEKINMU_NIGHTCREATE As String = "NSC0000HA69" '夜間自動勤務作成バッチ
    Private Const M_DEPT_OVERKINMUINFO As String = "NSC0000HA75" '超過勤務状態照会

    '未承認
    Private Const M_APPRO_DSP As String = "NSC0000HA70" '未承認一覧
    Private Const M_APPRO_ALLDSP As String = "NSC0000HA71" '全件表示

    Private Const M_APPRO_DAY_OVER As String = "NSC0000HAA1" '日別超勤
    Private Const M_APPRO_PERSONAL_OVER As String = "NSC0000HAA2" '個人別超勤
    Private Const M_APPRO_DAY_OVER_JISSEKI_CHG As String = "NSC0000HAA3" '実績詳細
    Private Const M_APPRO_DAY_OVER_APPROVE As String = "NSC0000HAA4" '承認操作
    Private Const M_APPRO_DAY_OVER_ALL_CHECK As String = "NSC0000HAA5" '全選択
    Private Const M_APPRO_DAY_OVER_NOT_CHECK As String = "NSC0000HAA6" '全解除
    Private Const M_APPRO_DAY_OVER_LOCK As String = "NSC0000HAA7" '確定（ロック）
    Private Const M_APPRO_DAY_OVER_LOCK_OUT As String = "NSC0000HAA8" '確定（解除）

    Private Const M_APPRO_APPLI_CHG As String = "NSC0000HA72" '届出詳細
    Private Const M_APPRO_APPLI_NEW As String = "NSC0000HA73" '届出入力
    Private Const M_APPRO_ALLAPPRO As String = "NSC0000HA74" '一括承認

    Private Const M_APPRO_DAYOVER As String = "NSC0000HA76" '日別超過勤務入力
    Private Const M_APPRO_DAYOVER_IN As String = "M_APPRO_DAYOVER_IN" '日別超過勤務入力画面用

    Private Const M_APPRO_DAYOVER_CHG As String = "NSC0000HA77" '日別時間外詳細

    '出退勤
    Private Const M_DAKOKU_DSP As String = "NSC0000HA80" '打刻状況
    Private Const M_DAKOKU_ERROR_DSP As String = "NSC0000HA81" 'エラー表示
    Private Const M_DAKOKU_JISSEKI_DSP As String = "NSC0000HA82" '実績詳細

    '日当直
    Private Const M_DUTY_MAKEDUTY As String = "NSC0000HA91" '日当直割当

    '職員管理
    Private Const M_STAFFIDO_BUSYO As String = "NSC2000HA26" '部署別ツリー
    Private Const M_STAFFIDO_HAICHI As String = "NSC2000HA27" '配置表イメージ
    Private Const M_STAFFIDO_KOJIN As String = "NSC2000HA03" '個人へジャンプ
    Private Const M_STAFFIDO_KIHON As String = "NSC2000HA25" '基本情報
    Private Const M_STAFFIDO_SINKI As String = "NSC2000HA20" '新規採用
    Private Const M_STAFFIDO_SEARCH As String = "NSC2000HA21" '職員検索
    Private Const M_STAFFIDO_FILE As String = "NSC2000HA22" 'ファイル出力
    Private Const M_STAFFIDO_IKKATSU As String = "NSC2000HA23" '一括取込
    Private Const M_STAFFIDO_STUDY As String = "NSC2000HA24" '研修申込
    Private Const M_STAFFIDO_ADD As String = "NSC2000HA50" '登録
    Private Const M_STAFFIDO_UPD As String = "NSC2000HA51" '変更
    Private Const M_STAFFIDO_DEL As String = "NSC2000HA52" '削除
    Private Const M_STAFFIDO_DELETE As String = "NSC2000HA28" '新規削除(全履歴削除)
    Private Const M_STAFFIDO_IINKAI As String = "NSC2000HA30" '委員会登録
    Private Const M_STAFFIDO_MENKYO As String = "NSC2000HA31" '免許登録
    Private Const M_STAFFIDO_SENMON As String = "NSC2000HA32" '専門学歴登録
    Private Const M_STAFFIDO_IINKAINITTEI As String = "NSC2000HA36" '委員会日程

    '+------------------------------------------------------------------------------------
    '|TreeView関連の固定値宣言
    '+------------------------------------------------------------------------------------
    '固定表示NodeのKey定数
    Private Const M_NodeKey_HOSP As String = "HOSP"
    Private Const M_NodeKey_LVL1 As String = "Level1"
    Private Const M_NodeKey_LVL2 As String = "Level2"
    Private Const M_NodeKey_LVL3 As String = "Level3"
    Private Const M_NodeKey_LVL4 As String = "Level4"
    Private Const M_NodeKey_LVL5 As String = "Level5"
    Private Const M_NodeKey_DEPT As String = "DEPT"

    '+------------------------------------------------------------------------------------
    '|ListView(職員一覧)関連の固定値宣言
    '+------------------------------------------------------------------------------------
    'ﾀﾌﾞIndex
    Private Const G_TAB_KINMUDEPT As Integer = 0
    Private Const G_TAB_DEPTSTAFF As Integer = 1
    Private Const G_TAB_WARDDEPT As Integer = 2
    Private Const G_TAB_POST As Integer = 3
    Private Const G_TAB_JOB As Integer = 4

    '+------------------------------------------------------------------------------------
    '|Splitter関連の固定値宣言
    '+------------------------------------------------------------------------------------
    Private Const M_PANENAME0 As String = "Dummy"
    Private Const M_PANENAME1 As String = "ToolBar"
    Private Const M_PANENAME2 As String = "Calender"
    Private Const M_PANENAME3 As String = "SearchDetail"
    Private Const M_PANENAME4 As String = "DeptList"
    Private Const M_PANENAME5 As String = "MainListView"
    Private Const M_PANENAME6 As String = "InfoMation"

    Private Const M_PANEWIDTH_CAL As Double = 3600 'Calender等の幅
    Private Const M_PANEHEIGHT_CAL As Double = 560 'Calenderの高さ
    Private Const M_PANEHEIGHT_CAL_BIG As Double = 3000 ' 2500        'Calenderの高さ
    Private Const M_PANEHEIGHT_INFO As Double = 500 'お知らせ情報の高さ
    Private Const M_PANEHEIGHT_CAL2 As Double = 1000 'Calenderの高さ２  

    '●【個人業務】 sptMain
    Private Const M_PER_PANEHEIGHT_JISSEKI_Small As Double = 580 '個人業務-[実績状況] 小さい画像用
    Private Const M_PER_PANEHEIGHT_APPLI_Small As Double = 580 '個人業務-[届出状況] 小さい画像用
    Private Const M_PER_PANEHEIGHT_HOL_Small As Double = 580 '個人業務-[休暇状況] 小さい画像用
    Private Const M_PER_PANEHEIGHT_JISSEKI_Large As Double = 2800 '個人業務-[実績状況] 大きい画像用
    Private Const M_PER_PANEHEIGHT_APPLI_Large As Double = 2200 '個人業務-[届出状況] 大きい画像用
    Private Const M_PER_PANEHEIGHT_HOL_Large As Double = 2200 '個人業務-[休暇状況] 大きい画像用
    '==========================================================================================================

    '●【個人業務】-休暇情報 sptPersonalHol
    Private Const M_PERSONALHOL_HEIGHT_LVW_Small As Double = 3000
    Private Const M_PERSONALHOL_HEIGHT_LVW_Large As Double = 3600
    Private Const M_PERSONALHOL_WIDTH_FRAME As Double = 4500

    '●【部署業務】
    Private Const M_DEP_PANEHEIGHT_Small As Double = 1600
    Private Const M_DEP_PANEHEIGHT_Large As Double = 2200

    '●【在院照会】
    Private Const M_STF_PANEHEIGHT As Double = 1200

    '●【職員管理】
    Private Const M_ZAI_PANEHEIGHT As Double = 800

    Private Const M_LISTWIDTH As Integer = 4000
    Private Const M_PERSONALWIDTH As Integer = 3500

    Private Const M_Change_BeforeDate As Integer = 0
    Private Const M_Change_AfterDate As Integer = 1

    'タスクバーの高さ
    Private m_numTaskBarHeight As Integer
    Private m_selectTimeMenuFlg As Boolean

    'ｶﾚﾝﾀﾞｰｺﾝﾄﾛｰﾙのﾊﾞｯｸｶﾗｰ
    Private Const M_CAL_BACKCOLOR As Integer = &H8000000F '平日の色

    Private m_CalDate As Date 'カレンダー日付
    Private m_DateFrom As Date '対象期間開始日
    Private m_DateTo As Date '対象期間終了日
    Private m_lngPutDateNum As Integer '対象期間日数
    Private m_lngKinmuDayCnt As Double '勤務日数
    Private m_lngTotalOverTime As Integer '時間外合計時間
    Private m_lngOverTime() As Integer '時間外合計時間(個別)
    Private m_lngKinmuTimeCnt As Integer '勤務合計時間

    Private m_strSelChildMenu As String '子画面ツールバーキー

    Private m_lngDefDeptIdx As Integer 'ツリービュー初期表示勤務部署インデックス

    Private m_strStartMode As String '計画画面表示モード
    Private m_lngPlanNo As Integer '選択計画番号

    Private m_blnKinmuDeptDspFlg As Boolean '個人業務表示時に勤務部署情報を表示するかどうか(【本人】→非表示 【部署】→ 表示)
    Private m_strDispMenu As String '表示中のメニューリソースID（部署業務から個人業務へ遷移したのか、出退勤から個人業務へ遷移したのか判断）

    Private m_intNowTab As Integer '現在選択されているタブ(職員管理用)
    Private m_DayOverSelectDate As Date '日別超過勤務入力用日付
    Private m_DayOverSelectFrom As Date '日別超過勤務入力用日付
    Private m_DayOverSelectTo As Date '日別超過勤務入力用日付

    '時間外リストビュー制御用
    Private m_objMouseMovePoint As New Point
    Private m_numBeforeSelectedItem As ListViewItem
    Private m_blnCheckedChangedFlg As Boolean

    '勤務部署ツリービュー表示
    Private m_StarMark As String
    '時間外用、現在選択計画番号
    Private m_currentSelPlanNo As Integer
    Private m_blnSelOverDay As Boolean  '時間外選択フラグ

    Private m_SmallIconDisp As New ImageList()      'お知らせアイコン
    Private m_numInformationNewDispTerm As Integer  'お知らせに【New】を表示させる期間

    '----------------------
    'スプレッド設定
    '----------------------
    Private Const M_MAXROW As Integer = 2
    Private Const M_MAXCOL As Integer = 3
    Private Const M_ROWHEIGHT As Integer = 20
    Private Const M_COLWIDTH As Integer = 90

    Private Const M_KINMUCNT_COL As Integer = 0 '勤務日数列
    Private Const M_OVERKINMU_COL As Integer = 1 '時間外合計列
    Private Const M_HEADER_ROW As Integer = 0 'ヘッダー行
    Private Const M_MEISAI_ROW As Integer = 1 '明細行

    Private Const M_KINMU_MAXCOL As Integer = 1 '最大列数
    Private Const M_KINMU_MAXROW As Integer = 6 '最大行数
    Private Const M_DATA_COL As Integer = 0 '１列固定
    Private Const M_KINMU_HEADER_ROW As Integer = 0 '勤務日数ヘッダー
    Private Const M_KINMU_ROW As Integer = 1 '勤務日数明細
    Private Const M_TIME_HEADER_ROW As Integer = 2 '勤務時間ヘッダー
    Private Const M_TIME_ROW As Integer = 3 '勤務時間明細
    Private Const M_OVER_HEADER_ROW As Integer = 4 '時間外ヘッダー
    Private Const M_OVER_ROW As Integer = 5 '時間外明細

    Private Const M_TANKA_MAXCOL As Integer = 1 '最大列数
    Private Const M_TANKA_MAXROW As Integer = 10 '最大行数
    Private Const M_TANKA_COL As Integer = 0 '１列固定
    Private Const M_DAY_HEADER_ROW As Integer = 0 '100/100ヘッダー
    Private Const M_DAY_ROW As Integer = 1 '100/100表示
    Private Const M_NOON_HEADER_ROW As Integer = 2 '125/100ヘッダー
    Private Const M_NOON_ROW As Integer = 3 '125/100表示
    Private Const M_WEEKDAYNIGHT_HEADER_ROW As Integer = 4 '150/100ヘッダー
    Private Const M_WEEKDAYNIGHT_ROW As Integer = 5 '150/100表示
    Private Const M_HOLIDAY_HEADER_ROW As Integer = 6 '135/100ヘッダー
    Private Const M_HOLIDAY_ROW As Integer = 7 '135/100表示
    Private Const M_HOLIDAYNIGHT_HEADER_ROW As Integer = 8 '160/100ヘッダー
    Private Const M_HOLIDAYNIGHT_ROW As Integer = 9 '160/100表示

    Private Const M_DAY_DATA As Integer = 1 '100/100データ
    Private Const M_NOON_DATA As Integer = 2 '125/100データ
    Private Const M_WEEKDAYNIGHT_DATA As Integer = 3 '150/100データ
    Private Const M_HOLIDAY_DATA As Integer = 4 '135/100データ
    Private Const M_HOLIDAYNIGHT_DATA As Integer = 5 '160/100データ

    '値格納配列要素数
    Private Const M_CHOUKINTIME150_DATA As Integer = 6 '150/100_2データ
    Private Const M_CHOUKINTIME175_DATA As Integer = 7 '170/100データ
    '2018-08-14 Darren ADD START
    Private Const M_CHOUKINTIME25_DATA As Integer = 8 '170/100データ
    '2018-08-14 Darren ADD END
    '追加スプレッド行番号
    Private Const M_CHOUKINTIME150_HEADER_ROW As Integer = 0 '150/100ヘッダー
    Private Const M_CHOUKINTIME150_ROW As Integer = 1 '150/100表示
    Private Const M_CHOUKINTIME175_HEADER_ROW As Integer = 2 '175/100ヘッダー
    Private Const M_CHOUKINTIME175_ROW As Integer = 3 '175/100表示
    '2018-08-14 Darren ADD START
    Private Const M_CHOUKINTIME25_HEADER_ROW As Integer = 4 '25/100ヘッダー
    Private Const M_CHOUKINTIME25_ROW As Integer = 5 '25/100表示
    '2018-08-14 Darren ADD END
    '2018-08-14 Darren UPDATE START
    'Private Const M_APR_YET_HEADER_ROW As Integer = 4 '未承認累計ヘッダー
    'Private Const M_APR_YET_ROW As Integer = 5 '未承認累計表示
    'Private Const M_APR_OVER_HEADER_ROW As Integer = 6 '承認済累計ヘッダー
    'Private Const M_APR_OVER_ROW As Integer = 7 '承認済累計表示
    Private Const M_APR_YET_HEADER_ROW As Integer = 6 '未承認累計ヘッダー
    Private Const M_APR_YET_ROW As Integer = 7 '未承認累計表示
    Private Const M_APR_OVER_HEADER_ROW As Integer = 8 '承認済累計ヘッダー
    Private Const M_APR_OVER_ROW As Integer = 9 '承認済累計表示
    '2018-08-14 Darren UPDATE END
    '値格納変数用
    Private m_lngAprYetData As Integer '未承認累計データ
    Private m_lngAprOverData As Integer '承認済累計データ
    '------------------------------
    'リストビューサブアイテム
    '------------------------------
    '【個人業務】- 実績状況
    Private Const M_PER_KINMUNM_J As Integer = 1 '勤務名称
    Private Const M_PER_DUTY_J As Integer = 2 '当直
    Private Const M_PER_KINMUTIME_J As Integer = 3 '勤務時間
    Private Const M_PER_OVERKINMU_J As Integer = 4 '時間外
    Private Const M_PER_DAKOKU_J As Integer = 5 '打刻情報
    Private Const M_MODE_HOPE As String = "1" '希望勤務

    '【個人業務】- 届出状況
    Private Const M_PER_STATUS_A As Integer = 1 '状態
    Private Const M_PER_NAME_A As Integer = 2 '届出名称
    Private Const M_PER_PERIOD_A As Integer = 3 '届出期間
    Private Const M_PER_APPLIDATE_A As Integer = 4 '申請日
    Private Const M_PER_CONTENS_A As Integer = 5 '内容

    '【部署業務】
    '勤務状況
    Private Const M_DEP_STAFFID As Integer = 1 '職員番号
    Private Const M_DEP_STAFFNM As Integer = 2 '氏名
    Private Const M_DEP_KINMUNM As Integer = 3 '勤務名称
    Private Const M_DEP_POSTNM As Integer = 4 '役職名称
    Private Const M_DEP_JOBNM As Integer = 5 '職種名称

    Private Const M_DEPOVER_STAFFID As Integer = 1 '職員番号
    Private Const M_DEPOVER_STAFFNM As Integer = 2 '職員氏名
    Private Const M_DEPOVER_100 As Integer = 3 '100/100
    Private Const M_DEPOVER_125 As Integer = 4 '125/100
    Private Const M_DEPOVER_150 As Integer = 5 '150/100
    Private Const M_DEPOVER_135 As Integer = 6 '135/100
    Private Const M_DEPOVER_160 As Integer = 7 '160/100
    Private Const M_DEPOVER_TOTAL As Integer = 8 '合計
    Private Const M_DEPOVER_APRYET As Short = 6 '未承認累計
    Private Const M_DEPOVER_APROVER As Short = 7 '承認済累計

    Private Const M_APR_MARK As Integer = 1 '制限時間出力記号
    Private Const M_APR_STAFFID As Integer = 2 '職員番号
    Private Const M_APR_STAFFNM As Integer = 3 '職員氏名
    Private Const M_APR_KINMUDEPT As Integer = 4 '勤務部署
    Private Const M_APR_APPLINM As Integer = 5 '届出名称
    Private Const M_APR_PERIOD As Integer = 6 '対象期間
    Private Const M_APR_DETAIL As Integer = 7 '詳細
    Private Const M_APR_APRYET As Short = 8 '未承認累計
    Private Const M_APR_APROVER As Short = 9 '承認済累計

    Private Const M_ALLAPR_MARK As Integer = 1 '制限時間出力記号
    Private Const M_ALLAPR_STAFFID As Integer = 2 '職員番号
    Private Const M_ALLAPR_STAFFNM As Integer = 3 '職員氏名
    Private Const M_ALLAPR_KINMUDEPT As Integer = 4 '勤務部署
    Private Const M_ALLAPR_APPLINM As Integer = 5 '届出名称
    Private Const M_ALLAPR_PERIOD As Integer = 6 '対象期間
    Private Const M_ALLAPR_DETAIL As Integer = 7 '詳細
    Private Const M_ALLAPR_APRYET As Short = 8 '未承認累計
    Private Const M_ALLAPR_APROVER As Short = 9 '承認済累計

    '【未承認】- 日別超過勤務入力
    Private Const M_DAYOVER_STAFFID As Integer = 1 '職員番号
    Private Const M_DAYOVER_STAFFNM As Integer = 2 '氏名
    Private Const M_DAYOVER_KINMU As Integer = 3 '開始　終了(勤務)
    Private Const M_DAYOVER_OVERKINMU As Integer = 4 '開始　終了(超勤務理由)
    Private Const M_DAYOVER_100 As Integer = 5 '100/100
    Private Const M_DAYOVER_125 As Integer = 6 '125/100
    Private Const M_DAYOVER_150 As Integer = 7 '150/100
    Private Const M_DAYOVER_135 As Integer = 8 '135/100
    Private Const M_DAYOVER_160 As Integer = 9 '160/100
    Private Const M_DAYOVER_MONTHTOTAL As Integer = 10 '月間合計

    '【出退勤】
    Private Const M_DAK_FROM As Integer = 1 '出勤
    Private Const M_DAK_TO As Integer = 2 '退勤
    Private Const M_DAK_STAFFID As Integer = 3 '職員番号
    Private Const M_DAK_STAFFNM As Integer = 4 '職員氏名
    Private Const M_DAK_KINMUNM As Integer = 5 '勤務名称
    Private Const M_DAK_PHS As Integer = 6 'PHS

    '【日当直】
    Private Const M_DUT_GROUPNM As Integer = 1 'グループ名称
    Private Const M_DUT_STAFFID As Integer = 2 '職員番号
    Private Const M_DUT_STAFFNM As Integer = 3 '氏名
    Private Const M_DUT_KINMUNM As Integer = 4 '勤務名称
    Private Const M_DUT_PHSNO As Integer = 5 'PHS番号

    '【在院照会】
    Private Const M_ZAI_STAFFID As Integer = 1 '職員番号
    Private Const M_ZAI_STAFFNM As Integer = 2 '氏名
    Private Const M_ZAI_KINMUNM As Integer = 3 '勤務名称
    Private Const M_ZAI_PHS As Integer = 4 'PHS番号

    Private Const M_SYO_STAFFID As Integer = 1 '職員番号
    Private Const M_SYO_STAFFNM As Integer = 2 '氏名
    Private Const M_SYO_STAFFKN As Integer = 3 'カナ
    Private Const M_SYO_KINMUNM As Integer = 4 '勤務部署
    Private Const M_SYO_WARDNM As Integer = 5 '配属部署
    Private Const M_SYO_POSTNM As Integer = 6 '役職
    Private Const M_SYO_JOBNM As Integer = 7 '職種
    Private Const M_SYO_POSTNM2 As Integer = 5 '役職（勤務＝配属）
    Private Const M_SYO_JOBNM2 As Integer = 6 '職種（勤務＝配属）

    '------------------------------
    'メニューボタン判定定数
    '------------------------------
    Private Const M_MAIN_HONNIN As String = "本人"
    Private Const M_MAIN_KINMUHYO As String = "勤務表"
    Private Const M_MAIN_JIKANGAI As String = "時間外"
    Private Const M_MAIN_MISHONIN As String = "未承認"
    Private Const M_MAIN_NITTOUTYOKU As String = "日当直"
    Private Const M_MAIN_STAFFMNG As String = "職員管理"
    Private Const M_MAIN_KENSYU As String = "研修登録"
    Private Const M_MAIN_SYUKEI As String = "集計設定"
    Private Const M_MAIN_SHIMEKIRI As String = "締切設定"
    Private Const M_MAIN_KOUMOKU As String = "項目設定"
    Private Const M_MAIN_OSHIRASE As String = "お知らせ設定"
    Private Const M_MAIN_HYOUKA As String = "評価項目設定"
    Private Const M_MAIN_FDOUTPUT As String = "ＦＤ出力設定"
    Private Const M_MAIN_ACCESSLOG As String = "アクセスログ設定"
    Private Const M_MAIN_COLOREDIT As String = "色設定"
    Private Const M_MAIN_MASTEREDIT As String = "マスタ設定"
    Private Const M_MAIN_KYOUTSU As String = "共通設定"
    Private Const M_MAIN_SECURITY As String = "セキュリティ"
    Private Const M_MAIN_SYONINKAISOU As String = "承認階層設定"
    Private Const M_MAIN_AVEKANJA As String = "平均患者数設定"
    Private Const M_MAIN_NITTOUTYOKUSTAFF As String = "日当直職員登録"

    '並列処理
    Private Const M_LIMIT_THREAD As Integer = 5    'この値と職員数の商でスレッド数を決定



    Private Const M_strSaiyoObject As String = "NSC0000HP02" 'オブジェクト名
    Private Const M_strMasterObject As String = "NSC0000HP01" 'オブジェクト名
    Private Const M_strKenmuObject As String = "NSC0000HP03" 'オブジェクト名
    Private Const M_strMenkyoObject As String = "NSC0000HP04" 'オブジェクト名
    Private Const M_strIinObject As String = "NSC0000HP06" 'オブジェクト名
    Private Const M_strGakurekiObject As String = "NSC0000HP07" 'オブジェクト名
    Private Const M_strSankyuObject As String = "NSC0000HP08" 'オブジェクト名
    Private Const M_strKazokuObject As String = "NSC0000HP09" 'オブジェクト名
    Private Const M_strStudyObject As String = "NSC0000HP10" 'オブジェクト名
    Private Const M_strLadderObject As String = "NSC0000HP13" 'オブジェクト名

    Private m_OldPlanNo As Integer
    Private m_bolCarenderFlg As Boolean

    '職員管理用
    Private m_DisplayMode As String '職員管理・表示モード(１：一覧、２：個人別)
    Private m_LoopFlg As Integer 'ループ防止用変数    

    Private Const M_strRetireCD As String = "RETIRE"
    Private Const M_strRetireName As String = "退職者"
    Private Const M_strNoConfCD As String = "NOCONF"
    Private Const M_strNoConfName As String = "未確定者"
    Private Const M_strSearchCD As String = "Search"
    Private Const M_strSearchName As String = "検索結果"


    Private m_dblLastUpdTime() As Double '最終更新日時(表示中のデータ)
    Private m_lngSEQ() As Integer '兼務用特殊
    Private m_strSEQ() As String '研修用特殊
    Private m_lngNendo() As Integer '研修用特殊
    Private m_strPlanFlg() As String '研修用特殊
    Private m_lngFromDate() As Integer '評価用特殊
    Private m_lngToDate() As Integer '評価用特殊
    Private m_lngDate() As Integer '評価用特殊

    Private Const M_strKinmuDept As String = "勤務部署" '勤務部署
    Private Const M_strWardDept As String = "配属部署" '配属部署
    Private Const M_strPost As String = "役職" '役職
    Private Const M_strJob As String = "職種" '職種

    Private Const M_strSelectID As String = "ID" 'キーID

    Private m_lngSelectListIndex As Integer '選択された職員の画面上のインデックス

    Private m_strSelectStaffMngID As String '選択された職員の職員管理番号
    Private m_strSelectStaffName As String '選択された職員の名前
    Private m_strSelectStaffID As String '選択された職員の職員番号
    Private m_strSelectResCD As String '選択された項目のリソースコード

    Private m_strObjectName As String '次画面名

    Private Const M_constIdoCD As Integer = 0 '異動情報　コード
    Private Const M_constIdoName As Integer = 1 '異動情報　名称
    Private Const M_constIdoDateFrom As Integer = 2 '異動情報　開始日
    Private Const M_constIdoDateTo As Integer = 3 '異動情報　終了日

    Private Const M_constKenmuDateFrom As Integer = 0 '兼務情報　開始日
    Private Const M_constKenmuDateTo As Integer = 1 '兼務情報　終了日
    Private Const M_constKenmuWardDeptCD As Integer = 2 '兼務情報　配属部署コード
    Private Const M_constKenmuWardDeptName As Integer = 3 '兼務情報　配属部署名称
    Private Const M_constKenmuKinmuDeptCD As Integer = 4 '兼務情報　勤務部署コード
    Private Const M_constKenmuKinmuDeptName As Integer = 5 '兼務情報　勤務部署名称
    Private Const M_constKenmuPostCD As Integer = 6 '兼務情報　役職コード
    Private Const M_constKenmuPostName As Integer = 7 '兼務情報　役職名称

    Private Const M_constEmpCD As Integer = 0 '採用情報　採用コード
    Private Const M_constEmpName As Integer = 1 '採用情報　採用名称
    Private Const M_constEmpDate As Integer = 2 '採用情報　採用年月日
    Private Const M_constRetireCD As Integer = 3 '採用情報　退職コード
    Private Const M_constRetireName As Integer = 4 '採用情報　退職名称
    Private Const M_constRetireDate As Integer = 5 '採用情報　退職年月日

    Private Const M_constMenkyoKbn As Integer = 0 '免許情報　免許区分
    Private Const M_constMenkyoName As Integer = 1 '免許情報　免許名称
    Private Const M_constMenkyoNo As Integer = 2 '免許情報　免許番号
    Private Const M_constMenkyoGetDate As Integer = 3 '免許情報　取得日
    Private Const M_constMenkyoBikou As Integer = 4 '免許情報　備考

    Private Const M_constShikakuCD As Integer = 0 '資格情報　資格コード
    Private Const M_constShikakuName As Integer = 1 '資格情報　資格名称
    Private Const M_constShikakuGetDate As Integer = 2 '資格情報　取得日
    Private Const M_constShikakuDateFrom As Integer = 3 '資格情報　開始日
    Private Const M_constShikakuDateTo As Integer = 4 '資格情報　終了日
    Private Const M_constShikakuBikou As Integer = 5 '資格情報　備考

    Private Const M_constSyokurekiCD As Integer = 0 '職種情報　職歴コード
    Private Const M_constSyokurekiName As Integer = 1 '職種情報　職歴名称
    Private Const M_constSyokurekiDateFrom As Integer = 2 '職種情報　開始日
    Private Const M_constSyokurekiDateTo As Integer = 3 '職種情報　終了日
    Private Const M_constSyokurekiMain As Integer = 4 '職種情報　勤務機関
    Private Const M_constSyokurekiBikou As Integer = 5 '職種情報　備考

    Private Const M_constIinCD As Integer = 0 '委員情報　委員コード
    Private Const M_constIinName As Integer = 1 '委員情報　委員名称
    Private Const M_constIinDateFrom As Integer = 2 '委員情報　開始日
    Private Const M_constIinDateTo As Integer = 3 '委員情報　終了日
    Private Const M_constIinBikou As Integer = 4 '委員情報　備考

    Private Const M_constChoukyuCD As Integer = 0 '長休情報　長休コード
    Private Const M_constChoukyuName As Integer = 1 '長休情報　長休名称
    Private Const M_constChoukyuDateFrom As Integer = 2 '長休情報　開始日
    Private Const M_constChoukyuDateTo As Integer = 3 '長休情報　終了日
    Private Const M_constChoukyuBikou As Integer = 4 '長休情報　備考

    Private Const M_constKyoukaiCD As Integer = 0 '協会情報　協会コード
    Private Const M_constKyoukaiName As Integer = 1 '協会情報　協会名称
    Private Const M_constKyoukaiBikou As Integer = 2 '協会情報　備考
    Private Const M_constKyoukaiDateFrom As Integer = 3 '協会情報　開始日

    Private Const M_constGakurekiKbnCD As Integer = 0 '学歴情報　学歴区分
    Private Const M_constGakurekiKbnName As Integer = 1 '学歴情報　学歴名称
    Private Const M_constGakurekiChiikiCD As Integer = 2 '学歴情報　地域コード
    Private Const M_constGakurekiChiikiName As Integer = 3 '学歴情報　地域名称
    Private Const M_constGakurekiLastKbn As Integer = 4 '学歴情報　最終学歴
    Private Const M_constGakurekiLastDate As Integer = 5 '学歴情報　卒業年月日
    Private Const M_constGakurekiSchoolCD As Integer = 6 '学歴情報　学校コード
    Private Const M_constGakurekiSchoolName As Integer = 7 '学歴情報　学校名称
    Private Const M_constGakurekiBikou As Integer = 8 '学歴情報　備考

    Private Const M_constKazokuName As Integer = 0 '家族情報　氏名
    Private Const M_constKazokuBirthday As Integer = 1 '家族情報　誕生日
    Private Const M_constKazokuTsudukiCD As Integer = 2 '家族情報　続柄コード
    Private Const M_constKazokuTsudukiName As Integer = 3 '家族情報　続柄名称
    Private Const M_constKazokuDoukyo As Integer = 4 '家族情報　同居区分
    Private Const M_constKazokuFuyou As Integer = 5 '家族情報　扶養区分
    Private Const M_constKazokuSeizon As Integer = 6 '家族情報　生存区分

    Private Const M_constSankyuYoteiDate As Integer = 0 '産休情報　予定出産日
    Private Const M_constSankyuSoutaiKbn As Integer = 1 '産休情報　双胎区分
    Private Const M_constSankyuYSanzenYamenFrom As Integer = 2 '産休情報　予定産前夜免開始日
    Private Const M_constSankyuYSanzenYamenTo As Integer = 3 '産休情報　予定産前夜免終了日
    Private Const M_constSankyuYSanzenKyukaFrom As Integer = 4 '産休情報　予定産前休暇開始日
    Private Const M_constSankyuYSanzenKyukaTo As Integer = 5 '産休情報　予定産前休暇終了日
    Private Const M_constSankyuYSangoKyukaFrom As Integer = 6 '産休情報　予定産後休暇開始日
    Private Const M_constSankyuYSangoKyukaTo As Integer = 7 '産休情報　予定産後休暇終了日
    Private Const M_constSankyuYIkujiKyukaFrom As Integer = 8 '産休情報　予定育児休暇開始日
    Private Const M_constSankyuYIkujiKyukaTo As Integer = 9 '産休情報　予定育児休暇終了日
    Private Const M_constSankyuKakuteiDate As Integer = 10 '産休情報　出産日
    Private Const M_constSankyuKSanzenYamenFrom As Integer = 11 '産休情報　確定産前夜免開始日
    Private Const M_constSankyuKSanzenYamenTo As Integer = 12 '産休情報　確定産前夜免終了日
    Private Const M_constSankyuKSanzenKyukaFrom As Integer = 13 '産休情報　確定産前休暇開始日
    Private Const M_constSankyuKSanzenKyukaTo As Integer = 14 '産休情報　確定産前休暇終了日
    Private Const M_constSankyuKSangoKyukaFrom As Integer = 15 '産休情報　確定産後休暇開始日
    Private Const M_constSankyuKSangoKyukaTo As Integer = 16 '産休情報　確定産後休暇終了日
    Private Const M_constSankyuKIkujiKyukaFrom As Integer = 17 '産休情報　確定育児休暇開始日
    Private Const M_constSankyuKIkujiKyukaTo As Integer = 18 '産休情報　確定育児休暇終了日

    Private m_Node As String 'ノード
    Private m_strNodeKey As String 'ノード
    Private m_LeftRightIdo As Integer 'ｸﾘｯｸ･ﾀﾞﾌﾞﾙｸﾘｯｸのときのﾎﾞﾀﾝ(異動一覧)
    Private m_IdoType As Integer '異動一覧表示ﾀｲﾌﾟ
    Private m_IdoBusyo(3) As String '異動一覧での選択部署(ｲﾝﾃﾞｯｸｽ,0:配属部署,1:勤務地,2:職種,3:役職)
    Private m_strAuthRangeKbn As String
    Private m_EndStatus As Boolean '終了状態(OK:True,ｷｬﾝｾﾙ:False)
    Private m_strRefreshList As String '個人⇒一覧に戻った時の再表示部署を退避させる
    Private m_blnSearchFlg As Boolean 'True:検索ボタン押下後 ,False;検索ボタン押下前
    Private m_selNoConfFlg As Boolean '未確定選択フラグ

    '画面背景色
    Private m_BackColor As String

    Private m_strDispDutyGroupCD As String
    Private m_strDispApplCD As String



    '----- 既存/新規ﾃﾞｰﾀ 定ﾌﾗｸﾞ(NewFlg)値 定義 --------------------------------------------------
    Private Const M_FlgOld As Integer = 0 '既存ﾃﾞｰﾀ
    Private Const M_FlgNew As Integer = 1 '新規ﾃﾞｰﾀ

    '----- 処理判定ﾌﾗｸﾞ(ProcFlg)値 定義 --------------------------------------------------
    Private Const M_FlgNon As Integer = 0 '無処理
    Private Const M_FlgInsert As Integer = 1 '追加処理
    Private Const M_FlgUpdate As Integer = 2 '更新処理
    Private Const M_FlgDelete As Integer = 3 '削除処理

    '----- 重複ﾁｪｯｸ結果値 定義 --------------------------------------------------
    Private Const M_ChkOk As Integer = 0 '重複なし
    Private Const M_ChkNg As Integer = 1 '重複

    '----- 日付編集ﾀｲﾌﾟ値 定義 --------------------------------------------------
    Private Const M_DateType1 As Integer = 0 'YYYY/MM/DD ﾀｲﾌﾟ
    Private Const M_DateType2 As Integer = 1 'YY/MM/DD-YY/MM/DD ﾀｲﾌﾟ

    Private Const M_TabJikoHyouka As Integer = 0 '自己評価Tab
    Private Const M_TabTaHyouka As Integer = 1 '他評価Tab

    Private Const M_Insert As Integer = 1 '新規登録
    Private Const M_Update As Integer = 2 '変更

    '基本情報画面起動ﾓｰﾄﾞ
    Private Const M_SHINKI As Integer = 0 '新規
    Private Const M_CHGTOROKU As Integer = 1 '変更

    Private m_lngSptHeight As Integer '表示時に使用

    Private m_strKinmuRef As String '勤務の参照権限
    Private m_strKinmuUpd As String '勤務の更新権限
    Private m_strOverKinmuRef As String '時間外の参照権限
    Private m_strOverKinmuUpd As String '時間外の更新権限
    Private m_strDakokuRef As String '出退勤の参照権限
    Private m_strDakokuUpd As String '出退勤の更新権限
    Private m_strDUTYRef As String '日当直管理の参照権限
    Private m_strDUTYUpd As String '日当直管理の更新権限

    Private m_blnDutyDispFlg As Boolean '日当直権限 True：参照以上 False：権限なし
    Private m_blnOverKinmuDispFlg As Boolean '時間外権限 True：参照以上 False：権限なし
    Private m_blnDakokuDispFlg As Boolean '打刻権限   True：参照以上 False：権限なし

    Private Const M_constAll As String = "0"
    Private Const M_constLv1 As String = "1"
    Private Const M_constLv2 As String = "2"
    Private Const M_constLv3 As String = "3"
    Private Const M_constLv4 As String = "4"
    Private Const M_constLv5 As String = "5"
    Private Const M_constKinmuDept As String = "9"
    Private Const M_constPersonal As String = "A"
    Private Const M_constNothing As String = "-"

    Private m_InformationUpdKbn As String

    'セキュリティチェック変数
    Private m_blnDataUpdCheckFlg As Boolean '職員管理で使用

    Private m_lngSelectDutyIdx As Integer '日当直ツリービューの選択値

    Private m_blnFormCloseFlg As Boolean '閉じるボタン:True、それ以外:False
    Private m_strBusyoHaichi As String '部署別:"1"、配置表:"2"
    Private Const M_DISP_BUSYO As String = "1" '部署
    Private Const M_DISP_HAICHI As String = "2" '配置
    Private m_blnStaffKihonInfo As Boolean 'true:表示ＯＫ、false:表示ＮＧ

    Private Const M_MAX_HAICHIROW1 As Integer = 18 ' 19    '列ヘッダ含む
    Private Const M_MAX_HAICHIROW2 As Integer = 5 '列ヘッダ含まない
    Private Const M_MAX_HAICHICOL As Integer = 4 ' 5 ' 6     '行ヘッダ含む

    Private Const M_HAICHI_ROWHEIGHT As Integer = 13 ' 11
    Private Const M_HAICHI_COLWIDTH As Integer = 16 ' 13

    Private m_lngAppliKikanMin As Integer '届出カレンダー期間Min
    Private m_lngAppliKikanMax As Integer '届出カレンダー期間Max
    Private Const M_CALENDARMAX As Integer = 20491231
    Private m_strAppliChange As String
    Private Const M_DISP_MISYONIN As String = "1" '未承認一覧/全件表示
    Private Const M_DISP_DAYOVER As String = "2" '日別時間外入力


    Private m_strSelHaichiKinmuDeptCD As String '配置表用選択勤務部署コード
    Private m_strSelHaichiStaffMngID As String '配置表用選択職員管理番号
    Private m_strSelHaichiStaffID As String '配置表用選択職員番号

    Private m_blnFirstDispFlg As Boolean '配置表用選択勤務部署コード

    Private Const M_POPUP_DELETE As Integer = 0 ' 2  'ﾎﾟｯﾌﾟｱｯﾌﾟ削除
    Private Const M_POPUP_OVERTITLE As Integer = 1 'ﾎﾟｯﾌﾟｱｯﾌﾟ 時間外命令簿タイトル
    Private Const M_POPUP_OVERPRINT As Integer = 2 'ﾎﾟｯﾌﾟｱｯﾌﾟ 時間外命令簿印刷
    Private Const M_POPUP_OVERPREVIEW As Integer = 3 'ﾎﾟｯﾌﾟｱｯﾌﾟ 時間外命令簿プレビュー
    Private Const M_POPUP_PERSONALTITLE As Integer = 4 'ﾎﾟｯﾌﾟｱｯﾌﾟ 個人カードタイトル
    Private Const M_POPUP_PERSONALPRINT As Integer = 5 'ﾎﾟｯﾌﾟｱｯﾌﾟ 個人カード印刷
    Private Const M_POPUP_PERSONALPREVIEW As Integer = 6 'ﾎﾟｯﾌﾟｱｯﾌﾟ 個人カードプレビュー

    Private Const M_LISTVIEW As String = "0" 'リストビューオブジェクト
    Private Const M_SPREAD As String = "1" 'スプレッドオブジェクト

    Private m_blnStaffDeleteFlg As Boolean '職員削除の権限を持つか否か

    Private m_blnGetMatrix As Boolean
    Private Const W_KAISU As String = "1"
    Private Const W_JIKAN As String = "2"

    Private m_strIkkatsuButton As String '委員会・免許一括登録ボタン (13：委員会　14：免許)
    Private m_LogOff_Chk As Boolean 'ログオフ判別用(True:ログオフ　False:他)

    Private m_ListView_Main As Integer
    Private m_ResCD_Kbn As Integer
    Private m_strSelBusyoCD As String
    Private m_strSelBusyoNM As String

    Private Const M_VERSION As Integer = 0

    Private m_DaikyuDate() As Integer
    Private m_blnHopeFlg As Boolean

    Private m_strOverKinmuDispType As String
    Private Const M_STR_DAY As String = "0"
    Private Const M_STR_PERSONAL As String = "1"

    Friend Const M_STRJIKANGAI As String = "001001"

    '0:アイコン無し,1:未承認前,2:未承認,3:自分承認済,4:確定済み
    Friend Const M_NO_ICON As String = "0"
    Friend Const M_NOT_APPROVE_BEFORE As String = "1"
    Friend Const M_OK_APPROVE As String = "2"
    Friend Const M_NOT_APPROVE_AFTER As String = "3"
    Friend Const M_NOT_APPROVE_DUE As String = "4"


    Dim m_objKinmuDept_page(4) As System.Windows.Forms.TabPage

    Dim lblDate As List(Of Label)
    Dim lblDate2 As List(Of Label)
    Dim lblDate3 As List(Of Label)

    Private m_OverKinmuFlg As Integer          '時間外データの出力フラグ（1：申請データ、0：承認データ）
    Private m_DetailTimeFlg As Integer          '本人画面の申請時間、承認済時間を表示するか（0：表示しない、1：表示する）


#End Region


#Region "構造体関連"

    '勤務実績情報（勤務部署表示時　１日分）
    Public Structure Kinmu_Type
        Dim strKinmuCD As String '勤務コード
        Dim strKinmuNm As String '勤務名称
        Dim strKinmuSecNm As String '勤務略称
        Dim strKinmuMark As String '勤務記号
        Dim strKinmuReasonKbn As String '勤務理由コード
        Dim strHalfKinmuFlg As String '半日勤務FLG
        Dim strKinmuFrom As String '勤務時間From
        Dim strKinmuTo As String '勤務時間To
        Dim strInputOKTimeChkFlg As String '超勤入力可否
    End Structure
    Private m_udtDayKinmuJisseki() As Kinmu_Type

    '時間外状況
    Private Structure OverKinmuTotal_Type
        Dim lng125 As Integer
        Dim lng150 As Integer
        Dim lng135 As Integer
        Dim lng160 As Integer
        Dim lng100 As Integer
        Dim lngTotal As Integer
        Dim lngBeforeHalf As Integer
        Dim lngAfterHalf As Integer
    End Structure
    Private m_udtOverKinmuTotal() As OverKinmuTotal_Type

    '------------------------------
    '子画面メニュー情報
    '------------------------------
    Private m_udtChildMenu() As ListBarMenu_Type


    '==========================
    '構造体：お知らせ情報
    '==========================
    Private Structure Infomation_Type
        Dim intDate As Integer '年月日
        Dim intFromDate As Integer '開始年月日
        Dim intToDate As Integer '終了年月日
        Dim strTitle As String 'タイトル
        Dim strContents As String '内容
        Dim strIMPORTANTKBN As String '重要度
        Dim strSEQ As String
    End Structure
    Private m_udtInformation() As Infomation_Type
    Private m_udtInformation2() As Infomation_Type

    '-------------------------
    '構造体：採用/異動情報
    '-------------------------
    <Serializable()> Public Structure IdoHistory_Type
        Dim strCD As String
        Dim lngStartDate As Integer
        Dim lngEndDate As Integer
    End Structure

    '-------------------------
    '構造体：時間外
    '-------------------------
    Public Structure OverKinmu_Type
        Dim lngDate As Integer '年月日
        Dim lngOKDate As Integer '超勤年月日
        Dim strKinmuCD As String '勤務コード
        Dim strDivisionFlg As String '分割フラグ
        Dim lngFromTime As Integer '開始時間
        Dim lngToTime As Integer '終了時間
        Dim strReasonCD As String '時間外理由コード
        Dim strReasonNm As String '時間外理由名称
        Dim strReasonSNm As String '時間外理由略称
        Dim strNextDayFlg As String '翌日フラグ
        Dim dblFirstDate As Double '初回登録年月日
        Dim dblLastUpdDate As Double '最終登録年月日
        Dim lngGetKbn As Integer '取得区分
        Dim strUNIQUESEQNO As String 'UNIQUESEQNO
        Dim strStateKbn As String '超勤状態区分'
        Dim strReasonText As String '備考       
    End Structure

    '------------------------------
    '構造体：職員情報
    '------------------------------
    <Serializable()> Public Structure Staff_Type
        Dim strStaffMngID As String '職員管理番号
        Dim strStaffID As String '職員番号
        Dim strName As String '職員氏名
        Dim strKana As String '職員カナ'
        Dim strSex As String '性別
        Dim strPHS As String 'PHS番号
        Dim SaiyoHistory() As IdoHistory_Type '採用歴
        Dim IdoHistory() As IdoHistory_Type '勤務部署異動歴
        Dim strPostCD As String '役職コード
        Dim strPostNm As String '役職名称
        Dim strJocCD As String '職種コード
        Dim strJocNm As String '職種名称
        Dim strKinmuDeptCD As String '勤務部署コード
        Dim strKinmuDeptName As String '勤務部署名称
        Dim strWardDeptCD As String '配属部署コード
        Dim strWardDeptName As String '配属部署名称
        Dim lngKinmuDeptNo As Integer '勤務部署表示順
        Dim lngWardDeptNo As Integer '配属部署表示順
        Dim lngPostNo As Integer '役職表示順
        Dim lngJobNo As Integer '職種表示順
        Dim lngStaffDispNo As Integer '職員表示順
    End Structure
    Private m_udtStaffData() As Staff_Type
    Private m_Personal() As Staff_Type

    Private m_udtKinmuDept() As DATABEAN.KinmuDept_Type
    Private m_udtWardDept() As DATABEAN.KinmuDept_Type
    Private m_udtJob() As DATABEAN.KinmuDept_Type
    Private m_udtPost() As DATABEAN.KinmuDept_Type

    '------------------------------
    '構造体：勤務実績
    '------------------------------
    Private Structure KinmuJisseki_Type
        Dim lngDate As Integer '年月日
        Dim strKinmuCD As String '勤務CD
        Dim strKinmuNm As String '勤務名称
        Dim strFromTime As String '正規開始時間
        Dim strToTime As String '正規終了時間
        Dim strOFromTime As String '時間外開始時刻
        Dim strOToTime As String '時間外終了時刻
        Dim strReasonCD As String '時間外理由CD
        Dim strReasonNm As String '時間外名称
        Dim strReasonSNm As String '時間外略称
        Dim blnOAnyData As Boolean '２件以上の場合はTrue
        Dim strInputOKTimeChkFlg As String '超勤入力可否
        Dim strUNIQUESEQNO As String
        Dim strAppliStaffMngID As String
        Dim lngAppliDate As Integer
        Dim lngApproveLevel As Integer
        Dim dblLastUpdDate As Double
        Dim strIconStatus As String '0:アイコン無し,1:未承認前,2:未承認,3:自分承認済,4:確定済み
        Dim strAppliApproveStatusKbn As String '申請者承認状態区分 2009/6/12 nishimura add
    End Structure
    Private m_udtKinmuData() As KinmuJisseki_Type

    '------------------------------
    '構造体：届出/承認
    '------------------------------
    Public Structure Application_Type
        Dim strUNIQUESEQNO As String 'UNIQUESEQNO
        Dim strAppliCD As String '届出コード
        Dim strAppliNm As String '届出名称
        Dim strAppliStaffMngID As String '申請者職員管理番号
        Dim strAppliStaffID As String '申請者職員番号
        Dim strAppliStaffName As String '申請者氏名
        Dim lngAppliDate As Integer '申請年月日
        Dim lngPeriodFromDate As Integer '期間開始年月日
        Dim lngPeriodToDate As Integer '期間終了年月日
        Dim lngFromTime As Integer '開始時間
        Dim lngToTime As Integer '終了時間
        Dim strNextDayFlg As String '翌日フラグ
        Dim strContents As String '内容
        Dim strReasonNote As String '理由
        Dim strAppliApproveStatusKbn As String '申請者承認状態区分
        Dim strAppliApproveStatusDisp As String '申請者承認状態表示
        Dim strComment As String 'コメント（ＨＥＡＤＥＲ）
        Dim strHanyouArea As String '汎用エリア
        Dim dblCancelDate As Double '破棄年月日
        Dim dblLastUpdTimeDate As Double '最終更新年月日
        Dim lngApproveClassLvl As Integer '承認階層レベル
        Dim strApproveStaffMngID As String '承認者職員管理番号
        Dim strApproveStaffID As String '承認者職員番号
        Dim strApproveStaffNm As String '承認者氏名
        Dim strApproveStatusKbn As String '承認状態区分(レベル別)
        Dim strApproveStatusDisp As String '承認状態表示(レベル別)
        Dim strScreenCtrlKbn As String '画面制御区分(0:汎用 1:年休 2:時間外)
        Dim strKinmuDeptCD As String '申請者の勤務部署コード
        Dim AprYetTimeTotal As Integer
        Dim AprOverTimeTotal As Integer
    End Structure
    Private m_udtAppliData() As Application_Type '【個人業務】- 届出
    Private m_udtApproveData() As Application_Type '【未承認業務】

    '------------------------------
    '構造体：【個人業務】- 日当直
    '------------------------------
    Private Structure DutyDetail_Type
        Dim strKinmuCD As String
        Dim strKinmuNm As String
        Dim strDutyGroupCD As String
    End Structure
    Private Structure Duty_Type
        Dim lngDate As Integer
        Dim Detail() As DutyDetail_Type
    End Structure
    Private m_udtDutyData() As Duty_Type

    '-------------------------------------
    '構造体：【日当直業務】- 日当直 1日用
    '-------------------------------------
    Private Structure DayDuty_Type
        Dim strStaffMngID As String '職員管理番号
        Dim strStaffID As String '職員番号
        Dim strName As String '氏名
        Dim strSex As String '性別
        Dim strPHS As String 'PHS番号
        Dim strKinmuCD As String '勤務コード
        Dim strKinmuNm As String '勤務名称
        Dim strGroupCD As String '日当直グループコード
        Dim strGroupNm As String '日当直グループ名称
        Dim blnZaiinFlg As Boolean '在院ﾌﾗｸﾞ
    End Structure
    Private m_udtDayDutyStaff() As DayDuty_Type

    '------------------------------
    '構造体：【個人業務】- 出退勤
    '------------------------------
    Private Structure DakokuDetail_Type
        Dim lngDakokuDate As Integer '打刻年月日
        Dim lngSEQ As Integer 'SEQ
        Dim lngTime As Integer '時刻
        Dim strKBN As String '区分
        Dim strKbnNm As String '区分名称
        Dim strTekiyoCD As String '摘要CD
        Dim strTekiyoNm As String '摘要名称
        Dim strManageFinish As String '処理済みフラグ
    End Structure
    Private Structure Dakoku_Type
        Dim Detail() As DakokuDetail_Type
        Dim blnZaiinFlg As Boolean '在院フラグ
        Dim strChkMsg() As String '打刻チェック内容
    End Structure
    Private m_udtDakokuData() As Dakoku_Type
    Private m_udtDayDakokuData() As Dakoku_Type '出退勤１日用

    '日別超過勤務入力
    Public Structure DayOverKinmu_Type
        Dim lng125Day As Integer
        Dim lng150Day As Integer
        Dim lng135Day As Integer
        Dim lng160Day As Integer
        Dim lng100Day As Integer
        Dim OverKinmuData() As OverKinmu_Type
        Dim AppliStaffMngID As String
        Dim AppliDate As Integer
        Dim UNIQUESEQNO As String
        Dim ApproveLevel As Integer
        Dim LastUpdDate As Double
        Dim IconStatus As String '0:アイコン無し,1:未承認前,2:未承認,3:自分承認済,4:確定済み
        Dim AprYetTimeTotal As Integer
        Dim AprOverTimeTotal As Integer
    End Structure
    Private m_udtDayOverKinmu() As DayOverKinmu_Type



    Private Structure StaffData_Type
        Dim ID As String
        Dim Name_Renamed As String
    End Structure
    Private m_StaffData() As StaffData_Type

    Private Structure Hyouka_Type
        Dim Kbn As String
        Dim Date_Renamed As Integer
    End Structure

    '構造体:自己評価
    Private Structure JikoHyouka_Type
        Dim NewFlg As Integer '既存/新規ﾃﾞｰﾀ 判定ﾌﾗｸﾞ
        Dim ProcFlg As Integer '処理 判定ﾌﾗｸﾞ
        Dim DispIndex As Integer 'ﾘｽﾄ表示時のｲﾝﾃﾞｯｸｽ
        Dim ByoinCD As String '病院CD
        Dim SyokuinNo As String '職員管理番号
        Dim HyoukaKikan As String '評価期間
        Dim Fromdate As Integer '評価期間開始年月日
        Dim Todate As Integer '評価期間終了年月日
        Dim JikoHyoukaDate As Integer '自己評価年月日
        Dim HyoukaLvCD As String '評価レベルCD
        Dim HyoukaLvNM As String '評価レベル名称
        Dim Lv1StaffMngID As String '第１評価者職員管理番号
        Dim Lv2StaffMngID As String '第２評価者職員管理番号
        Dim Lv3StaffMngID As String '第３評価者職員管理番号
        Dim Lv1StaffName As String '第１評価者職員氏名
        Dim Lv2StaffName As String '第２評価者職員氏名
        Dim Lv3StaffName As String '第３評価者職員氏名
        Dim Lv1StaffDate As Integer '第１評価者評価日
        Dim Lv2StaffDate As Integer '第２評価者評価日
        Dim Lv3StaffDate As Integer '第３評価者評価日
        Dim Lv1StaffCHGFlg As Boolean '第１評価者変更FLG
        Dim Lv2StaffCHGFlg As Boolean '第２評価者変更FLG
        Dim Lv3StaffCHGFlg As Boolean '第３評価者変更FLG
        Dim Lv1StaffClearFlg As Boolean '第１評価者削除FLG
        Dim Lv2StaffClearFlg As Boolean '第２評価者削除FLG
        Dim Lv3StaffClearFlg As Boolean '第３評価者削除FLG
        Dim PointAddDate As Integer '自己評価点数入力年月日
        Dim KakuteiKbn As String '確定区分(1：確定、それ以外：未確定)
        Dim Fdate As Double '初回登録日時
        Dim Ldate As Double '最終更新日時
        Dim UserID As String '登録者ID
    End Structure
    Private m_JikoHyouka() As JikoHyouka_Type

    '構造体:他評価Ｆ
    Private Structure TaHyouka_Type
        Dim NewFlg As Integer '既存/新規ﾃﾞｰﾀ 判定ﾌﾗｸﾞ
        Dim ProcFlg As Integer '処理 判定ﾌﾗｸﾞ
        Dim DispIndex As Integer 'ﾘｽﾄ表示時のｲﾝﾃﾞｯｸｽ
        Dim ByoinCD As String '病院CD
        Dim SyokuinNo As String '職員管理番号
        Dim HyoukaKikan As String '評価期間
        Dim Fromdate As Integer '評価期間開始年月日
        Dim Todate As Integer '評価期間終了年月日
        Dim JikoHyoukaDate As Integer '評価対象者の自己評価年月日(ｷｰ項目)
        Dim TaisyouStaffMngID As String '評価対象者職員番号
        Dim TaisyouStaffName As String '評価対象者氏名
        Dim TaisyouStaffBusyo As String '評価対象者の勤務部署
        Dim HyoukaLvCD As String '評価レベルCD
        Dim HyoukaLvNM As String '評価レベル名称
        Dim Lv1StaffMngID As String '第１評価者職員管理番号
        Dim Lv2StaffMngID As String '第２評価者職員管理番号
        Dim Lv3StaffMngID As String '第３評価者職員管理番号
        Dim Lv1StaffName As String '第１評価者職員氏名
        Dim Lv2StaffName As String '第２評価者職員氏名
        Dim Lv3StaffName As String '第３評価者職員氏名
        Dim Lv1StaffDate As Integer '第１評価者評価日
        Dim Lv2StaffDate As Integer '第２評価者評価日
        Dim Lv3StaffDate As Integer '第３評価者評価日
        Dim PointAddDate As Integer '対象者の評価日(点数入力日)
        Dim KakuteiKbn As String '確定区分(1：確定、それ以外：未確定)
        Dim Sintyoku As String '進捗(未/済/待)
        Dim HyoukaKbn As String '評価区分(1：自分が第１評価者、2：第２評価者、3：第３評価者)
        Dim Fdate As Double '初回登録日時
        Dim Ldate As Double '最終更新日時
        Dim UserID As String '登録者ID
    End Structure
    Private m_TaHyouka() As TaHyouka_Type

    '構造体：レベル名称
    Private Structure Level_Type
        Dim LvCD As String 'レベルCD
        Dim Name_Renamed As String 'レベル名称
    End Structure
    Private m_Level() As Level_Type

    '構造体：勤務部署
    Private Structure KangoM_Type
        Dim BusyoCD As String
        Dim BusyoNM As String
    End Structure
    Private m_KangoM() As KangoM_Type

    '構造体：期間
    Private Structure Kikan_Type
        Dim Fromdate As Integer
        Dim Todate As Integer
        Dim Kikan As String
    End Structure
    Private m_Kikan() As Kikan_Type

    '構造体:自己評価情報(自己評価ﾌｫｰﾑよりｾｯﾄ)格納ﾊﾞｯﾌｧ
    Private Structure UDDATEJIKOHYOUKA_Type
        Dim m_FromDate As Integer '重複ﾁｪｯｸ用
        Dim m_ToDate As Integer '変更ﾃﾞｰﾀ格納
        Dim m_HyoukaDate As Integer '変更ﾃﾞｰﾀ格納
        Dim m_LevelCD As String
    End Structure
    Private m_JIKOHYOUKABUF(1) As UDDATEJIKOHYOUKA_Type

    Private Structure MenuButton_Type
        Dim ResourceCD As String 'リソースコード
        Dim Title As String 'タイトル
        Dim ObjectName As String 'オブジェクト名称
        Dim ObjectKbn As String 'オブジェクト区分
        Dim SecResourceCD As String 'セキュリティリソースコード
        Dim strUpdAuthRangeKbn As String '更新権限範囲区分
        Dim strRefAuthRangeKbn As String '参照権限範囲区分
    End Structure
    Private m_MenuButton() As MenuButton_Type


    '配置表レイアウト用職員データ
    Private Structure HaichiStaff_Type
        Dim strStaffMngID As String
        Dim strStaffID As String
        Dim strStaffName As String
        Dim strDispNo As Integer
        Dim strEmpCD As String
        Dim strEmpName As String
        Dim strKinmuDeptCD As String
        Dim strKinmuDeptName As String
        Dim strWardDeptCD As String
        Dim strWardDeptName As String
        Dim strJobCD As String
        Dim strJobName As String
        Dim strPostCD As String
        Dim strPostName As String
        Dim strDispPostName As String
    End Structure

    Private Structure Haichi_Type
        Dim strKinmuDeptCD As String
        Dim strKinmuDeptName As String
        Dim Staff() As HaichiStaff_Type
        Dim lngSum1 As Integer
        Dim lngSum2 As Integer
    End Structure
    Private m_udtHaichiStaff() As Haichi_Type

    Private Structure Master_Type
        Dim strCD As String
        Dim strName As String
        Dim lngCnt As Integer
    End Structure
    Private m_udtJobM() As Master_Type
    Private m_udtEmpM() As Master_Type

    Private Structure HeaderData_Type
        Dim strName As String
        Dim strCD() As String
    End Structure

    Private m_strKangoshiCD() As HeaderData_Type
    Private m_strJosyuCD() As HeaderData_Type
    Private m_strDispPost() As HeaderData_Type


    '各集計項目の構造体
    Private Structure Ratio_Type
        Dim strKinmuCD As String '集計対象勤務 検索用文字列
        Dim sinRatio As Double '集計比率
    End Structure
    Private Structure MtrxType
        Dim BunruiCD As String '分類CD（必要人数、勤務回数等で比較する割当CD）
        Dim MtrxName As String '集計項目名
        Dim Calc() As Ratio_Type '勤務コードと比率
        Dim CntKbn As String '集計区分(1:集計比率 2:時間 3:累計)
    End Structure
    Private m_VMtrx() As MtrxType '縦集計
    Private m_lngVMtrxCnt() As Double '集計値

    Private Structure PrintData_Type
        Dim PrintResCD As String
        Dim PrintName As String
        Dim PrintObject As String
    End Structure
    Private m_strPrintData As PrintData_Type '右クリック帳票用リソースコード
    '------------------------------------
    '職員暦
    '------------------------------------
    Private Structure StaffHistory_Type
        Dim ID As String '職員ｺｰﾄﾞ
        Dim DeptCD As String '部署CD
        Dim No As Integer '表示NO
    End Structure
    Private m_StaffHistory() As StaffHistory_Type

    Private Structure Cyokin_Type
        Dim EndDay As String
        Dim HalfChk As String
        Dim HalfErr As String
        Dim MonthChk As String
        Dim MonthErr As String
    End Structure
    Private m_Cyokin As Cyokin_Type



    '時間外ロックオブジェクト取得
    Private Structure OverKinmuLock_Type
        Dim lngDate As Integer
        Dim strKinmuDeptCD As String
        Dim blnLockFlg As Boolean
        Dim dblLastUpdDate As Long
    End Structure
    Private m_udtOverKinmuLock() As OverKinmuLock_Type

    Private m_blnOverKinmuLockFlg As Boolean

    Private m_dayLockMark As String
    Private Structure Calc_CD_Type
        Dim strCD As String
        Dim strKBN As String
    End Structure
    Private Structure Time_Data_Type
        Dim lngDate As Integer
        Dim lngTime As Integer
    End Structure

#End Region





    'ログ出力用インスタンス
    Private ReadOnly appTrace As LogUtil.AppLogger = LogUtil.AppLogger.GetAppLogger(Me)

    Public Sub Pre_Load()
        Const W_SUBNAME As String = "NSC0000HA Pre_Load"

        Try
            'ログ出力用処理
            appTrace.SettingLogControlFlg()
            If appTrace.getLogControlFlg Then
                appTrace.SettingLogConfig()
                appTrace.MethodStart()
            End If

            'イメージパス
            g_ImagePath = General.paGetIniSetting(General.G_STRININAME, General.G_STRSECTION1, "ImagePath", My.Application.Info.DirectoryPath & "\" & "image\")
            'フォームアイコン 設定
            Me.Icon = New System.Drawing.Icon(g_ImagePath & "System.ico")
            'カレンダー年月日
            m_CalDate = Now

            m_OldPlanNo = 0


            '日別超過勤務入力用日付
            m_DayOverSelectDate = Now
            m_DayOverSelectFrom = New Date(Now.Year, Now.Month, 1)
            m_DayOverSelectTo = DateAdd(Microsoft.VisualBasic.DateInterval.Day, -1, DateAdd(Microsoft.VisualBasic.DateInterval.Month, 1, m_DayOverSelectFrom))

            g_strTargetStaffMngID = General.g_strUserMngID

            '届出カレンダー期間取得
            Call GetAppliKikan()

            '起動画面 判定 (0:ﾊﾟｽﾜｰﾄﾞ入力画面, 1:初期ﾒﾆｭｰ画面)
            If "1".Equals(General.paGetItemValue(General.G_STRMAINKEY1, General.G_STRSUBKEY1, "APSTARTFLG", "0", General.g_strHospitalCD)) OrElse "1".Equals(General.paGetSetting(General.G_SYSTEM_WIN7, General.G_STRMAINKEY1, "PSWDISPFLG", "0")) Then
                '初期画面の場合、施設情報を再取得する
                Call DataLoad()
                'APStartFlg初期化
                Call General.paSaveSetting(General.G_SYSTEM_WIN7, General.G_STRMAINKEY1, "PSWDISPFLG", "0")
            End If

            'ｱｸｾｽﾛｸﾞ管理フラグ(初期値は0)
            g_intAccessLogFlg = Integer.Parse(General.paGetItemValue(General.G_STRMAINKEY1, General.G_STRSUBKEY1, "ACCESSLOG", Convert.ToString(0), General.g_strHospitalCD))
            g_intUseNAVIFlg = Integer.Parse(General.paGetItemValue(General.G_STRMAINKEY1, General.G_STRSUBKEY1, "USENAVIFLG", Convert.ToString(0), General.g_strHospitalCD))

            m_blnFormCloseFlg = True
            m_blnFirstDispFlg = True
            m_strBusyoHaichi = M_DISP_BUSYO

            m_blnStaffDeleteFlg = False

            ReDim m_udtStaffData(0)

            m_strAppliChange = M_DISP_MISYONIN

            m_blnHopeFlg = False

            '看護単位M取得
            Call GetKangoM()

            '選択部署レジストリ読み込み
            '●選択勤務部署コード
            General.g_strSelKinmuDeptCD = General.paGetSetting(General.G_SYSTEM_WIN7 & "\" & General.G_STRMAINKEY1, "Current", "KINMUDEPTCD", "")
            '●選択勤務部署名称
            General.g_strSelKinmuDeptNm = General.paGetSetting(General.G_SYSTEM_WIN7 & "\" & General.G_STRMAINKEY1, "Current", "KINMUDEPTNM", "")

            '画面サイズ
            m_numTaskBarHeight = System.Windows.Forms.Screen.PrimaryScreen.Bounds.Height - System.Windows.Forms.Screen.GetWorkingArea(Me).Height
            If m_numTaskBarHeight = 0 Then
                m_numTaskBarHeight = 30
            End If
            Me.WindowState = System.Windows.Forms.FormWindowState.Maximized

            ReDim m_udtChildMenu(0)

            m_blnGetMatrix = True

            Call subSetLabelClear()

            Call subObjectVisibleFalse()

            'リストバー 設定
            Call sSetListBarMenu()

            'ツールバー 設定
            Call toolStrip_MAIN()

            'ｶﾚﾝﾀﾞｰ初期 表示
            'Load時処理　届出カレンダー処理後
            Call AidGeneral.subShowDateForm2()
            Call subSetControlList()
            Call setCustomCalendar()
            Call sSetCalendar()

            'お知らせ情報取得(NAVI有りでもお知らせ取得)
            Call sSetInformation()
            Call sGetInformation()

            'タブページの参照設定
            Call subSetvstKinmuDept_TabPages()

            AddHandler vstKinmuDept.DrawItem, AddressOf General.paTabControl_DrawItem_FontColorChange

            '勤務マスタ取得(全て)
            Call sGetKinmuM()

            m_strDispApplCD = "000000"
            Call GetApplMaster()

            '初期画面 ロード(利用者グループによって異なる)
            Call sDispFirstForm()

            '利用者ID
            lblUserID.Text = General.g_strUserID
            '利用者名称
            lblUserName.Text = General.g_strUserName
            '利用者所属部署名称
            lblUserDept.Text = General.g_strUserKinmuDeptNm

            m_blnFirstDispFlg = False

            '中央表示
            Call General.paDspCenter(Me)

            vseCover.Visible = True
            vseCover.Left = albMenu.Left
            vseCover.Width = Me.Width
            vseCover.Top = 97
            vseCover.Height = albMenu.Height
            fraDataGet.Left = vseCover.Width / 3
            fraDataGet.Top = vseCover.Height / 3
            Call vseCover.BringToFront()
            System.Windows.Forms.Application.DoEvents()

            'ログ出力用処理
            If appTrace.getLogControlFlg Then
                appTrace.MethodEnd()
            End If
        Catch ex As Exception
            Call General.paTrpMsg(Convert.ToString(Err.Number), W_SUBNAME)
        End Try
    End Sub

    'OnResizeのEventArgsを保持する
    Dim resizeEA As EventArgs = Nothing

    'フォームのサイズが変更した時
    Protected Overrides Sub OnResize(ByVal e As EventArgs)
        If resizeEA Is Nothing Then
            resizeEA = e
            AddHandler Application.Idle, AddressOf OnIdle
        End If
    End Sub

    'アプリケーションがアイドル状態になった時
    Private Sub OnIdle(ByVal s As Object, ByVal e As EventArgs)
        If Not (resizeEA Is Nothing) Then
            '基本クラスのOnResizeを呼び出す
            MyBase.OnResize(resizeEA)
            resizeEA = Nothing
            RemoveHandler Application.Idle, AddressOf OnIdle
        End If
    End Sub

    Private Sub Timer1_Tick(ByVal eventSender As System.Object, ByVal eventArgs As System.EventArgs) Handles Timer1.Tick

        '日付表示
        Dim txt As String = Me.GetFormattedDateText()

        If ToolStripStatusLabel2.Text.Equals(txt) = False Then
            ToolStripStatusLabel2.Text = txt
        End If

        '時刻表示
        txt = Me.GetFormattedTimeText

        If ToolStripStatusLabel3.Text.Equals(txt) = False Then
            ToolStripStatusLabel3.Text = txt
        End If
    End Sub

    Private Function GetFormattedDateText()
        Return Now.ToString("yyyy/MM/dd")
    End Function

    Private Function GetFormattedTimeText()
        Return Now.ToString("H:mm")
    End Function
    '================================================ここまで================================================================
    '届出カレンダー期間取得
    Private Sub GetAppliKikan()
        Const W_SUBNAME As String = "frmNSC0000HA SetAppliKikan"

        Try
            Dim w_SetKikan As Integer
            Dim w_Date As Date

            w_SetKikan = Integer.Parse(General.paGetItemValue(General.G_STRMAINKEY2, General.G_STRSUBKEY1, "INPUTMONTH", "2", General.g_strHospitalCD))
            w_Date = DateAdd(Microsoft.VisualBasic.DateInterval.Month, -(w_SetKikan - 1), Now)

            'min
            m_lngAppliKikanMin = Integer.Parse(Format(w_Date, "yyyyMM01"))
            'max
            m_lngAppliKikanMax = M_CALENDARMAX

        Catch ex As Exception
            Call General.paTrpMsg(Convert.ToString(Err.Number), W_SUBNAME)
            End
        End Try
    End Sub

    '============================
    '施設情報を取得
    '============================
    Private Sub DataLoad()
        Const W_SUBNAME As String = "NSC0000H DataLoad"

        Try
            Dim w_Int As Integer
            Dim w_DataCnt As Integer
            Dim w_Sql As String
            'DAOｵﾌﾞｼﾞｪｸﾄ
            Dim w_Rs As ADODB.Recordset
            'ﾌｨｰﾙﾄﾞｵﾌﾞｼﾞｪｸﾄ
            Dim w_病院CD_F As ADODB.Field
            Dim w_名称_F As ADODB.Field
            Dim w_システム開始日_F As ADODB.Field
            Dim w_システム開始ターム_F As ADODB.Field
            Dim w_計画単位_F As ADODB.Field
            Dim w_表示期間_F As ADODB.Field
            Dim w_REGISTFIRSTTIMEDATE_F As ADODB.Field
            Dim w_LASTUPDTIMEDATE_F As ADODB.Field
            Dim w_REGISTRANTID_F As ADODB.Field

            Dim w_strMsg() As String

            'Select文 編集
            w_Sql = "SELECT * FROM NS_COMMONINFO_M "
            w_Sql = w_Sql & "ORDER BY HOSPITALCD "
            w_Rs = General.paDBRecordSetOpen(w_Sql)

            '0件ﾃﾞｰﾀﾁｪｯｸ
            If w_Rs.RecordCount > 0 Then

                '*** With ｽﾃｰﾄﾒﾝﾄ開始 ***
                With w_Rs

                    'ﾃﾞｰﾀｶｳﾝﾄ
                    .MoveLast()
                    w_DataCnt = .RecordCount
                    .MoveFirst()

                    '病院CD等 退避配列 再定義
                    ReDim g_Kyotuinf(w_DataCnt)
                    'ﾌｨｰﾙﾄﾞｵﾌﾞｼﾞｪｸﾄ 生成
                    w_病院CD_F = .Fields("HOSPITALCD")
                    w_名称_F = .Fields("NAME")
                    w_システム開始日_F = .Fields("SYSFROMDAY")
                    w_システム開始ターム_F = .Fields("SYSFROMTERM")
                    w_計画単位_F = .Fields("PLANUNIT")
                    w_表示期間_F = .Fields("DISPPERIOD")
                    w_REGISTFIRSTTIMEDATE_F = .Fields("REGISTFIRSTTIMEDATE")
                    w_LASTUPDTIMEDATE_F = .Fields("LASTUPDTIMEDATE")
                    w_REGISTRANTID_F = .Fields("REGISTRANTID")

                    'ﾃﾞｰﾀ件数 繰り返し
                    For w_Int = 1 To w_DataCnt
                        '配列に格納
                        g_Kyotuinf(w_Int).ByoinCD = w_病院CD_F.Value
                        g_Kyotuinf(w_Int).Name = General.paGetDbFieldVal(w_名称_F, "")
                        g_Kyotuinf(w_Int).Sysdate = Integer.Parse(General.paGetDbFieldVal(w_システム開始日_F, 0))
                        g_Kyotuinf(w_Int).Systerm = Integer.Parse(General.paGetDbFieldVal(w_システム開始ターム_F, 0))
                        g_Kyotuinf(w_Int).Tani = General.paGetDbFieldVal(w_計画単位_F, "")
                        g_Kyotuinf(w_Int).Hyoji = General.paGetDbFieldVal(w_表示期間_F, "")
                        g_Kyotuinf(w_Int).Fdate = Long.Parse(General.paGetDbFieldVal(w_REGISTFIRSTTIMEDATE_F, 0))
                        g_Kyotuinf(w_Int).Ldate = Long.Parse(General.paGetDbFieldVal(w_LASTUPDTIMEDATE_F, 0))
                        g_Kyotuinf(w_Int).UserID = General.paGetDbFieldVal(w_REGISTRANTID_F, "")

                        '次ﾚｺｰﾄﾞへ移動
                        .MoveNext()

                    Next w_Int

                    '*** With ｽﾃｰﾄﾒﾝﾄ終了 ***
                End With
            Else
                '0件の場合
                '配列の初期化
                ReDim g_Kyotuinf(0)

                'ｴﾗｰﾒｯｾｰｼﾞ表示
                ReDim w_strMsg(1)
                w_strMsg(1) = "施設情報"
                Call General.paMsgDsp("NS0032", w_strMsg)
            End If

            'ｵﾌﾞｼﾞｪｸﾄ 削除
            w_Rs.Close()

        Catch ex As Exception
            Call General.paTrpMsg(Convert.ToString(Err.Number), W_SUBNAME)
        End Try
    End Sub

    Private Sub GetKangoM()
        Const W_SUBNAME As String = "Nssl001 GetKangoM"

        Try
            Dim w_Int As Integer

            ReDim m_KangoM(0)

            With General.g_objGetMaster
                .pHospitalCD = General.g_strHospitalCD

                .pKD_UserCD = ""
                .pKD_KinmuDeptCD = ""
                .pKN_GetKbn = 0
                .pKD_KijunDate = General.paGetDateIntegerFromDate(Now)

                If .mGetKinmuDept = False Then
                    '「全て」
                    m_KangoM(0).BusyoCD = "0000"
                    m_KangoM(0).BusyoNM = "すべて"

                Else
                    ReDim m_KangoM(.fKD_KinmuDeptCount)

                    '「全て」
                    m_KangoM(0).BusyoCD = "0000"
                    m_KangoM(0).BusyoNM = "すべて"

                    For w_Int = 1 To .fKD_KinmuDeptCount
                        .mKD_KinmuDeptIdx = w_Int

                        m_KangoM(w_Int).BusyoCD = .fKD_KinmuDeptCD
                        m_KangoM(w_Int).BusyoNM = .fKD_KinmuDeptName
                    Next w_Int

                End If

            End With

        Catch ex As Exception
            Call General.paTrpMsg(Convert.ToString(Err.Number), W_SUBNAME)
        End Try
    End Sub

    'ラベル初期設定
    Public Sub subSetLabelClear()
        Const W_SUBNAME As String = "frmNSC0000HA subSetLabelClear"

        Try
            lblDeptInfo.Text = ""
            lblKinmuDate.Text = ""
            lblSearchData.Text = ""
            lblDakokuDate.Text = ""
            lblZaiin.Text = ""
            lblDutyDate.Text = ""

        Catch ex As Exception
            Call General.paTrpMsg(Convert.ToString(Err.Number), W_SUBNAME)
        End Try
    End Sub
    Private Sub subObjectVisibleFalse()
        Try
            Dim w_PreErrorProc As String
            w_PreErrorProc = General.g_ErrorProc 'ﾌﾟﾛｼｰｼﾞｬ名の一時待避
            General.g_ErrorProc = "NSC0000HA subObjectVisibleFalse"

            vseMain.Visible = False
            PnlCalendar.Visible = False
            vseCalendar.Visible = False
            tvwPersonal.Visible = False
            tvwPersonal.Enabled = False
            tvwDuty.Visible = False
            lvwDeptInfo.Visible = False
            lvwMain.Visible = False
            vseInformation.Visible = False
            lvwInformation.Visible = False
            vstKinmuDept.Visible = False
            vstKinmuDept.Enabled = False
            vsePersonal.Visible = False
            vseDeptInfo.Visible = False
            vseApproveInfo.Visible = False
            vseDakokuInfo.Visible = False
            vseLadderInfo.Visible = False
            vseDutyInfo.Visible = False
            vseZaiin.Visible = False
            vseHaichi.Visible = False
            vsePersonalData.Visible = False

            sprKinmuCnt.Visible = False
            sprMatrix.Visible = False
            sprTanka.Visible = False
            sprOverTime.Visible = False
            imdFrom.Visible = False
            imdTo.Visible = False
            cmdPersonalFrom.Visible = False
            cmdPersonalTo.Visible = False
            cmdPersonalDataCalFrom.Visible = False
            cmdPersonalDataCalTo.Visible = False
            cmbStatus.Visible = False
            Label2.Visible = False
            Label3.Visible = False
            lblTime.Visible = False
            imtSelectTime.Visible = False

            General.g_ErrorProc = w_PreErrorProc '待避ﾌﾟﾛｼｰｼﾞｬ名を元に戻す

        Catch ex As Exception
            Throw
        End Try
    End Sub

    '===================================
    'リストバーメニュー 設定
    '===================================
    Private Sub sSetListBarMenu()
        Const W_SUBNAME As String = "NSC0000HA sSetListBarMenu"
        Try
            Dim w_lngLoop As Integer
            Dim w_lngLoop2 As Integer
            Dim w_lngGroupIdx As Integer
            Dim w_lstGroupIdx As System.Collections.ArrayList = New System.Collections.ArrayList

            w_lngGroupIdx = 0
            m_InformationUpdKbn = ""
            With albMenu

                '初期化(グループ/リストアイテムのクリア)
                .Items.Clear()
                'イメージサイズを調整
                albMenu.ImageScalingSize = New System.Drawing.Size(30, 30)
                'メニューを追加
                '初期表示画面選択用にリストにインデックスを格納
                w_lstGroupIdx.Add(w_lngGroupIdx)
                For w_lngLoop = 1 To UBound(g_MenuM)
                    Dim w_menuTitle As MenuToolStrip.MenuToolStripTitle = New MenuToolStrip.MenuToolStripTitle
                    w_menuTitle.AutoSize = False
                    w_menuTitle.Font = New Font("MS UI Gothic", 10, FontStyle.Bold)
                    w_menuTitle.Name = "MenuTitle" & w_lngLoop
                    w_menuTitle.Text = g_MenuM(w_lngLoop).strMenuNm
                    w_menuTitle.ImageTransparentColor = Color.Magenta
                    w_menuTitle.BackColor = System.Drawing.SystemColors.Control
                    w_menuTitle.Size = New Size(97, 20)
                    w_menuTitle.CheckOnClick = True
                    .Items.Add(w_menuTitle)
                    AddHandler w_menuTitle.Click, AddressOf albTitleButton_Click
                    For w_lngLoop2 = 1 To UBound(g_MenuM(w_lngLoop).ListBarMenu)
                        Dim w_subMenuTitle As ToolStripButton = New ToolStripButton
                        w_subMenuTitle.AutoSize = False
                        w_subMenuTitle.Font = New System.Drawing.Font("MS UI Gothic", 9.0!, System.Drawing.FontStyle.Bold)
                        w_subMenuTitle.ForeColor = Color.Blue
                        w_subMenuTitle.Image = System.Drawing.Image.FromFile(g_ImagePath & "MenuFolder.gif")
                        w_subMenuTitle.ImageTransparentColor = System.Drawing.Color.Magenta
                        w_subMenuTitle.Name = "subMenuTitle" & Convert.ToString(w_lngLoop) & "-" & Convert.ToString(w_lngLoop2)
                        w_subMenuTitle.RightToLeftAutoMirrorImage = True
                        w_subMenuTitle.ImageScaling = ToolStripItemImageScaling.SizeToFit

                        If 10 < g_MenuM(w_lngLoop).ListBarMenu(w_lngLoop2).strTitle.Length Then
                            w_subMenuTitle.Size = New System.Drawing.Size(97, 65)
                            w_subMenuTitle.Text = g_MenuM(w_lngLoop).ListBarMenu(w_lngLoop2).strTitle.Substring(0, 5) _
                                                    & vbCrLf _
                                                     & g_MenuM(w_lngLoop).ListBarMenu(w_lngLoop2).strTitle.Substring(5, g_MenuM(w_lngLoop).ListBarMenu(w_lngLoop2).strTitle.Length - 5)
                        Else
                            w_subMenuTitle.Size = New System.Drawing.Size(97, 50)
                            w_subMenuTitle.Text = g_MenuM(w_lngLoop).ListBarMenu(w_lngLoop2).strTitle
                        End If
                        w_subMenuTitle.TextImageRelation = System.Windows.Forms.TextImageRelation.ImageAboveText

                        AddHandler w_subMenuTitle.Click, AddressOf albMenuButton_Click

                        .Items.Add(w_subMenuTitle)
                        w_lngGroupIdx += 1

                        'お知らせの権限を取得
                        If g_MenuM(w_lngLoop).ListBarMenu(w_lngLoop2).strResCD = M_INFORMATION_RESCD Then
                            m_InformationUpdKbn = g_MenuM(w_lngLoop).ListBarMenu(w_lngLoop2).strUpdAuthRangeKbn
                        End If
                    Next
                    w_lstGroupIdx.Add(w_lngGroupIdx)
                Next

                .Items(0).PerformClick()

                '初期表示状態を設定
                .Items(w_lstGroupIdx(g_lngGroupIdx - 1) + g_lngListIdx).Select()
                .Items(w_lstGroupIdx(g_lngGroupIdx - 1) + g_lngListIdx).Image = System.Drawing.Image.FromFile(g_ImagePath & "MenuFolderOpen.GIF")

            End With

        Catch ex As Exception
            Call General.paTrpMsg(Convert.ToString(Err.Number), W_SUBNAME)
        End Try
    End Sub

    '=======================================
    'メインツールバー デフォルト設定
    '=======================================
    Private Sub toolStrip_MAIN()

        Const W_SUBNAME As String = "NSC0000HA toolStrip_MAIN"

        Try
            Dim w_Button As System.Windows.Forms.ToolStripButton
            Dim w_RegStr As String
            Dim w_strHosp As String
            Dim w_strApStartFlg As String

            With imlToolStrip
                '初期化
                .Images.Clear()

                .ImageSize = New System.Drawing.Size(40, 40)
                .Images.Add(System.Drawing.Image.FromFile(g_ImagePath & "\" & "終了.bmp"))
                '起動画面 判定 (0:ﾊﾟｽﾜｰﾄﾞ入力画面, 1:初期ﾒﾆｭｰ画面)
                .Images.Add(System.Drawing.Image.FromFile(g_ImagePath & "\" & "ログオフ.bmp"))
                '-----------------------------------------------
                .Images.Add(System.Drawing.Image.FromFile(g_ImagePath & "\" & "印刷.bmp"))

            End With

            With toolStrip
                '初期化
                .Items.Clear()

                .ImageList = imlToolStrip
                '1ﾎﾞﾀﾝ{ｽﾍﾟｰｽ}
                w_Button = New System.Windows.Forms.ToolStripButton()
                w_Button.ImageIndex = 0
                w_Button.Text = ""
                w_Button.Name = M_END_TOOL
                w_Button.ImageScaling = ToolStripItemImageScaling.None
                .Items.Add(w_Button)
                w_Button.ToolTipText = "終 了"

                '2ﾎﾞﾀﾝ{ログオフ}
                w_Button = New System.Windows.Forms.ToolStripButton()
                w_Button.ImageIndex = 1
                w_Button.Text = ""
                w_Button.Name = M_LOGOFF_TOOL
                w_Button.ImageScaling = ToolStripItemImageScaling.None
                .Items.Add(w_Button)
                w_Button.ToolTipText = "ログオフ"

                w_RegStr = General.G_SYSTEM_WIN7 & "\" & General.G_STRMAINKEY1
                w_strHosp = General.g_strHospitalCD
                w_strApStartFlg = General.paGetItemValue(General.G_STRMAINKEY1, General.G_STRSUBKEY1, "APSTARTFLG", "0", w_strHosp)
                If "1".Equals(w_strApStartFlg) Then
                    .Items.Item(M_LOGOFF_TOOL).Visible = False
                    menuFileLogOff.Visible = False
                End If
                '3ﾎﾞﾀﾝ{閉じる}
                w_Button = New System.Windows.Forms.ToolStripButton()
                w_Button.ImageIndex = 2
                w_Button.Text = ""
                w_Button.Name = M_PRINT_TOOL
                w_Button.ImageScaling = ToolStripItemImageScaling.None
                .Items.Add(w_Button)
                w_Button.ToolTipText = "印　刷"

            End With

        Catch ex As Exception
            Call General.paTrpMsg(Convert.ToString(Err.Number), W_SUBNAME)
        End Try
    End Sub

    '============================
    '各種 色番号を取得する
    '============================
    Private Sub sGetColorNo()
        Const W_SUBNAME As String = "NSC0000HA sGetColorNo"

        Try
            Dim w_StrReg As String

            '色情報のﾚｼﾞｽﾄﾘの設定
            w_StrReg = General.G_SYSTEM_WIN7 & "\" & General.G_STRMAINKEY1 & "\Current"

            '土曜日 文字/背景色
            g_Sat_ForeColor = Integer.Parse(General.paGetSetting(w_StrReg, "Color", "Saturday_Fore", Format(General.G_BLUE)))

            '日曜日 文字/背景色
            g_Sun_ForeColor = Integer.Parse(General.paGetSetting(w_StrReg, "Color", "Sunday_Fore", Format(General.G_PINK)))

            '祝日 文字/背景色
            g_Hol_ForeColor = Integer.Parse(General.paGetSetting(w_StrReg, "Color", "Holiday_Fore", Format(General.G_RED)))

        Catch ex As Exception
            Call General.paTrpMsg(Convert.ToString(Err.Number), W_SUBNAME)
        End Try
    End Sub

    '================================
    '時間外ロック情報 取得
    '================================
    Private Sub sGetOverKinmuLock()
        Const W_SUBNAME As String = "NSC0000HA sGetOverKinmuLock"

        Try
            Dim w_strSql As String
            Dim w_Rs As ADODB.Recordset
            Dim w_lngRecCnt As Integer
            Dim w_lngLoop As Integer
            Dim w_lngFrom As Integer
            Dim w_lngTo As Integer
            Dim w_TempDate As Date

            Dim w_Date_F As ADODB.Field
            Dim w_KinmuDeptCD_F As ADODB.Field
            Dim w_DueFlg_F As ADODB.Field
            Dim w_LDate_F As ADODB.Field

            '対象期間開始日
            w_TempDate = New Date(m_CalDate.Year, m_CalDate.Month, 1)
            w_lngFrom = General.DateUtil.paGetDateIntegerFromDate(w_TempDate)
            '対象期間終了日
            w_lngTo = General.DateUtil.paGetDateIntegerFromDate(DateAdd(Microsoft.VisualBasic.DateInterval.Day, -1,
                        DateAdd(Microsoft.VisualBasic.DateInterval.Month, 1,
                        General.DateUtil.paGetDateFromDateInteger(w_lngFrom))))

            '初期化
            ReDim m_udtOverKinmuLock(0)

            w_strSql = "SELECT"
            w_strSql = w_strSql & "  DATEF"
            w_strSql = w_strSql & " ,KINMUDEPTCD"
            w_strSql = w_strSql & " ,DUEFLG"
            w_strSql = w_strSql & " ,LASTUPDTIMEDATE"
            w_strSql = w_strSql & " FROM NS_OVERKINMULOCK_F "
            w_strSql = w_strSql & " WHERE HOSPITALCD  = '" & General.g_strHospitalCD & "'"
            w_strSql = w_strSql & " AND   DATEF      >= " & w_lngFrom
            w_strSql = w_strSql & " AND   DATEF      <= " & w_lngTo
            w_strSql = w_strSql & " ORDER BY DATEF, KINMUDEPTCD"

            'RecordSet ｵﾌﾞｼﾞｪｸﾄの作成
            w_Rs = General.paDBRecordSetOpen(w_strSql)

            If w_Rs.RecordCount <= 0 Then

            Else
                With w_Rs
                    .MoveLast()
                    w_lngRecCnt = .RecordCount
                    .MoveFirst()

                    w_Date_F = .Fields("DATEF")
                    w_KinmuDeptCD_F = .Fields("KINMUDEPTCD")
                    w_DueFlg_F = .Fields("DUEFLG")
                    w_LDate_F = .Fields("LASTUPDTIMEDATE")

                    '配列確保
                    ReDim m_udtOverKinmuLock(w_lngRecCnt)

                    For w_lngLoop = 1 To w_lngRecCnt

                        '●年月日
                        m_udtOverKinmuLock(w_lngLoop).lngDate = Integer.Parse(General.paGetDbFieldVal(w_Date_F, 0))
                        '●勤務部署コード
                        m_udtOverKinmuLock(w_lngLoop).strKinmuDeptCD = General.paGetDbFieldVal(w_KinmuDeptCD_F, "")
                        '●締めフラグ
                        m_udtOverKinmuLock(w_lngLoop).blnLockFlg = Integer.Parse(General.paGetDbFieldVal(w_DueFlg_F, 0))
                        '●最終更新日時
                        m_udtOverKinmuLock(w_lngLoop).dblLastUpdDate = Long.Parse(General.paGetDbFieldVal(w_LDate_F, 0))

                        .MoveNext()
                    Next w_lngLoop

                End With
            End If

            w_Rs.Close()
            w_Rs = Nothing

        Catch ex As Exception
            Call General.paTrpMsg(Convert.ToString(Err.Number), W_SUBNAME)
        End Try
    End Sub

    '================================
    'お知らせ情報 設定
    '================================
    Private Sub sSetInformation()
        Const W_SUBNAME As String = "NSC0000HA sSetInformation"

        Try
            lvwInformation.Location = New Point(3, 5)
            lvwInformation.Size = New System.Drawing.Size(912, 66)

        Catch ex As Exception
            Call General.paTrpMsg(Convert.ToString(Err.Number), W_SUBNAME)
        End Try
    End Sub

    '================================
    'お知らせ情報 取得
    '================================
    Private Sub sGetInformation()
        Const W_SUBNAME As String = "NSC0000HA sGetInformation"

        Try
            Dim w_strSql As String
            Dim w_Rs As ADODB.Recordset
            Dim w_lngRecCnt As Integer
            Dim w_lngLoop As Integer
            Dim w_intLoop2 As Integer
            Dim w_lngFrom As Integer
            Dim w_lngTo As Integer
            Dim w_str As String
            Dim w_Date As Date
            Dim w_WeekStr As String
            Dim w_Cnt As Integer
            Dim w_LItem As System.Windows.Forms.ListViewItem
            Dim w_column As System.Windows.Forms.ColumnHeader

            Dim w_Date_F As ADODB.Field
            Dim w_FromDate_F As ADODB.Field
            Dim w_ToDate_F As ADODB.Field
            Dim w_IMPORTANTKBN_F As ADODB.Field
            Dim w_GROUPCD_F As ADODB.Field
            Dim w_Title_F As ADODB.Field
            Dim w_Contents_F As ADODB.Field
            Dim w_SEQ_F As ADODB.Field

            Dim w_lngAddDate As Integer
            Const W_strGroupALL As String = "00000"
            w_Date = Now

            '対象期間開始日
            w_lngFrom = General.paGetDateIntegerFromDate(w_Date)
            '対象期間終了日
            w_lngAddDate = Integer.Parse(General.paGetItemValue(General.G_STRMAINKEY1, "DISPDATE", "INFORMATIONTERM", "7", General.g_strHospitalCD))
            w_lngTo = General.DateUtil.paGetDateIntegerFromDate(DateAdd(Microsoft.VisualBasic.DateInterval.Day, w_lngAddDate, w_Date))

            '初期化
            ReDim m_udtInformation(0)

            'NAVI有りの場合はNAVIの表定義を参照
            If g_intUseNAVIFlg = 1 Then
                w_strSql = "SELECT AA.TITLE"
                w_strSql = w_strSql & " ,AA.CONTENTS"
                w_strSql = w_strSql & " ,AA.UNIQUESEQNO"
                w_strSql = w_strSql & " ,AA.CATEGORYCD"
                w_strSql = w_strSql & " ,AA.IMPORTANTKBN"
                w_strSql = w_strSql & " ,AA.SENDERCD"
                w_strSql = w_strSql & " ,AA.FILENAME"
                w_strSql = w_strSql & " ,AA.DISPFROMDATE"
                w_strSql = w_strSql & " ,AA.DISPTODATE"
                w_strSql = w_strSql & " ,AA.KINMUDEPTCD"
                w_strSql = w_strSql & " ,HM.SECNAME"
                w_strSql = w_strSql & " FROM NS_INFORMATION_F AA"

                w_strSql = w_strSql & "      left OUTER join NS_HANYOU_M HM "
                w_strSql = w_strSql & "  on HM.HOSPITALCD = '" & General.g_strHospitalCD & "'"
                w_strSql = w_strSql & "      AND HM.MASTERID = 'E015' "
                w_strSql = w_strSql & "      AND HM.MASTERCD = AA.IMPORTANTKBN "

                w_strSql = w_strSql & " WHERE AA.HOSPITALCD = '" & General.g_strHospitalCD & "'"
                w_strSql = w_strSql & " AND AA.DISPFROMDATE <= " & w_lngFrom
                w_strSql = w_strSql & " AND (AA.DISPTODATE >= " & w_lngFrom
                w_strSql = w_strSql & "      OR AA.DISPTODATE = 99999999)"
                w_strSql = w_strSql & " ORDER BY AA.DISPFROMDATE"
            Else
                w_strSql = "SELECT AA.TITLE"
                w_strSql = w_strSql & " ,AA.CONTENTS"
                w_strSql = w_strSql & " ,AA.UNIQUESEQNO"
                w_strSql = w_strSql & " ,AA.DATEF"
                w_strSql = w_strSql & " FROM NS_INFORMATION_F      AA "
                w_strSql = w_strSql & " ,    NS_INFORMATIONGROUP_F GP "
                w_strSql = w_strSql & " WHERE AA.HOSPITALCD = '" & General.g_strHospitalCD & "'"
                w_strSql = w_strSql & " AND AA.DATEF >= " & w_lngFrom
                w_strSql = w_strSql & " AND AA.DATEF <= " & w_lngTo
                w_strSql = w_strSql & " AND GP.HOSPITALCD = AA.HOSPITALCD "
                w_strSql = w_strSql & " AND GP.UNIQUESEQNO = AA.UNIQUESEQNO "
                w_strSql = w_strSql & " AND ( GP.GROUPCD = '" & General.g_strUserGroupCD & "' "
                w_strSql = w_strSql & " OR    GP.GROUPCD = '" & W_strGroupALL & "') "
                w_strSql = w_strSql & " ORDER BY AA.DATEF, GP.SEQ"
            End If

            'RecordSet ｵﾌﾞｼﾞｪｸﾄの作成
            w_Rs = General.paDBRecordSetOpen(w_strSql)

            If w_Rs.RecordCount <= 0 Then

            Else
                With w_Rs
                    .MoveLast()
                    w_lngRecCnt = .RecordCount
                    .MoveFirst()
                    If g_intUseNAVIFlg = 1 Then
                        'NAVI有りの場合
                        w_FromDate_F = .Fields("DISPFROMDATE")
                        w_ToDate_F = .Fields("DISPTODATE")
                        w_Title_F = .Fields("TITLE")
                        w_Contents_F = .Fields("CONTENTS")
                        w_IMPORTANTKBN_F = .Fields("SECNAME")
                        w_SEQ_F = .Fields("UNIQUESEQNO")

                        '配列確保
                        ReDim m_udtInformation2(w_lngRecCnt)

                        For w_lngLoop = 1 To w_lngRecCnt
                            If w_Rs.RecordCount <= 0 Then
                            Else

                                '●年月日
                                m_udtInformation2(w_lngLoop).intFromDate = Integer.Parse(General.paGetDbFieldVal(w_FromDate_F, 0))
                                m_udtInformation2(w_lngLoop).intToDate = Integer.Parse(General.paGetDbFieldVal(w_ToDate_F, 0))
                                '●タイトル
                                m_udtInformation2(w_lngLoop).strTitle = w_Title_F.Value & ""
                                '内容
                                m_udtInformation2(w_lngLoop).strContents = w_Contents_F.Value & ""
                                '重要度
                                m_udtInformation2(w_lngLoop).strIMPORTANTKBN = w_IMPORTANTKBN_F.Value & ""

                                m_udtInformation2(w_lngLoop).strSEQ = w_SEQ_F.Value & ""

                                .MoveNext()
                            End If
                        Next w_lngLoop

                        w_Rs.Close()
                        w_Rs = Nothing

                        '対象のグループコードかチェック
                        ReDim m_udtInformation(0)
                        w_Cnt = 0
                        For w_lngLoop = 1 To UBound(m_udtInformation2)
                            w_strSql = "SELECT GROUPCD "
                            w_strSql = w_strSql & " FROM NS_INFORMATIONGROUP_F "
                            w_strSql = w_strSql & " WHERE HOSPITALCD = '" & General.g_strHospitalCD & "'"
                            w_strSql = w_strSql & " AND   UNIQUESEQNO = '" & m_udtInformation2(w_lngLoop).strSEQ & "'"

                            w_Rs = General.paDBRecordSetOpen(w_strSql)

                            If w_Rs.RecordCount <= 0 Then
                                '全くデータが存在しない場合はグループコード指定していないものとする
                                w_Cnt = w_Cnt + 1
                                ReDim Preserve m_udtInformation(w_Cnt)
                                m_udtInformation(w_Cnt) = m_udtInformation2(w_lngLoop)
                            Else
                                'データが存在する場合
                                w_lngRecCnt = w_Rs.RecordCount
                                w_GROUPCD_F = w_Rs.Fields("GROUPCD")
                                For w_intLoop2 = 1 To w_lngRecCnt
                                    If w_GROUPCD_F.Value = General.g_strUserGroupCD OrElse
                                        w_GROUPCD_F.Value = W_strGroupALL Then

                                        'グループコードが一致する場合
                                        w_Cnt = w_Cnt + 1
                                        ReDim Preserve m_udtInformation(w_Cnt)
                                        m_udtInformation(w_Cnt) = m_udtInformation2(w_lngLoop)
                                    Else
                                        'グループコードが不一致
                                    End If
                                    w_Rs.MoveNext()
                                Next w_intLoop2

                            End If
                        Next w_lngLoop

                    Else
                        w_Date_F = .Fields("DATEF")
                        w_Title_F = .Fields("TITLE")
                        w_Contents_F = .Fields("CONTENTS")
                        w_SEQ_F = .Fields("UNIQUESEQNO")

                        '配列確保
                        ReDim m_udtInformation(w_lngRecCnt)

                        For w_lngLoop = 1 To w_lngRecCnt

                            '●年月日
                            m_udtInformation(w_lngLoop).intDate = Integer.Parse(General.paGetDbFieldVal(w_Date_F, 0))
                            '●タイトル
                            m_udtInformation(w_lngLoop).strTitle = w_Title_F.Value & ""
                            '内容
                            m_udtInformation(w_lngLoop).strContents = w_Contents_F.Value & ""

                            m_udtInformation(w_lngLoop).strSEQ = w_SEQ_F.Value & ""

                            .MoveNext()
                        Next w_lngLoop
                    End If
                End With
            End If

            w_Rs.Close()
            w_Rs = Nothing

            '----------------------
            'リストにセットする
            '----------------------
            'クリア
            lvwInformation.Items.Clear()
            lvwInformation.Columns.Clear()
            lvwInformation.Visible = False
            lvwInformation.Alignment = System.Windows.Forms.ListViewAlignment.Top
            lvwInformation.View = System.Windows.Forms.View.Details
            lvwInformation.LabelEdit = False
            lvwInformation.Scrollable = True
            lvwInformation.GridLines = True

            If g_intUseNAVIFlg = 1 Then

                'アイコンの設定
                '1回でも読み込んでいればOK
                If m_SmallIconDisp.Images.Count <= 0 Then
                    With m_SmallIconDisp
                        .Images.Clear()
                        .ImageSize = New Size(30, 15)
                        .Images.Add("NEW", System.Drawing.Image.FromFile(g_ImagePath & "ImageNew.gif"))
                        .ColorDepth = ColorDepth.Depth32Bit
                    End With
                End If

                'イメージアイコンの設定
                lvwInformation.SmallImageList = m_SmallIconDisp

                '項目設定取得 お知らせに【New】を表示させる期間
                m_numInformationNewDispTerm = General.paGetItemValue(General.G_STRMAINKEY1, General.G_STRSECTION1, "INFORMATIONNEWDISPTERM", 0, General.g_strHospitalCD)

                'カラムの設定
                w_column = lvwInformation.Columns.Add("InforNewMark", "お知らせ情報最新マーク", Integer.Parse(General.paTwipsTopixels(500)), System.Windows.Forms.HorizontalAlignment.Left, "")

                w_column = lvwInformation.Columns.Add("importance", "重要度", Integer.Parse(General.paTwipsTopixels(950)), System.Windows.Forms.HorizontalAlignment.Left, "")
                'スクロールバーの表示非表示でカラムの幅を調整
                If UBound(m_udtInformation) > 4 Then
                    lvwInformation.Scrollable = True
                    w_column = lvwInformation.Columns.Add("Information", "お知らせ情報", System.Windows.Forms.Screen.PrimaryScreen.Bounds.Width - Integer.Parse(General.paTwipsTopixels(7300)), System.Windows.Forms.HorizontalAlignment.Left, "")
                Else
                    lvwInformation.Scrollable = False
                    w_column = lvwInformation.Columns.Add("Information", "お知らせ情報", System.Windows.Forms.Screen.PrimaryScreen.Bounds.Width - Integer.Parse(General.paTwipsTopixels(6900)), System.Windows.Forms.HorizontalAlignment.Left, "")
                End If


                For w_lngLoop = 1 To UBound(m_udtInformation)


                    '年月日
                    w_Date = General.paGetDateFromDateInteger(m_udtInformation(w_lngLoop).intFromDate)
                    Select Case w_Date.DayOfWeek
                        Case DayOfWeek.Sunday
                            w_WeekStr = "日"
                        Case DayOfWeek.Monday
                            w_WeekStr = "月"
                        Case DayOfWeek.Tuesday
                            w_WeekStr = "火"
                        Case DayOfWeek.Wednesday
                            w_WeekStr = "水"
                        Case DayOfWeek.Thursday
                            w_WeekStr = "木"
                        Case DayOfWeek.Friday
                            w_WeekStr = "金"
                        Case DayOfWeek.Saturday
                            w_WeekStr = "土"
                    End Select
                    w_str = General.paGetDateStringFromInteger(m_udtInformation(w_lngLoop).intFromDate) & "(" & w_WeekStr & ")"
                    'タイトル
                    w_str = w_str & Space(2) & m_udtInformation(w_lngLoop).strTitle
                    '内容
                    w_str = w_str & "：" & m_udtInformation(w_lngLoop).strContents

                    'NEWかどうかの判定を追加する！
                    If DateTime.Now.Subtract(w_Date).Days <= m_numInformationNewDispTerm Then
                        w_LItem = lvwInformation.Items.Add("Key" & w_lngLoop, "", 0)
                    Else
                        w_LItem = lvwInformation.Items.Add("Key" & w_lngLoop, "", 1)
                    End If

                    '重要度
                    If w_LItem.SubItems.Count > 1 Then
                        w_LItem.SubItems(1).Text = m_udtInformation(w_lngLoop).strIMPORTANTKBN
                    Else
                        w_LItem.SubItems.Insert(1, New System.Windows.Forms.ListViewItem.ListViewSubItem(Nothing, m_udtInformation(w_lngLoop).strIMPORTANTKBN))
                    End If

                    If w_LItem.SubItems.Count > 2 Then
                        w_LItem.SubItems(2).Text = w_str
                    Else
                        w_LItem.SubItems.Insert(2, New System.Windows.Forms.ListViewItem.ListViewSubItem(Nothing, w_str))
                    End If

                    w_LItem.ForeColor = System.Drawing.Color.Black

                    w_LItem.Tag = Convert.ToString(w_lngLoop)
                Next
            Else
                'スクロールバーの表示非表示でカラムの幅を調整
                If UBound(m_udtInformation) > 4 Then
                    lvwInformation.Scrollable = True
                    w_column = lvwInformation.Columns.Add("Information", "お知らせ情報", System.Windows.Forms.Screen.PrimaryScreen.Bounds.Width - Integer.Parse(General.paTwipsTopixels(5850)), System.Windows.Forms.HorizontalAlignment.Left, "")
                Else
                    lvwInformation.Scrollable = False
                    w_column = lvwInformation.Columns.Add("Information", "お知らせ情報", System.Windows.Forms.Screen.PrimaryScreen.Bounds.Width - Integer.Parse(General.paTwipsTopixels(5450)), System.Windows.Forms.HorizontalAlignment.Left, "")
                End If

                For w_lngLoop = 1 To UBound(m_udtInformation)

                    '年月日
                    w_Date = General.paGetDateFromDateInteger(m_udtInformation(w_lngLoop).intDate)
                    w_str = General.paFormatZero(w_Date.Day, 2) & "日"
                    'タイトル
                    w_str = w_str & Space(2) & m_udtInformation(w_lngLoop).strTitle

                    '内容
                    w_str = w_str & "：" & m_udtInformation(w_lngLoop).strContents

                    w_LItem = lvwInformation.Items.Add("Key" & w_lngLoop, w_str, "")
                    w_LItem.ForeColor = System.Drawing.Color.Black

                    w_LItem.Tag = Convert.ToString(w_lngLoop)
                Next
            End If

        Catch ex As Exception
            Call General.paTrpMsg(Convert.ToString(Err.Number), W_SUBNAME)
        End Try
    End Sub

    '====================================
    '勤務名称マスタ（全て） 取得
    '====================================
    Private Sub sGetKinmuM()
        Const W_SUBNAME As String = "NSC0000HA sGetKinmuM"

        Try
            Dim w_lngRecCnt As Integer
            Dim w_lngLoop As Integer


            '初期化
            ReDim g_KinmuM(0)

            With General.g_objGetMaster
                .pHospitalCD = General.g_strHospitalCD
                .pKN_GetKbn = 0 '全体
                If .mGetKinmuNameM = False Then

                Else
                    '件数
                    w_lngRecCnt = .fKN_KinmuCount
                    ReDim g_KinmuM(w_lngRecCnt)

                    For w_lngLoop = 1 To w_lngRecCnt
                        '索引
                        .mKN_KinmuIdx = w_lngLoop

                        '●勤務コード
                        g_KinmuM(w_lngLoop).strCD = .fKN_KinmuCD
                        '●名称
                        g_KinmuM(w_lngLoop).strName = .fKN_Name
                        '●記号
                        g_KinmuM(w_lngLoop).strMark = .fKN_MarkF
                        '●表示順
                        g_KinmuM(w_lngLoop).lngDispNo = .fKN_DispNo
                        '●勤務区分
                        g_KinmuM(w_lngLoop).strKinmuKbn = .fKN_KinmuKbn
                        '●勤務分類CD
                        g_KinmuM(w_lngLoop).strKinmuBunruiCD = .fKN_KinmuBunruiCD
                        '●半日勤務フラグ
                        g_KinmuM(w_lngLoop).strHalfFlg = .fKN_HalfKinmuFlg
                        '●AM勤務コード
                        g_KinmuM(w_lngLoop).strAMKinmuCD = .fKN_AMKinmuCD
                        '●PM勤務コード
                        g_KinmuM(w_lngLoop).strPMKinmuCD = .fKN_PMKinmuCD
                        '●代休取得フラグ
                        g_KinmuM(w_lngLoop).strGtDaikyuFlg = .fKN_GetDaikyuFlg
                        '●時間休フラグ
                        g_KinmuM(w_lngLoop).strGetTimeHolFlg = .fKN_TimeHolFlg
                        '●勤務グループコード
                        g_KinmuM(w_lngLoop).strKinmuGroupCD = .fKN_KinmuGrpCD
                        '●休み分類コード
                        g_KinmuM(w_lngLoop).strHolBunruiCD = .fKN_HolidayBunruiCD

                    Next w_lngLoop

                End If
            End With

        Catch ex As Exception
            Call General.paTrpMsg(Convert.ToString(Err.Number), W_SUBNAME)
        End Try
    End Sub

    '承認マスタ取得
    Public Sub GetApplMaster()
        Const W_SUBNAME As String = "frmNSC0000HA GetApplMaster"

        Try
            Dim w_lngRecCnt As Integer
            Dim w_lngLoop As Integer

            Dim w_strSql As String
            Dim w_Rs As ADODB.Recordset
            Dim w_CD_F As ADODB.Field
            Dim w_Name_F As ADODB.Field
            Dim w_SecName_F As ADODB.Field
            Dim w_DispNo_F As ADODB.Field

            Dim w_intIndex As Integer
            w_intIndex = 0


            cmbSelectAppl.Items.Clear()
            cmbPersonalAppli.Items.Clear()
            cmbStatus.Items.Clear()
            ReDim g_ApplMaster(0)

            w_strSql = "SELECT "
            w_strSql = w_strSql & "   APPLICD "
            w_strSql = w_strSql & " , NAME "
            w_strSql = w_strSql & " , SECNAME "
            w_strSql = w_strSql & " , DISPNO "
            w_strSql = w_strSql & "  FROM  NS_APPLICATION_M "
            w_strSql = w_strSql & "  WHERE  HOSPITALCD = '" & General.g_strHospitalCD & "' "
            '    '届出状況の時は時間外を省く

            w_strSql = w_strSql & "  ORDER BY   DISPNO  "

            w_Rs = General.paDBRecordSetOpen(w_strSql)

            If w_Rs.RecordCount <= 0 Then

            Else
                With w_Rs
                    .MoveLast()
                    w_lngRecCnt = .RecordCount
                    .MoveFirst()

                    ReDim g_ApplMaster(w_lngRecCnt)

                    w_CD_F = .Fields("APPLICD")
                    w_Name_F = .Fields("NAME")
                    w_SecName_F = .Fields("SECNAME")
                    w_DispNo_F = .Fields("DISPNO")

                    g_ApplMaster(0).strCD = "000000"
                    g_ApplMaster(0).strName = "すべて"

                    For w_lngLoop = 1 To w_lngRecCnt

                        If (M_STRJIKANGAI).Equals(w_CD_F.Value) AndAlso w_intIndex = 0 Then
                            w_intIndex = w_lngLoop
                        End If

                        g_ApplMaster(w_lngLoop).strCD = w_CD_F.Value
                        g_ApplMaster(w_lngLoop).strName = w_Name_F.Value
                        g_ApplMaster(w_lngLoop).strSecName = w_SecName_F.Value
                        g_ApplMaster(w_lngLoop).lngDispNo = w_DispNo_F.Value

                        .MoveNext()
                    Next w_lngLoop

                    .Close()
                End With
                w_Rs = Nothing
            End If

            For w_lngLoop = 0 To UBound(g_ApplMaster)

                cmbSelectAppl.Items.Add(g_ApplMaster(w_lngLoop).strName)
                cmbPersonalAppli.Items.Add(g_ApplMaster(w_lngLoop).strName)
                cmbStatus.Items.Add(g_ApplMaster(w_lngLoop).strName)

            Next w_lngLoop

            cmbSelectAppl.SelectedIndex = 1
            cmbSelectAppl.SelectedItem = 1
            vseApproveInfo.Select()
            cmbPersonalAppli.SelectedIndex = 0
            cmbStatus.SelectedIndex = 0

            'もしも、マスタが取得できなかった場合対応
            If UBound(g_ApplMaster) <= 0 Then

                g_ApplMaster(0).strCD = "000000"
                g_ApplMaster(0).strName = "すべて"
                g_ApplMaster(0).strSecName = ""
                g_ApplMaster(0).lngDispNo = 1

                cmbSelectAppl.Items.Clear()
                cmbPersonalAppli.Items.Clear()
                cmbStatus.Items.Clear()

                cmbSelectAppl.Items.Add(g_ApplMaster(0).strName)
                cmbPersonalAppli.Items.Add(g_ApplMaster(0).strName)
                cmbStatus.Items.Add(g_ApplMaster(0).strName)

                cmbSelectAppl.SelectedIndex = 0
                cmbPersonalAppli.SelectedIndex = 0
                cmbStatus.SelectedIndex = 0

            End If

        Catch ex As Exception
            Call General.paTrpMsg(Convert.ToString(Err.Number), W_SUBNAME)
        End Try
    End Sub

    '==================================
    '初期ロード画面処理
    '==================================
    Private Sub sDispFirstForm()
        Const W_SUBNAME As String = "NSC0000HA sDispFirstForm"

        Try
            Dim w_str As String = String.Empty
            '項目設定取得
            '申請時間表示フラグ
            m_DetailTimeFlg = General.paGetItemValue(General.G_STRMAINKEY2, General.G_STRSECTION1, "DETAILTIMEFLG", 1, General.g_strHospitalCD)


            '選択職員管理番号(ログイン時は利用者本人とする)
            g_strTargetStaffMngID = General.g_strUserMngID

            'リストビューのヘッダの高さ対応
            With lvwDeptInfo
                .Visible = True
                .Enabled = True

                '1回でも読み込んでいればOK
                If imlSmallIcon.Images.Count <= 0 Then
                    With imlSmallIcon
                        .Images.Clear()
                        .ImageSize = New System.Drawing.Size(.ImageSize.Width, 20)
                        .ImageSize = New System.Drawing.Size(20, .ImageSize.Height)
                        .Images.Add("MAN", System.Drawing.Image.FromFile(g_ImagePath & "man.ico"))
                        .Images.Add("WOMAN", System.Drawing.Image.FromFile(g_ImagePath & "woman.ico"))
                        .Images.Add("MAN2", System.Drawing.Image.FromFile(g_ImagePath & "man2.jpg"))
                        .Images.Add("WOMAN2", System.Drawing.Image.FromFile(g_ImagePath & "woman2.jpg"))
                        .Images.Add("FINISH", System.Drawing.Image.FromFile(g_ImagePath & "Finish.ico"))
                        .Images.Add("UNFINISH", System.Drawing.Image.FromFile(g_ImagePath & "unFinish.ico"))
                        .Images.Add("ERROR", System.Drawing.Image.FromFile(g_ImagePath & "Error.ico"))
                        .Images.Add("GREEN", System.Drawing.Image.FromFile(g_ImagePath & "Blue.jpg"))
                        .Images.Add("BLUE", System.Drawing.Image.FromFile(g_ImagePath & "Green.jpg"))
                        .Images.Add("OVER1", System.Drawing.Image.FromFile(g_ImagePath & "未承認前.bmp"))
                        .Images.Add("OVER2", System.Drawing.Image.FromFile(g_ImagePath & "未承認.bmp"))
                        .Images.Add("OVER3", System.Drawing.Image.FromFile(g_ImagePath & "承認済.bmp"))
                        .Images.Add("OVER4", System.Drawing.Image.FromFile(g_ImagePath & "確定.bmp"))
                        .Images.Add("OVER5", System.Drawing.Image.FromFile(g_ImagePath & "差戻.bmp"))
                    End With
                End If
            End With

            If g_lngGroupIdx = 0 OrElse g_lngListIdx = 0 Then

                '選択業務もしくはリストメニューが取得できなかった場合
                'どれにも該当しない場合
                Call sSetControl()

                'フォームキャプション
                If General.paGetItemValue(General.G_STRMAINKEY1, "PACKAGETYPE", "INSTALLPACKAGE", "0", General.g_strHospitalCD) = "0" Then
                    '        'MedWorks
                    w_str = G_PACKAGENAME_MED
                ElseIf General.paGetItemValue(General.G_STRMAINKEY1, "PACKAGETYPE", "INSTALLPACKAGE", "0", General.g_strHospitalCD) = "1" Then
                    'NsAid
                    w_str = G_PACKAGENAME_NSAID
                End If
                Me.Text = w_str & Space(2) & "【" & g_MenuM(g_lngGroupIdx).strMenuNm & "】"

            Else

                Select Case g_MenuM(g_lngGroupIdx).ListBarMenu(g_lngListIdx).strResCD

                    Case M_PERSONAL_RESCD
                        '●個人業務
                        m_strSelChildMenu = ""
                        g_strTargetStaffMngID = General.g_strUserMngID
                        m_blnKinmuDeptDspFlg = False
                        m_ResCD_Kbn = 1
                        General.g_strSelKinmuDeptCD = General.g_strUserKinmuDeptCD
                        Call sList_Personal()
                    Case M_DEPT_RESCD
                        '●勤務部署業務
                        m_strSelChildMenu = ""
                        m_strDispMenu = M_DEPT_RESCD

                        m_strBusyoHaichi = M_DISP_BUSYO
                        m_ResCD_Kbn = 2

                        Call sList_DeptInfo()
                    Case M_APPROVE_RESCD
                        '-----------
                        '未承認一覧
                        '-----------
                        m_strSelChildMenu = ""

                        m_strDispMenu = M_APPROVE_RESCD
                        m_strAppliChange = M_DISP_MISYONIN

                        m_strDispApplCD = "000000"
                        Call GetApplMaster()

                        Call sList_ApproveInfo()

                    Case M_DAKOKU_RESCD
                        '-----------
                        '出退勤業務
                        '-----------
                        '子画面メニューキー
                        m_strSelChildMenu = ""
                        m_strDispMenu = M_DAKOKU_RESCD
                        If vstKinmuDept.SelectedIndex = 0 Then
                            Call sList_DeptInfo()
                        Else
                            vstKinmuDept.SelectedIndex = 0
                        End If

                    Case M_DUTY_RESCD
                        '-----------
                        '日当直
                        '-----------
                        '子画面メニューキー
                        m_strSelChildMenu = ""

                        '日当直マスタ取得
                        m_strDispDutyGroupCD = "00"
                        Call GetDutyMaster()

                        Call sList_DutyInfo()

                    Case M_ZAIIN_RESCD
                        '-----------
                        '在院照会
                        '-----------
                        m_strSelChildMenu = ""
                        m_strDispMenu = M_ZAIIN_RESCD
                        If vstKinmuDept.SelectedIndex = 0 Then
                            Call sList_ZaiinInfo()
                        Else
                            vstKinmuDept.SelectedIndex = 0
                        End If

                    Case M_STAFFIDO_RESCD
                        '-----------
                        '職員管理
                        '-----------
                        m_strSelChildMenu = ""
                        m_strDispMenu = M_STAFFIDO_RESCD
                        m_strBusyoHaichi = M_DISP_BUSYO

                        vstKinmuDept.SelectedIndex = 0
                        Call sList_SyokuinKanriInfo(0)

                    Case M_OVERKINMU_RESCD
                        '-----------
                        '時間外
                        '-----------
                        '子画面メニューキー
                        m_strSelChildMenu = ""
                        m_strDispMenu = M_OVERKINMU_RESCD
                        m_strOverKinmuDispType = M_STR_DAY
                        If vstKinmuDept.SelectedIndex = 0 Then
                            m_strSelBusyoCD = General.g_strSelKinmuDeptCD
                            m_strSelBusyoNM = General.g_strSelKinmuDeptNm
                            If String.IsNullOrEmpty(m_strSelBusyoCD) Then
                                m_strSelBusyoCD = General.g_strUserKinmuDeptCD
                                m_strSelBusyoNM = General.g_strUserKinmuDeptNm
                            End If
                            Call sList_DayOver()
                        Else
                            vstKinmuDept.SelectedIndex = 0
                        End If

                    Case Else
                        'どれにも該当しない場合
                        Call sSetControl()
                End Select

                'フォームキャプション
                If General.paGetItemValue(General.G_STRMAINKEY1, "PACKAGETYPE", "INSTALLPACKAGE", "0", General.g_strHospitalCD) = "0" Then
                    'MedWorks
                    w_str = G_PACKAGENAME_MED
                ElseIf General.paGetItemValue(General.G_STRMAINKEY1, "PACKAGETYPE", "INSTALLPACKAGE", "0", General.g_strHospitalCD) = "1" Then
                    'NsAid
                    w_str = G_PACKAGENAME_NSAID
                End If
                Me.Text = w_str & Space(2) & "【" & g_MenuM(g_lngGroupIdx).strMenuNm & "】 - " & g_MenuM(g_lngGroupIdx).ListBarMenu(g_lngListIdx).strTitle
            End If

            '****** 一旦コメントアウト ********
            'albMenu.Groups(g_lngGroupIdx).ListItems(g_lngListIdx).IconLarge = 2
            imtSelectTime.Text = Format(Now, "HH:mm")
            lblTime.Text = imtSelectTime.Text
            imtSelectTime.ReadOnly = True

        Catch ex As Exception
            Call General.paTrpMsg(Convert.ToString(Err.Number), W_SUBNAME)
        End Try
    End Sub

    '================================
    'リストバーＭＥＮＵ【個人業務】
    '================================
    Private Sub sList_Personal()

        Const W_SUBNAME As String = "NSC0000HA sList_Personal"

        Try
            Dim w_Date As Date
            Dim w_lngFrom As Integer
            Dim w_lngTo As Integer
            Dim w_StaffData() As Staff_Type

            vseCover.Visible = True
            vseCover.Left = albMenu.Left
            vseCover.Width = Me.Width
            vseCover.Top = 97
            vseCover.Height = albMenu.Height
            fraDataGet.Left = vseCover.Width / 3
            fraDataGet.Top = vseCover.Height / 3
            Call vseCover.BringToFront()
            System.Windows.Forms.Application.DoEvents()

            'ﾏｳｽﾎﾟｲﾝﾀを砂時計に
            Me.Cursor = System.Windows.Forms.Cursors.WaitCursor

            w_Date = New Date(m_CalDate.Year, m_CalDate.Month, 1)
            '対象期間開始日
            m_DateFrom = w_Date
            '対象期間終了日
            m_DateTo = DateAdd(Microsoft.VisualBasic.DateInterval.Day, -1, DateAdd(Microsoft.VisualBasic.DateInterval.Month, 1, w_Date))
            '対象期間日数
            m_lngPutDateNum = DateDiff(Microsoft.VisualBasic.DateInterval.Day, m_DateFrom, m_DateTo) + 1

            'セキュリティ(勤務・時間外・出退勤・日当直)の取得
            Call subCheckPackage()
            Call Init()

            If g_MenuM(g_lngGroupIdx).ListBarMenu(g_lngListIdx).strResCD = M_PERSONAL_RESCD Then
                '時間外データ出力フラグ（本人画面）
                m_OverKinmuFlg = General.paGetItemValue(General.G_STRMAINKEY2, General.G_STRSECTION1, "OVERKINMUFLG", 0, General.g_strHospitalCD)
            Else
                m_OverKinmuFlg = 0
            End If

            '●ﾂｰﾙﾊﾞｰの設定
            Call sSetTbrMenu()

            '●リストビュー初期設定
            Call sSetListView()

            '●職員情報 取得
            w_lngFrom = General.paGetDateIntegerFromDate(m_DateFrom)
            w_lngTo = General.paGetDateIntegerFromDate(m_DateTo)
            If fncPersonalData(g_strTargetStaffMngID, w_lngFrom, w_lngTo, w_StaffData) = False Then
                '初期化
                ReDim m_Personal(0)
            Else
                '配列確保
                ReDim m_Personal(1)
                '**** 取得桁数不明 
                m_Personal(1) = General.paDeepCopy(w_StaffData(1))
            End If

            '各Panelの高さと幅を設定
            Call sSetControl()

            If (M_PER_JISSEKI_DSP).Equals(m_strSelChildMenu) Then
                '------------------
                '実績状況 取得
                '------------------
                'スプレッド初期設定
                Call sSetSpreadSheet()
                Call sGetResult_Personal()
                'スプレッド 表示
                Call sDispSpreadSheet()

            ElseIf (M_PER_APPLI_DSP).Equals(m_strSelChildMenu) Then
                '-----------------
                '届出状況 取得
                '-----------------
                Call sGetApplication()

            ElseIf (M_PER_HOLIDAY_DSP).Equals(m_strSelChildMenu) Then
                '-----------------
                '休暇状況
                '-----------------
            ElseIf (M_APPRO_PERSONAL_OVER).Equals(m_strSelChildMenu) Then
                '------------------
                '個人別時間外 取得
                '------------------
                'スプレッド初期設定
                Call sSetSpreadSheet()
                Call sGetResult_Personal()
                'スプレッド 表示
                If UBound(m_Personal) > 0 Then
                    Call sDispSpreadSheet()
                End If
            End If

            'リストビュー 表示
            Call sDispListView()

            If UBound(m_Personal) <= 0 Then
                'adminなどの利用者の場合対応
                lblSearchData.Text = ""
                '=================================
            Else
                '職員番号 職員氏名
                'lblSearchData.Font = New Font("MS UI Gothic", 11, FontStyle.Bold)
                lblSearchData.Text = m_Personal(1).strStaffID & Space(2) & m_Personal(1).strName
                lblSearchData.ForeColor = System.Drawing.Color.Blue
            End If

            'ﾏｳｽﾎﾟｲﾝﾀを元に戻す
            Me.Cursor = System.Windows.Forms.Cursors.Default

            vseCover.Visible = False

        Catch ex As Exception
            'ﾏｳｽﾎﾟｲﾝﾀを元に戻す
            Me.Cursor = System.Windows.Forms.Cursors.Default
            Call General.paTrpMsg(Convert.ToString(Err.Number), W_SUBNAME)
        End Try
    End Sub

    '================================
    'リストバーＭＥＮＵ[部署業務]
    '================================
    Private Sub sList_DeptInfo()
        Const W_SUBNAME As String = "NSC0000HA sList_DeptInfo"

        Try
            Dim w_Date As Date

            vseCover.Visible = True
            vseCover.Left = albMenu.Left
            vseCover.Width = Me.Width
            vseCover.Top = 97 'albMenu.Top
            vseCover.Height = albMenu.Height

            fraDataGet.Left = vseCover.Width / 3
            fraDataGet.Top = vseCover.Height / 3
            Call vseCover.BringToFront()
            System.Windows.Forms.Application.DoEvents()

            w_Date = New Date(m_CalDate.Year, m_CalDate.Month, 1)
            '対象期間開始日
            m_DateFrom = w_Date
            '対象期間終了日
            m_DateTo = DateAdd(Microsoft.VisualBasic.DateInterval.Day, -1, DateAdd(Microsoft.VisualBasic.DateInterval.Month, 1, w_Date))
            '対象期間日数
            m_lngPutDateNum = DateDiff(Microsoft.VisualBasic.DateInterval.Day, m_DateFrom, m_DateTo) + 1

            '●ﾂｰﾙﾊﾞｰの設定(部署業務)
            Call sSetTbrMenu()

            '●勤務部署取得(権限範囲)
            Call sGetKinmuDept(g_MenuM(g_lngGroupIdx).ListBarMenu(g_lngListIdx).strRefAuthRangeKbn)

            '●勤務部署ツリービュー 作成
            Call sSetKinmuDeptTreeView()

            '各Paneの高さと幅を設定
            sSetControl()

            vseCover.Visible = False

        Catch ex As Exception
            Call General.paTrpMsg(Convert.ToString(Err.Number), W_SUBNAME)
        End Try
    End Sub
    '================================
    'リストバーＭＥＮＵ[未承認一覧]
    '================================
    Private Sub sList_ApproveInfo()
        Const W_SUBNAME As String = "NSC0000HA sList_ApproveInfo"

        Try
            Dim w_Date As Date

            vseCover.Visible = True
            vseCover.Left = albMenu.Left
            vseCover.Width = Me.Width
            vseCover.Top = 97 'albMenu.Top
            vseCover.Height = albMenu.Height
            fraDataGet.Left = vseCover.Width / 3
            fraDataGet.Top = vseCover.Height / 3
            Call vseCover.BringToFront()
            System.Windows.Forms.Application.DoEvents()

            'ﾏｳｽﾎﾟｲﾝﾀを砂時計に
            Me.Cursor = System.Windows.Forms.Cursors.WaitCursor

            w_Date = New Date(m_CalDate.Year, m_CalDate.Month, 1)
            '対象期間開始日
            m_DateFrom = w_Date
            '対象期間終了日
            m_DateTo = DateAdd(Microsoft.VisualBasic.DateInterval.Day, -1, DateAdd(Microsoft.VisualBasic.DateInterval.Month, 1, w_Date))
            '対象期間日数
            m_lngPutDateNum = DateDiff(Microsoft.VisualBasic.DateInterval.Day, m_DateFrom, m_DateTo) + 1

            '●ﾂｰﾙﾊﾞｰの設定(未承認)
            Call sSetTbrMenu()

            '●リストビュー初期設定
            Call sSetListView()

            '●勤務部署取得(権限範囲)
            Call sGetKinmuDept(g_MenuM(g_lngGroupIdx).ListBarMenu(g_lngListIdx).strRefAuthRangeKbn)

            '●未承認データ 取得
            Call sGetNoApprove()

            '●未承認データ 表示
            Call sDispListView()

            '各Paneの高さと幅を設定
            Call sSetControl()

            'ﾏｳｽﾎﾟｲﾝﾀを元に戻す
            Me.Cursor = System.Windows.Forms.Cursors.Default

            vseCover.Visible = False

        Catch ex As Exception
            'ﾏｳｽﾎﾟｲﾝﾀを元に戻す
            Me.Cursor = System.Windows.Forms.Cursors.Default
            Call General.paTrpMsg(Convert.ToString(Err.Number), W_SUBNAME)
        End Try
    End Sub

    '日当直マスタ取得
    Public Sub GetDutyMaster()
        Const W_SUBNAME As String = "frmNSC0000HA GetDutyMaster"

        Try
            Dim w_Node As System.Windows.Forms.TreeNode
            Dim w_lngRecCnt As Integer
            Dim w_lngLoop As Integer

            cmbSelectDuty.Items.Clear()
            ReDim g_DutyMaster(0)

            With General.g_objGetMaster
                .pHospitalCD = General.g_strHospitalCD
                .pDG_GROUPCD = "" '全体
                .pDG_KijunDate = General.paGetDateIntegerFromDate(m_CalDate)
                If .mGetDutyGroup = False Then

                Else
                    '件数
                    w_lngRecCnt = .fDG_DataCount
                    ReDim g_DutyMaster(w_lngRecCnt)

                    g_DutyMaster(0).strCD = "00"
                    g_DutyMaster(0).strName = "すべて"

                    For w_lngLoop = 1 To w_lngRecCnt
                        '索引
                        .mDG_DataIdx = w_lngLoop

                        g_DutyMaster(w_lngLoop).strCD = .fDG_GroupCD
                        g_DutyMaster(w_lngLoop).strName = .fDG_GroupName
                        g_DutyMaster(w_lngLoop).strSecName = .fDG_SecName
                        g_DutyMaster(w_lngLoop).strSecName2 = .fDG_SecName2
                        g_DutyMaster(w_lngLoop).lngDispNo = .fDG_DispNo

                    Next w_lngLoop

                End If
            End With

            For w_lngLoop = 0 To UBound(g_DutyMaster)

                cmbSelectDuty.Items.Add(g_DutyMaster(w_lngLoop).strCD & Space(2) & g_DutyMaster(w_lngLoop).strName)

            Next w_lngLoop

            cmbSelectDuty.SelectedIndex = 0

            'もしも、マスタが取得できなかった場合対応
            If UBound(g_DutyMaster) <= 0 Then

                g_DutyMaster(0).strCD = "00"
                g_DutyMaster(0).strName = "すべて"
                g_DutyMaster(0).strSecName = ""
                g_DutyMaster(0).strSecName2 = ""
                g_DutyMaster(0).lngDispNo = 1
                cmbSelectDuty.Items.Add(g_DutyMaster(0).strCD & Space(2) & g_DutyMaster(0).strName)

            End If


            'ツリーに変更
            With tvwDuty

                'TreeViewのｸﾘｱｰ
                .Nodes.Clear()

                w_Node = .Nodes.Add("DutyList", "日当直グループ")
                w_Node.Expand()
                For w_lngLoop = 0 To UBound(g_DutyMaster)

                    w_Node = .Nodes.Find("DutyList", True)(0).Nodes.Add(Convert.ToString("Key" & g_DutyMaster(w_lngLoop).strCD), g_DutyMaster(w_lngLoop).strName)

                Next w_lngLoop
            End With

        Catch ex As Exception
            Call General.paTrpMsg(Convert.ToString(Err.Number), W_SUBNAME)
        End Try
    End Sub

    '================================
    'リストバーＭＥＮＵ【日当直】
    '================================
    Private Sub sList_DutyInfo()
        Const W_SUBNAME As String = "NSC0000HA sList_DutyInfo"

        Try
            Dim w_Date As Date

            vseCover.Visible = True
            vseCover.Left = albMenu.Left
            vseCover.Width = Me.Width
            vseCover.Top = 97 'albMenu.Top
            vseCover.Height = albMenu.Height
            fraDataGet.Left = vseCover.Width / 3
            fraDataGet.Top = vseCover.Height / 3
            Call vseCover.BringToFront()
            System.Windows.Forms.Application.DoEvents()

            'ﾏｳｽﾎﾟｲﾝﾀを砂時計に
            Me.Cursor = System.Windows.Forms.Cursors.WaitCursor

            w_Date = New Date(m_CalDate.Year, m_CalDate.Month, 1)
            '対象期間開始日
            m_DateFrom = w_Date
            '対象期間終了日
            m_DateTo = DateAdd(Microsoft.VisualBasic.DateInterval.Day, -1, DateAdd(Microsoft.VisualBasic.DateInterval.Month, 1, w_Date))
            '対象期間日数
            m_lngPutDateNum = DateDiff(Microsoft.VisualBasic.DateInterval.Day, m_DateFrom, m_DateTo) + 1

            '●ﾂｰﾙﾊﾞｰの設定(日当直)
            Call sSetTbrMenu()

            '●リストビュー初期設定
            Call sSetListView()

            '●日当直者 取得
            Call sGetDutyData()

            '●日当直者 表示
            Call sDispListView()

            '各Paneの高さと幅を設定
            Call sSetControl()

            'ﾏｳｽﾎﾟｲﾝﾀを元に戻す
            Me.Cursor = System.Windows.Forms.Cursors.Default

            vseCover.Visible = False

        Catch ex As Exception
            'ﾏｳｽﾎﾟｲﾝﾀを元に戻す
            Me.Cursor = System.Windows.Forms.Cursors.Default
            Call General.paTrpMsg(Convert.ToString(Err.Number), W_SUBNAME)
        End Try
    End Sub

    '================================
    'リストバーＭＥＮＵ【出退勤】
    '================================
    Private Sub sList_DakokuInfo()
        Const W_SUBNAME As String = "NSC0000HA sList_DakokuInfo"

        Try
            Dim w_Date As Date

            vseCover.Visible = True
            vseCover.Left = albMenu.Left
            vseCover.Width = Me.Width
            vseCover.Top = 97 'albMenu.Top
            vseCover.Height = albMenu.Height
            fraDataGet.Left = vseCover.Width / 3
            fraDataGet.Top = vseCover.Height / 3
            Call vseCover.BringToFront()
            System.Windows.Forms.Application.DoEvents()

            'ﾏｳｽﾎﾟｲﾝﾀを砂時計に
            Me.Cursor = System.Windows.Forms.Cursors.WaitCursor

            w_Date = New Date(m_CalDate.Year, m_CalDate.Month, 1)
            '対象期間開始日
            m_DateFrom = w_Date
            '対象期間終了日
            m_DateTo = DateAdd(Microsoft.VisualBasic.DateInterval.Day, -1, DateAdd(Microsoft.VisualBasic.DateInterval.Month, 1, w_Date))
            '対象期間日数
            m_lngPutDateNum = DateDiff(Microsoft.VisualBasic.DateInterval.Day, m_DateFrom, m_DateTo) + 1

            '●ﾂｰﾙﾊﾞｰの設定(出退勤)
            Call sSetTbrMenu()

            '●リストビュー初期設定
            Call sSetListView()

            '●勤務部署取得(権限範囲)
            Call sGetKinmuDept(g_MenuM(g_lngGroupIdx).ListBarMenu(g_lngListIdx).strRefAuthRangeKbn)

            '●勤務部署ツリービュー 作成
            Call sSetKinmuDeptTreeView()

            '各Paneの高さと幅を設定
            Call sSetControl()

            'ﾏｳｽﾎﾟｲﾝﾀを元に戻す
            Me.Cursor = System.Windows.Forms.Cursors.Default

            vseCover.Visible = False

        Catch ex As Exception
            'ﾏｳｽﾎﾟｲﾝﾀを元に戻す
            Me.Cursor = System.Windows.Forms.Cursors.Default
            Call General.paTrpMsg(Convert.ToString(Err.Number), W_SUBNAME)
        End Try
    End Sub

    '================================
    'リストバーＭＥＮＵ[在院照会]
    '================================
    Private Sub sList_ZaiinInfo()

        Const W_SUBNAME As String = "NSC0000HA sList_ZaiinInfo"

        Try
            vseCover.Visible = True
            vseCover.Left = albMenu.Left
            vseCover.Width = Me.Width
            vseCover.Top = 97 'albMenu.Top
            vseCover.Height = albMenu.Height
            fraDataGet.Left = vseCover.Width / 3
            fraDataGet.Top = vseCover.Height / 3
            Call vseCover.BringToFront()
            System.Windows.Forms.Application.DoEvents()

            '●ﾂｰﾙﾊﾞｰの設定(部署業務)
            Call sSetTbrMenu()

            '●リストビュー初期設定
            Call sSetListView()

            '●勤務部署取得(権限範囲)
            Call sGetKinmuDept(g_MenuM(g_lngGroupIdx).ListBarMenu(g_lngListIdx).strRefAuthRangeKbn)

            '●勤務部署ツリービュー 作成
            Call sSetKinmuDeptTreeView()

            '各Paneの高さと幅を設定
            Call sSetControl()

            vseCover.Visible = False

        Catch ex As Exception
            Call General.paTrpMsg(Convert.ToString(Err.Number), W_SUBNAME)
        End Try
    End Sub

    '================================
    'リストバーＭＥＮＵ[職員管理]
    '================================
    Private Sub sList_SyokuinKanriInfo(ByVal p_intTabIdx As Integer)
        Const W_SUBNAME As String = "NSC0000HA sList_SyokuinKanriInfo"

        Try
            Dim w_WarddeptFlg As String '勤務＝配属フラグ（"1"：勤務＝配属、"0"：勤務≠配属)
            w_WarddeptFlg = General.paGetItemValue(General.G_STRMAINKEY1, General.G_STRSECTION1, "WORDDEPTFLG", "0", General.g_strHospitalCD)

            If m_LoopFlg <> 1 Then
                vseCover.Visible = True
            End If

            vseCover.Left = albMenu.Left
            vseCover.Width = Me.Width
            vseCover.Top = 97 'albMenu.Top
            vseCover.Height = albMenu.Height
            fraDataGet.Left = vseCover.Width / 3
            fraDataGet.Top = vseCover.Height / 3
            Call vseCover.BringToFront()
            System.Windows.Forms.Application.DoEvents()

            m_DisplayMode = "1"

            Call subStaffSecurity()

            If m_LoopFlg = 0 OrElse m_LoopFlg = 1 Then
                Call sSetTbrMenu()
            End If

            'ループ処理防止
            If m_LoopFlg = 1 Then
                Exit Sub
            End If

            '●リストビュー初期設定
            Call sSetListView()

            '●勤務部署取得(権限範囲)---全てのタブで権限を参照するため必要
            Call sGetKinmuDept_Kanri(g_MenuM(g_lngGroupIdx).ListBarMenu(g_lngListIdx).strRefAuthRangeKbn)

            If "0".Equals(w_WarddeptFlg) Then
                If p_intTabIdx = 0 Then
                    '●勤務部署ツリービュー 作成
                    Call sSetKinmuDeptTreeView()
                ElseIf p_intTabIdx = 1 Then
                    '●配属部署マスタ取得
                    Call sGetMasterInfo(1)
                    '●配属部署ツリービュー 作成
                    Call sSetWardDeptTreeView()
                ElseIf p_intTabIdx = 2 Then
                    '●役職マスタ取得
                    Call sGetMasterInfo(2)
                    '●役職ツリービュー 作成
                    Call sSetPostTreeView()
                ElseIf p_intTabIdx = 3 Then
                    '●職種マスタ取得
                    Call sGetMasterInfo(3)
                    '●職種ツリービュー 作成
                    Call sSetJobTreeView()
                End If
            Else
                If p_intTabIdx = 0 Then
                    '●勤務部署ツリービュー 作成
                    Call sSetKinmuDeptTreeView()
                ElseIf p_intTabIdx = 1 Then
                    '●役職マスタ取得
                    Call sGetMasterInfo(1)
                    '●役職ツリービュー 作成
                    Call sSetPostTreeView()
                ElseIf p_intTabIdx = 2 Then
                    '●職種マスタ取得
                    Call sGetMasterInfo(2)
                    '●職種ツリービュー 作成
                    Call sSetJobTreeView()
                End If
            End If

            'ﾂｰﾙﾊﾞｰの設定がされなかった場合に実施
            If m_LoopFlg = 2 OrElse m_LoopFlg = 3 Then
                Call sSetTbrMenu()
                m_strSelChildMenu = M_STAFFIDO_RESCD
            End If

            '各Paneの高さと幅を設定
            Call sSetControl()

            vseCover.Visible = False

        Catch ex As Exception
            Call General.paTrpMsg(Convert.ToString(Err.Number), W_SUBNAME)
        End Try
    End Sub

    '================================
    'リストバーＭＥＮＵ[日別超過勤務入力]
    '================================
    Private Sub sList_DayOver()

        Const W_SUBNAME As String = "NSC0000HA sList_DayOver"

        Try
            Dim w_Date As Date
            Dim w_lngDate As Integer
            Dim w_lngFrom As Integer
            Dim w_lngTo As Integer
            Dim w_lngPlan As Integer
            Dim w_lngBeforePlan As Integer

            vseCover.Visible = True
            vseCover.Left = albMenu.Left
            vseCover.Width = Me.Width
            vseCover.Top = 97 'albMenu.Top
            vseCover.Height = albMenu.Height

            fraDataGet.Left = vseCover.Width / 3
            fraDataGet.Top = vseCover.Height / 3

            Call vseCover.BringToFront()
            System.Windows.Forms.Application.DoEvents()

            'ﾏｳｽﾎﾟｲﾝﾀを砂時計に
            Me.Cursor = System.Windows.Forms.Cursors.WaitCursor

            w_lngDate = General.paGetDateIntegerFromDate(m_CalDate, General.G_DATE_ENUM.yyyyMM)
            '----------------------------
            w_lngFrom = Integer.Parse(Mid(Convert.ToString(w_lngDate), 1, 4) & Mid(Convert.ToString(w_lngDate), 5, 2) & "01")
            w_Date = General.paGetDateFromDateInteger(w_lngFrom)
            w_lngTo = General.DateUtil.paGetDateIntegerFromDate(DateAdd(Microsoft.VisualBasic.DateInterval.Day, -1,
                        DateAdd(Microsoft.VisualBasic.DateInterval.Month, 1, w_Date)))

            w_Date = New Date(m_CalDate.Year, m_CalDate.Month, 1)
            '対象期間開始日
            m_DateFrom = w_Date
            '対象期間終了日
            m_DateTo = DateAdd(Microsoft.VisualBasic.DateInterval.Day, -1, DateAdd(Microsoft.VisualBasic.DateInterval.Month, 1, w_Date))
            '対象期間日数
            m_lngPutDateNum = DateDiff(Microsoft.VisualBasic.DateInterval.Day, m_DateFrom, m_DateTo) + 1



            '●ﾂｰﾙﾊﾞｰの設定(未承認)
            Call sSetTbrMenu()

            '●計画番号　取得
            Call subGetPlanNo(w_lngPlan, w_lngBeforePlan, Integer.Parse(w_lngFrom), Integer.Parse(w_lngTo))

            '●職員歴　取得
            Call subGetStaffHistory(w_lngPlan)

            '●勤務部署取得(権限範囲)
            Call sGetKinmuDept(g_MenuM(g_lngGroupIdx).ListBarMenu(g_lngListIdx).strRefAuthRangeKbn)

            'TreeView再描画分岐 
            If m_blnSelOverDay = True AndAlso w_lngPlan = m_currentSelPlanNo Then
                '時間外選択フラグ = True かつ 現在選択日付での計画番号 = 前回選択の計画番号　の場合、ノード選択イベントのみ発生
                tvwKinmuDept_NodeClick(tvwKinmuDept, New System.Windows.Forms.TreeViewEventArgs(tvwKinmuDept.SelectedNode))
            Else
                '●勤務部署ツリービュー 作成
                Call sSetKinmuDeptTreeView()
                m_blnSelOverDay = True
            End If

            '各Paneの高さと幅を設定
            Call sSetControl()

            'ﾏｳｽﾎﾟｲﾝﾀを元に戻す
            Me.Cursor = System.Windows.Forms.Cursors.Default

            vseCover.Visible = False

        Catch ex As Exception
            'ﾏｳｽﾎﾟｲﾝﾀを元に戻す
            Me.Cursor = System.Windows.Forms.Cursors.Default
            Call General.paTrpMsg(Convert.ToString(Err.Number), W_SUBNAME)
        End Try
    End Sub

    '================================
    'リストバーＭＥＮＵ[配置表]
    '================================
    Private Sub sList_HaichiInfo()
        Const W_SUBNAME As String = "NSC0000HA sList_HaichiInfo"

        Try
            Dim w_Date As Date

            vseCover.Visible = True
            vseCover.Left = albMenu.Left
            vseCover.Width = Me.Width
            vseCover.Top = 97 'albMenu.Top
            vseCover.Height = albMenu.Height

            fraDataGet.Left = vseCover.Width / 3
            fraDataGet.Top = vseCover.Height / 3

            Call vseCover.BringToFront()
            System.Windows.Forms.Application.DoEvents()

            w_Date = New Date(m_CalDate.Year, m_CalDate.Month, 1)
            '対象期間開始日
            m_DateFrom = w_Date
            '対象期間終了日
            m_DateTo = DateAdd(Microsoft.VisualBasic.DateInterval.Day, -1, DateAdd(Microsoft.VisualBasic.DateInterval.Month, 1, w_Date))
            '対象期間日数
            m_lngPutDateNum = DateDiff(Microsoft.VisualBasic.DateInterval.Day, m_DateFrom, m_DateTo) + 1

            '●ﾂｰﾙﾊﾞｰの設定(部署業務)
            Call sSetTbrMenu()

            '●勤務部署取得(権限範囲)
            Call sGetKinmuDept(g_MenuM(g_lngGroupIdx).ListBarMenu(g_lngListIdx).strRefAuthRangeKbn)

            '●勤務部署ツリービュー 作成
            Call sSetKinmuDeptTreeView()

            '配置用職員取得
            Call sGetHaichiStaff()

            '各Paneの高さと幅を設定
            Call sSetControl()

            '配置表表示
            Call sSetSpreadSheetHaichi()

            '初期選択は左上
            Call sprKangoshiData_Click(2, 2)

            vseCover.Visible = False

        Catch ex As Exception
            Call General.paTrpMsg(Convert.ToString(Err.Number), W_SUBNAME)
        End Try
    End Sub


    Public Sub subSetBackColor()
        Const W_SUBNAME As String = "frmNSC0000HA subSetBackColor"

        Try
            Dim w_Color As String

            Const W_White As String = "&H80000005" '白
            Const W_Cream As String = "&H00E8FAFF" 'クリーム色　ARGB=(255, 255, 250, 232)

            Dim w_lngLoop As Integer

            'パッケージタイプで判断
            '　　・MedWorks ⇒  基本は白
            '　　・NsAid    ⇒  基本はクリーム色
            '　色設定が存在すれば、そちら優先

            'MedWorks
            If General.paGetItemValue(General.G_STRMAINKEY1, "PACKAGETYPE", "INSTALLPACKAGE", "0", General.g_strHospitalCD).Equals("0") Then

                w_Color = W_White

                'NsAid
            ElseIf General.paGetItemValue(General.G_STRMAINKEY1, "PACKAGETYPE", "INSTALLPACKAGE", "0", General.g_strHospitalCD).Equals("1") Then

                w_Color = W_Cream

            End If

            If General.paGetItemValue(General.G_STRMAINKEY1, "DISPBACKCOLOR", "BACKCOLOR", "0", General.g_strHospitalCD).Equals("0") = False Then

                w_Color = General.paGetItemValue(General.G_STRMAINKEY1, "DISPBACKCOLOR", "BACKCOLOR", "", General.g_strHospitalCD)

            End If

            For w_lngLoop = 1 To UBound(g_MenuM)
                albMenu.Items(w_lngLoop).BackColor = ColorTranslator.FromOle(w_Color)
            Next w_lngLoop

            vsePersonal.BackColor = ColorTranslator.FromOle(w_Color)
            vseDeptInfo.BackColor = ColorTranslator.FromOle(w_Color)
            vseDakokuInfo.BackColor = ColorTranslator.FromOle(w_Color)
            vseDutyInfo.BackColor = ColorTranslator.FromOle(w_Color)
            vseApproveInfo.BackColor = ColorTranslator.FromOle(w_Color)
            vseZaiin.BackColor = ColorTranslator.FromOle(w_Color)
            vseHaichi.BackColor = ColorTranslator.FromOle(w_Color)
            vseMain.BackColor = ColorTranslator.FromOle(w_Color)
            stbMenuMain.BackColor = ColorTranslator.FromOle(w_Color)
            Label2.BackColor = ColorTranslator.FromOle(w_Color)
            Label3.BackColor = ColorTranslator.FromOle(w_Color)

            lvwDeptInfo.BackColor = ColorTranslator.FromOle(w_Color)
            lvwMain.BackColor = ColorTranslator.FromOle(w_Color)
            lblDeptInfo.BackColor = ColorTranslator.FromOle(w_Color)
            lblKinmuDate.BackColor = ColorTranslator.FromOle(w_Color)
            lblDakokuDate.BackColor = ColorTranslator.FromOle(w_Color)
            lblDutyDate.BackColor = ColorTranslator.FromOle(w_Color)
            lblApproveDate.BackColor = ColorTranslator.FromOle(w_Color)
            lblZaiin.BackColor = ColorTranslator.FromOle(w_Color)
            lblKinmuBusyo.BackColor = ColorTranslator.FromOle(w_Color)
            lblKikan.BackColor = ColorTranslator.FromOle(w_Color)
            vsePersonal.BackColor = ColorTranslator.FromOle(w_Color)
            lblTime.BackColor = ColorTranslator.FromOle(w_Color)

        Catch ex As Exception
            Call General.paTrpMsg(Convert.ToString(Err.Number), W_SUBNAME)
        End Try
    End Sub

    '画面ＩＤからセキュリティ部品を呼び出し、
    '取得された権限によって画面の表示を変更する
    Private Sub subCheckPackage()
        Try
            Dim w_PreErrorProc As String
            w_PreErrorProc = General.g_ErrorProc 'ﾌﾟﾛｼｰｼﾞｬ名の一時待避
            General.g_ErrorProc = "NSW0020HA subCheckPackage"

            Dim w_lngCnt As Double
            Dim w_lngLoop As Double

            Const W_ResultDetail As String = "NSW0020HA"
            Const W_KinmuRes As String = "NSW0020HA1"
            Const W_OverKinmuRes As String = "NSW0020HA2"
            Const W_DakokuRes As String = "NSW0020HA3"
            Const W_DUTYRes As String = "NSW0020HA4"

            '権限の初期化
            m_strKinmuRef = M_constNothing
            m_strKinmuUpd = M_constNothing
            m_strOverKinmuRef = M_constNothing
            m_strOverKinmuUpd = M_constNothing
            m_strDakokuRef = M_constNothing
            m_strDakokuUpd = M_constNothing
            m_strDUTYRef = M_constNothing
            m_strDUTYUpd = M_constNothing

            'セキュリティ部品　５−２
            'mGetAllResource （リソース権限一括取得)
            '引数　：　String(画面ＩＤ)
            With General.g_objSecurity
                If .mGetAllResource(W_ResultDetail) = True Then
                    '件数
                    w_lngCnt = .fAR_ResourceCount

                    For w_lngLoop = 1 To w_lngCnt
                        'インデックス
                        .mAR_ResourceIdx = w_lngLoop

                        '勤務リソース
                        If .fAR_ResourceCD.Equals(W_KinmuRes) Then
                            m_strKinmuRef = .fAR_RefAuthRangeKbn
                            m_strKinmuUpd = .fAr_UpdAuthRangeKbn
                            '時間外リソース
                        ElseIf .fAR_ResourceCD.Equals(W_OverKinmuRes) Then
                            m_strOverKinmuRef = .fAR_RefAuthRangeKbn
                            m_strOverKinmuUpd = .fAr_UpdAuthRangeKbn
                            '出退勤リソース
                        ElseIf .fAR_ResourceCD.Equals(W_DakokuRes) Then
                            m_strDakokuRef = .fAR_RefAuthRangeKbn
                            m_strDakokuUpd = .fAr_UpdAuthRangeKbn
                            '日当直リソース
                        ElseIf .fAR_ResourceCD.Equals(W_DUTYRes) Then
                            m_strDUTYRef = .fAR_RefAuthRangeKbn
                            m_strDUTYUpd = .fAr_UpdAuthRangeKbn
                        End If
                    Next w_lngLoop
                End If
            End With

            General.g_ErrorProc = w_PreErrorProc '待避ﾌﾟﾛｼｰｼﾞｬ名を元に戻す
        Catch ex As Exception
            Throw
        End Try
    End Sub

    Private Sub Init()
        Try
            Dim w_PreErrorProc As String
            w_PreErrorProc = General.g_ErrorProc 'ﾌﾟﾛｼｰｼﾞｬ名の一時待避
            General.g_ErrorProc = "NSW0020HA Init"

            '初期化
            m_blnDutyDispFlg = True
            m_blnOverKinmuDispFlg = True
            m_blnDakokuDispFlg = True

            '========================
            '●日当直刻情報
            '========================
            If M_constNothing.Equals(m_strDUTYRef) AndAlso M_constNothing.Equals(m_strDUTYUpd) Then
                '日当直情報権限なし
                m_blnDutyDispFlg = False
            End If

            '========================
            '●時間外情報
            '========================
            If M_constNothing.Equals(m_strOverKinmuRef) AndAlso M_constNothing.Equals(m_strOverKinmuUpd) Then
                '時間外情報権限なし
                m_blnOverKinmuDispFlg = False
            End If

            '========================
            '●打刻情報
            '========================
            If M_constNothing.Equals(m_strDakokuRef) AndAlso M_constNothing.Equals(m_strDakokuUpd) Then
                '打刻情報権限なし
                m_blnDakokuDispFlg = False
            End If

            General.g_ErrorProc = w_PreErrorProc '待避ﾌﾟﾛｼｰｼﾞｬ名を元に戻す
        Catch ex As Exception
            Throw
        End Try
    End Sub

    '=========================================
    'ツールバー デフォルト設定
    '=========================================
    Private Sub sSetTbrMenu()
        Const W_SUBNAME As String = "NSC0000HA sSetTbrMenu"

        Try

            Dim w_lngRecCnt As Integer
            Dim w_lngLoop As Integer

            Dim w_strResID As String
            Dim w_strResCD As String
            Dim w_strPreResCD As String = String.Empty
            Dim w_lngIdx As Integer

            Dim w_objTool As System.Windows.Forms.MenuStrip
            Dim w_Key As String

            Dim w_lngLockLoop As Integer
            Dim w_lngLockCnt As Integer
            Dim w_blnLockFlg As Boolean
            Dim w_strAuthRangeKbn As String = String.Empty

            If M_OVERKINMU_RESCD.Equals(g_MenuM(g_lngGroupIdx).ListBarMenu(g_lngListIdx).strResCD) Then
                w_blnLockFlg = False
                w_lngLockCnt = UBound(m_udtOverKinmuLock)
                For w_lngLockLoop = 1 To w_lngLockCnt

                    If m_udtOverKinmuLock(w_lngLockLoop).lngDate = General.paGetDateIntegerFromDate(m_CalDate) _
                        AndAlso m_udtOverKinmuLock(w_lngLockLoop).strKinmuDeptCD.Equals(General.g_strSelKinmuDeptCD) _
                        AndAlso m_udtOverKinmuLock(w_lngLockLoop).blnLockFlg = True Then

                        w_blnLockFlg = True
                        Exit For

                    End If

                Next w_lngLockLoop

                w_strAuthRangeKbn = ""

                w_strAuthRangeKbn = sGetOverKinmuLockUse()

            End If

            '----------
            '■初期化
            '----------

            m_blnStaffKihonInfo = False

            '●共通
            stbMenuMain.Items.Clear()

            If String.IsNullOrEmpty(m_strSelChildMenu) OrElse (m_LoopFlg <> 0 AndAlso (M_STAFFIDO_RESCD).Equals(m_strSelChildMenu)) Then

                'リソースCD
                w_strResID = g_MenuM(g_lngGroupIdx).ListBarMenu(g_lngListIdx).strResCD

                With General.g_objSecurity
                    If .mGetAllResource(w_strResID) = False Then
                        ReDim m_udtChildMenu(0)
                    Else
                        ReDim m_udtChildMenu(0)
                        'メニュー件数
                        w_lngRecCnt = .fAR_ResourceCount

                        For w_lngLoop = 1 To w_lngRecCnt
                            .mAR_ResourceIdx = w_lngLoop

                            w_strResCD = .fAR_ResourceCD
                            'ツールバー設定
                            If w_strResCD.Equals(w_strPreResCD) = False Then
                                w_lngIdx = UBound(m_udtChildMenu) + 1
                                ReDim Preserve m_udtChildMenu(w_lngIdx)

                                '●リソースコード
                                m_udtChildMenu(w_lngIdx).strResCD = w_strResCD
                                '●タイトル
                                m_udtChildMenu(w_lngIdx).strTitle = .fAR_Title
                                '●オブジェクト名称
                                m_udtChildMenu(w_lngIdx).strObjNm = .fAR_ObjectNm
                                '●オブジェクト区分
                                m_udtChildMenu(w_lngIdx).strObjKbn = .fAR_ObjectKbn
                                '●イメージ
                                m_udtChildMenu(w_lngIdx).strImageNm = .fAR_ImageFileName
                                '●汎用エリア
                                m_udtChildMenu(w_lngIdx).strHanyoArea = .fAR_HanyoArea
                                '●汎用エリア２
                                m_udtChildMenu(w_lngIdx).strHanyoArea2 = .fAR_HanyoArea2
                                '●セキュリティリソースコード
                                m_udtChildMenu(w_lngIdx).strSResCD = .fAR_SecuResourceCD
                                '●更新権限範囲区分
                                m_udtChildMenu(w_lngIdx).strUpdAuthRangeKbn = .fAr_UpdAuthRangeKbn
                                '●参照権限範囲区分
                                m_udtChildMenu(w_lngIdx).strRefAuthRangeKbn = .fAR_RefAuthRangeKbn

                                'ツールバー１つ目のボタンを初期値としてイベント発生させる
                                If w_lngIdx = 1 Then
                                    m_strSelChildMenu = m_udtChildMenu(w_lngIdx).strResCD
                                End If
                            End If

                            '退避
                            w_strPreResCD = w_strResCD

                        Next w_lngLoop
                    End If
                End With
            End If

            w_strResID = g_MenuM(g_lngGroupIdx).ListBarMenu(g_lngListIdx).strResCD

            '共通
            w_objTool = stbMenuMain

            With w_objTool
                '.ToolBars.Add("stbMenu", Threed.Constants_CaptionStyle.ssStandard) 'ツールバー作成

                '.DisplayContextMenu = False 'ユーザーがランタイムカスタマイザを使用できるかどうか

                '.ToolBars.Item("stbMenu").DockFlags = ActiveToolBars.Constants_DockFlags.ssDFTop Or ActiveToolBars.Constants_DockFlags.ssPositionLocked Or Threed.Constants_PictureBackgroundStyle.ssStretched 'TOPにドッキング
                '.ToolBars.Item("stbMenu").AllowCustomize = False
                '.ToolBars.Item("stbMenu").AllowHiding = False
                '.ToolBars.Item("stbMenu").DisplayGrabHandles = False
                '.ToolBars.Item("stbMenu").DisplayMoreToolsButton = True

                '.LargeIcons = False
                '.ToolBars.Item("stbMenu").CaptionAlignment = ActiveToolBars.Constants_CaptionAlignment.ssRightOfImage 'キャプション配置位置(イメージ下側)

                m_blnStaffDeleteFlg = False

                For w_lngLoop = 1 To UBound(m_udtChildMenu)
                    Dim w_MenuMainButton As ToolStripButton = New ToolStripButton

                    If String.IsNullOrEmpty(m_udtChildMenu(w_lngLoop).strImageNm) = False Then
                        w_Key = m_udtChildMenu(w_lngLoop).strResCD

                        '.Items.Add(m_udtChildMenu(w_lngLoop).strTitle, System.Drawing.Image.FromFile(g_ImagePath & m_udtChildMenu(w_lngLoop).strImageNm))
                        '.Items.Item(w_Key).Text = m_udtChildMenu(w_lngLoop).strTitle
                        '.Items.Item(w_Key).Image = System.Drawing.Image.FromFile(g_ImagePath & m_udtChildMenu(w_lngLoop).strImageNm)
                        '.Items.Item(w_Key).let_Picture(System.Drawing.Image.FromFile(g_ImagePath & m_udtChildMenu(w_lngLoop).strImageNm))
                        '.Items.Item(w_Key).let_PictureDisabled(System.Drawing.Image.FromFile(g_ImagePath & m_udtChildMenu(w_lngLoop).strImageNm)) '2009/06/01 Y.Iguchi Add
                        w_MenuMainButton.Text = m_udtChildMenu(w_lngLoop).strTitle
                        w_MenuMainButton.Image = System.Drawing.Image.FromFile(g_ImagePath & m_udtChildMenu(w_lngLoop).strImageNm)
                        w_MenuMainButton.DisplayStyle = ToolStripItemDisplayStyle.ImageAndText
                        w_MenuMainButton.Size = New Size(16, 16)
                        '.Items.Item(w_Key).DisplayStyle = ToolStripItemDisplayStyle.ImageAndText
                        '.Items.Item(w_Key).Size = New Size(16, 16)
                        '.Items.Item(w_Key).PictureSize = 16
                        '.Items.Item(w_Key).UseMaskColor = False
                        '.Items.Item(w_Key).ToolTipText = m_udtChildMenu(w_lngLoop).strHanyoArea
                        w_MenuMainButton.Name = w_Key
                        w_MenuMainButton.ToolTipText = m_udtChildMenu(w_lngLoop).strHanyoArea

                        AddHandler w_MenuMainButton.Click, AddressOf sbtMenuMain_Click

                        .Items.Add(w_MenuMainButton)
                        ' それを標準ツールバーに追加します。
                        '.Items.Item("stbMenu").Tools.Add(w_Key, ActiveToolBars.Constants_Type.ssTypeButton, w_lngLoop)

                        '職員管理機能時は「部署別」ボタンを非表示にする
                        If M_STAFFIDO_RESCD.Equals(m_strDispMenu) AndAlso M_DISP_HAICHI.Equals(m_strBusyoHaichi) Then
                            If M_STAFFIDO_HAICHI.Equals(w_Key) Then
                                .Items.Item(w_lngLoop - 1).Visible = False
                            End If
                        Else
                            If M_STAFFIDO_BUSYO.Equals(w_Key) Then
                                .Items.Item(w_lngLoop - 1).Visible = False
                            End If
                        End If

                        If M_APPROVE_RESCD.Equals(m_strDispMenu) AndAlso M_DISP_MISYONIN.Equals(m_strAppliChange) Then
                            If M_APPRO_DAYOVER_CHG.Equals(w_Key) Then
                                .Items.Item(w_lngLoop - 1).Visible = False
                            End If
                        Else
                            If M_APPRO_APPLI_CHG.Equals(w_Key) Then
                                .Items.Item(w_lngLoop - 1).Visible = False
                            End If
                        End If
                        '日別超勤
                        If M_OVERKINMU_RESCD.Equals(m_strDispMenu) AndAlso M_STR_DAY.Equals(m_strOverKinmuDispType) Then
                            If M_APPRO_DAY_OVER.Equals(w_Key) Then
                                .Items.Item(w_lngLoop - 1).Visible = False
                            End If

                            '日付と勤務部署コードをキーにして、
                            '確定（ロック）情報を取得する
                            If General.g_objSecurity.mCheckAuthRangeKbn2(m_udtChildMenu(w_lngLoop).strUpdAuthRangeKbn, w_strAuthRangeKbn) = True Then

                                If w_blnLockFlg = True Then
                                    If M_APPRO_DAY_OVER_LOCK.Equals(w_Key) Then
                                        .Items.Item(w_lngLoop - 1).Visible = False
                                    ElseIf M_APPRO_DAY_OVER_LOCK_OUT.Equals(w_Key) Then
                                        .Items.Item(w_lngLoop - 1).Visible = True
                                    End If
                                Else
                                    If M_APPRO_DAY_OVER_LOCK.Equals(w_Key) Then
                                        .Items.Item(w_lngLoop - 1).Visible = True
                                    ElseIf M_APPRO_DAY_OVER_LOCK_OUT.Equals(w_Key) Then
                                        .Items.Item(w_lngLoop - 1).Visible = False
                                    End If
                                End If
                            Else
                                .Items.Item(w_lngLoop - 1).Visible = False
                            End If
                            '日別に研修申込は表示しない
                            If M_PER_STUDY.Equals(w_Key) Then
                                .Items.Item(w_lngLoop - 1).Visible = False
                            End If

                            '個人別超勤
                        ElseIf M_OVERKINMU_RESCD.Equals(m_strDispMenu) AndAlso M_STR_PERSONAL.Equals(m_strOverKinmuDispType) Then
                            If M_APPRO_PERSONAL_OVER.Equals(w_Key) Then
                                .Items.Item(w_lngLoop - 1).Visible = False
                            End If
                            If M_APPRO_DAY_OVER_LOCK.Equals(w_Key) Then
                                .Items.Item(w_lngLoop - 1).Visible = False
                            End If
                            If M_APPRO_DAY_OVER_LOCK_OUT.Equals(w_Key) Then
                                .Items.Item(w_lngLoop - 1).Visible = False
                            End If
                        End If

                        'サブメニューの親子関係チェック
                        '汎用エリア２が空白は"親"
                        '汎用エリア２が空白以外の場合は、親が表示中の場合のみ表示
                        '汎用エリア２には、親のリソースコードが入力されています。
                        '汎用エリア２が空白の場合は親なので、常に表示
                        If String.IsNullOrEmpty(m_udtChildMenu(w_lngLoop).strHanyoArea2) = False Then

                            '選択されたツールインデックスを親に持つ子供のみ表示
                            If m_strSelChildMenu.Equals(m_udtChildMenu(w_lngLoop).strHanyoArea2) Then

                                .Items.Item(w_lngLoop - 1).Visible = True
                                .Items.Item(w_lngLoop - 1).Enabled = True

                                '選択されたツールインデックスが親でない子供は非表示にする
                            Else

                                .Items.Item(w_lngLoop - 1).Visible = False
                                .Items.Item(w_lngLoop - 1).Enabled = False

                            End If
                        End If
                        '職員基本情報が使えるか否か
                        If M_STAFFIDO_KIHON.Equals(m_udtChildMenu(w_lngLoop).strResCD) Then
                            m_blnStaffKihonInfo = True
                        End If

                        '勤務自動バッチが見えてしまうので隠す
                        If M_DEPT_MAKEKINMU_NIGHTCREATE.Equals(m_udtChildMenu(w_lngLoop).strResCD) Then
                            .Items.Item(w_lngLoop - 1).Visible = False
                        End If

                        '実績変更ﾎﾞﾀﾝを表示しない
                        If M_DEPT_MAKEKINMU_RESULT.Equals(m_udtChildMenu(w_lngLoop).strResCD) Then
                            .Items.Item(w_lngLoop - 1).Visible = False
                        End If

                        'FD出力
                        If M_STAFFIDO_FILE.Equals(w_Key) AndAlso m_LoopFlg <> 0 Then

                            If m_LoopFlg = 2 Then
                                'タブ変更かつ初期選択が大項目だった場合
                                .Items.Item(w_lngLoop - 1).Visible = False
                            ElseIf m_LoopFlg = 3 AndAlso String.IsNullOrEmpty(General.g_strSelKinmuDeptCD) Then
                                '職員管理画面へ遷移かつ初期選択が大項目だった場合
                                .Items.Item(w_lngLoop - 1).Visible = False
                            ElseIf General.paLeft(tvwKinmuDept.SelectedNode.Name, 4).Equals(M_NodeKey_DEPT) = False _
                                AndAlso M_strNoConfCD.Equals(tvwKinmuDept.SelectedNode.Name) = False _
                                AndAlso M_strRetireCD.Equals(tvwKinmuDept.SelectedNode.Name) = False _
                                AndAlso M_strSearchCD.Equals(tvwKinmuDept.SelectedNode.Name) = False Then
                                '選択ノードが大項目だった場合表示しない
                                .Items.Item(w_lngLoop - 1).Visible = False
                            End If
                        End If

                    End If

                    '職員登録が触れる人にだけ、職員削除の権限を持たせる
                    If m_udtChildMenu(w_lngLoop).strResCD = M_STAFFIDO_DELETE Then
                        m_blnStaffDeleteFlg = True
                    End If

                    '全表示ボタンを押すと承認操作を非表示にする
                    If M_APPRO_ALLDSP.Equals(m_strSelChildMenu) _
                        AndAlso M_APPRO_ALLAPPRO.Equals(m_udtChildMenu(w_lngLoop).strResCD) Then
                        .Items.Item(w_lngLoop - 1).Visible = False
                    End If
                Next w_lngLoop

            End With

            '解放
            w_objTool = Nothing

        Catch ex As Exception
            Call General.paTrpMsg(Convert.ToString(Err.Number), W_SUBNAME)
        End Try
    End Sub

    '================================
    '時間外ロック情報 取得
    '================================
    Private Function sGetOverKinmuLockUse() As String
        Const W_SUBNAME As String = "NSC0000HA sGetOverKinmuLockUse"


        Dim w_Rs As ADODB.Recordset
        Dim w_strSql As String
        Dim w_KinmuLevelCD1_F As ADODB.Field '階層レベルコード１
        Dim w_KinmuLevelCD2_F As ADODB.Field '階層レベルコード２
        Dim w_KinmuLevelCD3_F As ADODB.Field '階層レベルコード３
        Dim w_KinmuLevelCD4_F As ADODB.Field '階層レベルコード４
        Dim w_KinmuLevelCD5_F As ADODB.Field '階層レベルコード５

        Dim w_strKinmuLevelCD1 As String
        Dim w_strKinmuLevelCD2 As String
        Dim w_strKinmuLevelCD3 As String
        Dim w_strKinmuLevelCD4 As String
        Dim w_strKinmuLevelCD5 As String

        Dim w_lngKinmuDept As Integer
        Dim w_lngLoop As Integer

        sGetOverKinmuLockUse = "-"
        Try
            If General.g_objSecurity.mGetUserKinmuDeptInfo(General.paGetDateIntegerFromDate(m_CalDate)) = False Then

                Exit Function

            Else

                w_strSql = ""
                w_strSql = "SELECT        CLASSLEVELCD1"
                w_strSql = w_strSql & " , CLASSLEVELCD2"
                w_strSql = w_strSql & " , CLASSLEVELCD3"
                w_strSql = w_strSql & " , CLASSLEVELCD4"
                w_strSql = w_strSql & " , CLASSLEVELCD5"
                w_strSql = w_strSql & " FROM  NS_KINMUDEPT_M  "
                w_strSql = w_strSql & " WHERE HOSPITALCD   = '" & Trim(General.g_strHospitalCD) & "'"
                w_strSql = w_strSql & " AND   KINMUDEPTCD = '" & General.g_strSelKinmuDeptCD & "' "
                'RECORDSET ｵﾌﾞｼﾞｪｸﾄの作成
                w_Rs = General.paDBRecordSetOpen(w_strSql)

                If w_Rs.RecordCount <= 0 Then

                    w_Rs.Close()
                    w_Rs = Nothing

                    sGetOverKinmuLockUse = "0"
                    Exit Function

                Else
                    With w_Rs
                        .MoveFirst()

                        w_KinmuLevelCD1_F = .Fields("CLASSLEVELCD1")
                        w_KinmuLevelCD2_F = .Fields("CLASSLEVELCD2")
                        w_KinmuLevelCD3_F = .Fields("CLASSLEVELCD3")
                        w_KinmuLevelCD4_F = .Fields("CLASSLEVELCD4")
                        w_KinmuLevelCD5_F = .Fields("CLASSLEVELCD5")

                        w_strKinmuLevelCD1 = General.paGetDbFieldVal(w_KinmuLevelCD1_F, "")
                        w_strKinmuLevelCD2 = General.paGetDbFieldVal(w_KinmuLevelCD2_F, "")
                        w_strKinmuLevelCD3 = General.paGetDbFieldVal(w_KinmuLevelCD3_F, "")
                        w_strKinmuLevelCD4 = General.paGetDbFieldVal(w_KinmuLevelCD4_F, "")
                        w_strKinmuLevelCD5 = General.paGetDbFieldVal(w_KinmuLevelCD5_F, "")

                        w_lngKinmuDept = General.g_objSecurity.fUK_KinmuDeptCount

                        '階層レベルのチェック
                        For w_lngLoop = 1 To w_lngKinmuDept

                            General.g_objSecurity.mUK_KinmuDeptIdx = w_lngLoop

                            'ツリーリストで選択した部署の場合
                            If General.g_objSecurity.fuk_KinmuDeptCD.Equals(General.g_strSelKinmuDeptCD) Then
                                '階層レベルコード１が一致しなかった場合
                                If General.g_objSecurity.fUK_KinmuLevelCD1.Equals(Trim(w_strKinmuLevelCD1)) = False Then
                                    '全員権限を設定して終了
                                    sGetOverKinmuLockUse = "0"

                                    '階層レベルコード１が一致、
                                    '階層レベルコード２が一致しなかった場合
                                ElseIf General.g_objSecurity.fUK_KinmuLevelCD1.Equals(Trim(w_strKinmuLevelCD1)) _
                                    AndAlso General.g_objSecurity.fUK_KinmuLevelCD2.Equals(Trim(w_strKinmuLevelCD2)) = False Then
                                    'レベル１を設定して終了
                                    sGetOverKinmuLockUse = "1"

                                    '階層レベルコード１が一致、
                                    '階層レベルコード２が一致、
                                    '階層レベルコード３が一致しなかった場合
                                ElseIf General.g_objSecurity.fUK_KinmuLevelCD1.Equals(Trim(w_strKinmuLevelCD1)) _
                                    AndAlso General.g_objSecurity.fUK_KinmuLevelCD2.Equals(Trim(w_strKinmuLevelCD2)) _
                                    AndAlso General.g_objSecurity.fUK_KinmuLevelCD3.Equals(Trim(w_strKinmuLevelCD3)) = False Then
                                    'レベル２を設定して終了
                                    sGetOverKinmuLockUse = "2"

                                    '階層レベルコード１が一致、
                                    '階層レベルコード２が一致、
                                    '階層レベルコード３が一致、
                                    '階層レベルコード４が一致しなかった場合
                                ElseIf General.g_objSecurity.fUK_KinmuLevelCD1.Equals(Trim(w_strKinmuLevelCD1)) _
                                    AndAlso General.g_objSecurity.fUK_KinmuLevelCD2.Equals(Trim(w_strKinmuLevelCD2)) _
                                    AndAlso General.g_objSecurity.fUK_KinmuLevelCD3.Equals(Trim(w_strKinmuLevelCD3)) _
                                    AndAlso General.g_objSecurity.fUK_KinmuLevelCD4.Equals(Trim(w_strKinmuLevelCD4)) = False Then

                                    'レベル３を設定して終了
                                    sGetOverKinmuLockUse = "3"

                                    '階層レベルコード１が一致、
                                    '階層レベルコード２が一致、
                                    '階層レベルコード３が一致、
                                    '階層レベルコード４が一致、
                                    '階層レベルコード５が一致しなかった場合
                                ElseIf General.g_objSecurity.fUK_KinmuLevelCD1.Equals(Trim(w_strKinmuLevelCD1)) _
                                    AndAlso General.g_objSecurity.fUK_KinmuLevelCD2.Equals(Trim(w_strKinmuLevelCD2)) _
                                    AndAlso General.g_objSecurity.fUK_KinmuLevelCD3.Equals(Trim(w_strKinmuLevelCD3)) _
                                    AndAlso General.g_objSecurity.fUK_KinmuLevelCD4.Equals(Trim(w_strKinmuLevelCD4)) _
                                    AndAlso General.g_objSecurity.fUK_KinmuLevelCD5.Equals(Trim(w_strKinmuLevelCD5)) = False Then
                                    'レベル４を設定して終了
                                    sGetOverKinmuLockUse = "4"

                                    '階層レベルコード１が一致、
                                    '階層レベルコード２が一致、
                                    '階層レベルコード３が一致、
                                    '階層レベルコード４が一致、
                                    '階層レベルコード５が一致、
                                    '勤務部署コードが一致しなかった場合
                                ElseIf General.g_objSecurity.fUK_KinmuLevelCD1.Equals(Trim(w_strKinmuLevelCD1)) _
                                    AndAlso General.g_objSecurity.fUK_KinmuLevelCD2.Equals(Trim(w_strKinmuLevelCD2)) _
                                    AndAlso General.g_objSecurity.fUK_KinmuLevelCD3.Equals(Trim(w_strKinmuLevelCD3)) _
                                    AndAlso General.g_objSecurity.fUK_KinmuLevelCD4.Equals(Trim(w_strKinmuLevelCD4)) _
                                    AndAlso General.g_objSecurity.fUK_KinmuLevelCD5.Equals(Trim(w_strKinmuLevelCD5)) _
                                    AndAlso General.g_objSecurity.fuk_KinmuDeptCD.Equals(IIf(String.IsNullOrEmpty(General.g_strSelKinmuDeptCD), "", Trim(General.g_strSelKinmuDeptCD))) = False Then
                                    'レベル５を設定して終了
                                    sGetOverKinmuLockUse = "5"
                                    '勤務部署コードが一致した倍
                                ElseIf General.g_objSecurity.fuk_KinmuDeptCD.Equals(IIf(String.IsNullOrEmpty(General.g_strSelKinmuDeptCD), "", Trim(General.g_strSelKinmuDeptCD))) Then
                                    '勤務部署指定を設定して終了
                                    sGetOverKinmuLockUse = "9"
                                End If

                                Exit For
                            End If
                        Next w_lngLoop

                    End With
                End If

            End If

            w_Rs.Close()
            w_Rs = Nothing

        Catch ex As Exception
            Call General.paTrpMsg(Convert.ToString(Err.Number), W_SUBNAME)
        End Try
    End Function

    '=======================================
    'リストビュー設定
    '=======================================
    Private Sub sSetListView()
        Const W_SUBNAME As String = "NSC0000HA sSetListView"

        Try
            Dim w_column As System.Windows.Forms.ColumnHeader
            Dim lvwMainHol As System.Windows.Forms.ListView
            Dim w_WarddeptFlg As String '勤務＝配属フラグ（"1"：勤務＝配属、"0"：勤務≠配属)
            w_WarddeptFlg = General.paGetItemValue(General.G_STRMAINKEY1, General.G_STRSECTION1, "WORDDEPTFLG", "0", General.g_strHospitalCD)

            lvwMain.Columns.Clear()
            lvwMain.Items.Clear()

            If m_strSelChildMenu = M_PER_HOLIDAY_DSP Then
                '--------------------
                '■個人業務-休暇情報
                '--------------------
                With lvwMainHol
                    'ｱｲｺﾝの整列方法
                    .Alignment = System.Windows.Forms.ListViewAlignment.Top
                    'ﾘｽﾄﾋﾞｭｰﾀｲﾌﾟ設定
                    .View = System.Windows.Forms.View.Details
                    'ﾘｽﾄﾋﾞｭｰのItemｸﾘｱｰ
                    .Columns.Clear()
                    .Items.Clear()
                    .Sorting = SortOrder.Ascending
                    .FullRowSelect = True
                    .Scrollable = True
                    .GridLines = True
                    .Refresh()

                    'ラベル編集不可
                    .LabelEdit = False

                    'チェックボックス表示
                    .CheckBoxes = False

                    '-----------
                    '■休暇状況
                    '-----------
                    w_column = .Columns.Add("Key", "名称", General.paTwipsTopixels(1500), System.Windows.Forms.HorizontalAlignment.Left, "")
                    w_column = .Columns.Add("", "取得日数", General.paTwipsTopixels(1500), System.Windows.Forms.HorizontalAlignment.Left, "")
                    w_column = .Columns.Add("", "当年度合計", General.paTwipsTopixels(1500), System.Windows.Forms.HorizontalAlignment.Left, "")
                    w_column = .Columns.Add("", "残日数", General.paTwipsTopixels(1500), System.Windows.Forms.HorizontalAlignment.Left, "")


                End With
            ElseIf (M_PER_JISSEKI_DSP).Equals(m_strSelChildMenu) OrElse (M_PER_APPLI_DSP).Equals(m_strSelChildMenu) Then
                '----------------------------------------
                '■個人業務-実績状況, 個人業務-届出状況
                '----------------------------------------
                With lvwMain

                    'ｱｲｺﾝの整列方法
                    .Alignment = System.Windows.Forms.ListViewAlignment.Top
                    'ﾘｽﾄﾋﾞｭｰﾀｲﾌﾟ設定
                    .View = System.Windows.Forms.View.Details
                    'ﾘｽﾄﾋﾞｭｰのItemｸﾘｱｰ
                    .Columns.Clear()
                    .Items.Clear()
                    .FullRowSelect = True
                    .Scrollable = True
                    .GridLines = True
                    .Refresh()

                    'ラベル編集不可
                    .LabelEdit = False

                    '1回でも読み込んでいればOK
                    If imlSmallIcon.Images.Count <= 0 Then
                        With imlSmallIcon
                            .Images.Clear()
                            .ImageSize = New System.Drawing.Size(.ImageSize.Width, 20)
                            .ImageSize = New System.Drawing.Size(20, .ImageSize.Height)
                            .Images.Add("MAN", System.Drawing.Image.FromFile(g_ImagePath & "man.ico"))
                            .Images.Add("WOMAN", System.Drawing.Image.FromFile(g_ImagePath & "woman.ico"))
                            .Images.Add("MAN2", System.Drawing.Image.FromFile(g_ImagePath & "man2.jpg"))
                            .Images.Add("WOMAN2", System.Drawing.Image.FromFile(g_ImagePath & "woman2.jpg"))
                            .Images.Add("FINISH", System.Drawing.Image.FromFile(g_ImagePath & "Finish.ico"))
                            .Images.Add("UNFINISH", System.Drawing.Image.FromFile(g_ImagePath & "unFinish.ico"))
                            .Images.Add("ERROR", System.Drawing.Image.FromFile(g_ImagePath & "Error.ico"))
                            .Images.Add("GREEN", System.Drawing.Image.FromFile(g_ImagePath & "Blue.jpg"))
                            .Images.Add("BLUE", System.Drawing.Image.FromFile(g_ImagePath & "Green.jpg"))
                            .Images.Add("OVER1", System.Drawing.Image.FromFile(g_ImagePath & "未承認前.bmp"))
                            .Images.Add("OVER2", System.Drawing.Image.FromFile(g_ImagePath & "未承認.bmp"))
                            .Images.Add("OVER3", System.Drawing.Image.FromFile(g_ImagePath & "承認済.bmp"))
                            .Images.Add("OVER4", System.Drawing.Image.FromFile(g_ImagePath & "確定.bmp"))
                            .Images.Add("OVER5", System.Drawing.Image.FromFile(g_ImagePath & "差戻.bmp"))
                        End With
                    End If

                    .LargeImageList = imlSmallIcon
                    .SmallImageList = imlSmallIcon


                    'チェックボックス表示
                    .CheckBoxes = False

                    'ｶﾗﾑﾍｯﾀﾞｰの追加(使用コンポーネントにより変動する)
                    If M_PER_JISSEKI_DSP.Equals(m_strSelChildMenu) Then
                        '-----------
                        '■実績状況
                        '-----------
                        w_column = .Columns.Add("Key", "日付", General.paTwipsTopixels(1500), System.Windows.Forms.HorizontalAlignment.Left, "")
                        w_column = .Columns.Add("", "勤務", General.paTwipsTopixels(800), System.Windows.Forms.HorizontalAlignment.Left, "")
                        If m_blnDutyDispFlg = True Then
                            w_column = .Columns.Add("", "当直", General.paTwipsTopixels(800), System.Windows.Forms.HorizontalAlignment.Left, "")
                        End If
                        w_column = .Columns.Add("", "就業時間", General.paTwipsTopixels(1700), System.Windows.Forms.HorizontalAlignment.Left, "")
                        If m_blnOverKinmuDispFlg = True Then
                            w_column = .Columns.Add("", "時間外", General.paTwipsTopixels(2000), System.Windows.Forms.HorizontalAlignment.Left, "")
                        End If
                        If m_blnDakokuDispFlg = True Then
                            w_column = .Columns.Add("", "出退勤", General.paTwipsTopixels(2000), System.Windows.Forms.HorizontalAlignment.Left, "")
                        End If

                    ElseIf M_PER_APPLI_DSP.Equals(m_strSelChildMenu) Then
                        '-----------
                        '■届出状況
                        '-----------
                        w_column = .Columns.Add("Key", "連番", General.paTwipsTopixels(800), System.Windows.Forms.HorizontalAlignment.Left, "")
                        w_column = .Columns.Add("", "状態", General.paTwipsTopixels(1200), System.Windows.Forms.HorizontalAlignment.Left, "")
                        w_column = .Columns.Add("", "届出名称", General.paTwipsTopixels(1500), System.Windows.Forms.HorizontalAlignment.Left, "")
                        w_column = .Columns.Add("", "届出対象日", General.paTwipsTopixels(3500), System.Windows.Forms.HorizontalAlignment.Left, "")
                        w_column = .Columns.Add("", "申請日", General.paTwipsTopixels(1500), System.Windows.Forms.HorizontalAlignment.Left, "")
                        w_column = .Columns.Add("", "内容", General.paTwipsTopixels(3000), System.Windows.Forms.HorizontalAlignment.Left, "")
                    End If

                End With

            ElseIf M_DEPT_RESCD.Equals(g_MenuM(g_lngGroupIdx).ListBarMenu(g_lngListIdx).strResCD) Then

                If M_DEPT_KINMUINFO.Equals(m_strSelChildMenu) Then
                    '-------------
                    '■勤務部署
                    '-------------

                    With lvwDeptInfo
                        'ｱｲｺﾝの整列方法
                        .Alignment = System.Windows.Forms.ListViewAlignment.Top
                        'ﾘｽﾄﾋﾞｭｰﾀｲﾌﾟ設定
                        .View = System.Windows.Forms.View.Details
                        'ﾘｽﾄﾋﾞｭｰのItemｸﾘｱｰ
                        .Columns.Clear()
                        .Items.Clear()
                        .Sorting = SortOrder.Ascending
                        .FullRowSelect = True
                        .Scrollable = True
                        .GridLines = True
                        .Refresh()

                        'ラベル編集不可            'チェックボックス非表示
                        .CheckBoxes = False

                        .LabelEdit = False
                        'チェックボックス非表示
                        .CheckBoxes = False

                        '1回でも読み込んでいればOK
                        If imlSmallIcon.Images.Count <= 0 Then
                            With imlSmallIcon
                                .Images.Clear()
                                .ImageSize = New System.Drawing.Size(.ImageSize.Width, 20)
                                .ImageSize = New System.Drawing.Size(20, .ImageSize.Height)
                                .Images.Add("MAN", System.Drawing.Image.FromFile(g_ImagePath & "man.ico"))
                                .Images.Add("WOMAN", System.Drawing.Image.FromFile(g_ImagePath & "woman.ico"))
                                .Images.Add("MAN2", System.Drawing.Image.FromFile(g_ImagePath & "man2.jpg"))
                                .Images.Add("WOMAN2", System.Drawing.Image.FromFile(g_ImagePath & "woman2.jpg"))
                                .Images.Add("FINISH", System.Drawing.Image.FromFile(g_ImagePath & "Finish.ico"))
                                .Images.Add("UNFINISH", System.Drawing.Image.FromFile(g_ImagePath & "unFinish.ico"))
                                .Images.Add("ERROR", System.Drawing.Image.FromFile(g_ImagePath & "Error.ico"))
                                .Images.Add("GREEN", System.Drawing.Image.FromFile(g_ImagePath & "Blue.jpg"))
                                .Images.Add("BLUE", System.Drawing.Image.FromFile(g_ImagePath & "Green.jpg"))
                                .Images.Add("OVER1", System.Drawing.Image.FromFile(g_ImagePath & "未承認前.bmp"))
                                .Images.Add("OVER2", System.Drawing.Image.FromFile(g_ImagePath & "未承認.bmp"))
                                .Images.Add("OVER3", System.Drawing.Image.FromFile(g_ImagePath & "承認済.bmp"))
                                .Images.Add("OVER4", System.Drawing.Image.FromFile(g_ImagePath & "確定.bmp"))
                                .Images.Add("OVER5", System.Drawing.Image.FromFile(g_ImagePath & "差戻.bmp"))
                            End With
                        End If

                        .LargeImageList = imlSmallIcon
                        .SmallImageList = imlSmallIcon

                        w_column = .Columns.Add("Key", "連番", General.paTwipsTopixels(1000), System.Windows.Forms.HorizontalAlignment.Left, "")
                        w_column = .Columns.Add("", "職員番号", General.paTwipsTopixels(1800), System.Windows.Forms.HorizontalAlignment.Left, "")
                        w_column = .Columns.Add("", "氏名", General.paTwipsTopixels(2500), System.Windows.Forms.HorizontalAlignment.Left, "")
                        w_column = .Columns.Add("", "勤務", General.paTwipsTopixels(1500), System.Windows.Forms.HorizontalAlignment.Left, "")
                        w_column = .Columns.Add("", "役職", General.paTwipsTopixels(2000), System.Windows.Forms.HorizontalAlignment.Left, "")
                        w_column = .Columns.Add("", "職種", General.paTwipsTopixels(2000), System.Windows.Forms.HorizontalAlignment.Left, "")

                    End With

                ElseIf m_strSelChildMenu = M_DEPT_OVERTIME Then
                    '----------------
                    '■時間外状況
                    '----------------

                    With lvwDeptInfo
                        'ｱｲｺﾝの整列方法
                        .Alignment = System.Windows.Forms.ListViewAlignment.Top
                        'ﾘｽﾄﾋﾞｭｰﾀｲﾌﾟ設定
                        .View = System.Windows.Forms.View.Details
                        'ﾘｽﾄﾋﾞｭｰのItemｸﾘｱｰ
                        .Columns.Clear()
                        .Items.Clear()
                        .Sorting = SortOrder.Ascending
                        .FullRowSelect = True
                        .Scrollable = True
                        .GridLines = True
                        .Refresh()

                        'ラベル編集不可            'チェックボックス非表示
                        .CheckBoxes = False

                        .LabelEdit = False
                        'チェックボックス非表示
                        .CheckBoxes = False

                        '1回でも読み込んでいればOK
                        If imlSmallIcon.Images.Count <= 0 Then
                            With imlSmallIcon
                                .Images.Clear()
                                .ImageSize = New System.Drawing.Size(.ImageSize.Width, 20)
                                .ImageSize = New System.Drawing.Size(20, .ImageSize.Height)
                                .Images.Add("MAN", System.Drawing.Image.FromFile(g_ImagePath & "man.ico"))
                                .Images.Add("WOMAN", System.Drawing.Image.FromFile(g_ImagePath & "woman.ico"))
                                .Images.Add("MAN2", System.Drawing.Image.FromFile(g_ImagePath & "man2.jpg"))
                                .Images.Add("WOMAN2", System.Drawing.Image.FromFile(g_ImagePath & "woman2.jpg"))
                                .Images.Add("FINISH", System.Drawing.Image.FromFile(g_ImagePath & "Finish.ico"))
                                .Images.Add("UNFINISH", System.Drawing.Image.FromFile(g_ImagePath & "unFinish.ico"))
                                .Images.Add("ERROR", System.Drawing.Image.FromFile(g_ImagePath & "Error.ico"))
                                .Images.Add("GREEN", System.Drawing.Image.FromFile(g_ImagePath & "Blue.jpg"))
                                .Images.Add("BLUE", System.Drawing.Image.FromFile(g_ImagePath & "Green.jpg"))
                                .Images.Add("OVER1", System.Drawing.Image.FromFile(g_ImagePath & "未承認前.bmp"))
                                .Images.Add("OVER2", System.Drawing.Image.FromFile(g_ImagePath & "未承認.bmp"))
                                .Images.Add("OVER3", System.Drawing.Image.FromFile(g_ImagePath & "承認済.bmp"))
                                .Images.Add("OVER4", System.Drawing.Image.FromFile(g_ImagePath & "確定.bmp"))
                                .Images.Add("OVER5", System.Drawing.Image.FromFile(g_ImagePath & "差戻.bmp"))
                            End With
                        End If

                        .LargeImageList = imlSmallIcon
                        .SmallImageList = imlSmallIcon

                        w_column = .Columns.Add("Key", "連番", General.paTwipsTopixels(800), System.Windows.Forms.HorizontalAlignment.Left, "")
                        w_column = .Columns.Add("", "職員番号", General.paTwipsTopixels(1500), System.Windows.Forms.HorizontalAlignment.Left, "")
                        w_column = .Columns.Add("", "氏名", General.paTwipsTopixels(1800), System.Windows.Forms.HorizontalAlignment.Left, "")
                        w_column = .Columns.Add("", "100/100", General.paTwipsTopixels(1200), System.Windows.Forms.HorizontalAlignment.Right, "")
                        w_column = .Columns.Add("", "125/100", General.paTwipsTopixels(1200), System.Windows.Forms.HorizontalAlignment.Right, "")
                        w_column = .Columns.Add("", "150/100", General.paTwipsTopixels(1200), System.Windows.Forms.HorizontalAlignment.Right, "")
                        w_column = .Columns.Add("", "135/100", General.paTwipsTopixels(1200), System.Windows.Forms.HorizontalAlignment.Right, "")
                        w_column = .Columns.Add("", "160/100", General.paTwipsTopixels(1200), System.Windows.Forms.HorizontalAlignment.Right, "")
                        w_column = .Columns.Add("", "合計", General.paTwipsTopixels(1200), System.Windows.Forms.HorizontalAlignment.Right, "")

                    End With
                End If

                '===============
                '職員一覧
                '===============
                With lvwDeptStaff
                    'ｱｲｺﾝの整列方法
                    .Alignment = System.Windows.Forms.ListViewAlignment.Top
                    'ﾘｽﾄﾋﾞｭｰﾀｲﾌﾟ設定
                    .View = System.Windows.Forms.View.Details
                    'ﾘｽﾄﾋﾞｭｰのItemｸﾘｱｰ
                    .Columns.Clear()
                    .Items.Clear()
                    .FullRowSelect = True
                    .Scrollable = True
                    .GridLines = True
                    .Refresh()

                    'ラベル編集不可
                    .LabelEdit = False

                    w_column = .Columns.Add("Key", "職員番号", General.paTwipsTopixels(1500), System.Windows.Forms.HorizontalAlignment.Left, "")
                    w_column = .Columns.Add("", "氏名", General.paTwipsTopixels(1800), System.Windows.Forms.HorizontalAlignment.Left, "")

                End With

            ElseIf g_MenuM(g_lngGroupIdx).ListBarMenu(g_lngListIdx).strResCD = M_APPROVE_RESCD Then
                '--------------
                '■未承認業務
                '--------------

                With lvwDeptInfo
                    'ｱｲｺﾝの整列方法
                    .Alignment = System.Windows.Forms.ListViewAlignment.Top
                    'ﾘｽﾄﾋﾞｭｰﾀｲﾌﾟ設定
                    .View = System.Windows.Forms.View.Details
                    'ﾘｽﾄﾋﾞｭｰのItemｸﾘｱｰ
                    .Columns.Clear()
                    .Items.Clear()
                    .Sorting = SortOrder.Ascending
                    .FullRowSelect = True
                    .Scrollable = True
                    .GridLines = True
                    .Refresh()

                    'ラベル編集不可
                    .LabelEdit = False

                    '1回でも読み込んでいればOK
                    If imlSmallIcon.Images.Count <= 0 Then
                        With imlSmallIcon
                            .Images.Clear()
                            .ImageSize = New System.Drawing.Size(.ImageSize.Width, 20)
                            .ImageSize = New System.Drawing.Size(20, .ImageSize.Height)
                            .Images.Add("MAN", System.Drawing.Image.FromFile(g_ImagePath & "man.ico"))
                            .Images.Add("WOMAN", System.Drawing.Image.FromFile(g_ImagePath & "woman.ico"))
                            .Images.Add("MAN2", System.Drawing.Image.FromFile(g_ImagePath & "man2.jpg"))
                            .Images.Add("WOMAN2", System.Drawing.Image.FromFile(g_ImagePath & "woman2.jpg"))
                            .Images.Add("FINISH", System.Drawing.Image.FromFile(g_ImagePath & "Finish.ico"))
                            .Images.Add("UNFINISH", System.Drawing.Image.FromFile(g_ImagePath & "unFinish.ico"))
                            .Images.Add("ERROR", System.Drawing.Image.FromFile(g_ImagePath & "Error.ico"))
                            .Images.Add("GREEN", System.Drawing.Image.FromFile(g_ImagePath & "Blue.jpg"))
                            .Images.Add("BLUE", System.Drawing.Image.FromFile(g_ImagePath & "Green.jpg"))
                            .Images.Add("OVER1", System.Drawing.Image.FromFile(g_ImagePath & "未承認前.bmp"))
                            .Images.Add("OVER2", System.Drawing.Image.FromFile(g_ImagePath & "未承認.bmp"))
                            .Images.Add("OVER3", System.Drawing.Image.FromFile(g_ImagePath & "承認済.bmp"))
                            .Images.Add("OVER4", System.Drawing.Image.FromFile(g_ImagePath & "確定.bmp"))
                            .Images.Add("OVER5", System.Drawing.Image.FromFile(g_ImagePath & "差戻.bmp"))
                        End With
                    End If

                    .LargeImageList = imlSmallIcon
                    .SmallImageList = imlSmallIcon

                    If M_APPRO_DSP.Equals(m_strSelChildMenu) Then
                        '未承認一覧
                        'チェックボックス表示
                        .CheckBoxes = True

                        w_column = .Columns.Add("Key", "", General.paTwipsTopixels(350), System.Windows.Forms.HorizontalAlignment.Left, "")
                        w_column = .Columns.Add("Mark", "", General.paTwipsTopixels(430), System.Windows.Forms.HorizontalAlignment.Left, "")
                        w_column = .Columns.Add("", "職員番号", General.paTwipsTopixels(1500), System.Windows.Forms.HorizontalAlignment.Left, "")
                        w_column = .Columns.Add("", "氏名", General.paTwipsTopixels(2000), System.Windows.Forms.HorizontalAlignment.Left, "")
                        w_column = .Columns.Add("", "勤務部署", General.paTwipsTopixels(2000), System.Windows.Forms.HorizontalAlignment.Left, "")
                        w_column = .Columns.Add("", "届出分類", General.paTwipsTopixels(2000), System.Windows.Forms.HorizontalAlignment.Left, "")
                        w_column = .Columns.Add("", "届出対象日", General.paTwipsTopixels(2200), System.Windows.Forms.HorizontalAlignment.Left, "")
                        w_column = .Columns.Add("", "詳細", General.paTwipsTopixels(7000), System.Windows.Forms.HorizontalAlignment.Left, "")
                        w_column = .Columns.Add("", "申請時間累計", General.paTwipsTopixels(1900), System.Windows.Forms.HorizontalAlignment.Left, "")
                        w_column = .Columns.Add("", "承認済累計", General.paTwipsTopixels(1600), System.Windows.Forms.HorizontalAlignment.Left, "")

                    ElseIf M_APPRO_ALLDSP.Equals(m_strSelChildMenu) Then
                        '全表示
                        'チェックボックス非表示
                        .CheckBoxes = False

                        w_column = .Columns.Add("Key", "連番", General.paTwipsTopixels(850), System.Windows.Forms.HorizontalAlignment.Left, "")
                        w_column = .Columns.Add("Mark", "", General.paTwipsTopixels(430), System.Windows.Forms.HorizontalAlignment.Left, "")
                        w_column = .Columns.Add("", "職員番号", General.paTwipsTopixels(1500), System.Windows.Forms.HorizontalAlignment.Left, "")
                        w_column = .Columns.Add("", "氏名", General.paTwipsTopixels(2000), System.Windows.Forms.HorizontalAlignment.Left, "")
                        w_column = .Columns.Add("", "勤務部署", General.paTwipsTopixels(2000), System.Windows.Forms.HorizontalAlignment.Left, "")
                        w_column = .Columns.Add("", "届出分類", General.paTwipsTopixels(2000), System.Windows.Forms.HorizontalAlignment.Left, "")
                        w_column = .Columns.Add("", "届出対象日", General.paTwipsTopixels(2200), System.Windows.Forms.HorizontalAlignment.Left, "")
                        w_column = .Columns.Add("", "詳細", General.paTwipsTopixels(7000), System.Windows.Forms.HorizontalAlignment.Left, "")
                        w_column = .Columns.Add("", "申請時間累計", General.paTwipsTopixels(1600), System.Windows.Forms.HorizontalAlignment.Left, "")
                        w_column = .Columns.Add("", "承認済累計", General.paTwipsTopixels(1600), System.Windows.Forms.HorizontalAlignment.Left, "")

                    ElseIf M_APPRO_DAYOVER.Equals(m_strSelChildMenu) Then
                        '日別超過勤務入力
                        .CheckBoxes = False
                        w_column = .Columns.Add("Key", "連番", General.paTwipsTopixels(850), System.Windows.Forms.HorizontalAlignment.Left, "")
                        w_column = .Columns.Add("", "職員番号", General.paTwipsTopixels(1500), System.Windows.Forms.HorizontalAlignment.Left, "")
                        w_column = .Columns.Add("", "氏名", General.paTwipsTopixels(2700), System.Windows.Forms.HorizontalAlignment.Left, "")
                        w_column = .Columns.Add("", "開始　終了(勤務)", General.paTwipsTopixels(2500), System.Windows.Forms.HorizontalAlignment.Left, "")
                        w_column = .Columns.Add("", "開始　終了(時間外理由)", General.paTwipsTopixels(3100), System.Windows.Forms.HorizontalAlignment.Left, "")
                        w_column = .Columns.Add("", "100/100", General.paTwipsTopixels(1100), System.Windows.Forms.HorizontalAlignment.Left, "")
                        w_column = .Columns.Add("", "125/100", General.paTwipsTopixels(1100), System.Windows.Forms.HorizontalAlignment.Left, "")
                        w_column = .Columns.Add("", "150/100", General.paTwipsTopixels(1100), System.Windows.Forms.HorizontalAlignment.Left, "")
                        w_column = .Columns.Add("", "135/100", General.paTwipsTopixels(1100), System.Windows.Forms.HorizontalAlignment.Left, "")
                        w_column = .Columns.Add("", "160/100", General.paTwipsTopixels(1100), System.Windows.Forms.HorizontalAlignment.Left, "")
                        w_column = .Columns.Add("", "月間合計", General.paTwipsTopixels(1150), System.Windows.Forms.HorizontalAlignment.Left, "")

                    End If

                End With


            ElseIf M_DAKOKU_RESCD.Equals(g_MenuM(g_lngGroupIdx).ListBarMenu(g_lngListIdx).strResCD) Then
                '---------------------------------
                '■出退勤(部署リストビューを共有)
                '---------------------------------

                With lvwDeptInfo
                    'ｱｲｺﾝの整列方法
                    .Alignment = System.Windows.Forms.ListViewAlignment.Top
                    'ﾘｽﾄﾋﾞｭｰﾀｲﾌﾟ設定
                    .View = System.Windows.Forms.View.Details
                    'ﾘｽﾄﾋﾞｭｰのItemｸﾘｱｰ
                    .Columns.Clear()
                    .Items.Clear()
                    .Sorting = SortOrder.Ascending
                    .FullRowSelect = True
                    .Scrollable = True
                    .GridLines = True
                    .Refresh()

                    'ラベル編集不可
                    .LabelEdit = False
                    'チェックボックス非表示
                    .CheckBoxes = False

                    '1回でも読み込んでいればOK
                    If imlSmallIcon.Images.Count <= 0 Then
                        With imlSmallIcon
                            .Images.Clear()
                            .ImageSize = New System.Drawing.Size(.ImageSize.Width, 20)
                            .ImageSize = New System.Drawing.Size(20, .ImageSize.Height)
                            .Images.Add("MAN", System.Drawing.Image.FromFile(g_ImagePath & "man.ico"))
                            .Images.Add("WOMAN", System.Drawing.Image.FromFile(g_ImagePath & "woman.ico"))
                            .Images.Add("MAN2", System.Drawing.Image.FromFile(g_ImagePath & "man2.jpg"))
                            .Images.Add("WOMAN2", System.Drawing.Image.FromFile(g_ImagePath & "woman2.jpg"))
                            .Images.Add("FINISH", System.Drawing.Image.FromFile(g_ImagePath & "Finish.ico"))
                            .Images.Add("UNFINISH", System.Drawing.Image.FromFile(g_ImagePath & "unFinish.ico"))
                            .Images.Add("ERROR", System.Drawing.Image.FromFile(g_ImagePath & "Error.ico"))
                            .Images.Add("GREEN", System.Drawing.Image.FromFile(g_ImagePath & "Blue.jpg"))
                            .Images.Add("BLUE", System.Drawing.Image.FromFile(g_ImagePath & "Green.jpg"))
                            .Images.Add("OVER1", System.Drawing.Image.FromFile(g_ImagePath & "未承認前.bmp"))
                            .Images.Add("OVER2", System.Drawing.Image.FromFile(g_ImagePath & "未承認.bmp"))
                            .Images.Add("OVER3", System.Drawing.Image.FromFile(g_ImagePath & "承認済.bmp"))
                            .Images.Add("OVER4", System.Drawing.Image.FromFile(g_ImagePath & "確定.bmp"))
                            .Images.Add("OVER5", System.Drawing.Image.FromFile(g_ImagePath & "差戻.bmp"))
                        End With
                    End If

                    .LargeImageList = imlSmallIcon
                    .SmallImageList = imlSmallIcon

                    If M_DAKOKU_DSP.Equals(m_strSelChildMenu) Then
                        w_column = .Columns.Add("Key", "連番", General.paTwipsTopixels(900), System.Windows.Forms.HorizontalAlignment.Left, "")
                        w_column = .Columns.Add("", "出勤", General.paTwipsTopixels(1000), System.Windows.Forms.HorizontalAlignment.Left, "")
                        w_column = .Columns.Add("", "退勤", General.paTwipsTopixels(1000), System.Windows.Forms.HorizontalAlignment.Left, "")
                        w_column = .Columns.Add("", "職員番号", General.paTwipsTopixels(1800), System.Windows.Forms.HorizontalAlignment.Left, "")
                        w_column = .Columns.Add("", "氏名", General.paTwipsTopixels(1800), System.Windows.Forms.HorizontalAlignment.Left, "")
                        w_column = .Columns.Add("", "勤務", General.paTwipsTopixels(1300), System.Windows.Forms.HorizontalAlignment.Left, "")
                        w_column = .Columns.Add("", "PHS", General.paTwipsTopixels(1500), System.Windows.Forms.HorizontalAlignment.Left, "")
                    ElseIf M_DAKOKU_ERROR_DSP.Equals(m_strSelChildMenu) Then
                        w_column = .Columns.Add("Key", "連番", General.paTwipsTopixels(900), System.Windows.Forms.HorizontalAlignment.Left, "")
                        w_column = .Columns.Add("", "出勤", General.paTwipsTopixels(1000), System.Windows.Forms.HorizontalAlignment.Left, "")
                        w_column = .Columns.Add("", "退勤", General.paTwipsTopixels(1000), System.Windows.Forms.HorizontalAlignment.Left, "")
                        w_column = .Columns.Add("", "職員番号", General.paTwipsTopixels(1800), System.Windows.Forms.HorizontalAlignment.Left, "")
                        w_column = .Columns.Add("", "氏名", General.paTwipsTopixels(1800), System.Windows.Forms.HorizontalAlignment.Left, "")
                        w_column = .Columns.Add("", "勤務", General.paTwipsTopixels(1300), System.Windows.Forms.HorizontalAlignment.Left, "")
                        w_column = .Columns.Add("", "内容", General.paTwipsTopixels(1500), System.Windows.Forms.HorizontalAlignment.Left, "")
                    End If

                End With

                '===============
                '職員一覧
                '===============
                With lvwDeptStaff
                    'ｱｲｺﾝの整列方法
                    .Alignment = System.Windows.Forms.ListViewAlignment.Top
                    'ﾘｽﾄﾋﾞｭｰﾀｲﾌﾟ設定
                    .View = System.Windows.Forms.View.Details
                    'ﾘｽﾄﾋﾞｭｰのItemｸﾘｱｰ
                    .Columns.Clear()
                    .Items.Clear()
                    .FullRowSelect = True
                    .Scrollable = True
                    .GridLines = True
                    .Refresh()

                    'ラベル編集不可
                    .LabelEdit = False

                    w_column = .Columns.Add("Key", "職員番号", General.paTwipsTopixels(1500), System.Windows.Forms.HorizontalAlignment.Left, "")
                    w_column = .Columns.Add("", "氏名", General.paTwipsTopixels(1800), System.Windows.Forms.HorizontalAlignment.Left, "")

                End With

            ElseIf M_DUTY_RESCD.Equals(g_MenuM(g_lngGroupIdx).ListBarMenu(g_lngListIdx).strResCD) Then
                '---------------------------------
                '■日当直(部署リストビューを共有)
                '---------------------------------

                With lvwDeptInfo
                    'ｱｲｺﾝの整列方法
                    .Alignment = System.Windows.Forms.ListViewAlignment.Top
                    'ﾘｽﾄﾋﾞｭｰﾀｲﾌﾟ設定
                    .View = System.Windows.Forms.View.Details
                    'ﾘｽﾄﾋﾞｭｰのItemｸﾘｱｰ
                    .Columns.Clear()
                    .Items.Clear()
                    .Sorting = SortOrder.Ascending
                    .FullRowSelect = True
                    .Scrollable = True
                    .GridLines = True
                    .Refresh()

                    'ラベル編集不可
                    .LabelEdit = False
                    'チェックボックス非表示
                    .CheckBoxes = False

                    '1回でも読み込んでいればOK
                    If imlSmallIcon.Images.Count <= 0 Then
                        With imlSmallIcon
                            .Images.Clear()
                            .ImageSize = New System.Drawing.Size(.ImageSize.Width, 20)
                            .ImageSize = New System.Drawing.Size(20, .ImageSize.Height)
                            .Images.Add("MAN", System.Drawing.Image.FromFile(g_ImagePath & "man.ico"))
                            .Images.Add("WOMAN", System.Drawing.Image.FromFile(g_ImagePath & "woman.ico"))
                            .Images.Add("MAN2", System.Drawing.Image.FromFile(g_ImagePath & "man2.jpg"))
                            .Images.Add("WOMAN2", System.Drawing.Image.FromFile(g_ImagePath & "woman2.jpg"))
                            .Images.Add("FINISH", System.Drawing.Image.FromFile(g_ImagePath & "Finish.ico"))
                            .Images.Add("UNFINISH", System.Drawing.Image.FromFile(g_ImagePath & "unFinish.ico"))
                            .Images.Add("ERROR", System.Drawing.Image.FromFile(g_ImagePath & "Error.ico"))
                            .Images.Add("GREEN", System.Drawing.Image.FromFile(g_ImagePath & "Blue.jpg"))
                            .Images.Add("BLUE", System.Drawing.Image.FromFile(g_ImagePath & "Green.jpg"))
                            .Images.Add("OVER1", System.Drawing.Image.FromFile(g_ImagePath & "未承認前.bmp"))
                            .Images.Add("OVER2", System.Drawing.Image.FromFile(g_ImagePath & "未承認.bmp"))
                            .Images.Add("OVER3", System.Drawing.Image.FromFile(g_ImagePath & "承認済.bmp"))
                            .Images.Add("OVER4", System.Drawing.Image.FromFile(g_ImagePath & "確定.bmp"))
                            .Images.Add("OVER5", System.Drawing.Image.FromFile(g_ImagePath & "差戻.bmp"))
                        End With
                    End If

                    .LargeImageList = imlSmallIcon
                    .SmallImageList = imlSmallIcon

                    m_strSelChildMenu = M_DUTY_RESCD

                    w_column = .Columns.Add("Key", "連番", General.paTwipsTopixels(800), System.Windows.Forms.HorizontalAlignment.Left, "")
                    w_column = .Columns.Add("", "当番グループ", General.paTwipsTopixels(2000), System.Windows.Forms.HorizontalAlignment.Left, "")
                    w_column = .Columns.Add("", "職員番号", General.paTwipsTopixels(1800), System.Windows.Forms.HorizontalAlignment.Left, "")
                    w_column = .Columns.Add("", "氏名", General.paTwipsTopixels(1800), System.Windows.Forms.HorizontalAlignment.Left, "")
                    w_column = .Columns.Add("", "従事", General.paTwipsTopixels(1500), System.Windows.Forms.HorizontalAlignment.Left, "")
                    w_column = .Columns.Add("", "PHS", General.paTwipsTopixels(1500), System.Windows.Forms.HorizontalAlignment.Left, "")

                End With

            ElseIf M_ZAIIN_RESCD.Equals(g_MenuM(g_lngGroupIdx).ListBarMenu(g_lngListIdx).strResCD) Then

                With lvwDeptInfo
                    'ｱｲｺﾝの整列方法
                    .Alignment = System.Windows.Forms.ListViewAlignment.Top
                    'ﾘｽﾄﾋﾞｭｰﾀｲﾌﾟ設定
                    .View = System.Windows.Forms.View.Details
                    'ﾘｽﾄﾋﾞｭｰのItemｸﾘｱｰ
                    .Columns.Clear()
                    .Items.Clear()
                    .Sorting = SortOrder.Ascending
                    .FullRowSelect = True
                    .Scrollable = True
                    .GridLines = True
                    .Refresh()

                    'ラベル編集不可
                    .LabelEdit = False
                    'チェックボックス非表示
                    .CheckBoxes = False

                    '1回でも読み込んでいればOK
                    If imlSmallIcon.Images.Count <= 0 Then
                        With imlSmallIcon
                            .Images.Clear()
                            .ImageSize = New System.Drawing.Size(.ImageSize.Width, 20)
                            .ImageSize = New System.Drawing.Size(20, .ImageSize.Height)
                            .Images.Add("MAN", System.Drawing.Image.FromFile(g_ImagePath & "man.ico"))
                            .Images.Add("WOMAN", System.Drawing.Image.FromFile(g_ImagePath & "woman.ico"))
                            .Images.Add("MAN2", System.Drawing.Image.FromFile(g_ImagePath & "man2.jpg"))
                            .Images.Add("WOMAN2", System.Drawing.Image.FromFile(g_ImagePath & "woman2.jpg"))
                            .Images.Add("FINISH", System.Drawing.Image.FromFile(g_ImagePath & "Finish.ico"))
                            .Images.Add("UNFINISH", System.Drawing.Image.FromFile(g_ImagePath & "unFinish.ico"))
                            .Images.Add("ERROR", System.Drawing.Image.FromFile(g_ImagePath & "Error.ico"))
                            .Images.Add("GREEN", System.Drawing.Image.FromFile(g_ImagePath & "Blue.jpg"))
                            .Images.Add("BLUE", System.Drawing.Image.FromFile(g_ImagePath & "Green.jpg"))
                            .Images.Add("OVER1", System.Drawing.Image.FromFile(g_ImagePath & "未承認前.bmp"))
                            .Images.Add("OVER2", System.Drawing.Image.FromFile(g_ImagePath & "未承認.bmp"))
                            .Images.Add("OVER3", System.Drawing.Image.FromFile(g_ImagePath & "承認済.bmp"))
                            .Images.Add("OVER4", System.Drawing.Image.FromFile(g_ImagePath & "確定.bmp"))
                            .Images.Add("OVER5", System.Drawing.Image.FromFile(g_ImagePath & "差戻.bmp"))
                        End With
                    End If

                    .LargeImageList = imlSmallIcon
                    .SmallImageList = imlSmallIcon

                    m_strSelChildMenu = M_ZAIIN_RESCD

                    w_column = .Columns.Add("Key", "連番", General.paTwipsTopixels(800), System.Windows.Forms.HorizontalAlignment.Left, "")
                    w_column = .Columns.Add("", "職員番号", General.paTwipsTopixels(2000), System.Windows.Forms.HorizontalAlignment.Left, "")
                    w_column = .Columns.Add("", "氏名", General.paTwipsTopixels(3000), System.Windows.Forms.HorizontalAlignment.Left, "")
                    w_column = .Columns.Add("", "勤務", General.paTwipsTopixels(2000), System.Windows.Forms.HorizontalAlignment.Left, "")
                    w_column = .Columns.Add("", "PHS", General.paTwipsTopixels(2000), System.Windows.Forms.HorizontalAlignment.Left, "")

                End With
            ElseIf M_STAFFIDO_RESCD.Equals(g_MenuM(g_lngGroupIdx).ListBarMenu(g_lngListIdx).strResCD) Then
                '---------------------------------
                '■職員管理
                '---------------------------------

                With lvwDeptInfo
                    'ｱｲｺﾝの整列方法
                    .Alignment = System.Windows.Forms.ListViewAlignment.Top
                    'ﾘｽﾄﾋﾞｭｰﾀｲﾌﾟ設定
                    .View = System.Windows.Forms.View.Details
                    'ﾘｽﾄﾋﾞｭｰのItemｸﾘｱｰ
                    .Columns.Clear()
                    .Items.Clear()
                    .Sorting = SortOrder.None
                    .FullRowSelect = True
                    .Scrollable = True
                    .GridLines = True
                    .Refresh()

                    'ラベル編集不可
                    .LabelEdit = False
                    'チェックボックス非表示
                    .CheckBoxes = False

                    '1回でも読み込んでいればOK
                    If imlSmallIcon.Images.Count <= 0 Then
                        With imlSmallIcon
                            .Images.Clear()
                            .ImageSize = New System.Drawing.Size(.ImageSize.Width, 20)
                            .ImageSize = New System.Drawing.Size(20, .ImageSize.Height)
                            .Images.Add("MAN", System.Drawing.Image.FromFile(g_ImagePath & "man.ico"))
                            .Images.Add("WOMAN", System.Drawing.Image.FromFile(g_ImagePath & "woman.ico"))
                            .Images.Add("MAN2", System.Drawing.Image.FromFile(g_ImagePath & "man2.jpg"))
                            .Images.Add("WOMAN2", System.Drawing.Image.FromFile(g_ImagePath & "woman2.jpg"))
                            .Images.Add("FINISH", System.Drawing.Image.FromFile(g_ImagePath & "Finish.ico"))
                            .Images.Add("UNFINISH", System.Drawing.Image.FromFile(g_ImagePath & "unFinish.ico"))
                            .Images.Add("ERROR", System.Drawing.Image.FromFile(g_ImagePath & "Error.ico"))
                            .Images.Add("GREEN", System.Drawing.Image.FromFile(g_ImagePath & "Blue.jpg"))
                            .Images.Add("BLUE", System.Drawing.Image.FromFile(g_ImagePath & "Green.jpg"))
                            .Images.Add("OVER1", System.Drawing.Image.FromFile(g_ImagePath & "未承認前.bmp"))
                            .Images.Add("OVER2", System.Drawing.Image.FromFile(g_ImagePath & "未承認.bmp"))
                            .Images.Add("OVER3", System.Drawing.Image.FromFile(g_ImagePath & "承認済.bmp"))
                            .Images.Add("OVER4", System.Drawing.Image.FromFile(g_ImagePath & "確定.bmp"))
                            .Images.Add("OVER5", System.Drawing.Image.FromFile(g_ImagePath & "差戻.bmp"))
                        End With
                    End If

                    .LargeImageList = imlSmallIcon
                    .SmallImageList = imlSmallIcon

                    m_strSelChildMenu = M_STAFFIDO_RESCD

                    w_column = .Columns.Add("Key", "連番", General.paTwipsTopixels(1000), System.Windows.Forms.HorizontalAlignment.Left, "")
                    w_column = .Columns.Add("StaffMngID", "職員番号", General.paTwipsTopixels(1700), System.Windows.Forms.HorizontalAlignment.Left, "")
                    w_column = .Columns.Add("Name", "氏名", General.paTwipsTopixels(2500), System.Windows.Forms.HorizontalAlignment.Left, "")
                    w_column = .Columns.Add("Kana", "カナ", General.paTwipsTopixels(1540), System.Windows.Forms.HorizontalAlignment.Left, "")
                    w_column = .Columns.Add("KinmuDept", "勤務部署", General.paTwipsTopixels(1440), System.Windows.Forms.HorizontalAlignment.Left, "")
                    If "0".Equals(w_WarddeptFlg) Then
                        w_column = .Columns.Add("WardDept", "配属部署", General.paTwipsTopixels(1440), System.Windows.Forms.HorizontalAlignment.Left, "")
                    End If
                    w_column = .Columns.Add("Post", "役職", General.paTwipsTopixels(1440), System.Windows.Forms.HorizontalAlignment.Left, "")
                    w_column = .Columns.Add("Job", "職種", General.paTwipsTopixels(1440), System.Windows.Forms.HorizontalAlignment.Left, "")

                End With

            ElseIf M_OVERKINMU_RESCD.Equals(g_MenuM(g_lngGroupIdx).ListBarMenu(g_lngListIdx).strResCD) Then
                '---------------------------------
                '■時間外
                '---------------------------------
                '日別時間外
                If m_strOverKinmuDispType = M_STR_DAY Then

                    With lvwDeptInfo
                        'ｱｲｺﾝの整列方法
                        .Alignment = System.Windows.Forms.ListViewAlignment.Top
                        'ﾘｽﾄﾋﾞｭｰﾀｲﾌﾟ設定
                        .View = System.Windows.Forms.View.Details
                        'ﾘｽﾄﾋﾞｭｰのItemｸﾘｱｰ
                        .Columns.Clear()
                        .Items.Clear()
                        .Sorting = SortOrder.Ascending
                        .FullRowSelect = True
                        .Scrollable = True
                        .GridLines = True
                        .Refresh()

                        'ラベル編集不可
                        .LabelEdit = False

                        '1回でも読み込んでいればOK
                        If imlSmallIcon.Images.Count <= 0 Then
                            With imlSmallIcon
                                .Images.Clear()
                                .ImageSize = New System.Drawing.Size(.ImageSize.Width, 20)
                                .ImageSize = New System.Drawing.Size(20, .ImageSize.Height)
                                .Images.Add("MAN", System.Drawing.Image.FromFile(g_ImagePath & "man.ico"))
                                .Images.Add("WOMAN", System.Drawing.Image.FromFile(g_ImagePath & "woman.ico"))
                                .Images.Add("MAN2", System.Drawing.Image.FromFile(g_ImagePath & "man2.jpg"))
                                .Images.Add("WOMAN2", System.Drawing.Image.FromFile(g_ImagePath & "woman2.jpg"))
                                .Images.Add("FINISH", System.Drawing.Image.FromFile(g_ImagePath & "Finish.ico"))
                                .Images.Add("UNFINISH", System.Drawing.Image.FromFile(g_ImagePath & "unFinish.ico"))
                                .Images.Add("ERROR", System.Drawing.Image.FromFile(g_ImagePath & "Error.ico"))
                                .Images.Add("GREEN", System.Drawing.Image.FromFile(g_ImagePath & "Blue.jpg"))
                                .Images.Add("BLUE", System.Drawing.Image.FromFile(g_ImagePath & "Green.jpg"))
                                .Images.Add("OVER1", System.Drawing.Image.FromFile(g_ImagePath & "未承認前.bmp"))
                                .Images.Add("OVER2", System.Drawing.Image.FromFile(g_ImagePath & "未承認.bmp"))
                                .Images.Add("OVER3", System.Drawing.Image.FromFile(g_ImagePath & "承認済.bmp"))
                                .Images.Add("OVER4", System.Drawing.Image.FromFile(g_ImagePath & "確定.bmp"))
                                .Images.Add("OVER5", System.Drawing.Image.FromFile(g_ImagePath & "差戻.bmp"))
                            End With
                        End If

                        .LargeImageList = imlSmallIcon
                        .SmallImageList = imlSmallIcon

                        'チェックボックス表示
                        .CheckBoxes = True

                        If M_STR_DAY.Equals(m_strOverKinmuDispType) Then
                            '日別

                            w_column = .Columns.Add("Key", "", General.paTwipsTopixels(1200), System.Windows.Forms.HorizontalAlignment.Left, "")
                            w_column = .Columns.Add("", "職員番号", General.paTwipsTopixels(1500), System.Windows.Forms.HorizontalAlignment.Left, "")
                            w_column = .Columns.Add("", "氏名", General.paTwipsTopixels(3000), System.Windows.Forms.HorizontalAlignment.Left, "")
                            w_column = .Columns.Add("", "勤務", General.paTwipsTopixels(1200), System.Windows.Forms.HorizontalAlignment.Left, "")
                            w_column = .Columns.Add("", "就業時間", General.paTwipsTopixels(1800), System.Windows.Forms.HorizontalAlignment.Left, "")
                            w_column = .Columns.Add("", "時間外", General.paTwipsTopixels(3300), System.Windows.Forms.HorizontalAlignment.Left, "")
                            w_column = .Columns.Add("", "申請時間累計", General.paTwipsTopixels(1600), System.Windows.Forms.HorizontalAlignment.Left, "")
                            w_column = .Columns.Add("", "承認済累計", General.paTwipsTopixels(1600), System.Windows.Forms.HorizontalAlignment.Left, "")

                        ElseIf M_STR_PERSONAL.Equals(m_strOverKinmuDispType) Then
                            '個人別

                            w_column = .Columns.Add("Key", "日付", General.paTwipsTopixels(1500), System.Windows.Forms.HorizontalAlignment.Left, "")
                            w_column = .Columns.Add("", "勤務", General.paTwipsTopixels(1200), System.Windows.Forms.HorizontalAlignment.Left, "")
                            w_column = .Columns.Add("", "就業時間", General.paTwipsTopixels(1800), System.Windows.Forms.HorizontalAlignment.Left, "")
                            w_column = .Columns.Add("", "時間外", General.paTwipsTopixels(3300), System.Windows.Forms.HorizontalAlignment.Left, "")

                        End If


                    End With

                    '===============
                    '職員一覧
                    '===============
                    With lvwDeptStaff
                        'ｱｲｺﾝの整列方法
                        .Alignment = System.Windows.Forms.ListViewAlignment.Top
                        'ﾘｽﾄﾋﾞｭｰﾀｲﾌﾟ設定
                        .View = System.Windows.Forms.View.Details
                        'ﾘｽﾄﾋﾞｭｰのItemｸﾘｱｰ
                        .Columns.Clear()
                        .Items.Clear()
                        .FullRowSelect = True
                        .Scrollable = True
                        .GridLines = True
                        .Refresh()

                        'ラベル編集不可
                        .LabelEdit = False

                        w_column = .Columns.Add("Key", "職員番号", General.paTwipsTopixels(1500), System.Windows.Forms.HorizontalAlignment.Left, "")
                        w_column = .Columns.Add("", "氏名", General.paTwipsTopixels(1800), System.Windows.Forms.HorizontalAlignment.Left, "")

                    End With

                    '個人別時間外
                Else
                    With lvwMain

                        'ｱｲｺﾝの整列方法
                        .Alignment = System.Windows.Forms.ListViewAlignment.Top
                        'ﾘｽﾄﾋﾞｭｰﾀｲﾌﾟ設定
                        .View = System.Windows.Forms.View.Details
                        'ﾘｽﾄﾋﾞｭｰのItemｸﾘｱｰ
                        .Columns.Clear()
                        .Items.Clear()
                        .FullRowSelect = True
                        .Scrollable = True
                        .GridLines = True
                        .Refresh()

                        'ラベル編集不可
                        .LabelEdit = False

                        '1回でも読み込んでいればOK
                        If imlSmallIcon.Images.Count <= 0 Then
                            With imlSmallIcon
                                .Images.Clear()
                                .ImageSize = New System.Drawing.Size(.ImageSize.Width, 20)
                                .ImageSize = New System.Drawing.Size(20, .ImageSize.Height)
                                .Images.Add("MAN", System.Drawing.Image.FromFile(g_ImagePath & "man.ico"))
                                .Images.Add("WOMAN", System.Drawing.Image.FromFile(g_ImagePath & "woman.ico"))
                                .Images.Add("MAN2", System.Drawing.Image.FromFile(g_ImagePath & "man2.jpg"))
                                .Images.Add("WOMAN2", System.Drawing.Image.FromFile(g_ImagePath & "woman2.jpg"))
                                .Images.Add("FINISH", System.Drawing.Image.FromFile(g_ImagePath & "Finish.ico"))
                                .Images.Add("UNFINISH", System.Drawing.Image.FromFile(g_ImagePath & "unFinish.ico"))
                                .Images.Add("ERROR", System.Drawing.Image.FromFile(g_ImagePath & "Error.ico"))
                                .Images.Add("GREEN", System.Drawing.Image.FromFile(g_ImagePath & "Blue.jpg"))
                                .Images.Add("BLUE", System.Drawing.Image.FromFile(g_ImagePath & "Green.jpg"))
                                .Images.Add("OVER1", System.Drawing.Image.FromFile(g_ImagePath & "未承認前.bmp"))
                                .Images.Add("OVER2", System.Drawing.Image.FromFile(g_ImagePath & "未承認.bmp"))
                                .Images.Add("OVER3", System.Drawing.Image.FromFile(g_ImagePath & "承認済.bmp"))
                                .Images.Add("OVER4", System.Drawing.Image.FromFile(g_ImagePath & "確定.bmp"))
                                .Images.Add("OVER5", System.Drawing.Image.FromFile(g_ImagePath & "差戻.bmp"))
                            End With
                        End If

                        .LargeImageList = imlSmallIcon
                        .SmallImageList = imlSmallIcon

                        'チェックボックス表示
                        .CheckBoxes = True

                        '-----------
                        '■実績状況
                        '-----------
                        w_column = .Columns.Add("Key", "日付", General.paTwipsTopixels(1700), System.Windows.Forms.HorizontalAlignment.Left, "")
                        w_column = .Columns.Add("", "勤務", General.paTwipsTopixels(1500), System.Windows.Forms.HorizontalAlignment.Left, "")
                        w_column = .Columns.Add("", "就業時間", General.paTwipsTopixels(3000), System.Windows.Forms.HorizontalAlignment.Left, "")
                        w_column = .Columns.Add("", "時間外", General.paTwipsTopixels(3100), System.Windows.Forms.HorizontalAlignment.Left, "")

                    End With

                End If
            End If

            Call General.paSetFieldWidth(lvwDeptInfo, General.G_STRMAINKEY1 & "\" & G_PROJECTID, m_strSelChildMenu, False)
            Call General.paSetFieldWidth(lvwMain, General.G_STRMAINKEY1 & "\" & G_PROJECTID, m_strSelChildMenu, False)

        Catch ex As Exception
            Call General.paTrpMsg(Convert.ToString(Err.Number), W_SUBNAME)
        End Try
    End Sub

    '=======================================================
    '個人データ取得
    '
    '引数・・・　ByVal p_strMngID     [職員管理番号]
    '　　　　　　ByVal p_lngFrom      [開始年月日]
    '　　　　　　ByVal p_lngTo        [終了年月日]
    '　　　　　　ByRef p_StaffData()  [取得情報]
    '=======================================================
    Private Function fncPersonalData(ByVal p_strMngID As String, ByVal p_lngFrom As Integer, ByVal p_lngTo As Integer, ByRef p_StaffData() As Staff_Type) As Boolean

        Const W_SUBNAME As String = "NSC0000HA fncPersonalData"


        Dim w_lngRecCnt As Integer
        Dim w_lngLoop As Integer
        Dim w_StartDate As Integer
        Dim w_EndDate As Integer
        Dim w_Int1 As Integer
        Dim w_Int2 As Integer
        Dim w_Cnt As Integer

        '初期化
        fncPersonalData = False
        Try
            ReDim p_StaffData(0)

            '==================================
            '職員情報 取得
            '==================================
            With General.g_objGetData
                .p病院CD = General.g_strHospitalCD
                .p職員番号変換 = 0 '全ての情報
                .p職員区分 = 0 '職員管理番号指定
                .p職員番号 = p_strMngID '職員管理番号
                .p日付区分 = 1 '期間
                .p開始年月日 = p_lngFrom '開始年月日
                .p終了年月日 = p_lngTo '終了年月日
                .p履歴ソートFLG = 0 '昇順
                .pシステム区分 = 1 '職員歴必要なし
                If .mStaffInit = False Then
                    Exit Function
                Else
                    '採用情報配列/勤務部署異動配列 初期化
                    ReDim p_StaffData(1)
                    ReDim p_StaffData(1).SaiyoHistory(0)
                    ReDim p_StaffData(1).IdoHistory(0)

                    '●職員管理番号
                    p_StaffData(1).strStaffMngID = p_strMngID
                    '●氏名
                    p_StaffData(1).strName = .f氏名1
                    '●PHS番号
                    p_StaffData(1).strPHS = .fPHS電話番号
                    '●職員履歴管理件数
                    w_lngRecCnt = .f職員管理件数
                    ReDim p_StaffData(1).SaiyoHistory(w_lngRecCnt)

                    For w_lngLoop = 1 To w_lngRecCnt

                        .p職員管理索引 = w_lngLoop

                        '●採用年月日
                        p_StaffData(1).SaiyoHistory(w_lngLoop).lngStartDate = .f採用年月日1
                        '●採用条件コード
                        p_StaffData(1).SaiyoHistory(w_lngLoop).strCD = .f採用条件CD
                        '●転退年月日
                        p_StaffData(1).SaiyoHistory(w_lngLoop).lngEndDate = .f転退年月日1

                        '●職員番号(常に上書き 昇順の為)
                        p_StaffData(1).strStaffID = .f職員番号1

                    Next w_lngLoop

                    '●勤務部署異動情報
                    w_lngRecCnt = .f勤務地異動件数
                    ReDim p_StaffData(1).IdoHistory(w_lngRecCnt)

                    For w_lngLoop = 1 To w_lngRecCnt

                        .p勤務地異動索引 = w_lngLoop

                        '●異動年月日
                        p_StaffData(1).IdoHistory(w_lngLoop).lngStartDate = .f勤務地異動年月日
                        '●異動終了年月日
                        p_StaffData(1).IdoHistory(w_lngLoop).lngEndDate = .f勤務地終了年月日
                        '●勤務部署CD
                        p_StaffData(1).IdoHistory(w_lngLoop).strCD = .f看護単位CD1

                    Next w_lngLoop

                End If
            End With


            '--- 出力対象月内の勤務部署CDと採用CDの組合せを作成
            w_Int1 = 1
            w_Int2 = 1
            w_Cnt = 1
            Erase g_udtStaffHistory
            ReDim g_udtStaffHistory(0)
            If UBound(p_StaffData(1).SaiyoHistory) > 0 AndAlso UBound(p_StaffData(1).IdoHistory) > 0 Then
                ReDim g_udtStaffHistory(1)
                g_udtStaffHistory(1).strSaiyouCD = p_StaffData(1).SaiyoHistory(1).strCD
                g_udtStaffHistory(1).strKangoTaniCD = p_StaffData(1).IdoHistory(1).strCD
                g_udtStaffHistory(1).lngStartDate = p_lngFrom
                g_udtStaffHistory(1).lngEndDate = p_lngTo
                w_StartDate = p_lngFrom
                w_EndDate = p_lngTo
            End If
            '--- 取得した採用CDと勤務部署CDで組合せ作成
            Do
                '--- 全部チェックしたら、ループを抜ける
                If w_Int1 >= UBound(p_StaffData(1).SaiyoHistory) AndAlso w_Int2 >= UBound(p_StaffData(1).IdoHistory) Then Exit Do

                If p_StaffData(1).SaiyoHistory(w_Int1).lngEndDate = p_StaffData(1).IdoHistory(w_Int2).lngEndDate Then
                    w_EndDate = p_StaffData(1).SaiyoHistory(w_Int1).lngEndDate
                    w_Int1 = w_Int1 + 1
                    w_Int2 = w_Int2 + 1
                    w_StartDate = p_StaffData(1).SaiyoHistory(w_Int1).lngStartDate
                ElseIf p_StaffData(1).SaiyoHistory(w_Int1).lngEndDate > p_StaffData(1).IdoHistory(w_Int2).lngEndDate Then
                    w_EndDate = p_StaffData(1).IdoHistory(w_Int2).lngEndDate
                    w_Int2 = w_Int2 + 1
                    w_StartDate = p_StaffData(1).IdoHistory(w_Int2).lngStartDate
                Else
                    w_EndDate = p_StaffData(1).SaiyoHistory(w_Int1).lngEndDate
                    w_Int1 = w_Int1 + 1
                    w_StartDate = p_StaffData(1).SaiyoHistory(w_Int1).lngStartDate
                End If
                g_udtStaffHistory(w_Cnt).lngEndDate = w_EndDate
                w_Cnt = UBound(g_udtStaffHistory) + 1
                ReDim Preserve g_udtStaffHistory(w_Cnt)
                g_udtStaffHistory(w_Cnt).strSaiyouCD = p_StaffData(1).SaiyoHistory(w_Int1).strCD
                g_udtStaffHistory(w_Cnt).strKangoTaniCD = p_StaffData(1).IdoHistory(w_Int2).strCD
                g_udtStaffHistory(w_Cnt).lngStartDate = w_StartDate
                g_udtStaffHistory(w_Cnt).lngEndDate = p_lngTo '--- ダミーで出力末日をセット
            Loop

            '--- 初期化
            ReDim g_udtHistory(UBound(g_udtStaffHistory))

            Dim w_intCnt As Integer

            For w_intCnt = 0 To UBound(g_udtStaffHistory)
                Call g_udtHistory(w_intCnt).Initialize()
            Next w_intCnt

            '正常終了
            fncPersonalData = True

        Catch ex As Exception
            Call General.paTrpMsg(Convert.ToString(Err.Number), W_SUBNAME)
        End Try
    End Function

    '====================================
    'スプレッド設定[個人業務-実績照会]
    '====================================
    Private Sub sSetSpreadSheet()
        Const W_SUBNAME As String = "NSC0000HA sSetSpreadSheet"

        Try
            Dim w_lngLoop As Integer
            sprKinmuCnt.EditModeReplace = True

            '実線
            Dim cbsSolidLine As New FarPoint.Win.ComplexBorderSide(FarPoint.Win.ComplexBorderSideStyle.ThinLine, Color.Black)
            '点線
            Dim cbsHairLine As New FarPoint.Win.ComplexBorderSide(FarPoint.Win.ComplexBorderSideStyle.HairLine, Color.Black)
            '罫線なし
            Dim cbsNone As New FarPoint.Win.ComplexBorderSide(FarPoint.Win.ComplexBorderSideStyle.None)

            'ﾗﾍﾞﾙ型
            Dim sprCellType As FarPoint.Win.Spread.CellType.TextCellType =
                New FarPoint.Win.Spread.CellType.TextCellType

            'sprCellType.WordWrap = True
            sprCellType.Static = True

            With sprKinmuCnt_Sheet1
                '列ヘッダー非表示
                .ColumnHeaderVisible = False
                '行ヘッダー非表示
                .RowHeaderVisible = False
                'スクロールバー非表示
                sprKinmuCnt.HorizontalScrollBarPolicy = FarPoint.Win.Spread.ScrollBarPolicy.Never
                sprKinmuCnt.VerticalScrollBarPolicy = FarPoint.Win.Spread.ScrollBarPolicy.Never
                sprKinmuCnt.BorderStyle = BorderStyle.FixedSingle

                '最大行数
                If m_blnOverKinmuDispFlg = True Then
                    .RowCount = M_KINMU_MAXROW
                Else
                    .RowCount = M_KINMU_MAXROW - 2
                End If
                '最大列数
                .ColumnCount = M_KINMU_MAXCOL ' M_MAXCOL
                '行の高さ
                .SetRowHeight(M_KINMU_HEADER_ROW, M_ROWHEIGHT)
                .SetRowHeight(M_KINMU_ROW, (M_ROWHEIGHT * 2) - 5)
                .SetRowHeight(M_TIME_HEADER_ROW, M_ROWHEIGHT)
                .SetRowHeight(M_TIME_ROW, (M_ROWHEIGHT * 2) - 5)

                If m_blnOverKinmuDispFlg = True Then
                    '時間外表示　かつ　申請時間等表示の場合
                    .SetRowHeight(M_OVER_HEADER_ROW, M_ROWHEIGHT)
                    .SetRowHeight(M_OVER_ROW, (M_ROWHEIGHT * 2) - 5)
                End If

                '列幅
                .SetColumnWidth(-1, M_COLWIDTH) 'M_COLWIDTH


                'Spreadのリサイズ
                '-2は実線のサイズ調整
                General.paSpreadSizeFit(sprKinmuCnt, sprKinmuCnt.VerticalScrollBarPolicy,
                                        sprKinmuCnt.HorizontalScrollBarPolicy, .RowCount, M_COLWIDTH - 2)
                '高さの調整
                sprKinmuCnt.Height = sprKinmuCnt.Height - 2

                'セル囲いを消す
                sprKinmuCnt.EditModePermanent = True

                '１行目の背景色
                .Cells(M_KINMU_HEADER_ROW, M_DATA_COL).BackColor = System.Drawing.SystemColors.Control

                '３行目の背景色
                .Cells(M_TIME_HEADER_ROW, M_DATA_COL).BackColor = System.Drawing.SystemColors.Control

                If m_blnOverKinmuDispFlg = True Then
                    .Cells(M_OVER_HEADER_ROW, M_DATA_COL).BackColor = System.Drawing.SystemColors.Control
                End If

                '罫線を表示
                '下辺実線
                Dim cBorder As New FarPoint.Win.ComplexBorder(cbsNone, cbsNone, cbsNone, cbsSolidLine)
                .Rows(0, .RowCount - 2).Border = cBorder

                .Cells(M_KINMU_HEADER_ROW, M_DATA_COL, .RowCount - 1, .ColumnCount - 1).Locked = True

                'テキスト型のセル
                .Cells(M_KINMU_HEADER_ROW, M_DATA_COL, .RowCount - 1, .ColumnCount - 1).CellType = sprCellType

                '勤務日数
                .SetText(M_KINMU_HEADER_ROW, M_DATA_COL, "勤務日数")
                .Cells(M_KINMU_HEADER_ROW, M_DATA_COL).HorizontalAlignment = FarPoint.Win.Spread.CellHorizontalAlignment.Center
                .Cells(M_KINMU_HEADER_ROW, M_DATA_COL).VerticalAlignment = FarPoint.Win.Spread.CellHorizontalAlignment.Center

                '勤務時間
                .SetText(M_TIME_HEADER_ROW, M_DATA_COL, "勤務時間計")
                .Cells(M_TIME_HEADER_ROW, M_DATA_COL).HorizontalAlignment = FarPoint.Win.Spread.CellHorizontalAlignment.Center
                .Cells(M_TIME_HEADER_ROW, M_DATA_COL).VerticalAlignment = FarPoint.Win.Spread.CellHorizontalAlignment.Center

                If m_blnOverKinmuDispFlg = True Then
                    .SetText(M_OVER_HEADER_ROW, M_DATA_COL, "時間外")
                    .Cells(M_OVER_HEADER_ROW, M_DATA_COL).HorizontalAlignment = FarPoint.Win.Spread.CellHorizontalAlignment.Center
                    .Cells(M_OVER_HEADER_ROW, M_DATA_COL).VerticalAlignment = FarPoint.Win.Spread.CellHorizontalAlignment.Center
                End If

                sprKinmuCnt.Enabled = False '操作不可にするためEnable=Falseにする
                sprKinmuCnt.AutoSize = True

            End With

            Call subGetMatrix()

            If UBound(m_VMtrx) > 0 Then
                With sprMatrix_Sheet1

                    '列ヘッダー非表示
                    .ColumnHeaderVisible = False
                    '行ヘッダー非表示
                    .RowHeaderVisible = False
                    'スクロールバー非表示
                    sprMatrix.HorizontalScrollBarPolicy = FarPoint.Win.Spread.ScrollBarPolicy.Never
                    sprMatrix.VerticalScrollBarPolicy = FarPoint.Win.Spread.ScrollBarPolicy.Never
                    sprMatrix.BorderStyle = BorderStyle.FixedSingle

                    '最大行数
                    If UBound(m_VMtrx) > 9 Then
                        .RowCount = 9
                    Else
                        .RowCount = UBound(m_VMtrx)
                    End If

                    '最大列数
                    .ColumnCount = 2
                    '行の高さ
                    For w_lngLoop = 0 To UBound(m_VMtrx) - 1
                        '９件目以降は設定しない
                        If w_lngLoop > 8 Then
                            Exit For
                        End If

                        .SetRowHeight(w_lngLoop, M_ROWHEIGHT)
                    Next w_lngLoop

                    '列幅
                    .SetColumnWidth(0, 35)
                    .SetColumnWidth(1, 60)

                    '-2は実線のサイズ調整
                    General.paSpreadSizeFit(sprMatrix, sprMatrix.VerticalScrollBarPolicy,
                                            sprMatrix.HorizontalScrollBarPolicy, .RowCount, 95 - 2)
                    '高さの調整
                    sprMatrix.Height = sprMatrix.Height - 3

                    'セル囲いを消す
                    sprMatrix.EditModePermanent = True

                    '１列目の背景色
                    .Cells(0, M_DATA_COL, IIf(.RowCount > 0, .RowCount - 1, 0), M_DATA_COL).BackColor = System.Drawing.SystemColors.Control

                    '罫線を表示
                    '右辺点線、下辺実線
                    Dim cBorder_RightBottom As New FarPoint.Win.ComplexBorder(cbsNone, cbsNone, cbsHairLine, cbsSolidLine)
                    '下辺実線
                    Dim cBorder_Bottom As New FarPoint.Win.ComplexBorder(cbsNone, cbsNone, cbsNone, cbsSolidLine)

                    .Cells(M_KINMU_HEADER_ROW, M_DATA_COL, .RowCount - 1, M_DATA_COL).Border = cBorder_RightBottom
                    .Cells(M_KINMU_HEADER_ROW, 1, .RowCount - 1, 1).Border = cBorder_Bottom

                    .Cells(M_KINMU_HEADER_ROW, M_DATA_COL, .RowCount - 1, .ColumnCount - 1).Locked = True
                    .Cells(M_KINMU_HEADER_ROW, M_DATA_COL, .RowCount - 1, .ColumnCount - 1).CellType = sprCellType

                    For w_lngLoop = 0 To UBound(m_VMtrx) - 1

                        '９件目以降は表示しない
                        If w_lngLoop > 8 Then
                            Exit For
                        End If

                        .SetText(w_lngLoop, M_DATA_COL, General.paLeftB(m_VMtrx(w_lngLoop + 1).MtrxName, 4))

                    Next w_lngLoop

                    .Cells(0, 0, .RowCount - 1, .ColumnCount - 1).HorizontalAlignment = FarPoint.Win.Spread.CellHorizontalAlignment.Center
                    .Cells(0, 0, .RowCount - 1, .ColumnCount - 1).VerticalAlignment = FarPoint.Win.Spread.CellHorizontalAlignment.Center

                    sprMatrix.Enabled = False '操作不可にするためEnable=Falseにする
                    sprMatrix.AutoSize = True

                End With
            End If

            With sprTanka_Sheet1
                '列ヘッダー非表示
                .ColumnHeaderVisible = False
                '行ヘッダー非表示
                .RowHeaderVisible = False
                'スクロールバー非表示
                sprTanka.HorizontalScrollBarPolicy = FarPoint.Win.Spread.ScrollBarPolicy.Never
                sprTanka.VerticalScrollBarPolicy = FarPoint.Win.Spread.ScrollBarPolicy.Never
                sprTanka.BorderStyle = BorderStyle.FixedSingle

                '最大行数
                .RowCount = M_TANKA_MAXROW
                '最大列数
                .ColumnCount = M_TANKA_MAXCOL
                '行の高さ
                .SetRowHeight(M_DAY_HEADER_ROW, M_ROWHEIGHT)
                .SetRowHeight(M_DAY_ROW, (M_ROWHEIGHT * 2) - 5)
                .SetRowHeight(M_NOON_HEADER_ROW, M_ROWHEIGHT)
                .SetRowHeight(M_NOON_ROW, (M_ROWHEIGHT * 2) - 5)
                .SetRowHeight(M_WEEKDAYNIGHT_HEADER_ROW, M_ROWHEIGHT)
                .SetRowHeight(M_WEEKDAYNIGHT_ROW, (M_ROWHEIGHT * 2) - 5)
                .SetRowHeight(M_HOLIDAY_HEADER_ROW, M_ROWHEIGHT)
                .SetRowHeight(M_HOLIDAY_ROW, (M_ROWHEIGHT * 2) - 5)
                .SetRowHeight(M_HOLIDAYNIGHT_HEADER_ROW, M_ROWHEIGHT)
                .SetRowHeight(M_HOLIDAYNIGHT_ROW, (M_ROWHEIGHT * 2) - 5)

                '列幅
                .SetColumnWidth(-1, M_COLWIDTH)

                '-2は実線のサイズ調整
                General.paSpreadSizeFit(sprTanka, sprTanka.VerticalScrollBarPolicy,
                                        sprTanka.HorizontalScrollBarPolicy, .RowCount, M_COLWIDTH - 2)
                '高さの調整
                sprTanka.Height = sprTanka.Height - 2

                'セル囲いを消す
                sprTanka.EditModePermanent = True

                '100/100の背景色
                .Cells(M_DAY_HEADER_ROW, M_DATA_COL).BackColor = System.Drawing.SystemColors.Control

                '125/100の背景色
                .Cells(M_NOON_HEADER_ROW, M_DATA_COL).BackColor = System.Drawing.SystemColors.Control

                '150/100の背景色
                .Cells(M_WEEKDAYNIGHT_HEADER_ROW, M_DATA_COL).BackColor = System.Drawing.SystemColors.Control

                '135/100の背景色
                .Cells(M_HOLIDAY_HEADER_ROW, M_DATA_COL).BackColor = System.Drawing.SystemColors.Control

                '160/100の背景色
                .Cells(M_HOLIDAYNIGHT_HEADER_ROW, M_DATA_COL).BackColor = System.Drawing.SystemColors.Control

                '罫線を表示
                '下辺実線
                Dim cBorder As New FarPoint.Win.ComplexBorder(cbsNone, cbsNone, cbsNone, cbsSolidLine)

                .Rows(0, .RowCount - 2).Border = cBorder

                .Cells(M_DAY_HEADER_ROW, M_DATA_COL, .RowCount - 1, .ColumnCount - 1).Locked = True
                .Cells(M_DAY_HEADER_ROW, M_DATA_COL, .RowCount - 1, .ColumnCount - 1).CellType = sprCellType

                '100/100
                .SetText(M_DAY_HEADER_ROW, M_DATA_COL, "100/100")
                .Cells(M_DAY_HEADER_ROW, M_DATA_COL).HorizontalAlignment = FarPoint.Win.Spread.CellHorizontalAlignment.Center
                .Cells(M_DAY_HEADER_ROW, M_DATA_COL).VerticalAlignment = FarPoint.Win.Spread.CellHorizontalAlignment.Center

                '125/100
                .SetText(M_NOON_HEADER_ROW, M_DATA_COL, "125/100")
                .Cells(M_NOON_HEADER_ROW, M_DATA_COL).HorizontalAlignment = FarPoint.Win.Spread.CellHorizontalAlignment.Center
                .Cells(M_NOON_HEADER_ROW, M_DATA_COL).VerticalAlignment = FarPoint.Win.Spread.CellHorizontalAlignment.Center

                '150/100
                .SetText(M_WEEKDAYNIGHT_HEADER_ROW, M_DATA_COL, "150/100")
                .Cells(M_WEEKDAYNIGHT_HEADER_ROW, M_DATA_COL).HorizontalAlignment = FarPoint.Win.Spread.CellHorizontalAlignment.Center
                .Cells(M_WEEKDAYNIGHT_HEADER_ROW, M_DATA_COL).VerticalAlignment = FarPoint.Win.Spread.CellHorizontalAlignment.Center

                '135/100
                .SetText(M_HOLIDAY_HEADER_ROW, M_DATA_COL, "135/100")
                .Cells(M_HOLIDAY_HEADER_ROW, M_DATA_COL).HorizontalAlignment = FarPoint.Win.Spread.CellHorizontalAlignment.Center
                .Cells(M_HOLIDAY_HEADER_ROW, M_DATA_COL).VerticalAlignment = FarPoint.Win.Spread.CellHorizontalAlignment.Center

                '160/100
                .SetText(M_HOLIDAYNIGHT_HEADER_ROW, M_DATA_COL, "160/100")
                .Cells(M_HOLIDAYNIGHT_HEADER_ROW, M_DATA_COL).HorizontalAlignment = FarPoint.Win.Spread.CellHorizontalAlignment.Center
                .Cells(M_HOLIDAYNIGHT_HEADER_ROW, M_DATA_COL).VerticalAlignment = FarPoint.Win.Spread.CellHorizontalAlignment.Center

                sprTanka.Enabled = False '操作不可にするためEnable=Falseにする
                sprTanka.AutoSize = True

            End With

            With sprOverTime_Sheet1
                '列ヘッダー非表示
                .ColumnHeaderVisible = False
                '行ヘッダー非表示
                .RowHeaderVisible = False
                'スクロールバー非表示
                sprOverTime.HorizontalScrollBarPolicy = FarPoint.Win.Spread.ScrollBarPolicy.Never
                sprOverTime.VerticalScrollBarPolicy = FarPoint.Win.Spread.ScrollBarPolicy.Never
                sprOverTime.BorderStyle = BorderStyle.FixedSingle

                '2018-08-14 Darren UPDATE START
                '最大行数
                '.RowCount = 8
                .RowCount = 10
                '2018-08-14 Darren UPDATE END
                '最大列数
                .ColumnCount = 1

                '行の高さ
                .SetRowHeight(M_CHOUKINTIME150_HEADER_ROW, M_ROWHEIGHT)
                .SetRowHeight(M_CHOUKINTIME150_ROW, (M_ROWHEIGHT * 2) - 5)
                .SetRowHeight(M_CHOUKINTIME175_HEADER_ROW, M_ROWHEIGHT)
                .SetRowHeight(M_CHOUKINTIME175_ROW, (M_ROWHEIGHT * 2) - 5)
                '2018-08-14 Darren ADD START
                .SetRowHeight(M_CHOUKINTIME25_HEADER_ROW, M_ROWHEIGHT)
                .SetRowHeight(M_CHOUKINTIME25_ROW, (M_ROWHEIGHT * 2) - 5)
                '2018-08-14 Darren ADD END
                .SetRowHeight(M_APR_YET_HEADER_ROW, M_ROWHEIGHT)
                .SetRowHeight(M_APR_YET_ROW, (M_ROWHEIGHT * 2) - 5)
                .SetRowHeight(M_APR_OVER_HEADER_ROW, M_ROWHEIGHT)
                .SetRowHeight(M_APR_OVER_ROW, (M_ROWHEIGHT * 2) - 5)

                '列幅
                .SetColumnWidth(-1, M_COLWIDTH)

                'セル囲いを消す
                sprOverTime.EditModePermanent = True

                '150/100の背景色
                .Cells(M_CHOUKINTIME150_HEADER_ROW, M_DATA_COL).BackColor = System.Drawing.SystemColors.Control

                '175/100の背景色
                .Cells(M_CHOUKINTIME175_HEADER_ROW, M_DATA_COL).BackColor = System.Drawing.SystemColors.Control

                '2018-08-14 Darren ADD START
                '25/100の背景色
                .Cells(M_CHOUKINTIME25_HEADER_ROW, M_DATA_COL).BackColor = System.Drawing.SystemColors.Control
                '2018-08-14 Darren ADD END

                '未承認累計の背景色
                .Cells(M_APR_YET_HEADER_ROW, M_DATA_COL).BackColor = System.Drawing.SystemColors.Control

                '承認済累計の背景色
                .Cells(M_APR_OVER_HEADER_ROW, M_DATA_COL).BackColor = System.Drawing.SystemColors.Control

                '罫線を表示
                '下辺実線
                Dim cBorder As New FarPoint.Win.ComplexBorder(cbsNone, cbsNone, cbsNone, cbsSolidLine)

                .Rows(0, .RowCount - 2).Border = cBorder

                .Cells(M_CHOUKINTIME150_HEADER_ROW, M_DATA_COL, .RowCount - 1, .ColumnCount - 1).Locked = True
                .Cells(M_CHOUKINTIME150_HEADER_ROW, M_DATA_COL, .RowCount - 1, .ColumnCount - 1).CellType = sprCellType

                '150/100
                .SetText(M_CHOUKINTIME150_HEADER_ROW, M_DATA_COL, "150/100")
                .Cells(M_CHOUKINTIME150_HEADER_ROW, M_DATA_COL).HorizontalAlignment = FarPoint.Win.Spread.CellHorizontalAlignment.Center
                .Cells(M_CHOUKINTIME150_HEADER_ROW, M_DATA_COL).VerticalAlignment = FarPoint.Win.Spread.CellHorizontalAlignment.Center

                '175/100
                .SetText(M_CHOUKINTIME175_HEADER_ROW, M_DATA_COL, "175/100")
                .Cells(M_CHOUKINTIME175_HEADER_ROW, M_DATA_COL).HorizontalAlignment = FarPoint.Win.Spread.CellHorizontalAlignment.Center
                .Cells(M_CHOUKINTIME175_HEADER_ROW, M_DATA_COL).VerticalAlignment = FarPoint.Win.Spread.CellHorizontalAlignment.Center

                '2018-08-14 Darren ADD START
                '25/100
                .SetText(M_CHOUKINTIME25_HEADER_ROW, M_DATA_COL, "25/100")
                .Cells(M_CHOUKINTIME25_HEADER_ROW, M_DATA_COL).HorizontalAlignment = FarPoint.Win.Spread.CellHorizontalAlignment.Center
                .Cells(M_CHOUKINTIME25_HEADER_ROW, M_DATA_COL).VerticalAlignment = FarPoint.Win.Spread.CellHorizontalAlignment.Center
                '2018-08-14 Darren ADD END

                '未承認累計
                .SetText(M_APR_YET_HEADER_ROW, M_DATA_COL, "申請時間")
                .Cells(M_APR_YET_HEADER_ROW, M_DATA_COL).HorizontalAlignment = FarPoint.Win.Spread.CellHorizontalAlignment.Center
                .Cells(M_APR_YET_HEADER_ROW, M_DATA_COL).VerticalAlignment = FarPoint.Win.Spread.CellHorizontalAlignment.Center

                '承認済累計
                .SetText(M_APR_OVER_HEADER_ROW, M_DATA_COL, "承認済累計")
                .Cells(M_APR_OVER_HEADER_ROW, M_DATA_COL).HorizontalAlignment = FarPoint.Win.Spread.CellHorizontalAlignment.Center
                .Cells(M_APR_OVER_HEADER_ROW, M_DATA_COL).VerticalAlignment = FarPoint.Win.Spread.CellHorizontalAlignment.Center

                If m_DetailTimeFlg <> 1 Then
                    '2018-08-14 Darren UPDATE START
                    '申請時間等非表示の場合、未承認、承認済を表示しない為に行数変更
                    '.RowCount = 4
                    .RowCount = 6
                    '2018-08-14 Darren UPDATE END
                End If
                '-2は実線のサイズ調整
                General.paSpreadSizeFit(sprOverTime, sprOverTime.VerticalScrollBarPolicy,
                        sprOverTime.HorizontalScrollBarPolicy, .RowCount, M_COLWIDTH - 2)
                '高さの調整（-2だと未承認非表示時の下部の罫線が太すぎた）
                sprOverTime.Height = sprOverTime.Height - 3

                sprOverTime.Enabled = False '操作不可にするためEnable=Falseにする
                sprOverTime.AutoSize = True

            End With
        Catch ex As Exception
            Call General.paTrpMsg(Convert.ToString(Err.Number), W_SUBNAME)
        End Try
    End Sub

    '=====================================
    '実績データ取得【個人業務】- 実績照会
    '=====================================
    Private Sub sGetResult_Personal()
        Const W_SUBNAME As String = "NSC0000HA sGetResult_Personal"

        Dim w_lngFrom As Integer
        Dim w_lngPreFrom As Integer
        Dim w_lngTo As Integer
        Dim w_lngRecCnt As Integer
        Dim w_lngLoop As Integer
        Dim w_lngDate As Integer
        Dim w_DayIdx As Integer '出力開始日からの日数
        Dim w_lngTime As Integer
        Dim w_Int1 As Integer
        Dim w_HisIndex As Integer
        Dim w_KinmuIdx As Integer

        Dim w_lngDakokuCnt As Integer
        Dim w_lngDakokuLoop As Integer
        Dim w_lngDakokuKbnLoop As Integer
        Dim w_lngSaiyoLoop As Integer
        Dim w_lngKinmuLoop As Integer
        Dim w_lngKinmuLoop2 As Integer
        Dim w_lngDutyLoop As Integer
        Dim w_blnSaiyoFlg As Boolean
        Dim w_lngDutyDayCnt As Integer '日当直は１日に２件の場合がある
        Dim w_lngDutyDayLoop As Integer
        Dim w_lngDutyDate As Integer
        Dim w_lngDutyDayIdx As Integer

        Dim w_str As String
        Dim w_varKbn As Object
        Dim w_varKbn2 As Object
        Dim w_udtDakokuKbn() As DakokuDetail_Type
        Dim w_lngDayKinmuTime As Integer
        Dim w_lngMatrixLoop As Integer
        Dim w_lngMatrixCalcLoop As Integer
        Dim w_lngMatrixCnt As Integer
        Dim w_lngMatrixCalcCnt As Integer

        Dim w_strKinmuDeptCD As String
        Dim w_strSaiyoCD As String

        Dim w_strDateJudgment As String

        'mGetOverKinmuData処理
        Dim w_HolMCompare As Integer
        Dim w_intLoop As Integer
        Dim w_strDaikyuMng As String
        Dim w_strWeekHolCD As String
        Dim w_HolCnt As Integer
        Dim w_lngWeeklyHolDate() As Integer
        Dim w_lngAppLoop As Integer
        Dim w_lngAppCnt As Integer
        Dim w_KoujoKbnCd() As Calc_CD_Type
        Dim w_HolKbnCd() As Calc_CD_Type
        Dim w_CalcTime() As Time_Data_Type
        Dim w_lngLoop2 As Integer
        Dim w_Date As Date
        Dim w_Var As Object
        Dim w_numTmpDate As Integer
        Dim w_ToDokedeFrowFlg As Boolean
        ReDim w_CalcTime(0)

        Try
            'mGetOverKinmuData処理
            '初期化
            w_HolCnt = 0
            ReDim w_lngWeeklyHolDate(0)

            '超勤単価計算時に休日マスタ参照判定(0:参照する　1:参照しない)
            w_HolMCompare = Integer.Parse(General.paGetItemValue(General.G_STRMAINKEY3, General.G_STRSUBKEY1, "HOLMCOMPARE", Convert.ToString(0), General.g_strHospitalCD))
            '週休
            w_strWeekHolCD = General.paGetItemValue(General.G_STRMAINKEY3, General.G_STRSUBKEY1, "WEEKHOLIDAY", "", General.g_strHospitalCD)
            '代休管理（０：する、１：しない）
            w_strDaikyuMng = General.paGetItemValue(General.G_STRMAINKEY2, General.G_STRSUBKEY5, "DAIKYUMNG", "1", General.g_strHospitalCD)

            '開始日
            w_lngFrom = General.paGetDateIntegerFromDate(m_DateFrom)
            '開始日前日
            w_lngPreFrom = General.paGetDateIntegerFromDate(DateAdd(Microsoft.VisualBasic.DateInterval.Day, -1, m_DateFrom))
            '終了日
            w_lngTo = General.paGetDateIntegerFromDate(DateAdd(Microsoft.VisualBasic.DateInterval.Day, 1, m_DateTo))
            '初期化(勤務日数、時間外合計)
            m_lngKinmuDayCnt = 0
            m_lngTotalOverTime = 0
            m_lngKinmuTimeCnt = 0
            ReDim m_lngVMtrxCnt(UBound(m_VMtrx))

            '勤務実績用配列初期化(対象期間日数)
            ReDim m_udtKinmuData(m_lngPutDateNum + 1)
            '出退勤用配列 初期化(対象期間日数)
            ReDim m_udtDakokuData(m_lngPutDateNum)
            For w_lngLoop = 1 To m_lngPutDateNum
                ReDim m_udtDakokuData(w_lngLoop).Detail(0)
            Next w_lngLoop
            '日当直用配列 初期化(対象期間日数)
            ReDim m_udtDutyData(m_lngPutDateNum)
            For w_lngLoop = 1 To m_lngPutDateNum
                ReDim m_udtDutyData(w_lngLoop).Detail(0)
            Next w_lngLoop

            If String.IsNullOrEmpty(g_strTargetStaffMngID) = False Then

                If M_APPRO_PERSONAL_OVER.Equals(m_strSelChildMenu) Then
                    Call sGetPersonalOverAppliData(g_strTargetStaffMngID, w_lngFrom, w_lngTo)
                End If

                '--- 取得した採用・看護単位CDの組合せから勤務時間データを取得
                For w_lngLoop = 1 To UBound(g_udtStaffHistory)
                    Call fncGetSanteiTime(w_lngLoop)
                Next w_lngLoop

                'mGetOverKinmuData処理
                '━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
                '   代休管理データの取得
                '━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
                If fncGetDaikyuData(w_lngFrom, w_lngTo, g_strTargetStaffMngID) = False Then
                    Exit Sub
                End If

                w_str = General.paGetItemValue(General.G_STRMAINKEY3, "WORKTIMESET", "SELFWORKTIMECALCKOJYOBUNRUICD", "", General.g_strHospitalCD)
                w_Var = General.paSplit(w_str, ",")

                ReDim w_KoujoKbnCd(UBound(w_Var) + 1)

                For w_lngLoop = 0 To UBound(w_Var)
                    w_varKbn = Split(w_Var(w_lngLoop), ";")
                    w_str = w_varKbn(0)
                    w_KoujoKbnCd(w_lngLoop + 1).strKBN = w_varKbn(0)
                    w_varKbn2 = General.paSplit(w_str, "+")
                    For w_lngLoop2 = 0 To UBound(w_varKbn2)
                        w_KoujoKbnCd(w_lngLoop + 1).strCD = w_KoujoKbnCd(w_lngLoop + 1).strCD & General.paFormatSpace(w_varKbn2(w_lngLoop2), 2) & ","
                    Next w_lngLoop2
                Next w_lngLoop

                w_str = General.paGetItemValue(General.G_STRMAINKEY3, "WORKTIMESET", "SELFWORKTIMECALCHOLIDAYBUNRUICD", "", General.g_strHospitalCD)
                w_Var = General.paSplit(w_str, ",")

                ReDim w_HolKbnCd(UBound(w_Var) + 1)

                For w_lngLoop = 0 To UBound(w_Var)
                    w_varKbn = Split(w_Var(w_lngLoop), ";")
                    w_str = w_varKbn(0)
                    w_HolKbnCd(w_lngLoop + 1).strKBN = w_varKbn(0)
                    w_varKbn2 = General.paSplit(w_str, "+")
                    For w_lngLoop2 = 0 To UBound(w_varKbn2)
                        w_HolKbnCd(w_lngLoop + 1).strCD = w_HolKbnCd(w_lngLoop + 1).strCD & Format("0, 2", w_varKbn2(w_lngLoop2)) & ","
                    Next w_lngLoop2
                Next w_lngLoop

                '控除取得
                w_Date = General.paGetDateFromDateInteger(w_lngFrom)
                With General.g_objGetData
                    .p病院CD = General.g_strHospitalCD '病院CD
                    .p職員区分 = "0" '職員区分
                    .p職員番号 = g_strTargetStaffMngID '職員番号
                    .p日付区分 = 1 '日付区分
                    .p開始年月日 = w_lngFrom '開始年月日
                    .p終了年月日 = General.paGetDateIntegerFromDate(m_DateTo) '終了年月日
                    .p年休承認区分 = 0 '承認区分
                    .p削除区分 = 0 '削除区分
                    .p年休UNIQUESEQNO = "" 'UNIQUESEQNO
                    .p休暇分類CD = "" '休暇分類CD

                    If .mGetKinmuDetail = True Then
                        w_lngRecCnt = .f勤務詳細期間日数

                        ReDim Preserve w_CalcTime(w_lngRecCnt)

                        For w_lngLoop = 1 To w_lngRecCnt
                            w_numTmpDate = General.paGetDateIntegerFromDate(w_Date)
                            .p勤務詳細年月日 = w_numTmpDate
                            w_CalcTime(w_lngLoop).lngDate = w_numTmpDate

                            For w_Int1 = 1 To .f勤務詳細日別件数
                                .p勤務詳細日別索引 = w_Int1
                                For w_lngLoop2 = 1 To UBound(w_KoujoKbnCd)
                                    If InStr(w_KoujoKbnCd(w_lngLoop2).strCD, General.paFormatSpace(.f勤務詳細CD, 2)) > 0 Then
                                        w_CalcTime(w_lngLoop).lngTime = w_CalcTime(w_lngLoop).lngTime + TimeRound(.f控除時間, w_KoujoKbnCd(w_lngLoop2).strKBN)
                                    End If
                                Next w_lngLoop2
                            Next w_Int1

                            .m翌日勤務詳細()
                            w_Date = DateAdd(Microsoft.VisualBasic.DateInterval.Day, 1, w_Date)
                        Next w_lngLoop
                    End If

                    '時間年休取得
                    .p病院CD = General.g_strHospitalCD '病院CD
                    .p職員区分 = "0" '職員区分
                    .p職員番号 = g_strTargetStaffMngID '職員番号
                    .p日付区分 = 1 '日付区分
                    .p開始年月日 = w_lngFrom '開始年月日
                    .p終了年月日 = General.paGetDateIntegerFromDate(m_DateTo) '終了年月日
                    .p年休承認区分 = 0 '承認区分
                    .p削除区分 = 0 '削除区分
                    .p年休UNIQUESEQNO = "" 'UNIQUESEQNO
                    .p休暇分類CD = "" '休暇分類CD

                    If .mGetNenkyu = True Then
                        w_Date = General.paGetDateFromDateInteger(w_lngFrom)
                        w_lngRecCnt = .f年休期間日数

                        ReDim Preserve w_CalcTime(w_lngRecCnt)

                        For w_lngLoop = 1 To w_lngRecCnt
                            w_numTmpDate = General.paGetDateIntegerFromDate(w_Date)
                            .p年休年月日 = w_numTmpDate
                            w_CalcTime(w_lngLoop).lngDate = w_numTmpDate

                            For w_Int1 = 1 To .f年休日別件数
                                .p年休日別索引 = w_Int1
                                For w_lngLoop2 = 1 To UBound(w_HolKbnCd)
                                    If InStr(w_HolKbnCd(w_lngLoop2).strCD, General.paFormatSpace(.f年休休み分類CD, 2)) > 0 Then
                                        w_CalcTime(w_lngLoop).lngTime = w_CalcTime(w_lngLoop).lngTime + TimeRound(.f取得時間, w_HolKbnCd(w_lngLoop2).strKBN)
                                    End If
                                Next w_lngLoop2
                            Next w_Int1
                            .m翌日年休()
                            w_Date = DateAdd(Microsoft.VisualBasic.DateInterval.Day, 1, w_Date)
                        Next w_lngLoop
                    End If
                End With

                '==================================
                '勤務実績情報 取得
                '==================================
                With General.g_objGetData
                    .p病院CD = General.g_strHospitalCD
                    .p職員区分 = 0 '職員管理番号
                    .p職員番号 = g_strTargetStaffMngID
                    .p勤務取得区分 = 1 '0:予定 1:実績 2:予定/実績
                    .p確定部署CD = ""
                    .p日付区分 = 1 '期間
                    .p開始年月日 = w_lngFrom '開始年月日前日
                    .p終了年月日 = w_lngTo '終了年月日
                    If .mGetKinmu = False Then

                    Else
                        w_lngRecCnt = .f期間日数
                        .p実績年月日 = w_lngFrom

                        For w_lngLoop = 1 To w_lngRecCnt
                            w_lngDate = .f実績年月日

                            '実績年月日がある場合(勤務実績がある場合)
                            If w_lngDate > 0 Then
                                ''配列に格納すべきIndexを取得
                                w_DayIdx = DateDiff(Microsoft.VisualBasic.DateInterval.Day, m_DateFrom, General.DateUtil.paGetDateFromDateInteger(w_lngDate)) + 1

                                '採用期間内であるか
                                w_blnSaiyoFlg = False
                                For w_lngSaiyoLoop = 1 To UBound(m_Personal(1).SaiyoHistory)
                                    If m_Personal(1).SaiyoHistory(w_lngSaiyoLoop).lngStartDate <= w_lngDate AndAlso w_lngDate <= m_Personal(1).SaiyoHistory(w_lngSaiyoLoop).lngEndDate Then

                                        'ﾌﾗｸﾞをTrue(在職期間内である)
                                        w_blnSaiyoFlg = True

                                        Exit For
                                    End If
                                Next w_lngSaiyoLoop

                                '-----------------------------
                                '在職期間内の場合のみ格納
                                '-----------------------------
                                If w_blnSaiyoFlg = True Then

                                    '--- 採用CDと勤務部署CDの組合せを取得
                                    w_HisIndex = 0
                                    For w_Int1 = 1 To UBound(g_udtStaffHistory)
                                        If g_udtStaffHistory(w_Int1).lngStartDate <= w_lngDate AndAlso w_lngDate <= g_udtStaffHistory(w_Int1).lngEndDate Then
                                            w_HisIndex = w_Int1
                                            w_strSaiyoCD = g_udtStaffHistory(w_Int1).strSaiyouCD
                                            w_strKinmuDeptCD = g_udtStaffHistory(w_Int1).strKangoTaniCD
                                            Exit For
                                        End If
                                    Next w_Int1

                                    .p採用条件CD = w_strSaiyoCD
                                    .p看護単位CD = w_strKinmuDeptCD
                                    .p勤務CD = .f実績勤務CD

                                    If .mGetKinmuTime = True Then
                                        .p勤務時間索引 = 1
                                        m_udtKinmuData(w_DayIdx).strInputOKTimeChkFlg = .f超勤入力可否
                                    End If

                                    '●日付
                                    m_udtKinmuData(w_DayIdx).lngDate = w_lngDate
                                    '●勤務CD
                                    m_udtKinmuData(w_DayIdx).strKinmuCD = .f実績勤務CD
                                    w_KinmuIdx = 0
                                    If String.IsNullOrEmpty(m_udtKinmuData(w_DayIdx).strKinmuCD) = False Then
                                        w_KinmuIdx = Integer.Parse(m_udtKinmuData(w_DayIdx).strKinmuCD)
                                    End If
                                    '●勤務名称
                                    m_udtKinmuData(w_DayIdx).strKinmuNm = .f実績勤務名称
                                    '●勤務開始時刻
                                    m_udtKinmuData(w_DayIdx).strFromTime = g_udtHistory(w_HisIndex).SanteiTime(w_KinmuIdx).FormalTimeFrom
                                    '●勤務終了時刻
                                    m_udtKinmuData(w_DayIdx).strToTime = g_udtHistory(w_HisIndex).SanteiTime(w_KinmuIdx).FormalTimeTo


                                    '*** 勤務日数計算 ***
                                    If General.paGetDateIntegerFromDate(m_DateFrom) <= w_lngDate AndAlso w_lngDate <= General.paGetDateIntegerFromDate(m_DateTo) Then

                                        For w_lngKinmuLoop = 1 To UBound(g_KinmuM)
                                            If g_KinmuM(w_lngKinmuLoop).strCD = m_udtKinmuData(w_DayIdx).strKinmuCD Then
                                                '勤務/勤務以外の「勤務」であるか
                                                If "1".Equals(g_KinmuM(w_lngKinmuLoop).strKinmuKbn) Then
                                                    If "1".Equals(g_KinmuM(w_lngKinmuLoop).strHalfFlg) Then
                                                        '全日
                                                        m_lngKinmuDayCnt = m_lngKinmuDayCnt + 1
                                                    Else
                                                        '半日(組み合わせ勤務のそれぞれの勤務/勤務以外を取得する)
                                                        For w_lngKinmuLoop2 = 1 To UBound(g_KinmuM)
                                                            'AM勤務CD
                                                            If g_KinmuM(w_lngKinmuLoop).strAMKinmuCD.Equals(g_KinmuM(w_lngKinmuLoop2).strCD) Then
                                                                If "1".Equals(g_KinmuM(w_lngKinmuLoop2).strKinmuKbn) Then
                                                                    '勤務であれば0.5カウントする
                                                                    m_lngKinmuDayCnt = m_lngKinmuDayCnt + 0.5
                                                                    Exit For
                                                                End If
                                                            End If

                                                            'PM勤務CD
                                                            If g_KinmuM(w_lngKinmuLoop).strPMKinmuCD.Equals(g_KinmuM(w_lngKinmuLoop2).strCD) Then
                                                                If "1".Equals(g_KinmuM(w_lngKinmuLoop2).strKinmuKbn) Then
                                                                    '勤務であれば0.5カウントする
                                                                    m_lngKinmuDayCnt = m_lngKinmuDayCnt + 0.5
                                                                    Exit For
                                                                End If
                                                            End If
                                                        Next w_lngKinmuLoop2
                                                    End If
                                                End If

                                                Exit For
                                            End If
                                        Next w_lngKinmuLoop
                                    End If

                                    '固定勤務時間カウント
                                    If String.IsNullOrEmpty(g_udtHistory(w_HisIndex).SanteiTime(w_KinmuIdx).JituKinmuTime) = False Then
                                        w_lngDayKinmuTime = Integer.Parse(General.paLeft(Format(Integer.Parse(g_udtHistory(w_HisIndex).SanteiTime(w_KinmuIdx).JituKinmuTime), "0000"), 2)) * 60 + Integer.Parse(Mid(Format(Integer.Parse(g_udtHistory(w_HisIndex).SanteiTime(w_KinmuIdx).JituKinmuTime), "0000"), 3, 2))
                                    Else
                                        w_lngDayKinmuTime = 0
                                    End If

                                    For w_lngLoop2 = 1 To UBound(w_CalcTime)
                                        If w_CalcTime(w_lngLoop2).lngDate = w_lngDate Then
                                            w_lngDayKinmuTime = w_lngDayKinmuTime - w_CalcTime(w_lngLoop2).lngTime
                                            Exit For
                                        End If
                                    Next w_lngLoop2

                                    If w_lngDayKinmuTime < 0 Then
                                        w_lngDayKinmuTime = 0
                                    End If

                                    m_lngKinmuTimeCnt = m_lngKinmuTimeCnt + w_lngDayKinmuTime

                                    If General.paGetDateIntegerFromDate(m_DateFrom) <= w_lngDate AndAlso w_lngDate <= General.paGetDateIntegerFromDate(m_DateTo) Then

                                        '集計項目数ループ
                                        w_lngMatrixCnt = UBound(m_VMtrx)
                                        For w_lngMatrixLoop = 1 To w_lngMatrixCnt

                                            '集計項目に対する設定された勤務数ループ
                                            w_lngMatrixCalcCnt = UBound(m_VMtrx(w_lngMatrixLoop).Calc)
                                            For w_lngMatrixCalcLoop = 1 To w_lngMatrixCalcCnt

                                                '該当日の勤務が集計に設定されている勤務の場合
                                                If m_VMtrx(w_lngMatrixLoop).Calc(w_lngMatrixCalcLoop).strKinmuCD.Equals(m_udtKinmuData(w_DayIdx).strKinmuCD) Then

                                                    '回数カウントの場合
                                                    If W_KAISU.Equals(m_VMtrx(w_lngMatrixLoop).CntKbn) Then

                                                        '現在の値に、レート値を加算
                                                        m_lngVMtrxCnt(w_lngMatrixLoop) = m_lngVMtrxCnt(w_lngMatrixLoop) + m_VMtrx(w_lngMatrixLoop).Calc(w_lngMatrixCalcLoop).sinRatio
                                                        '時間カウントの場合
                                                    ElseIf W_JIKAN.Equals(m_VMtrx(w_lngMatrixLoop).CntKbn) Then

                                                        '現在の値に、勤務時間を加算
                                                        m_lngVMtrxCnt(w_lngMatrixLoop) = m_lngVMtrxCnt(w_lngMatrixLoop) + w_lngDayKinmuTime
                                                    End If

                                                End If

                                            Next w_lngMatrixCalcLoop

                                        Next w_lngMatrixLoop
                                    End If

                                    'mGetOverKinmuData処理
                                    '週休(項目設定)かチェック(単価別時間を振り分けるのに利用)
                                    If InStr(w_strWeekHolCD, General.paFormatSpace(m_udtKinmuData(w_DayIdx).strKinmuCD, 2)) > 0 Then
                                        w_HolCnt = w_HolCnt + 1
                                        ReDim Preserve w_lngWeeklyHolDate(w_HolCnt)
                                        w_lngWeeklyHolDate(w_HolCnt) = w_lngDate
                                    End If

                                End If '--- 在職期間内？
                            End If '--- 勤務実績が存在？

                            .m翌日実績()
                        Next w_lngLoop
                    End If
                End With

                '2018-08-14 Darren UPDATE START
                'ReDim m_lngOverTime(M_CHOUKINTIME175_DATA)
                ReDim m_lngOverTime(M_CHOUKINTIME25_DATA)
                '2018-08-14 Darren UPDATE END

                If m_blnOverKinmuDispFlg = True Then
                    '==================================
                    '時間外情報　取得
                    '==================================
                    '勤務日加算表示か超勤日加算表示の判断
                    '（0：単価超勤日 / 計上年月日、1：単価超勤日 / 計上超勤日、2：単価年月日 / 計上年月日）
                    w_strDateJudgment = General.paGetItemValue(General.G_STRMAINKEY3, General.G_STRSUBKEY1, "DATEJUDGMENT", "0", General.g_strHospitalCD)

                    w_DayIdx = 0

                    '届出フローフラグ初期化
                    w_ToDokedeFrowFlg = False

                    '時間外データの出力フラグが"1"の場合
                    If m_OverKinmuFlg = 1 Then
                        With General.g_objSyouninData
                            .pAppliCD = M_STRJIKANGAI                       '届出CD
                            .pAppliStaffMngiD = g_strTargetStaffMngID       '申請者の職員管理番号
                            .pAppliDate = General.paGetDateIntegerFromDate(Now, General.G_DATE_ENUM.yyyyMMdd)           '申請日付
                            .pUNIQUESEQNO = ""                              'UNIQUESEQNO
                            .pDispMode = "2"                                '表示ﾓｰﾄﾞ
                            .pSyoriKbn = "2"                                '処理区分
                            .pApproveStaffMngID = g_strTargetStaffMngID     '承認者職員管理番号

                            '届出フロー取得
                            If .mGetFlowApproveStaff = False Then
                            Else
                                For w_lngLoop = 1 To .fFA_ApproveCount
                                    'index取得
                                    .mFA_Idx = w_lngLoop

                                    If .fFA_ApproveStaffMngID = g_strTargetStaffMngID Then
                                        w_ToDokedeFrowFlg = True
                                        Exit For
                                    End If

                                Next w_lngLoop
                            End If
                        End With
                    End If

                    With General.g_objWorkBaseInfo

                        .p病院CD = General.g_strHospitalCD
                        .p開始年月日 = w_lngPreFrom
                        .p終了年月日 = w_lngTo

                        If .mOverKinmuInit(w_strDateJudgment) Then

                            .p病院CD = General.g_strHospitalCD
                            .p職員区分 = 0
                            .p職員番号 = g_strTargetStaffMngID
                            .p日付区分 = 1
                            .p開始年月日 = w_lngPreFrom
                            .p終了年月日 = w_lngTo
                            .p当直勤務CD = ""
                            '時間外データ出力フラグが"1"の場合、申請データを取得
                            If m_OverKinmuFlg = 1 And w_ToDokedeFrowFlg = False Then
                                .p時間外取得フラグ = 1
                            Else
                                .p時間外取得フラグ = 0
                            End If

                            If .mGetOverKinmuData Then
                                w_lngRecCnt = .f実績超勤件数
                                .p年月日 = w_lngPreFrom

                                For w_lngLoop = 1 To w_lngRecCnt
                                    w_lngDate = .f年月日

                                    If w_lngDate > 0 Then
                                        'その日に採用されているか
                                        w_blnSaiyoFlg = False
                                        For w_lngSaiyoLoop = 1 To UBound(m_Personal(1).SaiyoHistory)
                                            If m_Personal(1).SaiyoHistory(w_lngSaiyoLoop).lngStartDate <= w_lngDate AndAlso m_Personal(1).SaiyoHistory(w_lngSaiyoLoop).lngEndDate >= w_lngDate Then
                                                w_blnSaiyoFlg = True
                                                Exit For
                                            End If
                                        Next w_lngSaiyoLoop

                                        If w_blnSaiyoFlg Then
                                            For w_intLoop = 1 To .f超勤時間件数
                                                .p超勤時間索引 = w_intLoop

                                                '時間外データがあるか
                                                If "".Equals(.f超勤時間FROM) = False AndAlso "".Equals(.f超勤時間TO) = False Then

                                                    '破棄や取消されていないデータを取得
                                                    If "2".Equals(.f超勤状態区分) = False AndAlso "4".Equals(.f超勤状態区分) = False AndAlso "".Equals(.f超勤状態区分) = False Then

                                                        If w_DayIdx <> w_lngLoop - 1 Then
                                                            '配列格納用インデックス取得
                                                            w_DayIdx = w_lngLoop - 1
                                                            '●[時間外]開始時刻
                                                            m_udtKinmuData(w_DayIdx).strOFromTime = .f超勤時間FROM
                                                            '●[時間外]終了時刻
                                                            m_udtKinmuData(w_DayIdx).strOToTime = .f超勤時間TO
                                                            '●[時間外]理由CD
                                                            m_udtKinmuData(w_DayIdx).strReasonCD = .f超勤理由CD
                                                            '●[時間外]理由名称
                                                            m_udtKinmuData(w_DayIdx).strReasonNm = .f超勤理由名称
                                                            '●[時間外]理由略称
                                                            m_udtKinmuData(w_DayIdx).strReasonSNm = .f超勤理由略称
                                                            '●[時間外]状態区分
                                                            m_udtKinmuData(w_DayIdx).strIconStatus = .f超勤状態区分

                                                            If M_APPRO_PERSONAL_OVER.Equals(m_strSelChildMenu) Then
                                                                '●[時間外]ユニークシーク
                                                                m_udtKinmuData(w_DayIdx).strUNIQUESEQNO = .f超勤UNIQUESEQNO
                                                                '●[時間外]職員管理番号
                                                                m_udtKinmuData(w_DayIdx).strAppliStaffMngID = g_strTargetStaffMngID
                                                                m_udtKinmuData(w_DayIdx).lngApproveLevel = 0

                                                                w_lngAppCnt = UBound(m_udtApproveData)
                                                                For w_lngAppLoop = 1 To w_lngAppCnt

                                                                    If m_udtKinmuData(w_DayIdx).strUNIQUESEQNO.Equals(m_udtApproveData(w_lngAppLoop).strUNIQUESEQNO) Then

                                                                        m_udtKinmuData(w_DayIdx).lngApproveLevel = m_udtApproveData(w_lngAppLoop).lngApproveClassLvl
                                                                        m_udtKinmuData(w_DayIdx).dblLastUpdDate = m_udtApproveData(w_lngAppLoop).dblLastUpdTimeDate
                                                                        m_udtKinmuData(w_DayIdx).lngAppliDate = m_udtApproveData(w_lngAppLoop).lngPeriodFromDate
                                                                        m_udtKinmuData(w_DayIdx).strAppliStaffMngID = m_udtApproveData(w_lngAppLoop).strAppliStaffMngID

                                                                        Exit For
                                                                    End If
                                                                Next w_lngAppLoop
                                                            Else
                                                                '●[時間外]ユニークシーク
                                                                m_udtKinmuData(w_DayIdx).strUNIQUESEQNO = .f超勤UNIQUESEQNO
                                                                '●[時間外]職員管理番号
                                                                m_udtKinmuData(w_DayIdx).strAppliStaffMngID = g_strTargetStaffMngID
                                                                m_udtKinmuData(w_DayIdx).lngApproveLevel = 0

                                                                General.g_objSyouninData.pAppliCD = "001001"
                                                                General.g_objSyouninData.pAppliStaffMngID = m_udtKinmuData(w_DayIdx).strAppliStaffMngID
                                                                General.g_objSyouninData.pAppliDate = w_lngDate
                                                                General.g_objSyouninData.pUniqueSeqNo = m_udtKinmuData(w_DayIdx).strUNIQUESEQNO

                                                                If General.g_objSyouninData.mGetAppliApproveStaff = True Then
                                                                    General.g_objSyouninData.mAA_Idx = 1
                                                                    m_udtKinmuData(w_DayIdx).lngApproveLevel = General.g_objSyouninData.fAA_ApproveClassLevel
                                                                    m_udtKinmuData(w_DayIdx).strAppliStaffMngID = General.g_objSyouninData.fAA_ApproveStaffMngID
                                                                    m_udtKinmuData(w_DayIdx).strAppliApproveStatusKbn = General.g_objSyouninData.fAA_AppliApproveStatusKbn '2009/6/12 nishimura add
                                                                End If
                                                            End If
                                                            If m_udtKinmuData(w_DayIdx).lngApproveLevel = 0 Then
                                                                m_udtKinmuData(w_DayIdx).strIconStatus = M_NO_ICON
                                                            Else
                                                                General.g_objSyouninData.pAppliCD = M_STRJIKANGAI '届出CD
                                                                General.g_objSyouninData.pAppliStaffMngID = m_udtKinmuData(w_DayIdx).strAppliStaffMngID '申請者の職員管理番号
                                                                General.g_objSyouninData.pAppliDate = m_udtKinmuData(w_DayIdx).lngAppliDate '申請日付
                                                                General.g_objSyouninData.pUniqueSeqNo = m_udtKinmuData(w_DayIdx).strUNIQUESEQNO 'UNIQUESEQNO
                                                                General.g_objSyouninData.pDispMode = "2" '表示ﾓｰﾄﾞ
                                                                General.g_objSyouninData.pSyoriKbn = "2" '処理区分
                                                                General.g_objSyouninData.pApproveStaffMngID = General.g_strUserMngID '承認者職員管理番号
                                                                General.g_objSyouninData.mJEV_ApproveClassLevel = Convert.ToString(m_udtKinmuData(w_DayIdx).lngApproveLevel)
                                                                General.g_objSyouninData.mJEV_ApproveStaffMngID = General.g_strUserMngID

                                                                If General.g_objSyouninData.mJudgeVisibleEnable = False Then
                                                                    m_udtKinmuData(w_DayIdx).strIconStatus = M_NO_ICON
                                                                Else
                                                                    '0:アイコン無し,1:未承認前,2:未承認,3:自分承認済,4:確定済み

                                                                    '確定されているとき
                                                                    '→操作不能　確定状態
                                                                    If .f超勤状態区分 = 1 Then
                                                                        m_udtKinmuData(w_DayIdx).strIconStatus = M_NOT_APPROVE_DUE

                                                                        '承認ボタンが使えるとき
                                                                        '→操作待ち　未承認状態
                                                                    ElseIf "1".Equals(General.g_objSyouninData.fJEV_ApproveB) Then
                                                                        m_udtKinmuData(w_DayIdx).strIconStatus = M_OK_APPROVE

                                                                        '引き上げ承認ボタンが使えるとき
                                                                        '→操作不能　未承認状態
                                                                    ElseIf "1".Equals(General.g_objSyouninData.fJEV_ApproveUpB) Then
                                                                        m_udtKinmuData(w_DayIdx).strIconStatus = M_NOT_APPROVE_BEFORE

                                                                        'データが存在し、確定されていなくて承認ボタンと引き上げ承認ボタンが使えないとき
                                                                        '→操作不能　未確定承認状態
                                                                    Else
                                                                        m_udtKinmuData(w_DayIdx).strIconStatus = M_NOT_APPROVE_AFTER
                                                                    End If
                                                                End If
                                                            End If
                                                        Else
                                                            m_udtKinmuData(w_DayIdx).blnOAnyData = True
                                                        End If

                                                        If (.f超勤状態区分 = "1" And m_OverKinmuFlg = 0) Or m_OverKinmuFlg = 1 Then
                                                            m_lngOverTime(M_DAY_DATA) = m_lngOverTime(M_DAY_DATA) + .f超過勤務時間100
                                                            m_lngOverTime(M_NOON_DATA) = m_lngOverTime(M_NOON_DATA) + .f超過勤務時間125
                                                            m_lngOverTime(M_WEEKDAYNIGHT_DATA) = m_lngOverTime(M_WEEKDAYNIGHT_DATA) + .f超過勤務時間150
                                                            m_lngOverTime(M_HOLIDAY_DATA) = m_lngOverTime(M_HOLIDAY_DATA) + .f超過勤務時間135
                                                            m_lngOverTime(M_HOLIDAYNIGHT_DATA) = m_lngOverTime(M_HOLIDAYNIGHT_DATA) + .f超過勤務時間160
                                                            m_lngOverTime(M_CHOUKINTIME150_DATA) = m_lngOverTime(M_CHOUKINTIME150_DATA) + .f超過勤務時間150_2
                                                            m_lngOverTime(M_CHOUKINTIME175_DATA) = m_lngOverTime(M_CHOUKINTIME175_DATA) + .f超過勤務時間175
                                                            '2018-08-14 Darren ADD START
                                                            m_lngOverTime(M_CHOUKINTIME25_DATA) = m_lngOverTime(M_CHOUKINTIME25_DATA) + .f超過勤務時間25
                                                            '2018-08-14 Darren ADD END

                                                            '時間外合計 加算
                                                            w_lngTime = .f超過勤務時間100 + .f超過勤務時間125 + .f超過勤務時間135 + .f超過勤務時間150 + .f超過勤務時間160 + .f超過勤務時間150_2 + .f超過勤務時間175
                                                            m_lngTotalOverTime = m_lngTotalOverTime + w_lngTime
                                                        End If
                                                    End If
                                                End If
                                            Next w_intLoop
                                        End If
                                    End If
                                    .m翌日超勤()
                                Next w_lngLoop
                            End If
                        End If
                        .p職員番号 = g_strTargetStaffMngID
                        .p開始年月日 = General.DateUtil.paGetDateIntegerFromDate(m_DateTo)
                        '時間外データの出力フラグを元に戻す
                        If m_OverKinmuFlg = 1 Then
                            .p時間外取得フラグ = 0
                        End If
                        If .mGetOKAppliRuikei Then
                            m_lngAprYetData = .f申請時間
                            m_lngAprOverData = .f確定時間
                        Else
                            m_lngAprYetData = 0
                            m_lngAprOverData = 0
                        End If
                    End With
                End If

                If m_blnDutyDispFlg = True Then
                    '==================================
                    '日当直情報 取得
                    '==================================
                    With General.g_objGetData
                        .p病院CD = General.g_strHospitalCD
                        .p職員区分 = 0 '職員管理番号指定
                        .p職員番号 = g_strTargetStaffMngID '職員管理番号
                        .p日付区分 = 1 '期間
                        .p開始年月日 = w_lngFrom '開始年月日
                        .p終了年月日 = General.paGetDateIntegerFromDate(m_DateTo) '終了年月日
                        If .mGetDuty = False Then

                        Else
                            w_lngRecCnt = .f期間日数
                            .p日当直年月日 = w_lngFrom

                            For w_lngDutyLoop = 1 To w_lngRecCnt

                                '日別件数(１日に２件あり)
                                w_lngDutyDayCnt = .f日当直日別件数

                                For w_lngDutyDayLoop = 1 To w_lngDutyDayCnt
                                    .p日当直日別索引 = w_lngDutyDayLoop

                                    '●年月日
                                    w_lngDutyDate = .f日当直年月日

                                    '採用期間内であるか
                                    w_blnSaiyoFlg = False
                                    For w_lngSaiyoLoop = 1 To UBound(m_Personal(1).SaiyoHistory)
                                        If m_Personal(1).SaiyoHistory(w_lngSaiyoLoop).lngStartDate <= w_lngDutyDate AndAlso w_lngDutyDate <= m_Personal(1).SaiyoHistory(w_lngSaiyoLoop).lngEndDate Then
                                            'ﾌﾗｸﾞをTrue(在職期間内である)
                                            w_blnSaiyoFlg = True
                                            Exit For
                                        End If
                                    Next w_lngSaiyoLoop

                                    If w_lngDutyDate > 0 AndAlso w_blnSaiyoFlg = True Then

                                        w_lngDutyDayIdx = UBound(m_udtDutyData(w_lngDutyLoop).Detail) + 1
                                        ReDim Preserve m_udtDutyData(w_lngDutyLoop).Detail(w_lngDutyDayIdx)

                                        '●年月日
                                        m_udtDutyData(w_lngDutyLoop).lngDate = w_lngDutyDate
                                        '●勤務CD
                                        m_udtDutyData(w_lngDutyLoop).Detail(w_lngDutyDayIdx).strKinmuCD = .f日当直勤務CD
                                        '●勤務名称
                                        m_udtDutyData(w_lngDutyLoop).Detail(w_lngDutyDayIdx).strKinmuNm = .f日当直勤務名称
                                        '●日当直グループCD
                                        m_udtDutyData(w_lngDutyLoop).Detail(w_lngDutyDayIdx).strDutyGroupCD = .f日当直勤務グループCD
                                    End If
                                Next w_lngDutyDayLoop

                                .m翌日日当直()
                            Next w_lngDutyLoop
                        End If
                    End With
                End If

                If m_blnDakokuDispFlg = True Then
                    '==================================
                    '出退勤情報 取得
                    '==================================
                    '項目設定より出退勤区分名称を取得する
                    ReDim w_udtDakokuKbn(0)
                    w_str = General.paGetItemValue(General.G_STRMAINKEY5, General.G_STRSUBKEY1, "INOUTKINMUKBN", "", General.g_strHospitalCD)
                    If String.IsNullOrEmpty(w_str) = False Then
                        w_varKbn = General.paSplit(w_str, ",")
                        '配列確保
                        ReDim w_udtDakokuKbn(UBound(w_varKbn) + 1)

                        For w_lngLoop = 0 To UBound(w_varKbn)
                            w_varKbn2 = Split(w_varKbn(w_lngLoop), "~")
                            '●出退勤区分
                            w_udtDakokuKbn(w_lngLoop + 1).strKBN = w_varKbn2(0)
                            '●出退勤名称
                            w_udtDakokuKbn(w_lngLoop + 1).strKbnNm = w_varKbn2(1)
                        Next w_lngLoop
                    End If

                    w_lngDate = General.paGetDateIntegerFromDate(m_DateFrom)

                    '対象期間日数分 ﾙｰﾌﾟ
                    For w_lngLoop = 1 To m_lngPutDateNum

                        '配列に格納すべきIndexを取得
                        w_DayIdx = DateDiff(Microsoft.VisualBasic.DateInterval.Day, m_DateFrom, General.DateUtil.paGetDateFromDateInteger(w_lngDate)) + 1

                        '出退勤情報 取得
                        With General.g_objGetData
                            .p病院CD = General.g_strHospitalCD
                            .p職員区分 = 0 '職員管理番号指定
                            .p職員番号 = g_strTargetStaffMngID '職員管理番号
                            .p指定年月日 = w_lngDate '指定年月日
                            .p在院FLG = 1 '在院状況確認しない
                            .p指定時間 = "" '上記0の場合のみ有効
                            .p打刻区分 = 0 '勤務を元として取得
                            If .mGetDakoku = False Then

                            Else
                                w_lngDakokuCnt = .f打刻件数
                                ReDim m_udtDakokuData(w_DayIdx).Detail(w_lngDakokuCnt)

                                '打刻件数分 ﾙｰﾌﾟ
                                For w_lngDakokuLoop = 1 To w_lngDakokuCnt
                                    '索引
                                    .p打刻索引 = w_lngDakokuLoop

                                    '●打刻年月日
                                    m_udtDakokuData(w_DayIdx).Detail(w_lngDakokuLoop).lngDakokuDate = .f打刻年月日
                                    '●SEQ
                                    m_udtDakokuData(w_DayIdx).Detail(w_lngDakokuLoop).lngSEQ = .f打刻SEQ
                                    '●時刻
                                    m_udtDakokuData(w_DayIdx).Detail(w_lngDakokuLoop).lngTime = .f打刻時刻
                                    '●区分
                                    m_udtDakokuData(w_DayIdx).Detail(w_lngDakokuLoop).strKBN = .f出退区分
                                    '●区分名称
                                    For w_lngDakokuKbnLoop = 1 To UBound(w_udtDakokuKbn)
                                        If w_udtDakokuKbn(w_lngDakokuKbnLoop).strKBN.Equals(m_udtDakokuData(w_DayIdx).Detail(w_lngDakokuLoop).strKBN) Then
                                            m_udtDakokuData(w_DayIdx).Detail(w_lngDakokuLoop).strKbnNm = w_udtDakokuKbn(w_lngDakokuKbnLoop).strKbnNm
                                            Exit For
                                        End If
                                    Next w_lngDakokuKbnLoop

                                    '●摘要コード
                                    m_udtDakokuData(w_DayIdx).Detail(w_lngDakokuLoop).strTekiyoCD = .f摘要CD
                                    '●適用名称
                                    m_udtDakokuData(w_DayIdx).Detail(w_lngDakokuLoop).strTekiyoNm = .f摘要名称
                                    '●処理済みフラグ
                                    m_udtDakokuData(w_DayIdx).Detail(w_lngDakokuLoop).strManageFinish = .f処理済FLG

                                Next w_lngDakokuLoop
                            End If
                        End With

                        '日付加算
                        w_lngDate = General.DateUtil.paGetDateIntegerFromDate(DateAdd(Microsoft.VisualBasic.DateInterval.Day, w_lngLoop, m_DateFrom))

                    Next w_lngLoop
                End If
            End If

        Catch ex As Exception
            Call General.paTrpMsg(Convert.ToString(Err.Number), W_SUBNAME)
        End Try
    End Sub

    'メニューボタン制御
    Private Function subStaffSecurity() As Boolean
        Try
            Dim w_PreErrorProc As String
            w_PreErrorProc = General.g_ErrorProc 'ﾌﾟﾛｼｰｼﾞｬ名の一時待避
            General.g_ErrorProc = "frmNSC0000HA subStaffSecurity"

            Dim w_lngPackageCnt As Integer
            Dim w_lngLoop As Integer
            Dim w_lngIndex As Integer

            subStaffSecurity = False

            '初期化
            ReDim m_MenuButton(0)

            'セキュリティ部品　５−９
            'パッケージ別一括権限取得
            'mGetAllResourcePackage(p_画面ID)
            If General.g_objSecurity.mGetAllResource(g_strNSC2000HA) = True Then

                w_lngPackageCnt = General.g_objSecurity.fAR_ResourceCount

                For w_lngLoop = 1 To w_lngPackageCnt

                    General.g_objSecurity.mAR_ResourceIdx = w_lngLoop

                    If "2".Equals(General.g_objSecurity.fAR_ObjectKbn) Then

                        w_lngIndex = UBound(m_MenuButton) + 1

                        ReDim Preserve m_MenuButton(w_lngIndex)

                        m_MenuButton(w_lngIndex).ResourceCD = General.g_objSecurity.fAR_ResourceCD 'リソースコード
                        m_MenuButton(w_lngIndex).Title = General.g_objSecurity.fAR_Title 'タイトル
                        m_MenuButton(w_lngIndex).ObjectName = General.g_objSecurity.fAR_ObjectNm 'オブジェクト名称
                        m_MenuButton(w_lngIndex).ObjectKbn = General.g_objSecurity.fAR_ObjectKbn 'オブジェクト区分
                        m_MenuButton(w_lngIndex).SecResourceCD = General.g_objSecurity.fAR_SecuResourceCD 'セキュリティリソースコード
                        m_MenuButton(w_lngIndex).strUpdAuthRangeKbn = General.g_objSecurity.fAr_UpdAuthRangeKbn '更新権限範囲区分
                        m_MenuButton(w_lngIndex).strRefAuthRangeKbn = General.g_objSecurity.fAR_RefAuthRangeKbn '参照権限範囲区分

                    End If

                Next w_lngLoop

            End If

            subStaffSecurity = True

            General.g_ErrorProc = w_PreErrorProc '待避ﾌﾟﾛｼｰｼﾞｬ名を元に戻す
        Catch ex As Exception
            Throw
        End Try
    End Function

    '=======================================
    'スプレッド表示【個人業務】- 実績状況
    '=======================================
    Private Sub sDispSpreadSheet()
        Const W_SUBNAME As String = "NSC0000HA sDispSpreadSheet"
        Dim tmpNum As Integer   '退避変数

        Try
            Dim w_str As String
            Dim w_lngLoop As Integer

            With sprKinmuCnt_Sheet1

                '勤務日数
                .SetText(M_KINMU_ROW, M_DATA_COL, m_lngKinmuDayCnt & "日")
                .Cells(M_KINMU_ROW, M_DATA_COL).HorizontalAlignment = FarPoint.Win.Spread.CellHorizontalAlignment.Center
                .Cells(M_KINMU_ROW, M_DATA_COL).VerticalAlignment = FarPoint.Win.Spread.CellHorizontalAlignment.Center

                '労働時間合計
                w_str = General.paFormatSpace(m_lngKinmuTimeCnt \ 60, 2) & "h " & General.paFormatZero(m_lngKinmuTimeCnt Mod 60, 2)
                .SetText(M_TIME_ROW, M_DATA_COL, w_str & "m")
                .Cells(M_TIME_ROW, M_DATA_COL).HorizontalAlignment = FarPoint.Win.Spread.CellHorizontalAlignment.Center
                .Cells(M_TIME_ROW, M_DATA_COL).VerticalAlignment = FarPoint.Win.Spread.CellHorizontalAlignment.Center

                If m_blnOverKinmuDispFlg = True Then
                    '申請データ表示時は時間外欄に申請のみの時間を表示させる
                    If m_OverKinmuFlg = 1 Then
                        tmpNum = m_lngAprYetData
                    Else
                        tmpNum = m_lngTotalOverTime
                    End If
                    w_str = General.paFormatSpace((tmpNum \ 60), 2) & "h " & General.paFormatZero((tmpNum Mod 60), 2)

                    .SetText(M_OVER_ROW, M_DATA_COL, w_str & "m")
                    .Cells(M_OVER_ROW, M_DATA_COL).HorizontalAlignment = FarPoint.Win.Spread.CellHorizontalAlignment.Center
                    .Cells(M_OVER_ROW, M_DATA_COL).VerticalAlignment = FarPoint.Win.Spread.CellHorizontalAlignment.Center
                End If

            End With

            With sprMatrix_Sheet1

                For w_lngLoop = 0 To UBound(m_lngVMtrxCnt) - 1

                    '９件目以降は表示しない
                    If w_lngLoop > 8 Then
                        Exit For
                    End If

                    w_str = ""
                    If m_VMtrx(w_lngLoop + 1).CntKbn = W_KAISU Then
                        w_str = m_lngVMtrxCnt(w_lngLoop + 1) & "回"
                    ElseIf m_VMtrx(w_lngLoop + 1).CntKbn = W_JIKAN Then
                        w_str = General.paFormatSpace(m_lngVMtrxCnt(w_lngLoop + 1) \ 60, 2) & "h " & General.paFormatZero(m_lngVMtrxCnt(w_lngLoop + 1) Mod 60, 2) & "m"
                    End If
                    .SetText(w_lngLoop, 1, w_str)
                    .Cells(w_lngLoop, 1).HorizontalAlignment = FarPoint.Win.Spread.CellHorizontalAlignment.Center
                    .Cells(w_lngLoop, 1).VerticalAlignment = FarPoint.Win.Spread.CellHorizontalAlignment.Center

                Next w_lngLoop

                '本人集計が存在しない場合は、
                'スプレッドを表示しない
                If UBound(m_lngVMtrxCnt) = 0 Then
                    sprMatrix.Visible = False
                End If

            End With

            If m_blnOverKinmuDispFlg = True Then
                With sprTanka_Sheet1
                    '100/100
                    w_str = General.paFormatSpace(m_lngOverTime(M_DAY_DATA) \ 60, 2) & "h " & General.paFormatZero(m_lngOverTime(M_DAY_DATA) Mod 60, 2)
                    .SetText(M_DAY_ROW, M_DATA_COL, w_str & "m")
                    .Cells(M_DAY_ROW, M_DATA_COL).HorizontalAlignment = FarPoint.Win.Spread.CellHorizontalAlignment.Center
                    .Cells(M_DAY_ROW, M_DATA_COL).VerticalAlignment = FarPoint.Win.Spread.CellHorizontalAlignment.Center

                    '125/100
                    w_str = General.paFormatSpace(m_lngOverTime(M_NOON_DATA) \ 60, 2) & "h " & General.paFormatZero(m_lngOverTime(M_NOON_DATA) Mod 60, 2)

                    .SetText(M_NOON_ROW, M_DATA_COL, w_str & "m")
                    .Cells(M_NOON_ROW, M_DATA_COL).HorizontalAlignment = FarPoint.Win.Spread.CellHorizontalAlignment.Center
                    .Cells(M_NOON_ROW, M_DATA_COL).VerticalAlignment = FarPoint.Win.Spread.CellHorizontalAlignment.Center

                    '150/100
                    w_str = General.paFormatSpace(m_lngOverTime(M_WEEKDAYNIGHT_DATA) \ 60, 2) & "h " & General.paFormatZero(m_lngOverTime(M_WEEKDAYNIGHT_DATA) Mod 60, 2)

                    .SetText(M_WEEKDAYNIGHT_ROW, M_DATA_COL, w_str & "m")
                    .Cells(M_WEEKDAYNIGHT_ROW, M_DATA_COL).HorizontalAlignment = FarPoint.Win.Spread.CellHorizontalAlignment.Center
                    .Cells(M_WEEKDAYNIGHT_ROW, M_DATA_COL).VerticalAlignment = FarPoint.Win.Spread.CellHorizontalAlignment.Center

                    '135/100
                    w_str = General.paFormatSpace(m_lngOverTime(M_HOLIDAY_DATA) \ 60, 2) & "h " & General.paFormatZero(m_lngOverTime(M_HOLIDAY_DATA) Mod 60, 2)

                    .SetText(M_HOLIDAY_ROW, M_DATA_COL, w_str & "m")
                    .Cells(M_HOLIDAY_ROW, M_DATA_COL).HorizontalAlignment = FarPoint.Win.Spread.CellHorizontalAlignment.Center
                    .Cells(M_HOLIDAY_ROW, M_DATA_COL).VerticalAlignment = FarPoint.Win.Spread.CellHorizontalAlignment.Center

                    '160/100
                    w_str = General.paFormatSpace(m_lngOverTime(M_HOLIDAYNIGHT_DATA) \ 60, 2) & "h " & General.paFormatZero(m_lngOverTime(M_HOLIDAYNIGHT_DATA) Mod 60, 2)

                    .SetText(M_HOLIDAYNIGHT_ROW, M_DATA_COL, w_str & "m")
                    .Cells(M_HOLIDAYNIGHT_ROW, M_DATA_COL).HorizontalAlignment = FarPoint.Win.Spread.CellHorizontalAlignment.Center
                    .Cells(M_HOLIDAYNIGHT_ROW, M_DATA_COL).VerticalAlignment = FarPoint.Win.Spread.CellHorizontalAlignment.Center
                End With

                With sprOverTime_Sheet1
                    '150/100
                    w_str = General.paFormatSpace(m_lngOverTime(M_CHOUKINTIME150_DATA) \ 60, 2) & "h " & General.paFormatZero(m_lngOverTime(M_CHOUKINTIME150_DATA) Mod 60, 2)
                    .SetText(M_CHOUKINTIME150_ROW, M_DATA_COL, w_str & "m")
                    .Cells(M_CHOUKINTIME150_ROW, M_DATA_COL).HorizontalAlignment = FarPoint.Win.Spread.CellHorizontalAlignment.Center
                    .Cells(M_CHOUKINTIME150_ROW, M_DATA_COL).VerticalAlignment = FarPoint.Win.Spread.CellVerticalAlignment.Center

                    '175/100
                    w_str = General.paFormatSpace(m_lngOverTime(M_CHOUKINTIME175_DATA) \ 60, 2) & "h " & General.paFormatZero(m_lngOverTime(M_CHOUKINTIME175_DATA) Mod 60, 2)
                    .SetText(M_CHOUKINTIME175_ROW, M_DATA_COL, w_str & "m")
                    .Cells(M_CHOUKINTIME175_ROW, M_DATA_COL).HorizontalAlignment = FarPoint.Win.Spread.CellHorizontalAlignment.Center
                    .Cells(M_CHOUKINTIME175_ROW, M_DATA_COL).VerticalAlignment = FarPoint.Win.Spread.CellVerticalAlignment.Center

                    '2018-08-14 Darren ADD START
                    '25/100
                    w_str = General.paFormatSpace(m_lngOverTime(M_CHOUKINTIME25_DATA) \ 60, 2) & "h " & General.paFormatZero(m_lngOverTime(M_CHOUKINTIME25_DATA) Mod 60, 2)
                    .SetText(M_CHOUKINTIME25_ROW, M_DATA_COL, w_str & "m")
                    .Cells(M_CHOUKINTIME25_ROW, M_DATA_COL).HorizontalAlignment = FarPoint.Win.Spread.CellHorizontalAlignment.Center
                    .Cells(M_CHOUKINTIME25_ROW, M_DATA_COL).VerticalAlignment = FarPoint.Win.Spread.CellVerticalAlignment.Center
                    '2018-08-14 Darren ADD END

                    If m_DetailTimeFlg = 1 Then
                        '未承認累計
                        w_str = General.paFormatSpace(m_lngAprYetData \ 60, 2) & "h " & General.paFormatZero(m_lngAprYetData Mod 60, 2)
                        .SetText(M_APR_YET_ROW, M_DATA_COL, w_str & "m")
                        .Cells(M_APR_YET_ROW, M_DATA_COL).HorizontalAlignment = FarPoint.Win.Spread.CellHorizontalAlignment.Center
                        .Cells(M_APR_YET_ROW, M_DATA_COL).VerticalAlignment = FarPoint.Win.Spread.CellVerticalAlignment.Center

                        '承認済累計
                        w_str = General.paFormatSpace(m_lngAprOverData \ 60, 2) & "h " & General.paFormatZero(m_lngAprOverData Mod 60, 2)
                        .SetText(M_APR_OVER_ROW, M_DATA_COL, w_str & "m")
                        .Cells(M_APR_OVER_ROW, M_DATA_COL).HorizontalAlignment = FarPoint.Win.Spread.CellHorizontalAlignment.Center
                        .Cells(M_APR_OVER_ROW, M_DATA_COL).VerticalAlignment = FarPoint.Win.Spread.CellVerticalAlignment.Center
                    End If
                End With
            Else
                sprTanka.Visible = False
                sprOverTime.Visible = False
            End If

        Catch ex As Exception
            Call General.paTrpMsg(Convert.ToString(Err.Number), W_SUBNAME)
        End Try
    End Sub

    '==============================
    '【個人業務】- 届出状況 取得
    '==============================
    Private Sub sGetApplication()
        Const W_SUBNAME As String = "NSC0000HA sGetApplication"

        Try
            Dim w_lngFrom As Integer
            Dim w_lngTo As Integer
            Dim w_lngLoop As Integer
            Dim w_lngRecCnt As Integer
            Dim w_ScreenKbn As String '画面制御区分
            Dim w_lngIdx As Integer

            Dim w_strSelectIdx As String
            Dim w_strSelectCD As String
            Const W_strGroupALL As String = "000000"

            '開始日
            w_lngFrom = General.paGetDateIntegerFromDate(imdFrom.Value)
            '終了日
            w_lngTo = General.paGetDateIntegerFromDate(imdTo.Value)

            w_strSelectIdx = cmbStatus.SelectedIndex
            w_strSelectCD = g_ApplMaster(Integer.Parse(w_strSelectIdx)).strCD

            '配列初期化
            ReDim m_udtAppliData(0)

            '届出一覧取得
            With General.g_objSyouninData
                .mMA_AppliStaffMngID = g_strTargetStaffMngID '申請者職員管理番号
                .mMA_PeriodDateFrom = w_lngFrom '取得開始日
                .mMA_PeriodDateTo = w_lngTo '取得終了日
                .mMA_DateKbn = 1 '取得区分(取得期間)
                .mMA_KikanKbn = "1"

                If .mGetMemberAppliList = False Then

                Else
                    '届出件数
                    w_lngRecCnt = .fMA_Count

                    For w_lngLoop = 1 To w_lngRecCnt
                        '索引
                        .mMA_Idx = w_lngLoop

                        '画面制御区分
                        w_ScreenKbn = .fMA_ScreenCtrlKbn

                        If W_strGroupALL.Equals(w_strSelectCD) OrElse w_strSelectCD.Equals(.fMA_AppliCD) Then

                            If "2".Equals(w_ScreenKbn) = False Then

                                w_lngIdx = UBound(m_udtAppliData) + 1
                                ReDim Preserve m_udtAppliData(w_lngIdx)

                                '●UNIQUESEQNO
                                m_udtAppliData(w_lngIdx).strUNIQUESEQNO = .fMA_UNIQUESEQNO
                                '●届出コード
                                m_udtAppliData(w_lngIdx).strAppliCD = .fMA_AppliCD
                                '●届出名称
                                m_udtAppliData(w_lngIdx).strAppliNm = .fMA_AppliName
                                '●申請者職員管理番号
                                m_udtAppliData(w_lngIdx).strAppliStaffMngID = .fMA_AppliStaffMngID
                                '●申請者職員番号
                                m_udtAppliData(w_lngIdx).strAppliStaffID = .fMA_AppliStaffID
                                '●申請者氏名
                                m_udtAppliData(w_lngIdx).strAppliStaffName = .fMA_AppliStaffName
                                '●申請年月日
                                m_udtAppliData(w_lngIdx).lngAppliDate = .fMA_AppliDate
                                '●期間開始年月日
                                m_udtAppliData(w_lngIdx).lngPeriodFromDate = .fMA_PeriodFromDate
                                '●期間終了年月日
                                m_udtAppliData(w_lngIdx).lngPeriodToDate = .fMA_PeriodToDate
                                '●開始時間
                                m_udtAppliData(w_lngIdx).lngFromTime = .fMA_FromTime
                                '●終了時間
                                m_udtAppliData(w_lngIdx).lngToTime = .fMA_ToTime
                                '●翌日フラグ
                                m_udtAppliData(w_lngIdx).strNextDayFlg = .fMA_NextDayFlg
                                '●内容
                                m_udtAppliData(w_lngIdx).strContents = .fMA_Contents
                                '●理由
                                m_udtAppliData(w_lngIdx).strReasonNote = .fMA_ReasonNote
                                '●申請者承認状態区分
                                m_udtAppliData(w_lngIdx).strAppliApproveStatusKbn = .fMA_AppliApproveStatusKbn
                                '●申請者承認状態表示
                                m_udtAppliData(w_lngIdx).strAppliApproveStatusDisp = .fMA_AppliApproveStatusDisp
                                '●コメント
                                m_udtAppliData(w_lngIdx).strComment = .fMA_Comment
                                '●汎用エリア
                                m_udtAppliData(w_lngIdx).strHanyouArea = .fMA_HanyouArea
                                '●破棄年月日
                                m_udtAppliData(w_lngIdx).dblCancelDate = .fMA_CancelDate
                                '●最終更新年月日
                                m_udtAppliData(w_lngIdx).dblLastUpdTimeDate = .fMA_LastUpdTimeDate
                                '●画面制御区分
                                m_udtAppliData(w_lngIdx).strScreenCtrlKbn = w_ScreenKbn

                            End If
                        End If
                    Next w_lngLoop
                End If
            End With

        Catch ex As Exception
            Call General.paTrpMsg(Convert.ToString(Err.Number), W_SUBNAME)
        End Try
    End Sub

    '===============================
    'リストビュー表示
    '===============================
    Private Sub sDispListView()
        Const W_SUBNAME As String = "NSC0000HA sDispListView"

        Try
            Dim w_LItem As System.Windows.Forms.ListViewItem
            Dim w_Date As Date
            Dim w_Time As String
            Dim w_lngHolLoop As Integer
            Dim w_lngDakokuLoop As Integer
            Dim w_lngLoop As Integer
            Dim w_lngLoop2 As Integer
            Dim w_lngListIdx As Integer
            Dim w_lngStaffIdx As Integer
            Dim w_Hour As Integer
            Dim w_Min As Integer

            Dim w_lngSubListIndex As Integer

            Dim w_blnSelectOKFlg As Boolean
            Dim w_str As String
            Dim w_lngLoop3 As Integer
            Dim w_strKinmuDeptCD As String
            Dim w_LoclFlg As Boolean
            Dim w_strLimitOverMark As String
            Dim w_lngLimitOverMinute As Integer
            Dim w_strAppliCD As String
            Dim w_numDate As Integer

            '対象開始日
            w_Date = m_DateFrom

            w_blnSelectOKFlg = False

            Dim w_lngKinmuDeptLoop As Integer

            Dim w_lngRenbanNo As Integer

            Dim w_strIcon As String
            Dim w_WarddeptFlg As String '勤務＝配属フラグ（"1"：勤務＝配属、"0"：勤務≠配属)
            w_WarddeptFlg = General.paGetItemValue(General.G_STRMAINKEY1, General.G_STRSECTION1, "WORDDEPTFLG", "0", General.g_strHospitalCD)

            Select Case g_MenuM(g_lngGroupIdx).ListBarMenu(g_lngListIdx).strResCD

                Case M_PERSONAL_RESCD
                    '===============
                    '■個人業務
                    '===============
                    If m_strSelChildMenu = M_PER_JISSEKI_DSP Then
                        '-------------
                        '■実績状況
                        '-------------
                        '対象月 日付数分ﾙｰﾌﾟ
                        For w_lngLoop = 1 To m_lngPutDateNum

                            w_lngSubListIndex = 0

                            '超勤がない
                            If M_NO_ICON.Equals(m_udtKinmuData(w_lngLoop).strIconStatus) Then
                                w_strIcon = ""
                                '承認待ちだが承認できない
                            ElseIf M_NOT_APPROVE_BEFORE.Equals(m_udtKinmuData(w_lngLoop).strIconStatus) Then
                                w_strIcon = "OVER1"
                                '承認待ちで承認できる
                            ElseIf M_OK_APPROVE.Equals(m_udtKinmuData(w_lngLoop).strIconStatus) Then
                                w_strIcon = "OVER2"
                                '承認済
                            ElseIf M_NOT_APPROVE_AFTER.Equals(m_udtKinmuData(w_lngLoop).strIconStatus) _
                                OrElse M_NOT_APPROVE_DUE.Equals(m_udtKinmuData(w_lngLoop).strIconStatus) Then
                                w_strIcon = "OVER4"
                            Else
                                w_strIcon = ""
                            End If

                            If "2".Equals(m_udtKinmuData(w_lngLoop).strAppliApproveStatusKbn) OrElse "3".Equals(m_udtKinmuData(w_lngLoop).strAppliApproveStatusKbn) Then
                                w_strIcon = "OVER5"
                            End If
                            '●日付
                            w_str = General.paFormatSpace(w_Date.Day, 2) & "日"

                            '申請データ表示時はアイコンを表示しない
                            If m_OverKinmuFlg = 1 Then
                                w_strIcon = ""
                            End If


                            '●日締めマークの取得
                            '----------------------------------------------------------------------
                            'データの取得
                            '----------------------------------------------------------------------
                            '日締めマークの取得
                            m_dayLockMark = General.paGetItemValue(General.G_STRMAINKEY3, General.G_STRSUBKEY1, "DAYLOCKMARK", "", General.g_strHospitalCD)

                            '●時間外ロック
                            w_LoclFlg = False
                            For w_lngLoop3 = 1 To UBound(g_udtStaffHistory)
                                If g_udtStaffHistory(w_lngLoop3).lngStartDate <= General.paGetDateIntegerFromDate(w_Date) AndAlso General.paGetDateIntegerFromDate(w_Date) <= g_udtStaffHistory(w_lngLoop3).lngEndDate Then
                                    w_strKinmuDeptCD = g_udtStaffHistory(w_lngLoop3).strKangoTaniCD
                                    Exit For
                                End If
                            Next w_lngLoop3

                            For w_lngLoop3 = 1 To UBound(m_udtOverKinmuLock)
                                If m_udtOverKinmuLock(w_lngLoop3).blnLockFlg = True _
                                    AndAlso m_udtOverKinmuLock(w_lngLoop3).strKinmuDeptCD.Equals(w_strKinmuDeptCD) _
                                    AndAlso m_udtOverKinmuLock(w_lngLoop3).lngDate = General.paGetDateIntegerFromDate(w_Date) Then
                                    w_LoclFlg = True
                                    Exit For
                                End If
                            Next w_lngLoop3

                            If String.IsNullOrEmpty(w_strIcon) Then
                                If Weekday(w_Date) = 1 Then
                                    If w_LoclFlg = False Then
                                        w_LItem = lvwMain.Items.Add("Key" & w_lngLoop, w_str & "(日)", "")
                                    Else
                                        w_LItem = lvwMain.Items.Add("Key" & w_lngLoop, w_str & "(日)" & m_dayLockMark, "")
                                    End If
                                    w_LItem.ForeColor = System.Drawing.ColorTranslator.FromOle(g_Sun_ForeColor)
                                ElseIf Weekday(w_Date) = 7 Then
                                    If w_LoclFlg = False Then
                                        w_LItem = lvwMain.Items.Add("Key" & w_lngLoop, w_str & "(土)", "")
                                    Else
                                        w_LItem = lvwMain.Items.Add("Key" & w_lngLoop, w_str & "(土)" & m_dayLockMark, "")
                                    End If
                                    w_LItem.ForeColor = System.Drawing.ColorTranslator.FromOle(g_Sat_ForeColor)
                                Else
                                    If w_LoclFlg = False Then
                                        w_LItem = lvwMain.Items.Add("Key" & w_lngLoop, w_str & "(" & Format(w_Date, "ddd") & ")", "")
                                    Else
                                        w_LItem = lvwMain.Items.Add("Key" & w_lngLoop, w_str & "(" & Format(w_Date, "ddd") & ")" & m_dayLockMark, "")
                                    End If
                                    w_LItem.ForeColor = System.Drawing.Color.Black
                                End If
                            Else
                                If Weekday(w_Date) = 1 Then
                                    If w_LoclFlg = False Then
                                        w_LItem = lvwMain.Items.Add("Key" & w_lngLoop, w_str & "(日)", w_strIcon)
                                    Else
                                        w_LItem = lvwMain.Items.Add("Key" & w_lngLoop, w_str & "(日)" & m_dayLockMark, w_strIcon)
                                    End If
                                    w_LItem.ForeColor = System.Drawing.ColorTranslator.FromOle(g_Sun_ForeColor)
                                ElseIf Weekday(w_Date) = 7 Then
                                    If w_LoclFlg = False Then
                                        w_LItem = lvwMain.Items.Add("Key" & w_lngLoop, w_str & "(土)", w_strIcon)
                                    Else
                                        w_LItem = lvwMain.Items.Add("Key" & w_lngLoop, w_str & "(土)" & m_dayLockMark, w_strIcon)
                                    End If
                                    w_LItem.ForeColor = System.Drawing.ColorTranslator.FromOle(g_Sat_ForeColor)
                                Else
                                    If w_LoclFlg = False Then
                                        w_LItem = lvwMain.Items.Add("Key" & w_lngLoop, w_str & "(" & Format(w_Date, "ddd") & ")", w_strIcon)
                                    Else
                                        w_LItem = lvwMain.Items.Add("Key" & w_lngLoop, w_str & "(" & Format(w_Date, "ddd") & ")" & m_dayLockMark, w_strIcon)
                                    End If
                                    w_LItem.ForeColor = System.Drawing.Color.Black
                                End If
                            End If

                            '休日マスタチェック
                            For w_lngHolLoop = 1 To UBound(g_HolidayM)
                                If g_HolidayM(w_lngHolLoop).lngDate = General.paGetDateIntegerFromDate(w_Date) Then
                                    '祝日カラー
                                    w_LItem.ForeColor = System.Drawing.ColorTranslator.FromOle(g_Hol_ForeColor)
                                    Exit For
                                End If
                            Next w_lngHolLoop

                            '●勤務名称
                            w_lngSubListIndex = w_lngSubListIndex + 1
                            w_str = m_udtKinmuData(w_lngLoop).strKinmuNm
                            If w_LItem.SubItems.Count > w_lngSubListIndex Then
                                w_LItem.SubItems(w_lngSubListIndex).Text = w_str
                            Else
                                w_LItem.SubItems.Insert(w_lngSubListIndex, New System.Windows.Forms.ListViewItem.ListViewSubItem(Nothing, w_str))
                            End If

                            '●日当直
                            If m_blnDutyDispFlg = True Then
                                w_str = ""
                                If UBound(m_udtDutyData(w_lngLoop).Detail) > 0 Then
                                    w_str = m_udtDutyData(w_lngLoop).Detail(1).strKinmuNm
                                    If UBound(m_udtDutyData(w_lngLoop).Detail) >= 2 Then
                                        w_str = w_str & "*"
                                    End If
                                End If
                                w_lngSubListIndex = w_lngSubListIndex + 1
                                If w_LItem.SubItems.Count > w_lngSubListIndex Then
                                    w_LItem.SubItems(w_lngSubListIndex).Text = w_str
                                Else
                                    w_LItem.SubItems.Insert(w_lngSubListIndex, New System.Windows.Forms.ListViewItem.ListViewSubItem(Nothing, w_str))
                                End If
                            End If

                            '●勤務時間
                            w_str = ""
                            If ("0".Equals(m_udtKinmuData(w_lngLoop).strFromTime) AndAlso "0".Equals(m_udtKinmuData(w_lngLoop).strToTime)) OrElse (String.IsNullOrEmpty(m_udtKinmuData(w_lngLoop).strFromTime) AndAlso String.IsNullOrEmpty(m_udtKinmuData(w_lngLoop).strToTime)) Then
                                '時刻設定がない場合
                                w_str = ""
                            Else
                                w_Time = General.paFormatZero(Integer.Parse(m_udtKinmuData(w_lngLoop).strFromTime), 4)
                                w_str = General.paFormatZero(Integer.Parse(General.paLeft(w_Time, 2)), 2) & ":" & General.paFormatZero(Integer.Parse(Mid(w_Time, 3, 2)), 2) & "〜"

                                w_Time = General.paFormatZero(Integer.Parse(m_udtKinmuData(w_lngLoop).strToTime), 4)
                                w_str = w_str & General.paFormatZero(Integer.Parse(General.paLeft(w_Time, 2)), 2) & ":" & General.paFormatZero(Integer.Parse(Mid(w_Time, 3, 2)), 2)
                            End If
                            w_lngSubListIndex = w_lngSubListIndex + 1
                            If w_LItem.SubItems.Count > w_lngSubListIndex Then
                                w_LItem.SubItems(w_lngSubListIndex).Text = w_str
                            Else
                                w_LItem.SubItems.Insert(w_lngSubListIndex, New System.Windows.Forms.ListViewItem.ListViewSubItem(Nothing, w_str))
                            End If

                            '●時間外
                            If m_blnOverKinmuDispFlg = True Then
                                w_str = ""
                                If String.IsNullOrEmpty(m_udtKinmuData(w_lngLoop).strOFromTime) OrElse String.IsNullOrEmpty(m_udtKinmuData(w_lngLoop).strOToTime) Then
                                    '超勤なし
                                    w_str = ""
                                Else
                                    w_Time = General.paFormatZero(Integer.Parse(m_udtKinmuData(w_lngLoop).strOFromTime), 4)
                                    w_str = General.paFormatSpace(Integer.Parse(General.paLeft(w_Time, 2)), 2) & ":" & General.paFormatZero(Integer.Parse(Mid(w_Time, 3, 2)), 2) & "〜"

                                    w_Time = General.paFormatZero(Integer.Parse(m_udtKinmuData(w_lngLoop).strOToTime), 4)
                                    w_str = w_str & General.paFormatSpace(Integer.Parse(General.paLeft(w_Time, 2)), 2) & ":" & General.paFormatZero(Integer.Parse(Mid(w_Time, 3, 2)), 2)

                                    '超勤理由略称
                                    w_str = w_str & "(" & m_udtKinmuData(w_lngLoop).strReasonSNm & ")"

                                    '２件以上の場合は記号を表示
                                    If m_udtKinmuData(w_lngLoop).blnOAnyData = True Then
                                        w_str = w_str & "*"
                                    End If
                                End If
                                w_lngSubListIndex = w_lngSubListIndex + 1
                                If w_LItem.SubItems.Count > w_lngSubListIndex Then
                                    w_LItem.SubItems(w_lngSubListIndex).Text = w_str
                                Else
                                    w_LItem.SubItems.Insert(w_lngSubListIndex, New System.Windows.Forms.ListViewItem.ListViewSubItem(Nothing, w_str))
                                End If
                            End If

                            '●打刻情報
                            If m_blnDakokuDispFlg = True Then
                                w_str = ""
                                For w_lngDakokuLoop = 1 To UBound(m_udtDakokuData(w_lngLoop).Detail)
                                    w_Time = General.paFormatZero(m_udtDakokuData(w_lngLoop).Detail(w_lngDakokuLoop).lngTime, 4)
                                    w_str = w_str & m_udtDakokuData(w_lngLoop).Detail(w_lngDakokuLoop).strKbnNm &
                                            General.paFormatSpace(Integer.Parse(General.paLeft(w_Time, 2)), 2) & ":" &
                                            General.paFormatZero(Integer.Parse(Mid(w_Time, 3, 2)), 2)
                                Next w_lngDakokuLoop

                                w_lngSubListIndex = w_lngSubListIndex + 1
                                If w_LItem.SubItems.Count > w_lngSubListIndex Then
                                    w_LItem.SubItems(w_lngSubListIndex).Text = w_str
                                Else
                                    w_LItem.SubItems.Insert(w_lngSubListIndex, New System.Windows.Forms.ListViewItem.ListViewSubItem(Nothing, w_str))
                                End If
                            End If

                            '日付加算
                            w_Date = DateAdd(Microsoft.VisualBasic.DateInterval.Day, 1, w_Date)
                            w_LItem.Tag = Convert.ToString(w_lngLoop)
                        Next w_lngLoop

                    ElseIf m_strSelChildMenu = M_PER_APPLI_DSP Then
                        '-------------
                        '■届出状況
                        '-------------
                        '届出件数ﾙｰﾌﾟ
                        For w_lngLoop = 1 To UBound(m_udtAppliData)
                            '●連番
                            w_LItem = lvwMain.Items.Add("Key" & w_lngLoop, General.paFormatSpace(w_lngLoop, 3), "")
                            '●状態
                            w_str = m_udtAppliData(w_lngLoop).strAppliApproveStatusDisp
                            If w_LItem.SubItems.Count > M_PER_STATUS_A Then
                                w_LItem.SubItems(M_PER_STATUS_A).Text = w_str
                            Else
                                w_LItem.SubItems.Insert(M_PER_STATUS_A, New System.Windows.Forms.ListViewItem.ListViewSubItem(Nothing, w_str))
                            End If
                            '●届出名称
                            w_str = m_udtAppliData(w_lngLoop).strAppliNm
                            If w_LItem.SubItems.Count > M_PER_NAME_A Then
                                w_LItem.SubItems(M_PER_NAME_A).Text = w_str
                            Else
                                w_LItem.SubItems.Insert(M_PER_NAME_A, New System.Windows.Forms.ListViewItem.ListViewSubItem(Nothing, w_str))
                            End If
                            '●届出対象日
                            w_str = ""
                            If IsDate(Format(m_udtAppliData(w_lngLoop).lngPeriodFromDate, "0000/00/00")) = True Then
                                w_str = General.paGetDateStringFromInteger(m_udtAppliData(w_lngLoop).lngPeriodFromDate) & " 〜 "
                            End If
                            If IsDate(Format(m_udtAppliData(w_lngLoop).lngPeriodToDate, "0000/00/00")) = True Then
                                w_str = w_str & General.paGetDateStringFromInteger(m_udtAppliData(w_lngLoop).lngPeriodToDate)
                            End If
                            If w_LItem.SubItems.Count > M_PER_PERIOD_A Then
                                w_LItem.SubItems(M_PER_PERIOD_A).Text = w_str
                            Else
                                w_LItem.SubItems.Insert(M_PER_PERIOD_A, New System.Windows.Forms.ListViewItem.ListViewSubItem(Nothing, w_str))
                            End If
                            '●申請日
                            w_str = ""
                            If IsDate(Format(m_udtAppliData(w_lngLoop).lngAppliDate, "0000/00/00")) = True Then
                                w_str = General.paGetDateStringFromInteger(m_udtAppliData(w_lngLoop).lngAppliDate)
                            End If
                            If w_LItem.SubItems.Count > M_PER_APPLIDATE_A Then
                                w_LItem.SubItems(M_PER_APPLIDATE_A).Text = w_str
                            Else
                                w_LItem.SubItems.Insert(M_PER_APPLIDATE_A, New System.Windows.Forms.ListViewItem.ListViewSubItem(Nothing, w_str))
                            End If
                            '●内容
                            w_str = m_udtAppliData(w_lngLoop).strContents
                            If w_LItem.SubItems.Count > M_PER_CONTENS_A Then
                                w_LItem.SubItems(M_PER_CONTENS_A).Text = w_str
                            Else
                                w_LItem.SubItems.Insert(M_PER_CONTENS_A, New System.Windows.Forms.ListViewItem.ListViewSubItem(Nothing, w_str))
                            End If
                            w_LItem.Tag = Convert.ToString(w_lngLoop)
                        Next w_lngLoop

                    ElseIf M_PER_HOLIDAY_DSP.Equals(m_strSelChildMenu) Then
                        '-------------
                        '■休暇出状況
                        '-------------

                    End If

                Case M_DEPT_RESCD
                    '===============
                    '■部署業務
                    '===============
                    If M_DEPT_KINMUINFO.Equals(m_strSelChildMenu) Then
                        '=================
                        '勤務状況
                        '=================
                        w_lngListIdx = 0
                        w_lngStaffIdx = 0
                        For w_lngLoop = 1 To UBound(m_udtStaffData)

                            '勤務実績がない場合は表示なし
                            If String.IsNullOrEmpty(m_udtDayKinmuJisseki(w_lngLoop).strKinmuCD) = False Then

                                w_lngStaffIdx = w_lngStaffIdx + 1

                                '●連番
                                If "1".Equals(m_udtStaffData(w_lngLoop).strSex) Then
                                    '男性
                                    w_LItem = lvwDeptInfo.Items.Add("Key" & w_lngLoop, General.paFormatSpace(w_lngStaffIdx, 3), "MAN")
                                Else
                                    '女性
                                    w_LItem = lvwDeptInfo.Items.Add("Key" & w_lngLoop, General.paFormatSpace(w_lngStaffIdx, 3), "WOMAN")
                                End If

                                '●職員番号
                                w_str = General.paFormatSpace(m_udtStaffData(w_lngLoop).strStaffID, 10)
                                If w_LItem.SubItems.Count > M_DEP_STAFFID Then
                                    w_LItem.SubItems(M_DEP_STAFFID).Text = w_str
                                Else
                                    w_LItem.SubItems.Insert(M_DEP_STAFFID, New System.Windows.Forms.ListViewItem.ListViewSubItem(Nothing, w_str))
                                End If
                                '-----------------------------------------------------

                                '●氏名
                                w_str = m_udtStaffData(w_lngLoop).strName
                                If w_LItem.SubItems.Count > M_DEP_STAFFNM Then
                                    w_LItem.SubItems(M_DEP_STAFFNM).Text = w_str
                                Else
                                    w_LItem.SubItems.Insert(M_DEP_STAFFNM, New System.Windows.Forms.ListViewItem.ListViewSubItem(Nothing, w_str))
                                End If
                                '●勤務名称
                                If String.IsNullOrEmpty(m_udtDayKinmuJisseki(w_lngLoop).strKinmuCD) = False Then
                                    w_str = m_udtDayKinmuJisseki(w_lngLoop).strKinmuNm & "(" & m_udtDayKinmuJisseki(w_lngLoop).strKinmuMark & ")"
                                Else
                                    w_str = ""
                                End If
                                If w_LItem.SubItems.Count > M_DEP_KINMUNM Then
                                    w_LItem.SubItems(M_DEP_KINMUNM).Text = w_str
                                Else
                                    w_LItem.SubItems.Insert(M_DEP_KINMUNM, New System.Windows.Forms.ListViewItem.ListViewSubItem(Nothing, w_str))
                                End If
                                '●役職
                                w_str = m_udtStaffData(w_lngLoop).strPostNm
                                If w_LItem.SubItems.Count > M_DEP_POSTNM Then
                                    w_LItem.SubItems(M_DEP_POSTNM).Text = w_str
                                Else
                                    w_LItem.SubItems.Insert(M_DEP_POSTNM, New System.Windows.Forms.ListViewItem.ListViewSubItem(Nothing, w_str))
                                End If
                                '●職種
                                w_str = m_udtStaffData(w_lngLoop).strJocNm
                                If w_LItem.SubItems.Count > M_DEP_JOBNM Then
                                    w_LItem.SubItems(M_DEP_JOBNM).Text = w_str
                                Else
                                    w_LItem.SubItems.Insert(M_DEP_JOBNM, New System.Windows.Forms.ListViewItem.ListViewSubItem(Nothing, w_str))
                                End If

                                '選択職員の場合はインデックスを取得
                                If g_strTargetStaffMngID.Equals(m_udtStaffData(w_lngLoop).strStaffMngID) Then

                                    w_lngListIdx = w_lngStaffIdx - 1
                                    g_strTargetStaffMngID = m_udtStaffData(w_lngLoop).strStaffMngID
                                End If
                                w_LItem.Tag = Convert.ToString(w_lngLoop)
                            End If

                            '===========================
                            '職員一覧リストに表示する
                            '===========================
                            '●職員番号
                            w_LItem = lvwDeptStaff.Items.Add("Key" & w_lngLoop, m_udtStaffData(w_lngLoop).strStaffID, "")
                            '●氏名
                            If w_LItem.SubItems.Count > 1 Then
                                w_LItem.SubItems(1).Text = m_udtStaffData(w_lngLoop).strName
                            Else
                                w_LItem.SubItems.Insert(1, New System.Windows.Forms.ListViewItem.ListViewSubItem(Nothing, m_udtStaffData(w_lngLoop).strName))
                            End If

                            w_blnSelectOKFlg = True
                            w_LItem.Tag = Convert.ToString(w_lngLoop)
                        Next w_lngLoop

                        'リストビュー内選択職員設定
                        If w_lngListIdx = 0 Then
                            If UBound(m_udtStaffData) <= 0 Then
                                g_strTargetStaffMngID = ""
                            Else
                                If w_lngStaffIdx <= 0 Then
                                    g_strTargetStaffMngID = ""
                                Else
                                    lvwDeptInfo.Items.Item(0).Selected = True
                                    '選択職員管理番号
                                    g_strTargetStaffMngID = m_udtStaffData(1).strStaffMngID
                                End If
                            End If
                        Else
                            lvwDeptInfo.Items.Item(w_lngListIdx - 1).Selected = True
                        End If

                    ElseIf M_DEPT_OVERTIME.Equals(m_strSelChildMenu) Then
                        '=================
                        '時間外状況
                        '=================
                        w_lngListIdx = 0
                        For w_lngLoop = 1 To UBound(m_udtStaffData)

                            '●連番
                            If "1".Equals(m_udtStaffData(w_lngLoop).strSex) Then
                                '男性
                                w_LItem = lvwDeptInfo.Items.Add("Key" & w_lngLoop, General.paFormatSpace(w_lngLoop, 3), "MAN")
                            Else
                                '女性
                                w_LItem = lvwDeptInfo.Items.Add("Key" & w_lngLoop, General.paFormatSpace(w_lngLoop, 3), "WOMAN")
                            End If

                            '●職員番号
                            w_str = General.paFormatSpace(m_udtStaffData(w_lngLoop).strStaffID, 10)
                            If w_LItem.SubItems.Count > M_DEPOVER_STAFFID Then
                                w_LItem.SubItems(M_DEPOVER_STAFFID).Text = w_str
                            Else
                                w_LItem.SubItems.Insert(M_DEPOVER_STAFFID, New System.Windows.Forms.ListViewItem.ListViewSubItem(Nothing, w_str))
                            End If
                            '------------------------------------------------------

                            '●氏名
                            w_str = m_udtStaffData(w_lngLoop).strName
                            If w_LItem.SubItems.Count > M_DEPOVER_STAFFNM Then
                                w_LItem.SubItems(M_DEPOVER_STAFFNM).Text = w_str
                            Else
                                w_LItem.SubItems.Insert(M_DEPOVER_STAFFNM, New System.Windows.Forms.ListViewItem.ListViewSubItem(Nothing, w_str))
                            End If
                            '●100/100
                            w_Hour = m_udtOverKinmuTotal(w_lngLoop).lng100 \ 60
                            w_Min = m_udtOverKinmuTotal(w_lngLoop).lng100 Mod 60
                            w_str = w_Hour & ":" & General.paFormatZero(w_Min, 2)
                            If w_LItem.SubItems.Count > M_DEPOVER_100 Then
                                w_LItem.SubItems(M_DEPOVER_100).Text = w_str
                            Else
                                w_LItem.SubItems.Insert(M_DEPOVER_100, New System.Windows.Forms.ListViewItem.ListViewSubItem(Nothing, w_str))
                            End If
                            '●125/100
                            w_Hour = m_udtOverKinmuTotal(w_lngLoop).lng125 \ 60
                            w_Min = m_udtOverKinmuTotal(w_lngLoop).lng125 Mod 60
                            w_str = w_Hour & ":" & General.paFormatZero(w_Min, 2)
                            If w_LItem.SubItems.Count > M_DEPOVER_125 Then
                                w_LItem.SubItems(M_DEPOVER_125).Text = w_str
                            Else
                                w_LItem.SubItems.Insert(M_DEPOVER_125, New System.Windows.Forms.ListViewItem.ListViewSubItem(Nothing, w_str))
                            End If
                            '●150/100
                            w_Hour = m_udtOverKinmuTotal(w_lngLoop).lng150 \ 60
                            w_Min = m_udtOverKinmuTotal(w_lngLoop).lng150 Mod 60
                            w_str = w_Hour & ":" & General.paFormatZero(w_Min, 2)
                            If w_LItem.SubItems.Count > M_DEPOVER_150 Then
                                w_LItem.SubItems(M_DEPOVER_150).Text = w_str
                            Else
                                w_LItem.SubItems.Insert(M_DEPOVER_150, New System.Windows.Forms.ListViewItem.ListViewSubItem(Nothing, w_str))
                            End If
                            '●135/100
                            w_Hour = m_udtOverKinmuTotal(w_lngLoop).lng135 \ 60
                            w_Min = m_udtOverKinmuTotal(w_lngLoop).lng135 Mod 60
                            w_str = w_Hour & ":" & General.paFormatZero(w_Min, 2)
                            If w_LItem.SubItems.Count > M_DEPOVER_135 Then
                                w_LItem.SubItems(M_DEPOVER_135).Text = w_str
                            Else
                                w_LItem.SubItems.Insert(M_DEPOVER_135, New System.Windows.Forms.ListViewItem.ListViewSubItem(Nothing, w_str))
                            End If
                            '●160/100
                            w_Hour = m_udtOverKinmuTotal(w_lngLoop).lng160 \ 60
                            w_Min = m_udtOverKinmuTotal(w_lngLoop).lng160 Mod 60
                            w_str = w_Hour & ":" & General.paFormatZero(w_Min, 2)
                            If w_LItem.SubItems.Count > M_DEPOVER_160 Then
                                w_LItem.SubItems(M_DEPOVER_160).Text = w_str
                            Else
                                w_LItem.SubItems.Insert(M_DEPOVER_160, New System.Windows.Forms.ListViewItem.ListViewSubItem(Nothing, w_str))
                            End If
                            '●合計
                            w_Hour = m_udtOverKinmuTotal(w_lngLoop).lngTotal \ 60
                            w_Min = m_udtOverKinmuTotal(w_lngLoop).lngTotal Mod 60
                            w_str = w_Hour & ":" & General.paFormatZero(w_Min, 2)
                            If w_LItem.SubItems.Count > M_DEPOVER_TOTAL Then
                                w_LItem.SubItems(M_DEPOVER_TOTAL).Text = w_str
                            Else
                                w_LItem.SubItems.Insert(M_DEPOVER_TOTAL, New System.Windows.Forms.ListViewItem.ListViewSubItem(Nothing, w_str))
                            End If

                            '選択職員の場合はインデックスを取得
                            If g_strTargetStaffMngID.Equals(m_udtStaffData(w_lngLoop).strStaffMngID) Then
                                w_lngListIdx = w_lngLoop - 1
                                g_strTargetStaffMngID = m_udtStaffData(w_lngLoop).strStaffMngID
                            End If
                            w_LItem.Tag = Convert.ToString(w_lngLoop)
                            '===========================
                            '職員一覧リストに表示する
                            '===========================
                            '●職員番号
                            w_LItem = lvwDeptStaff.Items.Add("Key" & w_lngLoop, m_udtStaffData(w_lngLoop).strStaffID, "")
                            '●氏名
                            If w_LItem.SubItems.Count > 1 Then
                                w_LItem.SubItems(1).Text = m_udtStaffData(w_lngLoop).strName
                            Else
                                w_LItem.SubItems.Insert(1, New System.Windows.Forms.ListViewItem.ListViewSubItem(Nothing, m_udtStaffData(w_lngLoop).strName))
                            End If

                            w_blnSelectOKFlg = True
                            w_LItem.Tag = Convert.ToString(w_lngLoop)
                        Next w_lngLoop

                        'リストビュー内選択職員設定
                        If w_lngListIdx = 0 Then
                            If UBound(m_udtStaffData) <= 0 Then
                                g_strTargetStaffMngID = ""
                            Else
                                If w_lngStaffIdx <= 0 Then
                                    g_strTargetStaffMngID = ""
                                Else
                                    lvwDeptInfo.Items.Item(0).Selected = True
                                    '選択職員管理番号
                                    g_strTargetStaffMngID = m_udtStaffData(1).strStaffMngID
                                End If
                            End If
                        Else
                            lvwDeptInfo.Items.Item(w_lngListIdx - 1).Selected = True
                        End If
                    End If

                    '職員一覧リスト選択職員
                    If w_blnSelectOKFlg = True Then
                        If UBound(m_udtStaffData) > 0 Then
                            If lvwDeptStaff.Items.Count > 1 Then
                                lvwDeptStaff.Items.Item(0).Selected = True
                            End If
                        End If
                    End If

                Case M_APPROVE_RESCD

                    If M_APPRO_DAYOVER.Equals(m_strSelChildMenu) Then

                        w_lngStaffIdx = 0
                        w_lngRenbanNo = 0
                        For w_lngLoop = 1 To UBound(m_udtStaffData)

                            w_lngStaffIdx = w_lngStaffIdx + 1

                            '勤務実績がない場合は表示なし
                            If String.IsNullOrEmpty(m_udtDayKinmuJisseki(w_lngLoop).strKinmuCD) = False Then
                                w_lngRenbanNo = w_lngRenbanNo + 1

                                '●連番
                                If UBound(m_udtDayOverKinmu(w_lngLoop).OverKinmuData) <> 0 Then
                                    If "1".Equals(m_udtDayOverKinmu(w_lngLoop).OverKinmuData(1).strStateKbn) Then
                                        '承認済み
                                        w_LItem = lvwDeptInfo.Items.Add("Key" & w_lngLoop, General.paFormatSpace(w_lngRenbanNo, 3), "FINISH")
                                    ElseIf "4".Equals(m_udtDayOverKinmu(w_lngLoop).OverKinmuData(1).strStateKbn) Then
                                        '取消承認済み
                                        w_LItem = lvwDeptInfo.Items.Add("Key" & w_lngLoop, General.paFormatSpace(w_lngRenbanNo, 3), "")
                                    Else
                                        w_LItem = lvwDeptInfo.Items.Add("Key" & w_lngLoop, General.paFormatSpace(w_lngRenbanNo, 3), "UNFINISH")
                                    End If

                                Else
                                    'それ以外
                                    w_LItem = lvwDeptInfo.Items.Add("Key" & w_lngLoop, General.paFormatSpace(w_lngRenbanNo, 3), "")
                                End If

                                '●職員番号
                                w_str = General.paFormatSpace(m_udtStaffData(w_lngLoop).strStaffID, 10)
                                If w_LItem.SubItems.Count > M_DAYOVER_STAFFID Then
                                    w_LItem.SubItems(M_DAYOVER_STAFFID).Text = w_str
                                Else
                                    w_LItem.SubItems.Insert(M_DAYOVER_STAFFID, New System.Windows.Forms.ListViewItem.ListViewSubItem(Nothing, w_str))
                                End If
                                '------------------------------------------------------
                                '●氏名
                                w_str = m_udtStaffData(w_lngLoop).strName
                                If w_LItem.SubItems.Count > M_DAYOVER_STAFFNM Then
                                    w_LItem.SubItems(M_DAYOVER_STAFFNM).Text = w_str
                                Else
                                    w_LItem.SubItems.Insert(M_DAYOVER_STAFFNM, New System.Windows.Forms.ListViewItem.ListViewSubItem(Nothing, w_str))
                                End If
                                '●開始　終了(勤務)
                                If String.IsNullOrEmpty(fncChangeStrTime(m_udtDayKinmuJisseki(w_lngLoop).strKinmuFrom)) = False Then
                                    w_str = fncChangeStrTime(m_udtDayKinmuJisseki(w_lngLoop).strKinmuFrom) & "〜" & fncChangeStrTime(m_udtDayKinmuJisseki(w_lngLoop).strKinmuTo) & "(" & m_udtDayKinmuJisseki(w_lngLoop).strKinmuNm & ")"
                                Else
                                    w_str = ""
                                End If

                                If w_LItem.SubItems.Count > M_DAYOVER_KINMU Then
                                    w_LItem.SubItems(M_DAYOVER_KINMU).Text = w_str
                                Else
                                    w_LItem.SubItems.Insert(M_DAYOVER_KINMU, New System.Windows.Forms.ListViewItem.ListViewSubItem(Nothing, w_str))
                                End If

                                '●開始　終了(超勤理由)
                                If UBound(m_udtDayOverKinmu(w_lngLoop).OverKinmuData) > 0 Then
                                    If m_udtDayOverKinmu(w_lngLoop).OverKinmuData(1).lngFromTime = 0 AndAlso m_udtDayOverKinmu(w_lngLoop).OverKinmuData(1).lngToTime = 0 Then
                                        w_str = ""
                                    Else
                                        w_str = fncChangeStrTime(Convert.ToString(m_udtDayOverKinmu(w_lngLoop).OverKinmuData(1).lngFromTime)) & "〜" & fncChangeStrTime(Convert.ToString(m_udtDayOverKinmu(w_lngLoop).OverKinmuData(1).lngToTime)) & "(" & m_udtDayOverKinmu(w_lngLoop).OverKinmuData(1).strReasonSNm & ")"

                                        If UBound(m_udtDayOverKinmu(w_lngLoop).OverKinmuData) > 1 Then
                                            w_str = w_str & "*"
                                        End If
                                    End If
                                Else
                                    w_str = ""
                                End If

                                If w_LItem.SubItems.Count > M_DAYOVER_OVERKINMU Then
                                    w_LItem.SubItems(M_DAYOVER_OVERKINMU).Text = w_str
                                Else
                                    w_LItem.SubItems.Insert(M_DAYOVER_OVERKINMU, New System.Windows.Forms.ListViewItem.ListViewSubItem(Nothing, w_str))
                                End If
                                '●100/100
                                w_Hour = m_udtDayOverKinmu(w_lngLoop).lng100Day \ 60
                                w_Min = m_udtDayOverKinmu(w_lngLoop).lng100Day Mod 60
                                w_str = w_Hour & ":" & General.paFormatZero(w_Min, 2)
                                If w_LItem.SubItems.Count > M_DAYOVER_100 Then
                                    w_LItem.SubItems(M_DAYOVER_100).Text = w_str
                                Else
                                    w_LItem.SubItems.Insert(M_DAYOVER_100, New System.Windows.Forms.ListViewItem.ListViewSubItem(Nothing, w_str))
                                End If
                                '●125/100
                                w_Hour = m_udtDayOverKinmu(w_lngLoop).lng125Day \ 60
                                w_Min = m_udtDayOverKinmu(w_lngLoop).lng125Day Mod 60
                                w_str = w_Hour & ":" & General.paFormatZero(w_Min, 2)
                                If w_LItem.SubItems.Count > M_DAYOVER_125 Then
                                    w_LItem.SubItems(M_DAYOVER_125).Text = w_str
                                Else
                                    w_LItem.SubItems.Insert(M_DAYOVER_125, New System.Windows.Forms.ListViewItem.ListViewSubItem(Nothing, w_str))
                                End If
                                '●150/100
                                w_Hour = m_udtDayOverKinmu(w_lngLoop).lng150Day \ 60
                                w_Min = m_udtDayOverKinmu(w_lngLoop).lng150Day Mod 60
                                w_str = w_Hour & ":" & General.paFormatZero(w_Min, 2)
                                If w_LItem.SubItems.Count > M_DAYOVER_150 Then
                                    w_LItem.SubItems(M_DAYOVER_150).Text = w_str
                                Else
                                    w_LItem.SubItems.Insert(M_DAYOVER_150, New System.Windows.Forms.ListViewItem.ListViewSubItem(Nothing, w_str))
                                End If
                                '●135/100
                                w_Hour = m_udtDayOverKinmu(w_lngLoop).lng135Day \ 60
                                w_Min = m_udtDayOverKinmu(w_lngLoop).lng135Day Mod 60
                                w_str = w_Hour & ":" & General.paFormatZero(w_Min, 2)
                                If w_LItem.SubItems.Count > M_DAYOVER_135 Then
                                    w_LItem.SubItems(M_DAYOVER_135).Text = w_str
                                Else
                                    w_LItem.SubItems.Insert(M_DAYOVER_135, New System.Windows.Forms.ListViewItem.ListViewSubItem(Nothing, w_str))
                                End If
                                '●160/100
                                w_Hour = m_udtDayOverKinmu(w_lngLoop).lng160Day \ 60
                                w_Min = m_udtDayOverKinmu(w_lngLoop).lng160Day Mod 60
                                w_str = w_Hour & ":" & General.paFormatZero(w_Min, 2)
                                If w_LItem.SubItems.Count > M_DAYOVER_160 Then
                                    w_LItem.SubItems(M_DAYOVER_160).Text = w_str
                                Else
                                    w_LItem.SubItems.Insert(M_DAYOVER_160, New System.Windows.Forms.ListViewItem.ListViewSubItem(Nothing, w_str))
                                End If
                                '●月間合計
                                w_Hour = m_udtOverKinmuTotal(w_lngLoop).lngTotal \ 60
                                w_Min = m_udtOverKinmuTotal(w_lngLoop).lngTotal Mod 60
                                w_str = w_Hour & ":" & General.paFormatZero(w_Min, 2)
                                If w_LItem.SubItems.Count > M_DAYOVER_MONTHTOTAL Then
                                    w_LItem.SubItems(M_DAYOVER_MONTHTOTAL).Text = w_str
                                Else
                                    w_LItem.SubItems.Insert(M_DAYOVER_MONTHTOTAL, New System.Windows.Forms.ListViewItem.ListViewSubItem(Nothing, w_str))
                                End If

                                '選択職員の場合はインデックスを取得
                                If g_strTargetStaffMngID.Equals(m_udtStaffData(w_lngLoop).strStaffMngID) Then

                                    w_lngListIdx = w_lngStaffIdx - 1
                                    g_strTargetStaffMngID = m_udtStaffData(w_lngLoop).strStaffMngID
                                End If
                                w_LItem.Tag = Convert.ToString(w_lngLoop)
                            End If
                        Next w_lngLoop

                    Else

                        '制限時間出力記号
                        w_strLimitOverMark = General.paGetItemValue(General.G_STRMAINKEY3, General.G_STRSUBKEY1, "LIMITOVERMARK", "", General.g_strHospitalCD)
                        '制限時間分
                        w_lngLimitOverMinute = Integer.Parse(General.paGetItemValue(General.G_STRMAINKEY3, General.G_STRSUBKEY1, "LIMITOVERMINUTE", Convert.ToString(0), General.g_strHospitalCD))

                        For w_lngLoop = 1 To UBound(m_udtApproveData)

                            '届出コード取得
                            w_strAppliCD = m_udtApproveData(w_lngLoop).strAppliCD

                            If m_strSelChildMenu = M_APPRO_DSP Then
                                '--------------
                                '未承認一覧
                                '--------------

                                '●連番
                                w_LItem = lvwDeptInfo.Items.Add("Key" & w_lngLoop, General.paFormatSpace(w_lngLoop, 3), "")

                                '届出コードが時間外の場合
                                w_str = ""
                                If M_STRJIKANGAI.Equals(w_strAppliCD) Then
                                    If w_lngLimitOverMinute <= Integer.Parse(IIf(m_udtApproveData(w_lngLoop).strComment = "", 0, m_udtApproveData(w_lngLoop).strComment)) Then
                                        '制限時間分を超えている場合
                                        w_str = w_strLimitOverMark
                                    End If
                                End If
                                If w_LItem.SubItems.Count > M_APR_MARK Then
                                    w_LItem.SubItems(M_APR_MARK).Text = w_str
                                Else
                                    w_LItem.SubItems.Insert(M_APR_MARK, New System.Windows.Forms.ListViewItem.ListViewSubItem(Nothing, w_str))
                                End If

                                '●職員番号
                                w_str = General.paFormatSpace(m_udtApproveData(w_lngLoop).strAppliStaffID, 10)
                                If w_LItem.SubItems.Count > M_APR_STAFFID Then
                                    w_LItem.SubItems(M_APR_STAFFID).Text = w_str
                                Else
                                    w_LItem.SubItems.Insert(M_APR_STAFFID, New System.Windows.Forms.ListViewItem.ListViewSubItem(Nothing, w_str))
                                End If
                                '●氏名
                                w_str = m_udtApproveData(w_lngLoop).strAppliStaffName
                                If w_LItem.SubItems.Count > M_APR_STAFFNM Then
                                    w_LItem.SubItems(M_APR_STAFFNM).Text = w_str
                                Else
                                    w_LItem.SubItems.Insert(M_APR_STAFFNM, New System.Windows.Forms.ListViewItem.ListViewSubItem(Nothing, w_str))
                                End If
                                '●勤務部署
                                w_str = ""
                                For w_lngKinmuDeptLoop = 1 To UBound(m_KangoM)
                                    If m_KangoM(w_lngKinmuDeptLoop).BusyoCD.Equals(m_udtApproveData(w_lngLoop).strKinmuDeptCD) Then
                                        w_str = m_KangoM(w_lngKinmuDeptLoop).BusyoNM
                                        Exit For
                                    End If
                                Next w_lngKinmuDeptLoop
                                If w_LItem.SubItems.Count > M_APR_KINMUDEPT Then
                                    w_LItem.SubItems(M_APR_KINMUDEPT).Text = w_str
                                Else
                                    w_LItem.SubItems.Insert(M_APR_KINMUDEPT, New System.Windows.Forms.ListViewItem.ListViewSubItem(Nothing, w_str))
                                End If
                                '●届出名称
                                w_str = m_udtApproveData(w_lngLoop).strAppliNm
                                If w_LItem.SubItems.Count > M_APR_APPLINM Then
                                    w_LItem.SubItems(M_APR_APPLINM).Text = w_str
                                Else
                                    w_LItem.SubItems.Insert(M_APR_APPLINM, New System.Windows.Forms.ListViewItem.ListViewSubItem(Nothing, w_str))
                                End If
                                '●届出対象日
                                w_str = ""

                                '届出コードが時間外の場合
                                If M_STRJIKANGAI.Equals(w_strAppliCD) Then
                                    If IsDate(Format(m_udtApproveData(w_lngLoop).lngPeriodFromDate, "0000/00/00")) = True Then
                                        w_str = General.paGetDateStringFromInteger(m_udtApproveData(w_lngLoop).lngPeriodFromDate)
                                        w_str = w_str & "(" & Format(General.paGetDateFromDateInteger(m_udtApproveData(w_lngLoop).lngPeriodFromDate), "ddd") & ")"
                                    End If
                                Else
                                    If IsDate(Format(m_udtApproveData(w_lngLoop).lngPeriodFromDate, "0000/00/00")) = True Then

                                        w_str = General.paGetDateStringFromInteger(m_udtApproveData(w_lngLoop).lngPeriodFromDate)
                                        w_str = w_str & "(" & Format(General.paGetDateFromDateInteger(m_udtApproveData(w_lngLoop).lngPeriodFromDate), "ddd") & ")"
                                        w_str = w_str & " 〜 "
                                    End If
                                    If IsDate(Format(m_udtApproveData(w_lngLoop).lngPeriodToDate, "0000/00/00")) = True Then

                                        w_str = w_str & General.paGetDateStringFromInteger(m_udtApproveData(w_lngLoop).lngPeriodToDate)
                                        w_str = w_str & "(" & Format(General.paGetDateFromDateInteger(m_udtApproveData(w_lngLoop).lngPeriodToDate), "ddd") & ")"
                                    End If
                                End If
                                If w_LItem.SubItems.Count > M_APR_PERIOD Then
                                    w_LItem.SubItems(M_APR_PERIOD).Text = w_str
                                Else
                                    w_LItem.SubItems.Insert(M_APR_PERIOD, New System.Windows.Forms.ListViewItem.ListViewSubItem(Nothing, w_str))
                                End If

                                '●詳細
                                w_str = ""
                                '届出コードが時間外の場合
                                If w_strAppliCD = M_STRJIKANGAI Then
                                    w_str = m_udtApproveData(w_lngLoop).strHanyouArea
                                    If String.IsNullOrEmpty(w_str) = False Then
                                        w_str = Replace(w_str, "@", "〜", 1, 1)
                                    End If
                                Else
                                    w_str = m_udtApproveData(w_lngLoop).strHanyouArea
                                End If

                                If w_LItem.SubItems.Count > M_APR_DETAIL Then
                                    w_LItem.SubItems(M_APR_DETAIL).Text = w_str
                                Else
                                    w_LItem.SubItems.Insert(M_APR_DETAIL, New System.Windows.Forms.ListViewItem.ListViewSubItem(Nothing, w_str))
                                End If

                                '未承認累計
                                w_str = ""
                                If m_udtApproveData(w_lngLoop).AprYetTimeTotal = 0 Then
                                    '時間が0分の場合はブランクとする
                                    If w_LItem.SubItems.Count > M_APR_APRYET Then
                                        w_LItem.SubItems(M_APR_APRYET).Text = ""
                                    Else
                                        w_LItem.SubItems.Insert(M_APR_APRYET, New System.Windows.Forms.ListViewItem.ListViewSubItem(Nothing, ""))
                                    End If
                                Else
                                    '60分以上あった場合時間表示
                                    If (m_udtApproveData(w_lngLoop).AprYetTimeTotal \ 60) <> 0 Then
                                        w_str = w_str & (m_udtApproveData(w_lngLoop).AprYetTimeTotal \ 60) & "時間"
                                    End If
                                    '分の端数があった場合分表示
                                    If (m_udtApproveData(w_lngLoop).AprYetTimeTotal Mod 60) <> 0 Then
                                        w_str = w_str & (m_udtApproveData(w_lngLoop).AprYetTimeTotal Mod 60) & "分"
                                    End If
                                    If w_LItem.SubItems.Count > M_APR_APRYET Then
                                        w_LItem.SubItems(M_APR_APRYET).Text = w_str
                                    Else
                                        w_LItem.SubItems.Insert(M_APR_APRYET, New System.Windows.Forms.ListViewItem.ListViewSubItem(Nothing, w_str))
                                    End If

                                End If
                                '承認済累計
                                w_str = ""
                                If m_udtApproveData(w_lngLoop).AprOverTimeTotal = 0 Then
                                    '時間が0分の場合はブランクとする
                                    If w_LItem.SubItems.Count > M_APR_APROVER Then
                                        w_LItem.SubItems(M_APR_APROVER).Text = ""
                                    Else
                                        w_LItem.SubItems.Insert(M_APR_APROVER, New System.Windows.Forms.ListViewItem.ListViewSubItem(Nothing, ""))
                                    End If
                                Else
                                    '60分以上あった場合時間表示
                                    If (m_udtApproveData(w_lngLoop).AprOverTimeTotal \ 60) <> 0 Then
                                        w_str = w_str & (m_udtApproveData(w_lngLoop).AprOverTimeTotal \ 60) & "時間"
                                    End If
                                    '分の端数があった場合分表示
                                    If (m_udtApproveData(w_lngLoop).AprOverTimeTotal Mod 60) <> 0 Then
                                        w_str = w_str & (m_udtApproveData(w_lngLoop).AprOverTimeTotal Mod 60) & "分"
                                    End If
                                    If w_LItem.SubItems.Count > M_APR_APROVER Then
                                        w_LItem.SubItems(M_APR_APROVER).Text = w_str
                                    Else
                                        w_LItem.SubItems.Insert(M_APR_APROVER, New System.Windows.Forms.ListViewItem.ListViewSubItem(Nothing, w_str))
                                    End If

                                End If

                                w_LItem.Tag = Convert.ToString(w_lngLoop)

                            Else

                                '--------------
                                '全表示
                                '--------------

                                '●連番
                                If "1".Equals(m_udtApproveData(w_lngLoop).strAppliApproveStatusKbn) Then
                                    '承認済み
                                    w_LItem = lvwDeptInfo.Items.Add("Key" & w_lngLoop, General.paFormatSpace(w_lngLoop, 3), "FINISH")
                                Else
                                    'それ以外
                                    w_LItem = lvwDeptInfo.Items.Add("Key" & w_lngLoop, General.paFormatSpace(w_lngLoop, 3), "UNFINISH")
                                End If

                                '届出コードが時間外の場合
                                w_str = ""
                                If w_strAppliCD = M_STRJIKANGAI Then
                                    If w_lngLimitOverMinute <= Integer.Parse(IIf(m_udtApproveData(w_lngLoop).strComment.Equals(""), 0, m_udtApproveData(w_lngLoop).strComment)) Then
                                        '制限時間分を超えている場合
                                        w_str = w_strLimitOverMark
                                    End If
                                End If
                                If w_LItem.SubItems.Count > M_APR_MARK Then
                                    w_LItem.SubItems(M_APR_MARK).Text = w_str
                                Else
                                    w_LItem.SubItems.Insert(M_APR_MARK, New System.Windows.Forms.ListViewItem.ListViewSubItem(Nothing, w_str))
                                End If

                                '●職員番号
                                w_str = Format(m_udtApproveData(w_lngLoop).strAppliStaffID)
                                If w_LItem.SubItems.Count > M_ALLAPR_STAFFID Then
                                    w_LItem.SubItems(M_ALLAPR_STAFFID).Text = w_str
                                Else
                                    w_LItem.SubItems.Insert(M_ALLAPR_STAFFID, New System.Windows.Forms.ListViewItem.ListViewSubItem(Nothing, w_str))
                                End If

                                '●氏名
                                w_str = m_udtApproveData(w_lngLoop).strAppliStaffName
                                If w_LItem.SubItems.Count > M_ALLAPR_STAFFNM Then
                                    w_LItem.SubItems(M_ALLAPR_STAFFNM).Text = w_str
                                Else
                                    w_LItem.SubItems.Insert(M_ALLAPR_STAFFNM, New System.Windows.Forms.ListViewItem.ListViewSubItem(Nothing, w_str))
                                End If

                                '●勤務部署
                                w_str = ""
                                For w_lngKinmuDeptLoop = 1 To UBound(m_udtKinmuDept)
                                    If m_udtKinmuDept(w_lngKinmuDeptLoop).strDeptCD.Equals(m_udtApproveData(w_lngLoop).strKinmuDeptCD) Then
                                        w_str = m_udtKinmuDept(w_lngKinmuDeptLoop).strDeptName
                                        Exit For
                                    End If
                                Next w_lngKinmuDeptLoop
                                If w_LItem.SubItems.Count > M_ALLAPR_KINMUDEPT Then
                                    w_LItem.SubItems(M_ALLAPR_KINMUDEPT).Text = w_str
                                Else
                                    w_LItem.SubItems.Insert(M_ALLAPR_KINMUDEPT, New System.Windows.Forms.ListViewItem.ListViewSubItem(Nothing, w_str))
                                End If

                                '●届出名称
                                w_str = m_udtApproveData(w_lngLoop).strAppliNm
                                If w_LItem.SubItems.Count > M_ALLAPR_APPLINM Then
                                    w_LItem.SubItems(M_ALLAPR_APPLINM).Text = w_str
                                Else
                                    w_LItem.SubItems.Insert(M_ALLAPR_APPLINM, New System.Windows.Forms.ListViewItem.ListViewSubItem(Nothing, w_str))
                                End If

                                '●届出対象日
                                w_str = ""

                                If M_STRJIKANGAI.Equals(w_strAppliCD) Then
                                    '届出コードが時間外の場合
                                    If IsDate(Format(m_udtApproveData(w_lngLoop).lngPeriodFromDate, "0000/00/00")) = True Then
                                        w_str = General.paGetDateStringFromInteger(m_udtApproveData(w_lngLoop).lngPeriodFromDate)
                                        w_str = w_str & "(" & Format(General.paGetDateFromDateInteger(m_udtApproveData(w_lngLoop).lngPeriodFromDate), "ddd") & ")"
                                    End If
                                Else
                                    If IsDate(Format(m_udtApproveData(w_lngLoop).lngPeriodFromDate, "0000/00/00")) = True Then

                                        w_str = General.paGetDateStringFromInteger(m_udtApproveData(w_lngLoop).lngPeriodFromDate)
                                        w_str = w_str & "(" & Format(General.paGetDateFromDateInteger(m_udtApproveData(w_lngLoop).lngPeriodFromDate), "ddd") & ")"
                                        w_str = w_str & " 〜 "
                                    End If
                                    If IsDate(Format(m_udtApproveData(w_lngLoop).lngPeriodToDate, "0000/00/00")) = True Then

                                        w_str = w_str & General.paGetDateStringFromInteger(m_udtApproveData(w_lngLoop).lngPeriodToDate)
                                        w_str = w_str & "(" & Format(General.paGetDateFromDateInteger(m_udtApproveData(w_lngLoop).lngPeriodToDate), "ddd") & ")"

                                    End If
                                End If

                                If w_LItem.SubItems.Count > M_ALLAPR_PERIOD Then
                                    w_LItem.SubItems(M_ALLAPR_PERIOD).Text = w_str
                                Else
                                    w_LItem.SubItems.Insert(M_ALLAPR_PERIOD, New System.Windows.Forms.ListViewItem.ListViewSubItem(Nothing, w_str))
                                End If

                                '●詳細
                                w_str = ""
                                '届出コードが時間外の場合
                                If w_strAppliCD = M_STRJIKANGAI Then
                                    w_str = m_udtApproveData(w_lngLoop).strHanyouArea
                                    If String.IsNullOrEmpty(w_str) = False Then
                                        w_str = Replace(w_str, "@", "〜", 1, 1)
                                    End If
                                Else
                                    w_str = m_udtApproveData(w_lngLoop).strHanyouArea
                                End If

                                If w_LItem.SubItems.Count > M_ALLAPR_DETAIL Then
                                    w_LItem.SubItems(M_ALLAPR_DETAIL).Text = w_str
                                Else
                                    w_LItem.SubItems.Insert(M_ALLAPR_DETAIL, New System.Windows.Forms.ListViewItem.ListViewSubItem(Nothing, w_str))
                                End If

                                '未承認累計
                                w_str = ""
                                If m_udtApproveData(w_lngLoop).AprYetTimeTotal = 0 Then
                                    '時間が0分の場合はブランクとする
                                    If w_LItem.SubItems.Count > M_APR_APRYET Then
                                        w_LItem.SubItems(M_APR_APRYET).Text = ""
                                    Else
                                        w_LItem.SubItems.Insert(M_APR_APRYET, New System.Windows.Forms.ListViewItem.ListViewSubItem(Nothing, ""))
                                    End If
                                Else
                                    '60分以上あった場合時間表示
                                    If (m_udtApproveData(w_lngLoop).AprYetTimeTotal \ 60) <> 0 Then
                                        w_str = w_str & (m_udtApproveData(w_lngLoop).AprYetTimeTotal \ 60) & "時間"
                                    End If
                                    '分の端数があった場合分表示
                                    If (m_udtApproveData(w_lngLoop).AprYetTimeTotal Mod 60) <> 0 Then
                                        w_str = w_str & (m_udtApproveData(w_lngLoop).AprYetTimeTotal Mod 60) & "分"
                                    End If
                                    If w_LItem.SubItems.Count > M_APR_APRYET Then
                                        w_LItem.SubItems(M_APR_APRYET).Text = w_str
                                    Else
                                        w_LItem.SubItems.Insert(M_APR_APRYET, New System.Windows.Forms.ListViewItem.ListViewSubItem(Nothing, w_str))
                                    End If

                                End If
                                '承認済累計
                                w_str = ""
                                If m_udtApproveData(w_lngLoop).AprOverTimeTotal = 0 Then
                                    '時間が0分の場合はブランクとする
                                    If w_LItem.SubItems.Count > M_APR_APROVER Then
                                        w_LItem.SubItems(M_APR_APROVER).Text = ""
                                    Else
                                        w_LItem.SubItems.Insert(M_APR_APROVER, New System.Windows.Forms.ListViewItem.ListViewSubItem(Nothing, ""))
                                    End If
                                Else
                                    '60分以上あった場合時間表示
                                    If (m_udtApproveData(w_lngLoop).AprOverTimeTotal \ 60) <> 0 Then
                                        w_str = w_str & (m_udtApproveData(w_lngLoop).AprOverTimeTotal \ 60) & "時間"
                                    End If
                                    '分の端数があった場合分表示
                                    If (m_udtApproveData(w_lngLoop).AprOverTimeTotal Mod 60) <> 0 Then
                                        w_str = w_str & (m_udtApproveData(w_lngLoop).AprOverTimeTotal Mod 60) & "分"
                                    End If
                                    If w_LItem.SubItems.Count > M_APR_APROVER Then
                                        w_LItem.SubItems(M_APR_APROVER).Text = w_str
                                    Else
                                        w_LItem.SubItems.Insert(M_APR_APROVER, New System.Windows.Forms.ListViewItem.ListViewSubItem(Nothing, w_str))
                                    End If

                                End If

                                w_LItem.Tag = Convert.ToString(w_lngLoop)

                            End If
                        Next w_lngLoop

                    End If

                Case M_DAKOKU_RESCD
                    '===============
                    '■出退勤
                    '===============
                    w_lngListIdx = 0
                    If m_strSelChildMenu = M_DAKOKU_DSP Then
                        '=================
                        '状況表示
                        '=================
                        For w_lngLoop = 1 To UBound(m_udtStaffData)

                            '●連番
                            If m_udtDayDakokuData(w_lngLoop).blnZaiinFlg = True Then
                                '在院
                                w_LItem = lvwDeptInfo.Items.Add("Key" & w_lngLoop, General.paFormatSpace(w_lngLoop, 3), "MAN2")
                                '======================================================================================================================
                            Else
                                '不在
                                w_LItem = lvwDeptInfo.Items.Add("Key" & w_lngLoop, General.paFormatSpace(w_lngLoop, 3), "WOMAN2")
                                '======================================================================================================================
                            End If
                            '------------------------------------------------------

                            '●出勤区分検索
                            w_str = "--:--"
                            For w_lngLoop2 = 1 To UBound(m_udtDayDakokuData(w_lngLoop).Detail)
                                If "1".Equals(m_udtDayDakokuData(w_lngLoop).Detail(w_lngLoop2).strKBN) Then
                                    w_str = Format(m_udtDayDakokuData(w_lngLoop).Detail(w_lngLoop2).lngTime, "00:00")
                                    Exit For
                                End If
                            Next w_lngLoop2
                            If w_LItem.SubItems.Count > M_DAK_FROM Then
                                w_LItem.SubItems(M_DAK_FROM).Text = w_str
                            Else
                                w_LItem.SubItems.Insert(M_DAK_FROM, New System.Windows.Forms.ListViewItem.ListViewSubItem(Nothing, w_str))
                            End If
                            w_LItem.Tag = Convert.ToString(w_lngLoop)

                            '●退勤区分
                            w_str = "--:--"
                            For w_lngLoop2 = 1 To UBound(m_udtDayDakokuData(w_lngLoop).Detail)
                                If "2".Equals(m_udtDayDakokuData(w_lngLoop).Detail(w_lngLoop2).strKBN) Then
                                    w_str = Format(m_udtDayDakokuData(w_lngLoop).Detail(w_lngLoop2).lngTime, "00:00")
                                    Exit For
                                End If
                            Next w_lngLoop2
                            If w_LItem.SubItems.Count > M_DAK_TO Then
                                w_LItem.SubItems(M_DAK_TO).Text = w_str
                            Else
                                w_LItem.SubItems.Insert(M_DAK_TO, New System.Windows.Forms.ListViewItem.ListViewSubItem(Nothing, w_str))
                            End If


                            '●職員番号
                            w_str = General.paFormatSpace(m_udtStaffData(w_lngLoop).strStaffID, 10)
                            If w_LItem.SubItems.Count > M_DAK_STAFFID Then
                                w_LItem.SubItems(M_DAK_STAFFID).Text = w_str
                            Else
                                w_LItem.SubItems.Insert(M_DAK_STAFFID, New System.Windows.Forms.ListViewItem.ListViewSubItem(Nothing, w_str))
                            End If
                            '-----------------------------------------------------
                            '●氏名
                            w_str = m_udtStaffData(w_lngLoop).strName
                            If w_LItem.SubItems.Count > M_DAK_STAFFNM Then
                                w_LItem.SubItems(M_DAK_STAFFNM).Text = w_str
                            Else
                                w_LItem.SubItems.Insert(M_DAK_STAFFNM, New System.Windows.Forms.ListViewItem.ListViewSubItem(Nothing, w_str))
                            End If
                            '●勤務名称
                            If String.IsNullOrEmpty(m_udtDayKinmuJisseki(w_lngLoop).strKinmuCD) = False Then
                                w_str = m_udtDayKinmuJisseki(w_lngLoop).strKinmuNm & "(" & m_udtDayKinmuJisseki(w_lngLoop).strKinmuMark & ")"
                            Else
                                w_str = ""
                            End If
                            If w_LItem.SubItems.Count > M_DAK_KINMUNM Then
                                w_LItem.SubItems(M_DAK_KINMUNM).Text = w_str
                            Else
                                w_LItem.SubItems.Insert(M_DAK_KINMUNM, New System.Windows.Forms.ListViewItem.ListViewSubItem(Nothing, w_str))
                            End If
                            '●PHS
                            w_str = m_udtStaffData(w_lngLoop).strPHS
                            If w_LItem.SubItems.Count > M_DAK_PHS Then
                                w_LItem.SubItems(M_DAK_PHS).Text = w_str
                            Else
                                w_LItem.SubItems.Insert(M_DAK_PHS, New System.Windows.Forms.ListViewItem.ListViewSubItem(Nothing, w_str))
                            End If

                            '選択職員の場合はインデックスを取得
                            If g_strTargetStaffMngID.Equals(m_udtStaffData(w_lngLoop).strStaffMngID) Then
                                w_lngListIdx = w_lngLoop - 1
                                g_strTargetStaffMngID = m_udtStaffData(w_lngLoop).strStaffMngID
                            End If

                            '===========================
                            '職員一覧リストに表示する
                            '===========================
                            '●職員番号
                            w_LItem = lvwDeptStaff.Items.Add("Key" & w_lngLoop, m_udtStaffData(w_lngLoop).strStaffID, "")
                            '●氏名
                            If w_LItem.SubItems.Count > 1 Then
                                w_LItem.SubItems(1).Text = m_udtStaffData(w_lngLoop).strName
                            Else
                                w_LItem.SubItems.Insert(1, New System.Windows.Forms.ListViewItem.ListViewSubItem(Nothing, m_udtStaffData(w_lngLoop).strName))
                            End If

                            w_blnSelectOKFlg = True
                            w_LItem.Tag = Convert.ToString(w_lngLoop)
                        Next w_lngLoop

                        'リストビュー内選択職員設定
                        If w_lngListIdx = 0 Then
                            If UBound(m_udtStaffData) <= 0 Then
                                g_strTargetStaffMngID = ""
                            Else
                                lvwDeptInfo.Items.Item(0).Selected = True
                                '選択職員管理番号
                                g_strTargetStaffMngID = m_udtStaffData(1).strStaffMngID
                            End If
                        Else
                            lvwDeptInfo.Items.Item(w_lngListIdx - 1).Selected = True
                        End If

                    ElseIf M_DAKOKU_ERROR_DSP.Equals(m_strSelChildMenu) Then
                        '=================
                        'エラー表示
                        '=================
                        For w_lngLoop = 1 To UBound(m_udtStaffData)
                            'エラー対象者かどうか判断

                            '●連番
                            '在院
                            w_LItem = lvwDeptInfo.Items.Add("Key" & w_lngLoop, General.paFormatSpace(w_lngLoop, 3), "ERROR")
                            '======================================================================================================================
                            '-----------------------------------------------------

                            '●出勤区分検索
                            w_str = "--:--"
                            For w_lngLoop2 = 1 To UBound(m_udtDayDakokuData(w_lngLoop).Detail)
                                If "1".Equals(m_udtDayDakokuData(w_lngLoop).Detail(w_lngLoop2).strKBN) Then
                                    w_str = Format(m_udtDayDakokuData(w_lngLoop).Detail(w_lngLoop2).lngTime, "00:00")
                                    Exit For
                                End If
                            Next w_lngLoop2
                            If w_LItem.SubItems.Count > M_DAK_FROM Then
                                w_LItem.SubItems(M_DAK_FROM).Text = w_str
                            Else
                                w_LItem.SubItems.Insert(M_DAK_FROM, New System.Windows.Forms.ListViewItem.ListViewSubItem(Nothing, w_str))
                            End If
                            w_LItem.Tag = Convert.ToString(w_lngLoop)

                            '●退勤区分
                            w_str = "--:--"
                            For w_lngLoop2 = 1 To UBound(m_udtDayDakokuData(w_lngLoop).Detail)
                                If "2".Equals(m_udtDayDakokuData(w_lngLoop).Detail(w_lngLoop2).strKBN) Then
                                    w_str = Format(m_udtDayDakokuData(w_lngLoop).Detail(w_lngLoop2).lngTime, "00:00")
                                    Exit For
                                End If
                            Next w_lngLoop2
                            If w_LItem.SubItems.Count > M_DAK_TO Then
                                w_LItem.SubItems(M_DAK_TO).Text = w_str
                            Else
                                w_LItem.SubItems.Insert(M_DAK_TO, New System.Windows.Forms.ListViewItem.ListViewSubItem(Nothing, w_str))
                            End If

                            '●職員番号
                            w_str = General.paFormatSpace(m_udtStaffData(w_lngLoop).strStaffID, 10)
                            If w_LItem.SubItems.Count > M_DAK_STAFFID Then
                                w_LItem.SubItems(M_DAK_STAFFID).Text = w_str
                            Else
                                w_LItem.SubItems.Insert(M_DAK_STAFFID, New System.Windows.Forms.ListViewItem.ListViewSubItem(Nothing, w_str))
                            End If
                            '-----------------------------------------------------
                            '●氏名
                            w_str = m_udtStaffData(w_lngLoop).strName
                            If w_LItem.SubItems.Count > M_DAK_STAFFNM Then
                                w_LItem.SubItems(M_DAK_STAFFNM).Text = w_str
                            Else
                                w_LItem.SubItems.Insert(M_DAK_STAFFNM, New System.Windows.Forms.ListViewItem.ListViewSubItem(Nothing, w_str))
                            End If
                            '●勤務名称
                            If String.IsNullOrEmpty(m_udtDayKinmuJisseki(w_lngLoop).strKinmuCD) = False Then
                                w_str = m_udtDayKinmuJisseki(w_lngLoop).strKinmuNm & "(" & m_udtDayKinmuJisseki(w_lngLoop).strKinmuMark & ")"
                            Else
                                w_str = ""
                            End If
                            If w_LItem.SubItems.Count > M_DAK_KINMUNM Then
                                w_LItem.SubItems(M_DAK_KINMUNM).Text = w_str
                            Else
                                w_LItem.SubItems.Insert(M_DAK_KINMUNM, New System.Windows.Forms.ListViewItem.ListViewSubItem(Nothing, w_str))
                            End If
                            '●エラー内容
                            If UBound(m_udtDayDakokuData(w_lngLoop).strChkMsg) <= 0 Then
                                If w_LItem.SubItems.Count > M_DAK_PHS Then
                                    w_LItem.SubItems(M_DAK_PHS).Text = ""
                                Else
                                    w_LItem.SubItems.Insert(M_DAK_PHS, New System.Windows.Forms.ListViewItem.ListViewSubItem(Nothing, ""))
                                End If
                            Else
                                w_str = m_udtDayDakokuData(w_lngLoop).strChkMsg(1)
                                If w_LItem.SubItems.Count > M_DAK_PHS Then
                                    w_LItem.SubItems(M_DAK_PHS).Text = w_str
                                Else
                                    w_LItem.SubItems.Insert(M_DAK_PHS, New System.Windows.Forms.ListViewItem.ListViewSubItem(Nothing, w_str))
                                End If
                            End If

                            '選択職員の場合はインデックスを取得
                            If g_strTargetStaffMngID.Equals(m_udtStaffData(w_lngLoop).strStaffMngID) Then
                                w_lngListIdx = w_lngLoop - 1
                                g_strTargetStaffMngID = m_udtStaffData(w_lngLoop).strStaffMngID
                            End If

                            '===========================
                            '職員一覧リストに表示する
                            '===========================
                            '●職員番号
                            w_LItem = lvwDeptStaff.Items.Add("Key" & w_lngLoop, m_udtStaffData(w_lngLoop).strStaffID, "")
                            '●氏名
                            If w_LItem.SubItems.Count > 1 Then
                                w_LItem.SubItems(1).Text = m_udtStaffData(w_lngLoop).strName
                            Else
                                w_LItem.SubItems.Insert(1, New System.Windows.Forms.ListViewItem.ListViewSubItem(Nothing, m_udtStaffData(w_lngLoop).strName))
                            End If

                            w_blnSelectOKFlg = True
                            w_LItem.Tag = Convert.ToString(w_lngLoop)
                        Next w_lngLoop

                        'リストビュー内選択職員設定
                        If w_lngListIdx = 0 Then
                            If UBound(m_udtStaffData) <= 0 Then
                                g_strTargetStaffMngID = ""
                            Else
                                If w_lngStaffIdx <= 0 Then
                                    g_strTargetStaffMngID = ""
                                Else
                                    lvwDeptInfo.Items.Item(0).Selected = True
                                    '選択職員管理番号
                                    g_strTargetStaffMngID = m_udtStaffData(1).strStaffMngID
                                End If
                            End If
                        Else
                            lvwDeptInfo.Items.Item(w_lngListIdx - 1).Selected = True
                        End If

                    End If

                    '職員一覧リスト選択職員
                    If w_blnSelectOKFlg = True Then
                        If UBound(m_udtStaffData) > 0 Then
                            If lvwDeptStaff.Items.Count > 1 Then
                                lvwDeptStaff.Items.Item(0).Selected = True
                            End If
                        End If
                    End If

                Case M_DUTY_RESCD
                    '===============
                    '■日当直
                    '===============
                    w_lngListIdx = 0
                    For w_lngLoop = 1 To UBound(m_udtDayDutyStaff)

                        '●連番
                        If m_udtDayDutyStaff(w_lngLoop).blnZaiinFlg = True Then
                            '在院
                            w_LItem = lvwDeptInfo.Items.Add("Key" & w_lngLoop, General.paFormatSpace(w_lngLoop, 3), "MAN2")
                        Else
                            w_LItem = lvwDeptInfo.Items.Add("Key" & w_lngLoop, General.paFormatSpace(w_lngLoop, 3), "WOMAN2")
                        End If
                        '-----------------------------------------------------

                        '●グループ名称
                        w_str = m_udtDayDutyStaff(w_lngLoop).strGroupNm
                        If w_LItem.SubItems.Count > M_DUT_GROUPNM Then
                            w_LItem.SubItems(M_DUT_GROUPNM).Text = w_str
                        Else
                            w_LItem.SubItems.Insert(M_DUT_GROUPNM, New System.Windows.Forms.ListViewItem.ListViewSubItem(Nothing, w_str))
                        End If

                        '●職員番号
                        w_str = General.paFormatSpace(m_udtDayDutyStaff(w_lngLoop).strStaffID, 10)
                        If w_LItem.SubItems.Count > M_DUT_STAFFID Then
                            w_LItem.SubItems(M_DUT_STAFFID).Text = w_str
                        Else
                            w_LItem.SubItems.Insert(M_DUT_STAFFID, New System.Windows.Forms.ListViewItem.ListViewSubItem(Nothing, w_str))
                        End If
                        '●氏名
                        w_str = m_udtDayDutyStaff(w_lngLoop).strName
                        If w_LItem.SubItems.Count > M_DUT_STAFFNM Then
                            w_LItem.SubItems(M_DUT_STAFFNM).Text = w_str
                        Else
                            w_LItem.SubItems.Insert(M_DUT_STAFFNM, New System.Windows.Forms.ListViewItem.ListViewSubItem(Nothing, w_str))
                        End If
                        '●勤務名称
                        If String.IsNullOrEmpty(m_udtDayDutyStaff(w_lngLoop).strKinmuCD) = False Then
                            w_str = m_udtDayDutyStaff(w_lngLoop).strKinmuNm
                        Else
                            w_str = ""
                        End If
                        If w_LItem.SubItems.Count > M_DUT_KINMUNM Then
                            w_LItem.SubItems(M_DUT_KINMUNM).Text = w_str
                        Else
                            w_LItem.SubItems.Insert(M_DUT_KINMUNM, New System.Windows.Forms.ListViewItem.ListViewSubItem(Nothing, w_str))
                        End If
                        '●PHS
                        w_str = m_udtDayDutyStaff(w_lngLoop).strPHS
                        If w_LItem.SubItems.Count > M_DUT_PHSNO Then
                            w_LItem.SubItems(M_DUT_PHSNO).Text = w_str
                        Else
                            w_LItem.SubItems.Insert(M_DUT_PHSNO, New System.Windows.Forms.ListViewItem.ListViewSubItem(Nothing, w_str))
                        End If

                        '選択職員の場合はインデックスを取得
                        If g_strTargetStaffMngID.Equals(m_udtDayDutyStaff(w_lngLoop).strStaffMngID) Then
                            w_lngListIdx = w_lngLoop - 1
                            g_strTargetStaffMngID = m_udtDayDutyStaff(w_lngLoop).strStaffMngID
                        End If
                        w_LItem.Tag = Convert.ToString(w_lngLoop)
                    Next w_lngLoop

                    'リストビュー内選択職員設定
                    If w_lngListIdx = 0 Then
                        If UBound(m_udtDayDutyStaff) <= 0 Then
                            g_strTargetStaffMngID = ""
                        Else
                            lvwDeptInfo.Items.Item(0).Selected = True
                            '選択職員管理番号
                            g_strTargetStaffMngID = m_udtDayDutyStaff(1).strStaffMngID
                        End If
                    Else
                        lvwDeptInfo.Items.Item(w_lngListIdx - 1).Selected = True
                    End If


                Case M_ZAIIN_RESCD
                    '===============
                    '■在院照会
                    '===============
                    w_lngListIdx = 0
                    For w_lngLoop = 1 To UBound(m_udtStaffData)


                        '●連番
                        If m_udtDayDakokuData(w_lngLoop).blnZaiinFlg = True Then
                            '在院
                            w_LItem = lvwDeptInfo.Items.Add("Key" & w_lngLoop, General.paFormatSpace(w_lngLoop, 3), "MAN2")
                        Else
                            '不在
                            w_LItem = lvwDeptInfo.Items.Add("Key" & w_lngLoop, General.paFormatSpace(w_lngLoop, 3), "WOMAN2")
                        End If

                        '●職員番号
                        w_str = General.paFormatSpace(m_udtStaffData(w_lngLoop).strStaffID, 10)
                        If w_LItem.SubItems.Count > M_ZAI_STAFFID Then
                            w_LItem.SubItems(M_ZAI_STAFFID).Text = w_str
                        Else
                            w_LItem.SubItems.Insert(M_ZAI_STAFFID, New System.Windows.Forms.ListViewItem.ListViewSubItem(Nothing, w_str))
                        End If
                        w_str = m_udtStaffData(w_lngLoop).strName
                        If w_LItem.SubItems.Count > M_ZAI_STAFFNM Then
                            w_LItem.SubItems(M_ZAI_STAFFNM).Text = w_str
                        Else
                            w_LItem.SubItems.Insert(M_ZAI_STAFFNM, New System.Windows.Forms.ListViewItem.ListViewSubItem(Nothing, w_str))
                        End If
                        '●勤務名称
                        If String.IsNullOrEmpty(m_udtDayKinmuJisseki(w_lngLoop).strKinmuCD) = False Then
                            w_str = m_udtDayKinmuJisseki(w_lngLoop).strKinmuNm & "(" & m_udtDayKinmuJisseki(w_lngLoop).strKinmuMark & ")"
                        Else
                            w_str = ""
                        End If
                        If w_LItem.SubItems.Count > M_ZAI_KINMUNM Then
                            w_LItem.SubItems(M_ZAI_KINMUNM).Text = w_str
                        Else
                            w_LItem.SubItems.Insert(M_ZAI_KINMUNM, New System.Windows.Forms.ListViewItem.ListViewSubItem(Nothing, w_str))
                        End If
                        '●PHS番号
                        w_str = m_udtStaffData(w_lngLoop).strPHS
                        If w_LItem.SubItems.Count > M_ZAI_PHS Then
                            w_LItem.SubItems(M_ZAI_PHS).Text = w_str
                        Else
                            w_LItem.SubItems.Insert(M_ZAI_PHS, New System.Windows.Forms.ListViewItem.ListViewSubItem(Nothing, w_str))
                        End If

                        '選択職員の場合はインデックスを取得
                        If (m_udtStaffData(w_lngLoop).strStaffMngID).Equals(g_strTargetStaffMngID) Then
                            w_lngListIdx = w_lngLoop - 1
                            g_strTargetStaffMngID = m_udtStaffData(w_lngLoop).strStaffMngID
                        End If
                        w_LItem.Tag = Convert.ToString(w_lngLoop)
                    Next w_lngLoop

                    'リストビュー内選択職員設定
                    If w_lngListIdx = 0 Then
                        If UBound(m_udtStaffData) <= 0 Then
                            g_strTargetStaffMngID = ""
                            lvwDeptInfo.Items.Clear()
                        Else
                            lvwDeptInfo.Items.Item(0).Selected = True
                            '選択職員管理番号
                            g_strTargetStaffMngID = m_udtStaffData(1).strStaffMngID
                        End If
                    Else
                        lvwDeptInfo.Items.Item(w_lngListIdx - 1).Selected = True
                    End If
                Case M_STAFFIDO_RESCD
                    '==============
                    '■職員管理
                    '==============
                    'Hirata 2009/04/09 ADD ************************
                    'ﾘｽﾄﾋﾞｭｰのItemが残ったままの場合 ｸﾘｱする
                    If lvwDeptInfo.Items.Count > 0 Then
                        lvwDeptInfo.Items.Clear()
                    End If
                    '**********************************************
                    w_lngListIdx = 0
                    For w_lngLoop = 1 To UBound(m_udtStaffData)

                        '●連番
                        If "1".Equals(m_udtStaffData(w_lngLoop).strSex) Then
                            '男性
                            w_LItem = lvwDeptInfo.Items.Add("Key" & w_lngLoop, General.paFormatSpace(w_lngLoop, 3), "MAN")
                        Else
                            '女性
                            w_LItem = lvwDeptInfo.Items.Add("Key" & w_lngLoop, General.paFormatSpace(w_lngLoop, 3), "WOMAN")
                        End If

                        '●職員番号
                        w_str = General.paFormatSpace(m_udtStaffData(w_lngLoop).strStaffID, 10)
                        If w_LItem.SubItems.Count > M_SYO_STAFFID Then
                            w_LItem.SubItems(M_SYO_STAFFID).Text = w_str
                        Else
                            w_LItem.SubItems.Insert(M_SYO_STAFFID, New System.Windows.Forms.ListViewItem.ListViewSubItem(Nothing, w_str))
                        End If
                        '●氏名
                        w_str = m_udtStaffData(w_lngLoop).strName
                        If w_LItem.SubItems.Count > M_SYO_STAFFNM Then
                            w_LItem.SubItems(M_SYO_STAFFNM).Text = w_str
                        Else
                            w_LItem.SubItems.Insert(M_SYO_STAFFNM, New System.Windows.Forms.ListViewItem.ListViewSubItem(Nothing, w_str))
                        End If
                        '●カナ
                        w_str = m_udtStaffData(w_lngLoop).strKana
                        If w_LItem.SubItems.Count > M_SYO_STAFFKN Then
                            w_LItem.SubItems(M_SYO_STAFFKN).Text = w_str
                        Else
                            w_LItem.SubItems.Insert(M_SYO_STAFFKN, New System.Windows.Forms.ListViewItem.ListViewSubItem(Nothing, w_str))
                        End If
                        '●勤務部署
                        w_str = m_udtStaffData(w_lngLoop).strKinmuDeptName
                        If w_LItem.SubItems.Count > M_SYO_KINMUNM Then
                            w_LItem.SubItems(M_SYO_KINMUNM).Text = w_str
                        Else
                            w_LItem.SubItems.Insert(M_SYO_KINMUNM, New System.Windows.Forms.ListViewItem.ListViewSubItem(Nothing, w_str))
                        End If
                        '勤務＝配属
                        If "0".Equals(w_WarddeptFlg) Then
                            '●配属部署
                            w_str = m_udtStaffData(w_lngLoop).strWardDeptName
                            If w_LItem.SubItems.Count > M_SYO_WARDNM Then
                                w_LItem.SubItems(M_SYO_WARDNM).Text = w_str
                            Else
                                w_LItem.SubItems.Insert(M_SYO_WARDNM, New System.Windows.Forms.ListViewItem.ListViewSubItem(Nothing, w_str))
                            End If
                            '●役職
                            w_str = m_udtStaffData(w_lngLoop).strPostNm
                            If w_LItem.SubItems.Count > M_SYO_POSTNM Then
                                w_LItem.SubItems(M_SYO_POSTNM).Text = w_str
                            Else
                                w_LItem.SubItems.Insert(M_SYO_POSTNM, New System.Windows.Forms.ListViewItem.ListViewSubItem(Nothing, w_str))
                            End If
                            '●配属
                            w_str = m_udtStaffData(w_lngLoop).strJocNm
                            If w_LItem.SubItems.Count > M_SYO_JOBNM Then
                                w_LItem.SubItems(M_SYO_JOBNM).Text = w_str
                            Else
                                w_LItem.SubItems.Insert(M_SYO_JOBNM, New System.Windows.Forms.ListViewItem.ListViewSubItem(Nothing, w_str))
                            End If
                            '勤務＝配属
                        Else
                            '●役職
                            w_str = m_udtStaffData(w_lngLoop).strPostNm
                            If w_LItem.SubItems.Count > M_SYO_POSTNM2 Then
                                w_LItem.SubItems(M_SYO_POSTNM2).Text = w_str
                            Else
                                w_LItem.SubItems.Insert(M_SYO_POSTNM2, New System.Windows.Forms.ListViewItem.ListViewSubItem(Nothing, w_str))
                            End If
                            '●配属
                            w_str = m_udtStaffData(w_lngLoop).strJocNm
                            If w_LItem.SubItems.Count > M_SYO_JOBNM2 Then
                                w_LItem.SubItems(M_SYO_JOBNM2).Text = w_str
                            Else
                                w_LItem.SubItems.Insert(M_SYO_JOBNM2, New System.Windows.Forms.ListViewItem.ListViewSubItem(Nothing, w_str))
                            End If
                        End If

                        '選択職員の場合はインデックスを取得
                        If g_strTargetStaffMngID.Equals(m_udtStaffData(w_lngLoop).strStaffMngID) Then
                            w_lngListIdx = w_lngLoop
                            g_strTargetStaffMngID = m_udtStaffData(w_lngLoop).strStaffMngID
                        End If
                        w_LItem.Tag = Convert.ToString(w_lngLoop)
                    Next w_lngLoop

                    'リストビュー内選択職員設定
                    If w_lngListIdx = 0 Then
                        If UBound(m_udtStaffData) <= 0 Then
                            g_strTargetStaffMngID = ""
                            lvwDeptInfo.Items.Clear()
                        Else
                            lvwDeptInfo.Items.Item(0).Selected = True
                            lvwDeptInfo.Items.Item(0).Focused = True
                            '選択職員管理番号
                            g_strTargetStaffMngID = m_udtStaffData(1).strStaffMngID
                        End If
                    Else
                        lvwDeptInfo.Items.Item(w_lngListIdx - 1).Selected = True
                        lvwDeptInfo.Items.Item(w_lngListIdx - 1).Focused = True
                    End If
                    lvwDeptInfo.Select()

                Case M_OVERKINMU_RESCD
                    '===============
                    '■時間外
                    '===============
                    If M_STR_DAY.Equals(m_strOverKinmuDispType) Then

                        w_lngStaffIdx = 0
                        w_lngRenbanNo = 0
                        For w_lngLoop = 1 To UBound(m_udtStaffData)

                            w_lngStaffIdx = w_lngStaffIdx + 1

                            '勤務実績がない場合は表示なし
                            If String.IsNullOrEmpty(m_udtDayKinmuJisseki(w_lngLoop).strKinmuCD) = False Then
                                w_lngRenbanNo = w_lngRenbanNo + 1

                                '●連番
                                If UBound(m_udtDayOverKinmu(w_lngLoop).OverKinmuData) <> 0 Then

                                    '超勤がない
                                    If M_NO_ICON.Equals(m_udtDayOverKinmu(w_lngLoop).IconStatus) Then
                                        w_LItem = lvwDeptInfo.Items.Add("Key" & w_lngLoop, General.paFormatSpace(w_lngRenbanNo, 3), "")
                                        '承認待ちだが承認できない
                                    ElseIf M_NOT_APPROVE_BEFORE.Equals(m_udtDayOverKinmu(w_lngLoop).IconStatus) Then
                                        w_LItem = lvwDeptInfo.Items.Add("Key" & w_lngLoop, General.paFormatSpace(w_lngRenbanNo, 3), "OVER1")
                                        '承認待ちで承認できる
                                    ElseIf M_OK_APPROVE.Equals(m_udtDayOverKinmu(w_lngLoop).IconStatus) Then
                                        w_LItem = lvwDeptInfo.Items.Add("Key" & w_lngLoop, General.paFormatSpace(w_lngRenbanNo, 3), "OVER2")
                                        '承認済だが確定されていない
                                    ElseIf M_NOT_APPROVE_AFTER.Equals(m_udtDayOverKinmu(w_lngLoop).IconStatus) Then
                                        w_LItem = lvwDeptInfo.Items.Add("Key" & w_lngLoop, General.paFormatSpace(w_lngRenbanNo, 3), "OVER3")
                                        '確定されている
                                    ElseIf M_NOT_APPROVE_DUE.Equals(m_udtDayOverKinmu(w_lngLoop).IconStatus) Then
                                        w_LItem = lvwDeptInfo.Items.Add("Key" & w_lngLoop, General.paFormatSpace(w_lngRenbanNo, 3), "OVER4")
                                    Else
                                        w_LItem = lvwDeptInfo.Items.Add("Key" & w_lngLoop, General.paFormatSpace(w_lngRenbanNo, 3), "")
                                    End If

                                Else
                                    'それ以外
                                    w_LItem = lvwDeptInfo.Items.Add("Key" & w_lngLoop, General.paFormatSpace(w_lngRenbanNo, 3), "")
                                End If

                                '●職員番号
                                w_str = General.paFormatSpace(m_udtStaffData(w_lngLoop).strStaffID, 10)
                                If w_LItem.SubItems.Count > M_DAYOVER_STAFFID Then
                                    w_LItem.SubItems(M_DAYOVER_STAFFID).Text = w_str
                                Else
                                    w_LItem.SubItems.Insert(M_DAYOVER_STAFFID, New System.Windows.Forms.ListViewItem.ListViewSubItem(Nothing, w_str))
                                End If
                                '●氏名
                                w_str = m_udtStaffData(w_lngLoop).strName
                                If w_LItem.SubItems.Count > M_DAYOVER_STAFFNM Then
                                    w_LItem.SubItems(M_DAYOVER_STAFFNM).Text = w_str
                                Else
                                    w_LItem.SubItems.Insert(M_DAYOVER_STAFFNM, New System.Windows.Forms.ListViewItem.ListViewSubItem(Nothing, w_str))
                                End If

                                '●勤務名称
                                If String.IsNullOrEmpty(m_udtDayKinmuJisseki(w_lngLoop).strKinmuCD) = False Then
                                    w_str = m_udtDayKinmuJisseki(w_lngLoop).strKinmuNm & "(" & m_udtDayKinmuJisseki(w_lngLoop).strKinmuMark & ")"
                                Else
                                    w_str = ""
                                End If
                                If w_LItem.SubItems.Count > M_DEP_KINMUNM Then
                                    w_LItem.SubItems(M_DEP_KINMUNM).Text = w_str
                                Else
                                    w_LItem.SubItems.Insert(M_DEP_KINMUNM, New System.Windows.Forms.ListViewItem.ListViewSubItem(Nothing, w_str))
                                End If

                                '●就業時間
                                If "0".Equals(m_udtDayKinmuJisseki(w_lngLoop).strKinmuFrom) AndAlso "0".Equals(m_udtDayKinmuJisseki(w_lngLoop).strKinmuTo) Then
                                    w_str = ""
                                Else
                                    w_str = fncChangeStrTime(m_udtDayKinmuJisseki(w_lngLoop).strKinmuFrom) & "〜" & fncChangeStrTime(m_udtDayKinmuJisseki(w_lngLoop).strKinmuTo)
                                End If
                                If w_LItem.SubItems.Count > M_DAYOVER_OVERKINMU Then
                                    w_LItem.SubItems(M_DAYOVER_OVERKINMU).Text = w_str
                                Else
                                    w_LItem.SubItems.Insert(M_DAYOVER_OVERKINMU, New System.Windows.Forms.ListViewItem.ListViewSubItem(Nothing, w_str))
                                End If

                                '●時間外
                                w_str = Convert.ToString(UBound(m_udtDayOverKinmu(w_lngLoop).OverKinmuData))
                                If "0".Equals(w_str) Then
                                    w_str = ""
                                ElseIf "1".Equals(w_str) Then
                                    w_str = fncChangeStrTime(Convert.ToString(m_udtDayOverKinmu(w_lngLoop).OverKinmuData(1).lngFromTime)) & "〜" & fncChangeStrTime(Convert.ToString(m_udtDayOverKinmu(w_lngLoop).OverKinmuData(1).lngToTime)) & "(" & m_udtDayOverKinmu(w_lngLoop).OverKinmuData(1).strReasonSNm & ")"
                                Else
                                    w_str = fncChangeStrTime(Convert.ToString(m_udtDayOverKinmu(w_lngLoop).OverKinmuData(1).lngFromTime)) & "〜" & fncChangeStrTime(Convert.ToString(m_udtDayOverKinmu(w_lngLoop).OverKinmuData(1).lngToTime)) & "(" & m_udtDayOverKinmu(w_lngLoop).OverKinmuData(1).strReasonSNm & ")" & " *"
                                End If
                                If w_LItem.SubItems.Count > M_DEP_JOBNM Then
                                    w_LItem.SubItems(M_DEP_JOBNM).Text = w_str
                                Else
                                    w_LItem.SubItems.Insert(M_DEP_JOBNM, New System.Windows.Forms.ListViewItem.ListViewSubItem(Nothing, w_str))
                                End If

                                '未承認累計
                                w_str = ""
                                If m_udtDayOverKinmu(w_lngLoop).AprYetTimeTotal = 0 Then
                                    '時間が0分の場合はブランクとする
                                    If w_LItem.SubItems.Count > M_DEPOVER_APRYET Then
                                        w_LItem.SubItems(M_DEPOVER_APRYET).Text = ""
                                    Else
                                        w_LItem.SubItems.Insert(M_DEPOVER_APRYET, New System.Windows.Forms.ListViewItem.ListViewSubItem(Nothing, ""))
                                    End If
                                Else
                                    '60分以上あった場合時間表示
                                    If (m_udtDayOverKinmu(w_lngLoop).AprYetTimeTotal \ 60) <> 0 Then
                                        w_str = w_str & (m_udtDayOverKinmu(w_lngLoop).AprYetTimeTotal \ 60) & "時間"
                                    End If
                                    '分の端数があった場合分表示
                                    If (m_udtDayOverKinmu(w_lngLoop).AprYetTimeTotal Mod 60) <> 0 Then
                                        w_str = w_str & (m_udtDayOverKinmu(w_lngLoop).AprYetTimeTotal Mod 60) & "分"
                                    End If
                                    If w_LItem.SubItems.Count > M_DEPOVER_APRYET Then
                                        w_LItem.SubItems(M_DEPOVER_APRYET).Text = w_str
                                    Else
                                        w_LItem.SubItems.Insert(M_DEPOVER_APRYET, New System.Windows.Forms.ListViewItem.ListViewSubItem(Nothing, w_str))
                                    End If
                                End If
                                '承認済累計
                                w_str = ""
                                If m_udtDayOverKinmu(w_lngLoop).AprOverTimeTotal = 0 Then


                                    If w_LItem.SubItems.Count > M_DEPOVER_APROVER Then
                                        w_LItem.SubItems(M_DEPOVER_APROVER).Text = ""
                                    Else
                                        w_LItem.SubItems.Insert(M_DEPOVER_APROVER, New System.Windows.Forms.ListViewItem.ListViewSubItem(Nothing, ""))
                                    End If
                                Else
                                    '60分以上あった場合時間表示
                                    If (m_udtDayOverKinmu(w_lngLoop).AprOverTimeTotal \ 60) <> 0 Then
                                        w_str = w_str & (m_udtDayOverKinmu(w_lngLoop).AprOverTimeTotal \ 60) & "時間"
                                    End If
                                    '分の端数があった場合分表示
                                    If (m_udtDayOverKinmu(w_lngLoop).AprOverTimeTotal Mod 60) <> 0 Then
                                        w_str = w_str & (m_udtDayOverKinmu(w_lngLoop).AprOverTimeTotal Mod 60) & "分"
                                    End If
                                    If w_LItem.SubItems.Count > M_DEPOVER_APROVER Then
                                        w_LItem.SubItems(M_DEPOVER_APROVER).Text = w_str
                                    Else
                                        w_LItem.SubItems.Insert(M_DEPOVER_APROVER, New System.Windows.Forms.ListViewItem.ListViewSubItem(Nothing, w_str))
                                    End If

                                End If

                                '選択職員の場合はインデックスを取得
                                If m_udtStaffData(w_lngLoop).strStaffMngID.Equals(g_strTargetStaffMngID) Then

                                    w_lngListIdx = w_lngRenbanNo - 1
                                    g_strTargetStaffMngID = m_udtStaffData(w_lngLoop).strStaffMngID
                                End If
                                w_LItem.Tag = Convert.ToString(w_lngLoop)

                                '===========================
                                '職員一覧リストに表示する
                                '===========================
                                '●職員番号
                                w_LItem = lvwDeptStaff.Items.Add("Key" & w_lngLoop, m_udtStaffData(w_lngLoop).strStaffID, "")
                                '●氏名
                                If w_LItem.SubItems.Count > 1 Then
                                    w_LItem.SubItems(1).Text = m_udtStaffData(w_lngLoop).strName
                                Else
                                    w_LItem.SubItems.Insert(1, New System.Windows.Forms.ListViewItem.ListViewSubItem(Nothing, m_udtStaffData(w_lngLoop).strName))
                                End If

                                w_blnSelectOKFlg = True
                                w_LItem.Tag = Convert.ToString(w_lngLoop)

                            End If
                        Next w_lngLoop

                        'リストビュー内選択職員設定
                        If w_lngListIdx = 0 Then
                            If UBound(m_udtStaffData) <= 0 Then
                                g_strTargetStaffMngID = ""
                            Else
                                If w_lngRenbanNo <= 0 Then
                                    g_strTargetStaffMngID = ""
                                Else
                                    lvwDeptInfo.Items.Item(0).Selected = True
                                    lvwDeptInfo.Items.Item(0).Focused = True
                                    '選択職員管理番号
                                    g_strTargetStaffMngID = m_udtStaffData(1).strStaffMngID
                                End If
                            End If
                        Else
                            lvwDeptInfo.Items.Item(w_lngListIdx).Selected = True
                        End If

                    ElseIf m_strOverKinmuDispType = M_STR_PERSONAL Then
                        '-------------
                        '■個人別時間外
                        '-------------
                        If UBound(m_Personal) > 0 Then
                            '対象月 日付数分ﾙｰﾌﾟ
                            For w_lngLoop = 1 To m_lngPutDateNum

                                w_lngSubListIndex = 0

                                '超勤がない
                                If (M_NO_ICON).Equals(m_udtKinmuData(w_lngLoop).strIconStatus) Then
                                    w_strIcon = ""
                                    '承認待ちだが承認できない
                                ElseIf (M_NOT_APPROVE_BEFORE).Equals(m_udtKinmuData(w_lngLoop).strIconStatus) Then
                                    w_strIcon = "OVER1"
                                    '承認待ちで承認できる
                                ElseIf (M_OK_APPROVE).Equals(m_udtKinmuData(w_lngLoop).strIconStatus) Then
                                    w_strIcon = "OVER2"
                                    '承認済だが確定されていない
                                ElseIf (M_NOT_APPROVE_AFTER).Equals(m_udtKinmuData(w_lngLoop).strIconStatus) Then
                                    w_strIcon = "OVER3"
                                    '確定されている
                                ElseIf (M_NOT_APPROVE_DUE).Equals(m_udtKinmuData(w_lngLoop).strIconStatus) Then
                                    w_strIcon = "OVER4"
                                Else
                                    w_strIcon = ""
                                End If

                                '●日締めマークの取得
                                '----------------------------------------------------------------------
                                'データの取得
                                '----------------------------------------------------------------------
                                m_dayLockMark = General.paGetItemValue(General.G_STRMAINKEY3, General.G_STRSUBKEY1, "DAYLOCKMARK", "", General.g_strHospitalCD)

                                '●時間外ロック
                                w_LoclFlg = False
                                w_numDate = General.paGetDateIntegerFromDate(w_Date)
                                For w_lngLoop3 = 1 To UBound(g_udtStaffHistory)
                                    If g_udtStaffHistory(w_lngLoop3).lngStartDate <= w_numDate AndAlso w_numDate <= g_udtStaffHistory(w_lngLoop3).lngEndDate Then
                                        w_strKinmuDeptCD = g_udtStaffHistory(w_lngLoop3).strKangoTaniCD
                                        Exit For
                                    End If
                                Next w_lngLoop3

                                For w_lngLoop3 = 1 To UBound(m_udtOverKinmuLock)
                                    If m_udtOverKinmuLock(w_lngLoop3).blnLockFlg = True AndAlso (w_strKinmuDeptCD).Equals(m_udtOverKinmuLock(w_lngLoop3).strKinmuDeptCD) AndAlso m_udtOverKinmuLock(w_lngLoop3).lngDate = w_numDate Then
                                        w_LoclFlg = True
                                        Exit For
                                    End If
                                Next w_lngLoop3

                                '●日付
                                'w_str = Format(VB.Day(w_Date), "@@") & "日"
                                w_str = Format(w_Date, "dd") & "日"

                                If String.IsNullOrEmpty(w_strIcon) Then
                                    If Weekday(w_Date) = 1 Then
                                        If w_LoclFlg = False Then
                                            w_LItem = lvwMain.Items.Add("Key" & w_lngLoop, w_str & "(日)", "")
                                        Else
                                            w_LItem = lvwMain.Items.Add("Key" & w_lngLoop, w_str & "(日)" & m_dayLockMark, "")
                                        End If
                                        w_LItem.ForeColor = System.Drawing.ColorTranslator.FromOle(g_Sun_ForeColor)
                                    ElseIf Weekday(w_Date) = 7 Then
                                        If w_LoclFlg = False Then
                                            w_LItem = lvwMain.Items.Add("Key" & w_lngLoop, w_str & "(土)", "")
                                        Else
                                            w_LItem = lvwMain.Items.Add("Key" & w_lngLoop, w_str & "(土)" & m_dayLockMark, "")
                                        End If
                                        w_LItem.ForeColor = System.Drawing.ColorTranslator.FromOle(g_Sat_ForeColor)
                                    Else
                                        If w_LoclFlg = False Then
                                            w_LItem = lvwMain.Items.Add("Key" & w_lngLoop, w_str & "(" & Format(w_Date, "ddd") & ")", "")
                                        Else
                                            w_LItem = lvwMain.Items.Add("Key" & w_lngLoop, w_str & "(" & Format(w_Date, "ddd") & ")" & m_dayLockMark, "")
                                        End If
                                        w_LItem.ForeColor = System.Drawing.Color.Black
                                    End If
                                Else
                                    If Weekday(w_Date) = 1 Then
                                        If w_LoclFlg = False Then
                                            w_LItem = lvwMain.Items.Add("Key" & w_lngLoop, w_str & "(日) ", w_strIcon)
                                        Else
                                            w_LItem = lvwMain.Items.Add("Key" & w_lngLoop, w_str & "(日)" & m_dayLockMark, w_strIcon)
                                        End If
                                        w_LItem.ForeColor = System.Drawing.ColorTranslator.FromOle(g_Sun_ForeColor)
                                    ElseIf Weekday(w_Date) = 7 Then
                                        If w_LoclFlg = False Then
                                            w_LItem = lvwMain.Items.Add("Key" & w_lngLoop, w_str & "(土) ", w_strIcon)
                                        Else
                                            w_LItem = lvwMain.Items.Add("Key" & w_lngLoop, w_str & "(土)" & m_dayLockMark, w_strIcon)
                                        End If
                                        w_LItem.ForeColor = System.Drawing.ColorTranslator.FromOle(g_Sat_ForeColor)
                                    Else
                                        If w_LoclFlg = False Then
                                            w_LItem = lvwMain.Items.Add("Key" & w_lngLoop, w_str & "(" & Format(w_Date, "ddd") & ") ", w_strIcon)
                                        Else
                                            w_LItem = lvwMain.Items.Add("Key" & w_lngLoop, w_str & "(" & Format(w_Date, "ddd") & ")" & m_dayLockMark, w_strIcon)
                                        End If
                                        w_LItem.ForeColor = System.Drawing.Color.Black
                                    End If
                                End If

                                '休日マスタチェック
                                For w_lngHolLoop = 1 To UBound(g_HolidayM)
                                    If g_HolidayM(w_lngHolLoop).lngDate = General.paGetDateIntegerFromDate(w_Date) Then
                                        '祝日カラー
                                        w_LItem.ForeColor = System.Drawing.ColorTranslator.FromOle(g_Hol_ForeColor)
                                        Exit For
                                    End If
                                Next w_lngHolLoop

                                '●勤務名称
                                w_lngSubListIndex = w_lngSubListIndex + 1
                                w_str = m_udtKinmuData(w_lngLoop).strKinmuNm
                                If w_LItem.SubItems.Count > w_lngSubListIndex Then
                                    w_LItem.SubItems(w_lngSubListIndex).Text = w_str
                                Else
                                    w_LItem.SubItems.Insert(w_lngSubListIndex, New System.Windows.Forms.ListViewItem.ListViewSubItem(Nothing, w_str))
                                End If

                                '●就業時間
                                If "0".Equals(m_udtKinmuData(w_lngLoop).strFromTime) AndAlso "0".Equals(m_udtKinmuData(w_lngLoop).strToTime) Then
                                    w_str = ""
                                Else
                                    w_str = fncChangeStrTime(m_udtKinmuData(w_lngLoop).strFromTime) & "〜" & fncChangeStrTime(m_udtKinmuData(w_lngLoop).strToTime)
                                End If
                                w_lngSubListIndex = w_lngSubListIndex + 1
                                If w_LItem.SubItems.Count > w_lngSubListIndex Then
                                    w_LItem.SubItems(w_lngSubListIndex).Text = w_str
                                Else
                                    w_LItem.SubItems.Insert(w_lngSubListIndex, New System.Windows.Forms.ListViewItem.ListViewSubItem(Nothing, w_str))
                                End If

                                '●時間外
                                If String.IsNullOrEmpty(m_udtKinmuData(w_lngLoop).strOFromTime) _
                                    AndAlso String.IsNullOrEmpty(m_udtKinmuData(w_lngLoop).strOToTime) Then
                                    w_str = ""
                                Else
                                    w_str = fncChangeStrTime(m_udtKinmuData(w_lngLoop).strOFromTime) & "〜" & fncChangeStrTime(m_udtKinmuData(w_lngLoop).strOToTime) & "(" & m_udtKinmuData(w_lngLoop).strReasonSNm & ")"

                                    If m_udtKinmuData(w_lngLoop).blnOAnyData = True Then
                                        w_str = w_str & " *"
                                    End If
                                End If
                                w_lngSubListIndex = w_lngSubListIndex + 1
                                If w_LItem.SubItems.Count > w_lngSubListIndex Then
                                    w_LItem.SubItems(w_lngSubListIndex).Text = w_str
                                Else
                                    w_LItem.SubItems.Insert(w_lngSubListIndex, New System.Windows.Forms.ListViewItem.ListViewSubItem(Nothing, w_str))
                                End If

                                '日付を連動させる
                                If m_CalDate.Date.Equals(w_Date) Then
                                    lvwMain.Items.Item(lvwMain.Items.Count - 1).Selected = True
                                    lvwMain.Items.Item(lvwMain.Items.Count - 1).Focused = True
                                End If

                                '日付加算
                                w_Date = DateAdd(Microsoft.VisualBasic.DateInterval.Day, 1, w_Date)
                                w_LItem.Tag = Convert.ToString(w_lngLoop)
                            Next w_lngLoop
                        End If
                    End If

                    If w_blnSelectOKFlg = True Then
                        If UBound(m_udtStaffData) > 0 Then
                            lvwDeptStaff.Items.Item(0).Selected = True
                            lvwDeptStaff.Items.Item(0).Focused = True
                        End If
                    End If
            End Select

        Catch ex As Exception
            Call General.paTrpMsg(Convert.ToString(Err.Number), W_SUBNAME)
        End Try
    End Sub

    '---------------------------------------------------------
    '勤務部署 取得(権限範囲)
    '引数・・・　p_AuthRangeKbn(権限範囲区分)
    '---------------------------------------------------------
    Private Sub sGetKinmuDept(ByVal p_AuthRangeKbn As String)
        Const W_SUBNAME As String = "NSC0000HA sGetKinmuDept"

        Try
            Dim w_lngRecCnt As Integer
            Dim w_lngLoop As Integer
            Dim w_lngIdx As Integer

            '初期化
            ReDim m_udtKinmuDept(0)

            '==================================
            '勤務部署 取得(権限範囲)
            '==================================
            With General.g_objSecurity
                .pSAIKEIUSEFLG = "1"

                If .mGetAuthKinmuDept(p_AuthRangeKbn) = False Then

                Else
                    '●勤務部署件数
                    w_lngRecCnt = .fAK_KinmuDeptCount

                    For w_lngLoop = 1 To w_lngRecCnt
                        '索引
                        .mAK_KinmuDeptIdx = w_lngLoop

                        '「退職」「未確定」は除く
                        If "1".Equals(.fAK_DataKbn) Then
                            w_lngIdx = UBound(m_udtKinmuDept) + 1

                            ReDim Preserve m_udtKinmuDept(w_lngIdx)
                            m_udtKinmuDept(w_lngIdx) = New DATABEAN.KinmuDept_Type

                            '●勤務部署区分
                            m_udtKinmuDept(w_lngIdx).strDeptKbn = .fAK_DataKbn
                            '●勤務部署コード
                            m_udtKinmuDept(w_lngIdx).strDeptCD = .fAK_KinmuDeptCD
                            '●勤務部署名称
                            m_udtKinmuDept(w_lngIdx).strDeptName = .fAK_KinmuDeptName
                            '●勤務部署略称
                            m_udtKinmuDept(w_lngIdx).strDeptSecNm = .fAK_SecName
                            '●勤務部署略称２
                            m_udtKinmuDept(w_lngIdx).strDeptSecNm2 = .fAK_SecName2
                            '●表示NO
                            m_udtKinmuDept(w_lngIdx).lngDispNo = .fAK_DispNo
                            '●階層レベル１コード
                            m_udtKinmuDept(w_lngIdx).strClassLvlCD(1) = .fAK_KinmuLevelCD1
                            '●階層レベル１名称
                            m_udtKinmuDept(w_lngIdx).strClassLvlNM(1) = .fAK_KinmuLevelName1
                            '●階層レベル２コード
                            m_udtKinmuDept(w_lngIdx).strClassLvlCD(2) = .fAK_KinmuLevelCD2
                            '●階層レベル２名称
                            m_udtKinmuDept(w_lngIdx).strClassLvlNM(2) = .fAK_KinmuLevelName2
                            '●階層レベル３コード
                            m_udtKinmuDept(w_lngIdx).strClassLvlCD(3) = .fAK_KinmuLevelCD3
                            '●階層レベル３名称
                            m_udtKinmuDept(w_lngIdx).strClassLvlNM(3) = .fAK_KinmuLevelName3
                            '●階層レベル４コード
                            m_udtKinmuDept(w_lngIdx).strClassLvlCD(4) = .fAK_KinmuLevelCD4
                            '●階層レベル４名称
                            m_udtKinmuDept(w_lngIdx).strClassLvlNM(4) = .fAK_KinmuLevelName4
                            '●階層レベル５コード
                            m_udtKinmuDept(w_lngIdx).strClassLvlCD(5) = .fAK_KinmuLevelCD5
                            '●階層レベル５名称
                            m_udtKinmuDept(w_lngIdx).strClassLvlNM(5) = .fAK_KinmuLevelName5
                            '●夜間看護加算フラグ
                            m_udtKinmuDept(w_lngIdx).strNightKangoAddFlg = .fAK_NightKangoAddFlg
                            '●計画作成対象フラグ
                            m_udtKinmuDept(w_lngIdx).strPlanMakeFlg = .fAK_PlanMakeFlg
                            '●チーム数
                            m_udtKinmuDept(w_lngIdx).lngTeamCnt = .fAK_TeamCount
                            '●分割フラグ
                            m_udtKinmuDept(w_lngIdx).strDivisionFlg = .fAK_DivisionFlg
                            '●定員数
                            m_udtKinmuDept(w_lngIdx).lngCapaCount = .fAK_CapaCount
                            '●汎用エリア
                            m_udtKinmuDept(w_lngIdx).strHanyoArea = .fAK_HanyoArea
                            '●汎用エリア２
                            m_udtKinmuDept(w_lngIdx).strHanyoArea2 = .fAK_HanyoArea2
                        End If
                    Next w_lngLoop
                End If
            End With

        Catch ex As Exception
            Call General.paTrpMsg(Convert.ToString(Err.Number), W_SUBNAME)
        End Try
    End Sub

    '========================================
    '勤務部署ツリービュー 作成
    '========================================
    Private Sub sSetKinmuDeptTreeView()
        Const W_SUBNAME As String = "NSC0000HA sSetKinmuDeptTreeView"

        Try
            Dim w_Node As System.Windows.Forms.TreeNode
            Dim w_lngLoop As Integer

            Dim w_lngLvl1Idx As Integer
            Dim w_lngLvl2Idx As Integer
            Dim w_lngLvl3Idx As Integer
            Dim w_lngLvl4Idx As Integer
            Dim w_lngLvl5Idx As Integer

            Dim w_preClassLvlCD1 As String
            Dim w_preClassLvlCD2 As String
            Dim w_preClassLvlCD3 As String
            Dim w_preClassLvlCD4 As String
            Dim w_preClassLvlCD5 As String
            Dim w_strMark As String
            Dim w_lngPlan As Integer
            Dim w_lngBeforePlan As Integer
            Dim w_SelKinmuDeptFlg As Boolean
            Dim w_UserKinmuDeptFlg As Boolean
            Dim w_numDate As Integer
            Dim w_NodeSelectedFlg As Boolean = False    'tvwKinmuDept.SelectedNode プロパティに値の設定有無の判定フラグ

            w_numDate = General.paGetDateIntegerFromDate(m_CalDate)
            Call subGetPlanNo(w_lngPlan, w_lngBeforePlan, w_numDate, w_numDate)
            m_currentSelPlanNo = w_lngPlan '現在表示計画番号の取得
            For w_lngLoop = 1 To UBound(m_udtKinmuDept)
                If (m_udtKinmuDept(w_lngLoop).strDeptCD).Equals(General.g_strSelKinmuDeptCD) Then
                    w_SelKinmuDeptFlg = True
                End If
                If (m_udtKinmuDept(w_lngLoop).strDeptCD).Equals(General.g_strUserKinmuDeptCD) Then
                    w_UserKinmuDeptFlg = True
                End If
            Next w_lngLoop

            If w_SelKinmuDeptFlg = False Then
                If w_UserKinmuDeptFlg Then
                    General.g_strSelKinmuDeptCD = General.g_strUserKinmuDeptCD
                ElseIf UBound(m_udtKinmuDept) > 0 Then
                    General.g_strSelKinmuDeptCD = m_udtKinmuDept(1).strDeptCD
                End If
            End If

            m_lngDefDeptIdx = 0

            'ドロップダウンの初期設定
            vstKinmuDept.Visible = True
            vstKinmuDept.Size = New System.Drawing.Size(247, 640 - m_numTaskBarHeight)
            vstKinmuDept.Location = New Point(100, 334)

            With tvwKinmuDept
                If m_bolCarenderFlg = False OrElse (m_bolCarenderFlg = True AndAlso m_OldPlanNo <> w_lngPlan OrElse w_lngPlan = 0) Then
                    'TreeViewの初期設定
                    .Nodes.Clear()
                    .Visible = True
                    .Scrollable = True
                    .Font = New System.Drawing.Font("ＭＳ ゴシック", 11.25F)
                    .Size = New Size(245, 642)

                    '施設名
                    w_Node = .Nodes.Add(M_NodeKey_HOSP, General.g_strHospitalNm)
                    w_Node.Expand()
                    m_StarMark = General.paGetItemValue(General.G_STRMAINKEY2, General.G_STRSUBKEY1, "DISPMIKAKUTEIKIGO", "", General.g_strHospitalCD)
                    For w_lngLoop = 1 To UBound(m_udtKinmuDept)

                        AidGeneral.paGetKinmuDeptTvw_Part1(tvwKinmuDept, m_udtKinmuDept, w_lngLoop, w_lngLvl1Idx, w_lngLvl2Idx, w_lngLvl3Idx, w_lngLvl4Idx, w_lngLvl5Idx, w_preClassLvlCD1, w_preClassLvlCD2, w_preClassLvlCD3, w_preClassLvlCD4, w_preClassLvlCD5)

                        w_strMark = ""

                        If (M_DEPT_RESCD).Equals(g_MenuM(g_lngGroupIdx).ListBarMenu(g_lngListIdx).strResCD) OrElse (M_OVERKINMU_RESCD).Equals(g_MenuM(g_lngGroupIdx).ListBarMenu(g_lngListIdx).strResCD) Then
                            If SearchDeptKakuteiData(w_lngPlan, m_udtKinmuDept(w_lngLoop).strDeptCD, General.g_strHospitalCD) = False Then
                                w_strMark = m_StarMark
                            End If
                        End If

                        AidGeneral.paGetKinmuDeptTvw_Part2(tvwKinmuDept, m_udtKinmuDept, w_lngLoop, w_lngLvl1Idx, w_lngLvl2Idx, w_lngLvl3Idx, w_lngLvl4Idx, w_lngLvl5Idx, w_preClassLvlCD1, w_preClassLvlCD2, w_preClassLvlCD3, w_preClassLvlCD4, w_preClassLvlCD5, False, "", w_strMark)

                        If (M_STAFFIDO_RESCD).Equals(g_MenuM(g_lngGroupIdx).ListBarMenu(g_lngListIdx).strResCD) Then
                            '退職者・未確定への対応
                            If (M_strNoConfCD).Equals(m_udtKinmuDept(w_lngLoop).strDeptCD) Then
                                '階層レベル１追加
                                .Nodes.Find(M_NodeKey_HOSP, True)(0).Nodes.Add(m_udtKinmuDept(w_lngLoop).strDeptCD, M_strNoConfName)
                            End If
                            If (M_strRetireCD).Equals(m_udtKinmuDept(w_lngLoop).strDeptCD) Then
                                '階層レベル１追加
                                .Nodes.Find(M_NodeKey_HOSP, True)(0).Nodes.Add(m_udtKinmuDept(w_lngLoop).strDeptCD, M_strRetireName)
                            End If
                            '検索への対応
                            If w_lngLoop = UBound(m_udtKinmuDept) Then
                                '階層レベル１追加
                                .Nodes.Find(M_NodeKey_HOSP, True)(0).Nodes.Add(M_strSearchCD, M_strSearchName)
                            End If
                        End If

                        '選択部署が取得されていない場合
                        If String.IsNullOrEmpty(General.g_strSelKinmuDeptCD) Then
                            '初回は自部署を選択
                            If (m_udtKinmuDept(w_lngLoop).strDeptCD).Equals(General.g_strUserKinmuDeptCD) Then
                                If String.IsNullOrEmpty(m_udtKinmuDept(w_lngLoop).strClassLvlCD(1)) = False Then .Nodes.Find(M_NodeKey_HOSP & Convert.ToString(w_lngLvl1Idx), True)(0).Expand()
                                If String.IsNullOrEmpty(m_udtKinmuDept(w_lngLoop).strClassLvlCD(2)) = False Then .Nodes.Find(M_NodeKey_LVL2 & Convert.ToString(w_lngLvl2Idx), True)(0).Expand()
                                If String.IsNullOrEmpty(m_udtKinmuDept(w_lngLoop).strClassLvlCD(3)) = False Then .Nodes.Find(M_NodeKey_LVL3 & Convert.ToString(w_lngLvl3Idx), True)(0).Expand()
                                If String.IsNullOrEmpty(m_udtKinmuDept(w_lngLoop).strClassLvlCD(4)) = False Then .Nodes.Find(M_NodeKey_LVL4 & Convert.ToString(w_lngLvl4Idx), True)(0).Expand()
                                If String.IsNullOrEmpty(m_udtKinmuDept(w_lngLoop).strClassLvlCD(5)) = False Then .Nodes.Find(M_NodeKey_LVL5 & Convert.ToString(w_lngLvl5Idx), True)(0).Expand()

                                If m_strSelChildMenu = M_STAFFIDO_RESCD Then
                                    If (M_strNoConfCD).Equals(General.g_strSelKinmuDeptCD) Then
                                        '未確定だったら
                                        .Nodes.Find(M_strNoConfCD, True)(0).Checked = True
                                        .SelectedNode = .Nodes.Find(M_strNoConfCD, True)(0)
                                        w_NodeSelectedFlg = True
                                    ElseIf (M_strRetireCD).Equals(General.g_strSelKinmuDeptCD) Then
                                        '退職者だったら
                                        .Nodes.Find(M_strRetireCD, True)(0).Checked = True
                                        .SelectedNode = .Nodes.Find(M_strRetireCD, True)(0)
                                        w_NodeSelectedFlg = True
                                    ElseIf (M_strSearchCD).Equals(General.g_strSelKinmuDeptCD) Then
                                        '検索だったら
                                        .Nodes.Find(M_strSearchCD, True)(0).Checked = True
                                        .SelectedNode = .Nodes.Find(M_strSearchCD, True)(0)
                                        w_NodeSelectedFlg = True
                                        'それ以外だったら
                                    Else
                                        .Nodes.Find(M_NodeKey_DEPT & Convert.ToString(w_lngLoop), True)(0).Checked = True
                                        .SelectedNode = .Nodes.Find(M_NodeKey_DEPT & Convert.ToString(w_lngLoop), True)(0)
                                        w_NodeSelectedFlg = True
                                    End If

                                End If
                                'デフォルトインデックス
                                m_lngDefDeptIdx = w_lngLoop
                            End If
                        Else
                            '前回選択部署の場合、OPENにする
                            If m_udtKinmuDept(w_lngLoop).strDeptCD = General.g_strSelKinmuDeptCD Then
                                If String.IsNullOrEmpty(m_udtKinmuDept(w_lngLoop).strClassLvlCD(1)) = False Then .Nodes.Find(M_NodeKey_HOSP & Convert.ToString(w_lngLvl1Idx), True)(0).Expand()
                                If String.IsNullOrEmpty(m_udtKinmuDept(w_lngLoop).strClassLvlCD(2)) = False Then .Nodes.Find(M_NodeKey_LVL2 & Convert.ToString(w_lngLvl2Idx), True)(0).Expand()
                                If String.IsNullOrEmpty(m_udtKinmuDept(w_lngLoop).strClassLvlCD(3)) = False Then .Nodes.Find(M_NodeKey_LVL3 & Convert.ToString(w_lngLvl3Idx), True)(0).Expand()
                                If String.IsNullOrEmpty(m_udtKinmuDept(w_lngLoop).strClassLvlCD(4)) = False Then .Nodes.Find(M_NodeKey_LVL4 & Convert.ToString(w_lngLvl4Idx), True)(0).Expand()
                                If String.IsNullOrEmpty(m_udtKinmuDept(w_lngLoop).strClassLvlCD(5)) = False Then .Nodes.Find(M_NodeKey_LVL5 & Convert.ToString(w_lngLvl5Idx), True)(0).Expand()

                                If (M_strNoConfCD).Equals(General.g_strSelKinmuDeptCD) Then
                                    '未確定だったら
                                    .Nodes.Find(M_strNoConfCD, True)(0).Checked = True
                                    .SelectedNode = .Nodes.Find(M_strNoConfCD, True)(0)
                                    w_NodeSelectedFlg = True
                                ElseIf (M_strRetireCD).Equals(General.g_strSelKinmuDeptCD) Then
                                    '退職者だったら
                                    .Nodes.Find(M_strRetireCD, True)(0).Checked = True
                                    .SelectedNode = .Nodes.Find(M_strRetireCD, True)(0)
                                    w_NodeSelectedFlg = True
                                ElseIf (M_strSearchCD).Equals(General.g_strSelKinmuDeptCD) Then
                                    '検索だったら
                                    .Nodes.Find(M_strSearchCD, True)(0).Checked = True
                                    .SelectedNode = .Nodes.Find(M_strSearchCD, True)(0)
                                    w_NodeSelectedFlg = True
                                Else
                                    .Nodes.Find(M_NodeKey_DEPT & Convert.ToString(w_lngLoop), True)(0).Checked = True
                                    .SelectedNode = .Nodes.Find(M_NodeKey_DEPT & Convert.ToString(w_lngLoop), True)(0)
                                    w_NodeSelectedFlg = True
                                End If
                                'デフォルトインデックス
                                m_lngDefDeptIdx = w_lngLoop
                            End If
                        End If
                    Next w_lngLoop
                Else
                    For w_lngLoop = 1 To UBound(m_udtKinmuDept)
                        If String.IsNullOrEmpty(General.g_strSelKinmuDeptCD) Then
                            If (m_udtKinmuDept(w_lngLoop).strDeptCD).Equals(General.g_strUserKinmuDeptCD) Then
                                m_lngDefDeptIdx = w_lngLoop
                            End If
                        Else
                            If (m_udtKinmuDept(w_lngLoop).strDeptCD).Equals(General.g_strSelKinmuDeptCD) Then
                                m_lngDefDeptIdx = w_lngLoop
                            End If
                        End If
                    Next w_lngLoop
                End If
                m_OldPlanNo = w_lngPlan
                'Nodeクリックイベントを発生させる
                If m_lngDefDeptIdx <> 0 Then

                    'SelectedNodeプロパティで値がセットされた場合、クリック処理が走っているので下記IF文内を通らない
                    If w_NodeSelectedFlg = False Then

                        If (M_strNoConfCD).Equals(General.g_strSelKinmuDeptCD) Then
                            '未確定だったら
                            Call tvwKinmuDept_NodeClick(tvwKinmuDept, New System.Windows.Forms.TreeViewEventArgs(.Nodes.Find(M_NodeKey_HOSP, True)(0)))
                        ElseIf (M_strRetireCD).Equals(General.g_strSelKinmuDeptCD) Then
                            '退職者だったら
                            Call tvwKinmuDept_NodeClick(tvwKinmuDept, New System.Windows.Forms.TreeViewEventArgs(.Nodes.Find(M_NodeKey_HOSP, True)(0)))
                        ElseIf (M_strSearchCD).Equals(General.g_strSelKinmuDeptCD) Then
                            '検索だったら
                            Call tvwKinmuDept_NodeClick(tvwKinmuDept, New System.Windows.Forms.TreeViewEventArgs(.Nodes.Find(M_NodeKey_HOSP, True)(0)))
                        Else
                            'それ以外だったら
                            Call tvwKinmuDept_NodeClick(tvwKinmuDept, New System.Windows.Forms.TreeViewEventArgs(.Nodes.Find(M_NodeKey_DEPT & Convert.ToString(m_lngDefDeptIdx), True)(0)))
                        End If
                    End If
                Else
                    General.g_strSelKinmuDeptCD = ""
                    General.g_strSelKinmuDeptNm = ""
                End If
            End With

        Catch ex As Exception
            Call General.paTrpMsg(Convert.ToString(Err.Number), W_SUBNAME)
        End Try
    End Sub

    '==============================
    '【未承認業務】- 未承認一覧 取得
    '==============================
    Private Sub sGetNoApprove()
        Const W_SUBNAME As String = "NSC0000HA sGetNoApprove"

        Try
            Dim w_lngLoop As Integer
            Dim w_lngRecCnt As Integer
            Dim w_lngIdx As Integer
            Dim w_str As String

            Dim w_strSelectIdx As String
            Dim w_strSelectCD As String
            Const W_strGroupALL As String = "000000"
            Const W_strListALL As String = "0000"

            Dim w_lngFrom As Integer
            Dim w_lngTo As Integer

            w_lngFrom = General.paGetDateIntegerFromDate(imdAppliFrom.Text)
            w_lngTo = General.paGetDateIntegerFromDate(imdAppliTo.Text)

            '基準日
            w_lngLoop = General.paGetDateIntegerFromDate(m_CalDate)

            w_strSelectIdx = cmbSelectAppl.SelectedIndex
            w_strSelectCD = g_ApplMaster(Integer.Parse(w_strSelectIdx)).strCD

            '配列初期化
            ReDim m_udtApproveData(0)

            '未承認一覧取得
            With General.g_objSyouninData

                '承認者職員管理番号
                .pApproveStaffMngID = General.g_strUserMngID
                If (M_APPRO_DSP).Equals(m_strSelChildMenu) Then
                    .mNA_GetKbn = "1" '未承認一覧
                Else
                    .mNA_GetKbn = "2" '全件表示
                End If

                .mNA_DateKbn = 1 '取得区分(取得期間)
                .mNA_DateFrom = w_lngFrom '年月日FROM
                .mNA_DateTo = w_lngTo '年月日TO
                .mNA_KikanKbn = 1

                If .mGetNotApproveList = False Then

                Else
                    '届出件数
                    w_lngRecCnt = .fNA_Count

                    For w_lngLoop = 1 To w_lngRecCnt
                        '索引
                        .mNA_Idx = w_lngLoop

                        If ((W_strGroupALL).Equals(w_strSelectCD) OrElse (.fNA_AppliCD).Equals(w_strSelectCD)) _
                            AndAlso ((W_strListALL).Equals(m_strSelBusyoCD) OrElse m_strSelBusyoCD.Equals(.fNA_ApproveKinmuDeptCD)) Then

                            w_lngIdx = UBound(m_udtApproveData) + 1
                            ReDim Preserve m_udtApproveData(w_lngIdx)

                            '●UNIQUESEQNO
                            m_udtApproveData(w_lngIdx).strUNIQUESEQNO = .fNA_UNIQUESEQNO
                            '●届出コード
                            m_udtApproveData(w_lngIdx).strAppliCD = .fNA_AppliCD
                            '●届出名称
                            m_udtApproveData(w_lngIdx).strAppliNm = .fNA_AppliName
                            '●申請者職員管理番号
                            m_udtApproveData(w_lngIdx).strAppliStaffMngID = .fNA_AppliStaffMngID
                            '●申請者職員番号
                            m_udtApproveData(w_lngIdx).strAppliStaffID = .fNA_AppliStaffID
                            '●申請者氏名
                            m_udtApproveData(w_lngIdx).strAppliStaffName = .fNA_AppliStaffName
                            '●申請年月日
                            m_udtApproveData(w_lngIdx).lngAppliDate = .fNA_AppliDate
                            '●期間開始年月日
                            m_udtApproveData(w_lngIdx).lngPeriodFromDate = .fNA_PeriodFromDate
                            '●期間終了年月日
                            m_udtApproveData(w_lngIdx).lngPeriodToDate = .fNA_PeriodToDate
                            '●開始時間
                            m_udtApproveData(w_lngIdx).lngFromTime = .fNA_FromTime
                            '●終了時間
                            m_udtApproveData(w_lngIdx).lngToTime = .fNA_ToTime
                            '●翌日フラグ
                            m_udtApproveData(w_lngIdx).strNextDayFlg = .fNA_NextDayFlg
                            '●内容
                            m_udtApproveData(w_lngIdx).strContents = .fNA_Contents
                            '●理由
                            m_udtApproveData(w_lngIdx).strReasonNote = .fNA_ReasonNote
                            '●申請者承認状態区分
                            m_udtApproveData(w_lngIdx).strAppliApproveStatusKbn = .fNA_AppliApproveStatusKbn
                            '●申請者承認状態表示
                            m_udtApproveData(w_lngIdx).strAppliApproveStatusDisp = .fNA_AppliApproveStatusDisp
                            '●コメント
                            m_udtApproveData(w_lngIdx).strComment = .fNA_Comment
                            '●汎用エリア
                            m_udtApproveData(w_lngIdx).strHanyouArea = .fNA_HanyouArea
                            '●破棄年月日
                            m_udtApproveData(w_lngIdx).dblCancelDate = .fNA_CancelDate
                            '●最終更新年月日
                            m_udtApproveData(w_lngIdx).dblLastUpdTimeDate = .fNA_LastUpdTimeDate
                            '●画面制御区分
                            m_udtApproveData(w_lngIdx).strScreenCtrlKbn = .fNA_ScreenCtrlKbn
                            '●承認階層レベル
                            m_udtApproveData(w_lngIdx).lngApproveClassLvl = .fNA_ApproveClassLevel
                            '●承認者職員管理番号
                            m_udtApproveData(w_lngIdx).strApproveStaffMngID = .fNA_ApproveStaffMngID
                            '●承認者職員番号
                            m_udtApproveData(w_lngIdx).strApproveStaffID = .fNA_ApproveStaffID
                            '●承認者氏名
                            m_udtApproveData(w_lngIdx).strApproveStaffNm = .fNA_ApproveStaffName
                            '●承認状態区分(レベル別)
                            m_udtApproveData(w_lngIdx).strApproveStatusKbn = .fNA_ApproveStatusKbn
                            '●承認状態表示(レベル別)
                            m_udtApproveData(w_lngIdx).strApproveStatusDisp = .fNA_ApproveStatusDisp
                            '●申請者勤務部署コード
                            m_udtApproveData(w_lngIdx).strKinmuDeptCD = .fNA_ApproveKinmuDeptCD

                            '★時間外の場合は、超勤Fの最終更新年月日を取得しておく(排他制御)
                            General.g_objWorkBaseInfo.p職員番号 = .fNA_AppliStaffMngID
                            General.g_objWorkBaseInfo.p開始年月日 = General.paGetDateIntegerFromDate(m_CalDate)

                            If General.g_objWorkBaseInfo.mGetOKAppliRuikei Then
                                m_udtApproveData(w_lngIdx).AprYetTimeTotal = General.g_objWorkBaseInfo.f申請時間
                                m_udtApproveData(w_lngIdx).AprOverTimeTotal = General.g_objWorkBaseInfo.f確定時間
                            Else
                                m_udtApproveData(w_lngIdx).AprYetTimeTotal = 0
                                m_udtApproveData(w_lngIdx).AprOverTimeTotal = 0
                            End If
                        End If

                    Next w_lngLoop
                End If
            End With

            '全て選択 & 全て解除ボタン表示
            If m_strSelChildMenu = M_APPRO_DSP Then
                '未承認画面
                cmdAllCheck.Visible = True
                cmdAllClear.Visible = True
                w_str = "未承認一覧"
            Else
                '全件表示
                cmdAllCheck.Visible = False
                cmdAllClear.Visible = False
                w_str = "全表示"
            End If


            'lblItem_0.Top = 180
            'lblKinmuti.Top = 120
            'cmdKinmuti.Top = 150
            'lblItem_0.Left = 3960
            'lblKinmuti.Left = 4920
            'cmdKinmuti.Left = 7410


            lblItem_1.Visible = True
            cmbSelectAppl.Visible = True
            imdAppliFrom.Visible = True
            'cmdApproveInfoCalFrom.Visible = True
            Label3.Visible = True
            imdAppliTo.Visible = True
            'cmdApproveInfoCalTo.Visible = True
            cmdChgDate_0.Visible = False
            cmdSelDate.Visible = False
            cmdChgDate_1.Visible = False

            lblSearchData.Text = Format(m_CalDate, "yyyy年MM月dd日") & "(" & General.paGetWeekName(m_CalDate) & ")" & Space(2) & w_str
            lblSearchData.ForeColor = System.Drawing.Color.Blue
            'lblSearchData.Font = New Font("ＭＳ ゴシック", 11.25F, FontStyle.Bold)

        Catch ex As Exception
            Call General.paTrpMsg(Convert.ToString(Err.Number), W_SUBNAME)
        End Try
    End Sub

    '================================
    '【日当直業務】 日当直者 取得
    '================================
    Private Sub sGetDutyData()
        Const W_SUBNAME As String = "NSC0000HA sGetDutyData"

        Try
            Dim w_lngDate As Integer
            Dim w_lngRecCnt As Integer
            Dim w_lngLoop As Integer
            Dim w_strSql As String
            Dim w_Rs As ADODB.Recordset
            Dim w_udtWork() As DayDuty_Type
            Dim w_lngIdx As Integer
            Dim w_lngDayCnt As Integer

            Dim w_StaffMngID As String
            Dim w_strKinmuCD() As String
            Dim w_strKinmuNm() As String
            Dim w_strGroupCD() As String
            Dim w_strGroupNm() As String

            Dim w_StaffData() As Staff_Type
            Dim w_BaseDataFlg As Boolean

            Dim w_lngTime As Integer
            Dim w_strStaffMngID_BK As String
            Dim w_strSelectGroupIdx As String
            Dim w_strSelectGroupCD As String
            Const W_strGroupALL As String = "00"

            Dim w_StaffMngID_F As ADODB.Field

            '基準日
            w_lngDate = General.paGetDateIntegerFromDate(m_CalDate)

            w_strSelectGroupIdx = Convert.ToString(m_lngSelectDutyIdx)
            w_strSelectGroupCD = g_DutyMaster(Integer.Parse(w_strSelectGroupIdx)).strCD

            '日当直者配列 初期化
            ReDim m_udtDayDutyStaff(0)
            ReDim w_udtWork(0)

            '------------------------------------
            '日当直実績より対象日の職員を取得
            '------------------------------------
            w_strSql = "SELECT STAFFMNGID FROM NS_DUTY_F"
            w_strSql = w_strSql & " WHERE HOSPITALCD = '" & General.g_strHospitalCD & "'"
            'すべてが選択されている場合
            If (W_strGroupALL).Equals(w_strSelectGroupCD) Then
                'SQL追加なし
                'すべて以外が選択されている場合
            Else
                w_strSql = w_strSql & " AND DUTYGROUPCD = '" & w_strSelectGroupCD & "' "
            End If
            w_strSql = w_strSql & " AND DATEF = " & w_lngDate
            w_strSql = w_strSql & " ORDER BY STAFFMNGID "
            'RecordSet ｵﾌﾞｼﾞｪｸﾄの作成
            w_Rs = General.paDBRecordSetOpen(w_strSql)

            If w_Rs.RecordCount <= 0 Then

            Else
                With w_Rs
                    .MoveLast()
                    w_lngRecCnt = .RecordCount
                    .MoveFirst()

                    w_StaffMngID_F = .Fields("STAFFMNGID")

                    w_strStaffMngID_BK = ""

                    For w_lngLoop = 1 To w_lngRecCnt
                        '職員管理番号取得
                        w_StaffMngID = w_StaffMngID_F.Value & ""
                        w_BaseDataFlg = False

                        '職員管理番号が同じ場合は処理しない
                        If w_StaffMngID.Equals(w_strStaffMngID_BK) = False Then

                            '日当直実績取得(部品より)
                            If fncDayDuty(w_lngDate, w_StaffMngID, w_strKinmuCD, w_strKinmuNm, w_strGroupCD, w_strGroupNm, w_strSelectGroupCD) = False Then

                            Else
                                '１日に２件日当直がある場合も別配列に格納
                                For w_lngDayCnt = 1 To UBound(w_strKinmuCD)
                                    w_lngIdx = UBound(w_udtWork) + 1
                                    ReDim Preserve w_udtWork(w_lngIdx)

                                    If w_BaseDataFlg = False Then
                                        '氏名/PHS情報などを取得する
                                        If fncPersonalData(w_StaffMngID, w_lngDate, w_lngDate, w_StaffData) = False Then

                                        Else
                                            '基本情報取得済み
                                            w_BaseDataFlg = True
                                        End If
                                    End If

                                    '●職員管理番号
                                    w_udtWork(w_lngIdx).strStaffMngID = w_StaffMngID
                                    '●勤務コード
                                    w_udtWork(w_lngIdx).strKinmuCD = w_strKinmuCD(w_lngDayCnt)
                                    '●勤務名称
                                    w_udtWork(w_lngIdx).strKinmuNm = w_strKinmuNm(w_lngDayCnt)
                                    '●グループコード
                                    w_udtWork(w_lngIdx).strGroupCD = w_strGroupCD(w_lngDayCnt)
                                    '●グループ名称
                                    w_udtWork(w_lngIdx).strGroupNm = w_strGroupNm(w_lngDayCnt)

                                    If w_BaseDataFlg = True Then
                                        '●職員番号
                                        w_udtWork(w_lngIdx).strStaffID = w_StaffData(1).strStaffID
                                        '●氏名
                                        w_udtWork(w_lngIdx).strName = w_StaffData(1).strName
                                        '●性別
                                        w_udtWork(w_lngIdx).strSex = w_StaffData(1).strSex
                                        '●PHS
                                        w_udtWork(w_lngIdx).strPHS = w_StaffData(1).strPHS

                                    End If

                                Next w_lngDayCnt
                            End If

                        End If

                        '職員管理番号退避
                        w_strStaffMngID_BK = w_StaffMngID

                        .MoveNext()
                    Next w_lngLoop
                End With
            End If

            w_lngTime = Integer.Parse(Format(Now, "HHmm"))

            'そのまま出力用配列に格納する
            ReDim m_udtDayDutyStaff(UBound(w_udtWork))
            For w_lngLoop = 1 To UBound(w_udtWork)
                m_udtDayDutyStaff(w_lngLoop) = w_udtWork(w_lngLoop)

                '●出退勤 取得
                Call fncDutyDakoku(w_lngDate, w_lngTime, w_lngLoop)

            Next w_lngLoop

            '日付
            lblSearchData.Text = Format(m_CalDate, "yyyy年MM月dd日") & "(" & General.paGetWeekName(m_CalDate) & ")" & "　日当直者"
            lblSearchData.ForeColor = System.Drawing.Color.Blue
            'lblSearchData.Font = New Font("ＭＳ ゴシック", 11.25F, FontStyle.Bold)

            '解放
            w_Rs = Nothing

        Catch ex As Exception
            Call General.paTrpMsg(Convert.ToString(Err.Number), W_SUBNAME)
        End Try
    End Sub

    '---------------------------------------------------------
    '勤務部署 取得(権限範囲)
    '引数・・・　p_AuthRangeKbn(権限範囲区分)
    '---------------------------------------------------------
    Private Sub sGetKinmuDept_Kanri(ByVal p_AuthRangeKbn As String)
        Const W_SUBNAME As String = "NSC0000HA sGetKinmuDept_Kanri"

        Try
            Dim w_lngRecCnt As Integer
            Dim w_lngLoop As Integer
            Dim w_lngIdx As Integer

            '初期化
            ReDim m_udtKinmuDept(0)

            '==================================
            '勤務部署 取得(権限範囲)
            '==================================
            With General.g_objSecurity
                .pSAIKEIUSEFLG = "1"

                If .mGetAuthKinmuDept(p_AuthRangeKbn) = False Then

                Else
                    '●勤務部署件数
                    w_lngRecCnt = .fAK_KinmuDeptCount

                    For w_lngLoop = 1 To w_lngRecCnt
                        '索引
                        .mAK_KinmuDeptIdx = w_lngLoop

                        w_lngIdx = UBound(m_udtKinmuDept) + 1

                        ReDim Preserve m_udtKinmuDept(w_lngIdx)
                        m_udtKinmuDept(w_lngIdx) = New DATABEAN.KinmuDept_Type

                        '●勤務部署区分
                        m_udtKinmuDept(w_lngIdx).strDeptKbn = .fAK_DataKbn
                        '●勤務部署コード
                        m_udtKinmuDept(w_lngIdx).strDeptCD = .fAK_KinmuDeptCD
                        '●勤務部署名称
                        m_udtKinmuDept(w_lngIdx).strDeptName = .fAK_KinmuDeptName
                        '●勤務部署略称
                        m_udtKinmuDept(w_lngIdx).strDeptSecNm = .fAK_SecName
                        '●勤務部署略称２
                        m_udtKinmuDept(w_lngIdx).strDeptSecNm2 = .fAK_SecName2
                        '●表示NO
                        m_udtKinmuDept(w_lngIdx).lngDispNo = .fAK_DispNo
                        '●階層レベル１コード
                        m_udtKinmuDept(w_lngIdx).strClassLvlCD(1) = .fAK_KinmuLevelCD1
                        '●階層レベル１名称
                        m_udtKinmuDept(w_lngIdx).strClassLvlNM(1) = .fAK_KinmuLevelName1
                        '●階層レベル２コード
                        m_udtKinmuDept(w_lngIdx).strClassLvlCD(2) = .fAK_KinmuLevelCD2
                        '●階層レベル２名称
                        m_udtKinmuDept(w_lngIdx).strClassLvlNM(2) = .fAK_KinmuLevelName2
                        '●階層レベル３コード
                        m_udtKinmuDept(w_lngIdx).strClassLvlCD(3) = .fAK_KinmuLevelCD3
                        '●階層レベル３名称
                        m_udtKinmuDept(w_lngIdx).strClassLvlNM(3) = .fAK_KinmuLevelName3
                        '●階層レベル４コード
                        m_udtKinmuDept(w_lngIdx).strClassLvlCD(4) = .fAK_KinmuLevelCD4
                        '●階層レベル４名称
                        m_udtKinmuDept(w_lngIdx).strClassLvlNM(4) = .fAK_KinmuLevelName4
                        '●階層レベル５コード
                        m_udtKinmuDept(w_lngIdx).strClassLvlCD(5) = .fAK_KinmuLevelCD5
                        '●階層レベル５名称
                        m_udtKinmuDept(w_lngIdx).strClassLvlNM(5) = .fAK_KinmuLevelName5
                        '●夜間看護加算フラグ
                        m_udtKinmuDept(w_lngIdx).strNightKangoAddFlg = .fAK_NightKangoAddFlg
                        '●計画作成対象フラグ
                        m_udtKinmuDept(w_lngIdx).strPlanMakeFlg = .fAK_PlanMakeFlg
                        '●チーム数
                        m_udtKinmuDept(w_lngIdx).lngTeamCnt = .fAK_TeamCount
                        '●分割フラグ
                        m_udtKinmuDept(w_lngIdx).strDivisionFlg = .fAK_DivisionFlg
                        '●定員数
                        m_udtKinmuDept(w_lngIdx).lngCapaCount = .fAK_CapaCount
                        '●汎用エリア
                        m_udtKinmuDept(w_lngIdx).strHanyoArea = .fAK_HanyoArea
                        '●汎用エリア２
                        m_udtKinmuDept(w_lngIdx).strHanyoArea2 = .fAK_HanyoArea2
                        '●再掲フラグ
                        m_udtKinmuDept(w_lngIdx).strSaikeiFlg = .fAK_SaikeiFlg

                    Next w_lngLoop
                End If
            End With

        Catch ex As Exception
            Call General.paTrpMsg(Convert.ToString(Err.Number), W_SUBNAME)
        End Try
    End Sub

    Private Sub sGetMasterInfo(ByVal p_intTab As Integer)
        Const W_SUBNAME As String = "NSC0000HA sGetMasterInfo"

        Try
            Dim w_lngRecCnt As Integer
            Dim w_lngLoop As Integer
            Dim w_lngIdx As Integer
            Dim w_WorkTbl As DATABEAN.KinmuDept_Type
            Dim w_Int As Integer
            Dim w_Int2 As Integer
            Dim w_lngKugiri() As Integer
            Dim w_Int3 As Integer

            Dim w_WarddeptFlg As String '勤務＝配属フラグ（"1"：勤務＝配属、"0"：勤務≠配属)
            w_WarddeptFlg = General.paGetItemValue(General.G_STRMAINKEY1, General.G_STRSECTION1, "WORDDEPTFLG", "0", General.g_strHospitalCD)

            If "0".Equals(w_WarddeptFlg) Then

                Select Case p_intTab
                    '配属
                    Case 1
                        ReDim m_udtWardDept(0)

                        With General.g_objGetMaster
                            .pWD_WardDeptCD = ""
                            .pWD_KijunDate = General.paGetDateIntegerFromDate(Now)

                            If .mGetWardDept = False Then

                            Else
                                w_lngRecCnt = .fWD_wardDeptCount

                                For w_lngLoop = 1 To w_lngRecCnt
                                    '索引
                                    .mWD_WardDeptIdx = w_lngLoop

                                    w_lngIdx = UBound(m_udtWardDept) + 1

                                    ReDim Preserve m_udtWardDept(w_lngIdx)
                                    m_udtWardDept(w_lngIdx) = New DATABEAN.KinmuDept_Type

                                    '●勤務部署区分
                                    m_udtWardDept(w_lngIdx).strDeptKbn = "1"
                                    '●配属部署コード
                                    m_udtWardDept(w_lngIdx).strDeptCD = .fWD_wardDeptCD
                                    '●配属部署名称
                                    m_udtWardDept(w_lngIdx).strDeptName = .fWD_wardDeptName
                                    '●配属部署略称
                                    m_udtWardDept(w_lngIdx).strDeptSecNm = .fWD_SecName
                                    '●配属部署略称２
                                    m_udtWardDept(w_lngIdx).strDeptSecNm2 = .fWD_SecName2
                                    '●表示NO
                                    m_udtWardDept(w_lngIdx).lngDispNo = .fWD_DispNo
                                    '●階層レベル１コード
                                    m_udtWardDept(w_lngIdx).strClassLvlCD(1) = .fWD_ClassLevelCD1
                                    '●階層レベル１名称
                                    m_udtWardDept(w_lngIdx).strClassLvlNM(1) = .fWD_ClassLevelName1
                                    '●階層レベル２コード
                                    m_udtWardDept(w_lngIdx).strClassLvlCD(2) = .fWD_ClassLevelCD2
                                    '●階層レベル２名称
                                    m_udtWardDept(w_lngIdx).strClassLvlNM(2) = .fWD_ClassLevelName2
                                    '●階層レベル３コード
                                    m_udtWardDept(w_lngIdx).strClassLvlCD(3) = .fWD_ClassLevelCD3
                                    '●階層レベル３名称
                                    m_udtWardDept(w_lngIdx).strClassLvlNM(3) = .fWD_ClassLevelName3
                                    '●階層レベル４コード
                                    m_udtWardDept(w_lngIdx).strClassLvlCD(4) = .fWD_ClassLevelCD4
                                    '●階層レベル４名称
                                    m_udtWardDept(w_lngIdx).strClassLvlNM(4) = .fWD_ClassLevelName4
                                    '●階層レベル５コード
                                    m_udtWardDept(w_lngIdx).strClassLvlCD(5) = .fWD_ClassLevelCD5
                                    '●階層レベル５名称
                                    m_udtWardDept(w_lngIdx).strClassLvlNM(5) = .fWD_ClassLevelName5
                                    '●汎用エリア
                                    m_udtWardDept(w_lngIdx).strHanyoArea = .fWD_HanyouArea
                                    '●汎用エリア２
                                    m_udtWardDept(w_lngIdx).strHanyoArea2 = .fWD_HanyouArea2
                                    m_udtWardDept(w_lngIdx).lngCalssLvlNo(1) = .fWD_ClassLevelDisp1
                                    m_udtWardDept(w_lngIdx).lngCalssLvlNo(2) = .fWD_ClassLevelDisp2
                                    m_udtWardDept(w_lngIdx).lngCalssLvlNo(3) = .fWD_ClassLevelDisp3
                                    m_udtWardDept(w_lngIdx).lngCalssLvlNo(4) = .fWD_ClassLevelDisp4
                                    m_udtWardDept(w_lngIdx).lngCalssLvlNo(5) = .fWD_ClassLevelDisp5
                                Next w_lngLoop

                                '配属部署マスタを、階層レベルの表示順に並べ替え
                                For w_Int = 1 To UBound(m_udtWardDept)
                                    For w_Int2 = 1 To UBound(m_udtWardDept) - w_Int
                                        '並び替え 実行 ?
                                        If (m_udtWardDept(w_Int).lngCalssLvlNo(1) > m_udtWardDept(w_Int + w_Int2).lngCalssLvlNo(1)) Then
                                            w_WorkTbl = m_udtWardDept(w_Int)
                                            m_udtWardDept(w_Int) = m_udtWardDept(w_Int + w_Int2)
                                            m_udtWardDept(w_Int + w_Int2) = w_WorkTbl

                                        ElseIf (m_udtWardDept(w_Int).lngCalssLvlNo(1) = m_udtWardDept(w_Int + w_Int2).lngCalssLvlNo(1)) AndAlso (m_udtWardDept(w_Int).lngCalssLvlNo(2) > m_udtWardDept(w_Int + w_Int2).lngCalssLvlNo(2)) Then
                                            w_WorkTbl = m_udtWardDept(w_Int)
                                            m_udtWardDept(w_Int) = m_udtWardDept(w_Int + w_Int2)
                                            m_udtWardDept(w_Int + w_Int2) = w_WorkTbl

                                        ElseIf (m_udtWardDept(w_Int).lngCalssLvlNo(1) = m_udtWardDept(w_Int + w_Int2).lngCalssLvlNo(1)) AndAlso (m_udtWardDept(w_Int).lngCalssLvlNo(2) = m_udtWardDept(w_Int + w_Int2).lngCalssLvlNo(2)) AndAlso (m_udtWardDept(w_Int).lngCalssLvlNo(3) > m_udtWardDept(w_Int + w_Int2).lngCalssLvlNo(3)) Then
                                            w_WorkTbl = m_udtWardDept(w_Int)
                                            m_udtWardDept(w_Int) = m_udtWardDept(w_Int + w_Int2)
                                            m_udtWardDept(w_Int + w_Int2) = w_WorkTbl

                                        ElseIf (m_udtWardDept(w_Int).lngCalssLvlNo(1) = m_udtWardDept(w_Int + w_Int2).lngCalssLvlNo(1)) AndAlso (m_udtWardDept(w_Int).lngCalssLvlNo(2) = m_udtWardDept(w_Int + w_Int2).lngCalssLvlNo(2)) AndAlso (m_udtWardDept(w_Int).lngCalssLvlNo(3) = m_udtWardDept(w_Int + w_Int2).lngCalssLvlNo(3)) AndAlso (m_udtWardDept(w_Int).lngCalssLvlNo(4) > m_udtWardDept(w_Int + w_Int2).lngCalssLvlNo(4)) Then
                                            w_WorkTbl = m_udtWardDept(w_Int)
                                            m_udtWardDept(w_Int) = m_udtWardDept(w_Int + w_Int2)
                                            m_udtWardDept(w_Int + w_Int2) = w_WorkTbl

                                        ElseIf (m_udtWardDept(w_Int).lngCalssLvlNo(1) = m_udtWardDept(w_Int + w_Int2).lngCalssLvlNo(1)) AndAlso (m_udtWardDept(w_Int).lngCalssLvlNo(2) = m_udtWardDept(w_Int + w_Int2).lngCalssLvlNo(2)) AndAlso (m_udtWardDept(w_Int).lngCalssLvlNo(3) = m_udtWardDept(w_Int + w_Int2).lngCalssLvlNo(3)) AndAlso (m_udtWardDept(w_Int).lngCalssLvlNo(4) = m_udtWardDept(w_Int + w_Int2).lngCalssLvlNo(4)) AndAlso (m_udtWardDept(w_Int).lngCalssLvlNo(5) > m_udtWardDept(w_Int + w_Int2).lngCalssLvlNo(5)) Then
                                            w_WorkTbl = m_udtWardDept(w_Int)
                                            m_udtWardDept(w_Int) = m_udtWardDept(w_Int + w_Int2)
                                            m_udtWardDept(w_Int + w_Int2) = w_WorkTbl

                                        End If
                                    Next w_Int2
                                    '待ち処理
                                    System.Windows.Forms.Application.DoEvents()
                                Next w_Int
                                '-------------------------------------

                                '配属部署を表示No順に並び替え
                                ReDim w_lngKugiri(0)
                                For w_Int = 1 To UBound(m_udtWardDept) - 1
                                    If (m_udtWardDept(w_Int).lngCalssLvlNo(1) = m_udtWardDept(w_Int + 1).lngCalssLvlNo(1)) AndAlso (m_udtWardDept(w_Int).lngCalssLvlNo(2) = m_udtWardDept(w_Int + 1).lngCalssLvlNo(2)) AndAlso (m_udtWardDept(w_Int).lngCalssLvlNo(3) = m_udtWardDept(w_Int + 1).lngCalssLvlNo(3)) AndAlso (m_udtWardDept(w_Int).lngCalssLvlNo(4) = m_udtWardDept(w_Int + 1).lngCalssLvlNo(4)) AndAlso (m_udtWardDept(w_Int).lngCalssLvlNo(5) = m_udtWardDept(w_Int + 1).lngCalssLvlNo(5)) Then
                                    Else
                                        '違う階層になればそこを区切りとして記録
                                        ReDim Preserve w_lngKugiri(UBound(w_lngKugiri) + 1)
                                        w_lngKugiri(UBound(w_lngKugiri)) = w_Int
                                    End If
                                Next w_Int
                                ReDim Preserve w_lngKugiri(UBound(w_lngKugiri) + 1)
                                '配属部署を格納している配列の最後のインデックスを区切りとして記録
                                w_lngKugiri(UBound(w_lngKugiri)) = UBound(m_udtWardDept)

                                '並び替え開始
                                '区切った個数分ループ
                                For w_Int = 0 To UBound(w_lngKugiri) - 1
                                    '区切り開始から終わりまでループ
                                    '配属部署を格納している配列の１つを代表に他の配列の表示Noと比べていく
                                    For w_Int2 = w_lngKugiri(w_Int) + 1 To w_lngKugiri(w_Int + 1) - 1
                                        For w_Int3 = w_Int2 + 1 To w_lngKugiri(w_Int + 1)
                                            If m_udtWardDept(w_Int2).lngDispNo > m_udtWardDept(w_Int3).lngDispNo Then
                                                w_WorkTbl = m_udtWardDept(w_Int2)
                                                m_udtWardDept(w_Int2) = m_udtWardDept(w_Int3)
                                                m_udtWardDept(w_Int3) = w_WorkTbl
                                            End If

                                        Next w_Int3
                                    Next w_Int2
                                Next w_Int

                                '未確定データ
                                w_lngIdx = UBound(m_udtWardDept) + 1
                                ReDim Preserve m_udtWardDept(w_lngIdx)
                                m_udtWardDept(w_lngIdx) = New DATABEAN.KinmuDept_Type

                                m_udtWardDept(w_lngIdx).strDeptKbn = "2"
                                m_udtWardDept(w_lngIdx).strDeptCD = M_strNoConfCD
                                m_udtWardDept(w_lngIdx).strDeptName = M_strNoConfName

                                '退職者データ
                                w_lngIdx = w_lngIdx + 1
                                ReDim Preserve m_udtWardDept(w_lngIdx)
                                m_udtWardDept(w_lngIdx) = New DATABEAN.KinmuDept_Type

                                m_udtWardDept(w_lngIdx).strDeptKbn = "3"
                                m_udtWardDept(w_lngIdx).strDeptCD = M_strRetireCD
                                m_udtWardDept(w_lngIdx).strDeptName = M_strRetireName


                            End If
                        End With

                        '**役職**
                    Case 2
                        ReDim m_udtPost(0)

                        With General.g_objGetMaster
                            .pPM_CD = ""
                            .pPM_KijunDate = General.paGetDateIntegerFromDate(Now)

                            If .mGetPostm = False Then

                            Else
                                w_lngRecCnt = .fPM_DataCount

                                For w_lngLoop = 1 To w_lngRecCnt
                                    '索引
                                    .mPM_DataIdx = w_lngLoop

                                    w_lngIdx = UBound(m_udtPost) + 1
                                    ReDim Preserve m_udtPost(w_lngIdx)
                                    m_udtPost(w_lngIdx) = New DATABEAN.KinmuDept_Type

                                    '●勤務部署区分
                                    m_udtPost(w_lngIdx).strDeptKbn = "1"
                                    '●配属部署コード
                                    m_udtPost(w_lngIdx).strDeptCD = .fPM_postCD
                                    '●配属部署名称
                                    m_udtPost(w_lngIdx).strDeptName = .fPM_Name
                                    '●配属部署略称
                                    m_udtPost(w_lngIdx).strDeptSecNm = .fPM_SecName
                                    '●配属部署略称２
                                    m_udtPost(w_lngIdx).strDeptSecNm2 = .fPM_SecName2
                                    '●表示NO
                                    m_udtPost(w_lngIdx).lngDispNo = .fPM_DispNo
                                    '●汎用エリア
                                    m_udtPost(w_lngIdx).strHanyoArea = .fPM_HanyouArea
                                    '●汎用エリア２
                                    m_udtPost(w_lngIdx).strHanyoArea2 = .fPM_HanyouArea2
                                Next w_lngLoop
                                '未確定データ
                                w_lngIdx = UBound(m_udtPost) + 1
                                ReDim Preserve m_udtPost(w_lngIdx)
                                m_udtPost(w_lngIdx) = New DATABEAN.KinmuDept_Type

                                m_udtPost(w_lngIdx).strDeptKbn = "2"
                                m_udtPost(w_lngIdx).strDeptCD = M_strNoConfCD
                                m_udtPost(w_lngIdx).strDeptName = M_strNoConfName

                                '退職者データ
                                w_lngIdx = w_lngIdx + 1
                                ReDim Preserve m_udtPost(w_lngIdx)
                                m_udtPost(w_lngIdx) = New DATABEAN.KinmuDept_Type

                                m_udtPost(w_lngIdx).strDeptKbn = "3"
                                m_udtPost(w_lngIdx).strDeptCD = M_strRetireCD
                                m_udtPost(w_lngIdx).strDeptName = M_strRetireName

                            End If
                        End With

                        '**職種**
                    Case 3
                        ReDim m_udtJob(0)

                        With General.g_objGetMaster
                            .pJM_CD = ""
                            .pJM_KijunDate = General.paGetDateIntegerFromDate(Now)

                            If .mGetJobM = False Then

                            Else
                                w_lngRecCnt = .fJM_DataCount

                                For w_lngLoop = 1 To w_lngRecCnt
                                    '索引
                                    .mJM_DataIdx = w_lngLoop

                                    w_lngIdx = UBound(m_udtJob) + 1
                                    ReDim Preserve m_udtJob(w_lngIdx)
                                    m_udtJob(w_lngIdx) = New DATABEAN.KinmuDept_Type

                                    '●勤務部署区分
                                    m_udtJob(w_lngIdx).strDeptKbn = "1"
                                    '●配属部署コード
                                    m_udtJob(w_lngIdx).strDeptCD = .fJM_JobCD
                                    '●配属部署名称
                                    m_udtJob(w_lngIdx).strDeptName = .fJM_Name
                                    '●配属部署略称
                                    m_udtJob(w_lngIdx).strDeptSecNm = .fJM_SecName
                                    '●配属部署略称２
                                    m_udtJob(w_lngIdx).strDeptSecNm2 = .fJM_SecName2
                                    '●表示NO
                                    m_udtJob(w_lngIdx).lngDispNo = .fJM_DispNo
                                    '●汎用エリア
                                    m_udtJob(w_lngIdx).strHanyoArea = .fJM_HanyouArea
                                    '●汎用エリア２
                                    m_udtJob(w_lngIdx).strHanyoArea2 = .fJM_HanyouArea2
                                Next w_lngLoop

                                '未確定データ
                                w_lngIdx = UBound(m_udtJob) + 1
                                ReDim Preserve m_udtJob(w_lngIdx)
                                m_udtJob(w_lngIdx) = New DATABEAN.KinmuDept_Type

                                m_udtJob(w_lngIdx).strDeptKbn = "2"
                                m_udtJob(w_lngIdx).strDeptCD = M_strNoConfCD
                                m_udtJob(w_lngIdx).strDeptName = M_strNoConfName

                                '退職者データ
                                w_lngIdx = w_lngIdx + 1
                                ReDim Preserve m_udtJob(w_lngIdx)
                                m_udtJob(w_lngIdx) = New DATABEAN.KinmuDept_Type

                                m_udtJob(w_lngIdx).strDeptKbn = "3"
                                m_udtJob(w_lngIdx).strDeptCD = M_strRetireCD
                                m_udtJob(w_lngIdx).strDeptName = M_strRetireName

                            End If
                        End With
                End Select
            Else
                Select Case p_intTab
                    '**役職**
                    Case 1
                        ReDim m_udtPost(0)

                        With General.g_objGetMaster
                            .pPM_CD = ""
                            .pPM_KijunDate = General.paGetDateIntegerFromDate(Now)

                            If .mGetPostm = False Then

                            Else
                                w_lngRecCnt = .fPM_DataCount

                                For w_lngLoop = 1 To w_lngRecCnt
                                    '索引
                                    .mPM_DataIdx = w_lngLoop

                                    w_lngIdx = UBound(m_udtPost) + 1
                                    ReDim Preserve m_udtPost(w_lngIdx)
                                    m_udtPost(w_lngIdx) = New DATABEAN.KinmuDept_Type

                                    '●勤務部署区分
                                    m_udtPost(w_lngIdx).strDeptKbn = "1"
                                    '●配属部署コード
                                    m_udtPost(w_lngIdx).strDeptCD = .fPM_postCD
                                    '●配属部署名称
                                    m_udtPost(w_lngIdx).strDeptName = .fPM_Name
                                    '●配属部署略称
                                    m_udtPost(w_lngIdx).strDeptSecNm = .fPM_SecName
                                    '●配属部署略称２
                                    m_udtPost(w_lngIdx).strDeptSecNm2 = .fPM_SecName2
                                    '●表示NO
                                    m_udtPost(w_lngIdx).lngDispNo = .fPM_DispNo
                                    '●汎用エリア
                                    m_udtPost(w_lngIdx).strHanyoArea = .fPM_HanyouArea
                                    '●汎用エリア２
                                    m_udtPost(w_lngIdx).strHanyoArea2 = .fPM_HanyouArea2
                                Next w_lngLoop
                                '未確定データ
                                w_lngIdx = UBound(m_udtPost) + 1
                                ReDim Preserve m_udtPost(w_lngIdx)
                                m_udtPost(w_lngIdx) = New DATABEAN.KinmuDept_Type

                                m_udtPost(w_lngIdx).strDeptKbn = "2"
                                m_udtPost(w_lngIdx).strDeptCD = M_strNoConfCD
                                m_udtPost(w_lngIdx).strDeptName = M_strNoConfName

                                '退職者データ
                                w_lngIdx = w_lngIdx + 1
                                ReDim Preserve m_udtPost(w_lngIdx)
                                m_udtPost(w_lngIdx) = New DATABEAN.KinmuDept_Type

                                m_udtPost(w_lngIdx).strDeptKbn = "3"
                                m_udtPost(w_lngIdx).strDeptCD = M_strRetireCD
                                m_udtPost(w_lngIdx).strDeptName = M_strRetireName

                            End If
                        End With

                        '**職種**
                    Case 2
                        ReDim m_udtJob(0)

                        With General.g_objGetMaster
                            .pJM_CD = ""
                            .pJM_KijunDate = General.paGetDateIntegerFromDate(Now)

                            If .mGetJobM = False Then

                            Else
                                w_lngRecCnt = .fJM_DataCount

                                For w_lngLoop = 1 To w_lngRecCnt
                                    '索引
                                    .mJM_DataIdx = w_lngLoop

                                    w_lngIdx = UBound(m_udtJob) + 1
                                    ReDim Preserve m_udtJob(w_lngIdx)
                                    m_udtJob(w_lngIdx) = New DATABEAN.KinmuDept_Type

                                    '●勤務部署区分
                                    m_udtJob(w_lngIdx).strDeptKbn = "1"
                                    '●配属部署コード
                                    m_udtJob(w_lngIdx).strDeptCD = .fJM_JobCD
                                    '●配属部署名称
                                    m_udtJob(w_lngIdx).strDeptName = .fJM_Name
                                    '●配属部署略称
                                    m_udtJob(w_lngIdx).strDeptSecNm = .fJM_SecName
                                    '●配属部署略称２
                                    m_udtJob(w_lngIdx).strDeptSecNm2 = .fJM_SecName2
                                    '●表示NO
                                    m_udtJob(w_lngIdx).lngDispNo = .fJM_DispNo
                                    '●汎用エリア
                                    m_udtJob(w_lngIdx).strHanyoArea = .fJM_HanyouArea
                                    '●汎用エリア２
                                    m_udtJob(w_lngIdx).strHanyoArea2 = .fJM_HanyouArea2
                                Next w_lngLoop

                                '未確定データ
                                w_lngIdx = UBound(m_udtJob) + 1
                                ReDim Preserve m_udtJob(w_lngIdx)
                                m_udtJob(w_lngIdx) = New DATABEAN.KinmuDept_Type

                                m_udtJob(w_lngIdx).strDeptKbn = "2"
                                m_udtJob(w_lngIdx).strDeptCD = M_strNoConfCD
                                m_udtJob(w_lngIdx).strDeptName = M_strNoConfName

                                '退職者データ
                                w_lngIdx = w_lngIdx + 1
                                ReDim Preserve m_udtJob(w_lngIdx)
                                m_udtJob(w_lngIdx) = New DATABEAN.KinmuDept_Type

                                m_udtJob(w_lngIdx).strDeptKbn = "3"
                                m_udtJob(w_lngIdx).strDeptCD = M_strRetireCD
                                m_udtJob(w_lngIdx).strDeptName = M_strRetireName

                            End If
                        End With
                End Select
            End If

        Catch ex As Exception
            Call General.paTrpMsg(Convert.ToString(Err.Number), W_SUBNAME)
        End Try
    End Sub

    '========================================
    '配属部署ツリービュー 
    '========================================
    Private Sub sSetWardDeptTreeView()
        Const W_SUBNAME As String = "NSC0000HA sSetWardDeptTreeView"

        Try
            Dim w_Node As System.Windows.Forms.TreeNode
            Dim w_lngLoop As Integer

            Dim w_lngLvl1Idx As Integer
            Dim w_lngLvl2Idx As Integer
            Dim w_lngLvl3Idx As Integer
            Dim w_lngLvl4Idx As Integer
            Dim w_lngLvl5Idx As Integer

            Dim w_preClassLvlCD1 As String
            Dim w_preClassLvlCD2 As String
            Dim w_preClassLvlCD3 As String
            Dim w_preClassLvlCD4 As String
            Dim w_preClassLvlCD5 As String

            Dim w_blnClassLv1Flg As Boolean
            Dim w_blnClassLv2Flg As Boolean
            Dim w_blnClassLv3Flg As Boolean
            Dim w_blnClassLv4Flg As Boolean
            Dim w_NodeSelectedFlg As Boolean = False    'tvwKinmuDept.SelectedNode プロパティに値の設定有無の判定フラグ

            m_lngDefDeptIdx = 0

            With tvwKinmuDept

                m_strRefreshList = ""

                .Nodes.Clear()

                '施設名
                w_Node = .Nodes.Add(M_NodeKey_HOSP, General.g_strHospitalNm)

                For w_lngLoop = 1 To UBound(m_udtWardDept)
                    w_blnClassLv1Flg = False
                    w_blnClassLv2Flg = False
                    w_blnClassLv3Flg = False
                    w_blnClassLv4Flg = False

                    AidGeneral.paGetKinmuDeptTvw_Part1(tvwKinmuDept, m_udtWardDept, w_lngLoop, w_lngLvl1Idx, w_lngLvl2Idx, w_lngLvl3Idx, w_lngLvl4Idx, w_lngLvl5Idx, w_preClassLvlCD1, w_preClassLvlCD2, w_preClassLvlCD3, w_preClassLvlCD4, w_preClassLvlCD5)

                    AidGeneral.paGetKinmuDeptTvw_Part2(tvwKinmuDept, m_udtWardDept, w_lngLoop, w_lngLvl1Idx, w_lngLvl2Idx, w_lngLvl3Idx, w_lngLvl4Idx, w_lngLvl5Idx, w_preClassLvlCD1, w_preClassLvlCD2, w_preClassLvlCD3, w_preClassLvlCD4, w_preClassLvlCD5)

                    If (M_STAFFIDO_RESCD).Equals(g_MenuM(g_lngGroupIdx).ListBarMenu(g_lngListIdx).strResCD) Then
                        '退職者・未確定への対応
                        If (M_strNoConfCD).Equals(m_udtWardDept(w_lngLoop).strDeptCD) Then
                            '階層レベル１追加
                            'Node追加
                            w_Node = .Nodes.Find(M_NodeKey_HOSP, True)(0).Nodes.Add(m_udtWardDept(w_lngLoop).strDeptCD, M_strNoConfName)
                        End If
                        If (M_strRetireCD).Equals(m_udtWardDept(w_lngLoop).strDeptCD) Then
                            '階層レベル１追加
                            'Node追加
                            w_Node = .Nodes.Find(M_NodeKey_HOSP, True)(0).Nodes.Add(m_udtWardDept(w_lngLoop).strDeptCD, M_strRetireName)
                        End If
                        '検索への対応
                        If w_lngLoop = UBound(m_udtWardDept) Then
                            '階層レベル１追加
                            'Node追加
                            w_Node = .Nodes.Find(M_NodeKey_HOSP, True)(0).Nodes.Add(M_strSearchCD, M_strSearchName)
                        End If
                    End If

                    '前回選択部署の場合、OPENにする
                    If (m_udtWardDept(w_lngLoop).strDeptCD).Equals(g_strSelWardDeptCD) Then
                        If String.IsNullOrEmpty(m_udtWardDept(w_lngLoop).strClassLvlCD(1)) = False Then .Nodes.Find(M_NodeKey_HOSP & Convert.ToString(w_lngLvl1Idx), True)(0).Expand()
                        If String.IsNullOrEmpty(m_udtWardDept(w_lngLoop).strClassLvlCD(2)) = False Then .Nodes.Find(M_NodeKey_LVL2 & Convert.ToString(w_lngLvl2Idx), True)(0).Expand()
                        If String.IsNullOrEmpty(m_udtWardDept(w_lngLoop).strClassLvlCD(3)) = False Then .Nodes.Find(M_NodeKey_LVL3 & Convert.ToString(w_lngLvl3Idx), True)(0).Expand()
                        If String.IsNullOrEmpty(m_udtWardDept(w_lngLoop).strClassLvlCD(4)) = False Then .Nodes.Find(M_NodeKey_LVL4 & Convert.ToString(w_lngLvl4Idx), True)(0).Expand()
                        If String.IsNullOrEmpty(m_udtWardDept(w_lngLoop).strClassLvlCD(5)) = False Then .Nodes.Find(M_NodeKey_LVL5 & Convert.ToString(w_lngLvl5Idx), True)(0).Expand()

                        If (M_strNoConfCD).Equals(g_strSelWardDeptCD) Then
                            '未確定だったら
                            .Nodes.Find(M_strNoConfCD, True)(0).Checked = True
                            .SelectedNode = .Nodes.Find(M_strNoConfCD, True)(0)
                            w_NodeSelectedFlg = True
                        ElseIf (M_strRetireCD).Equals(g_strSelWardDeptCD) Then
                            '退職者だったら
                            .Nodes.Find(M_strRetireCD, True)(0).Checked = True
                            .SelectedNode = .Nodes.Find(M_strRetireCD, True)(0)
                            w_NodeSelectedFlg = True
                        ElseIf (M_strSearchCD).Equals(g_strSelWardDeptCD) Then
                            '検索だったら
                            .Nodes.Find(M_strSearchCD, True)(0).Checked = True
                            .SelectedNode = .Nodes.Find(M_strSearchCD, True)(0)
                            w_NodeSelectedFlg = True
                        Else
                            'それ以外だったら
                            .Nodes.Find(M_NodeKey_DEPT & Convert.ToString(w_lngLoop), True)(0).Checked = True
                            .SelectedNode = .Nodes.Find(M_NodeKey_DEPT & Convert.ToString(w_lngLoop), True)(0)
                            w_NodeSelectedFlg = True
                        End If

                        'デフォルトインデックス
                        m_lngDefDeptIdx = w_lngLoop
                    End If

                Next w_lngLoop

                'Nodeクリックイベントを発生させる
                If m_lngDefDeptIdx <> 0 Then
                    'SelectedNodeプロパティで値がセットされた場合、クリック処理が走っているので下記IF文内を通さない	
                    If w_NodeSelectedFlg = False Then
                        If (M_strNoConfCD).Equals(g_strSelWardDeptCD) Then
                            '未確定だったら
                            Call tvwKinmuDept_NodeClick(tvwKinmuDept, New System.Windows.Forms.TreeViewEventArgs(.Nodes.Find(M_NodeKey_HOSP, True)(0)))
                        ElseIf (M_strRetireCD).Equals(g_strSelWardDeptCD) Then
                            '退職者だったら
                            Call tvwKinmuDept_NodeClick(tvwKinmuDept, New System.Windows.Forms.TreeViewEventArgs(.Nodes.Find(M_NodeKey_HOSP, True)(0)))
                        ElseIf (M_strSearchCD).Equals(g_strSelWardDeptCD) Then
                            '検索だったら
                            Call tvwKinmuDept_NodeClick(tvwKinmuDept, New System.Windows.Forms.TreeViewEventArgs(.Nodes.Find(M_NodeKey_HOSP, True)(0)))
                        Else
                            'それ以外だったら
                            Call tvwKinmuDept_NodeClick(tvwKinmuDept, New System.Windows.Forms.TreeViewEventArgs(.Nodes.Find(M_NodeKey_DEPT & Convert.ToString(m_lngDefDeptIdx), True)(0)))
                        End If
                    End If
                End If

                '最上位の階層を展開する
                .Nodes.Find(M_NodeKey_HOSP, True)(0).Expand()

            End With

            vstKinmuDept.Visible = False

        Catch ex As Exception
            Call General.paTrpMsg(Convert.ToString(Err.Number), W_SUBNAME)
        End Try
    End Sub

    '========================================
    '職種ツリービュー 作成
    '========================================
    Private Sub sSetJobTreeView()
        Const W_SUBNAME As String = "NSC0000HA sSetJobTreeView"

        Try
            Dim w_Node As System.Windows.Forms.TreeNode
            Dim w_lngLoop As Integer

            Dim w_lngLvl1Idx As Integer
            Dim w_lngLvl2Idx As Integer
            Dim w_lngLvl3Idx As Integer
            Dim w_lngLvl4Idx As Integer
            Dim w_lngLvl5Idx As Integer
            Dim w_NodeSelectedFlg As Boolean = False    'tvwKinmuDept.SelectedNode プロパティに値の設定有無の判定フラグ


            m_lngDefDeptIdx = 0

            With tvwKinmuDept

                m_strRefreshList = ""

                'TreeViewのｸﾘｱ
                .Nodes.Clear()

                '施設名
                w_Node = .Nodes.Add(M_NodeKey_HOSP, "職種")

                For w_lngLoop = 1 To UBound(m_udtJob)

                    '階層レベル１追加
                    w_lngLvl1Idx = w_lngLvl1Idx + 1
                    'Node追加
                    If M_strNoConfCD.Equals(m_udtJob(w_lngLoop).strDeptCD) = False _
                        AndAlso M_strRetireCD.Equals(m_udtJob(w_lngLoop).strDeptCD) = False _
                        AndAlso w_lngLoop <> UBound(m_udtJob) Then

                        w_Node = .Nodes.Find(M_NodeKey_HOSP, True)(0).Nodes.Add(M_NodeKey_DEPT & Convert.ToString(w_lngLvl1Idx), m_udtJob(w_lngLoop).strDeptName)
                    End If

                    '退職者・未確定への対応
                    If (M_strNoConfCD).Equals(m_udtJob(w_lngLoop).strDeptCD) Then
                        '階層レベル１追加
                        'Node追加
                        w_Node = .Nodes.Find(M_NodeKey_HOSP, True)(0).Nodes.Add(m_udtJob(w_lngLoop).strDeptCD, M_strNoConfName)
                    End If
                    If (M_strRetireCD).Equals(m_udtJob(w_lngLoop).strDeptCD) Then
                        '階層レベル１追加
                        'Node追加
                        w_Node = .Nodes.Find(M_NodeKey_HOSP, True)(0).Nodes.Add(m_udtJob(w_lngLoop).strDeptCD, M_strRetireName)
                    End If
                    '検索への対応
                    If w_lngLoop = UBound(m_udtJob) Then
                        '階層レベル１追加
                        'Node追加
                        w_Node = .Nodes.Find(M_NodeKey_HOSP, True)(0).Nodes.Add(M_strSearchCD, M_strSearchName)
                    End If

                    '前回選択部署の場合、OPENにする
                    If (m_udtJob(w_lngLoop).strDeptCD).Equals(g_strSelJobCD) Then
                        If String.IsNullOrEmpty(m_udtJob(w_lngLoop).strClassLvlCD(1)) = False Then .Nodes.Find(M_NodeKey_HOSP & Convert.ToString(w_lngLvl1Idx), True)(0).Expand()
                        If String.IsNullOrEmpty(m_udtJob(w_lngLoop).strClassLvlCD(2)) = False Then .Nodes.Find(M_NodeKey_LVL2 & Convert.ToString(w_lngLvl2Idx), True)(0).Expand()
                        If String.IsNullOrEmpty(m_udtJob(w_lngLoop).strClassLvlCD(3)) = False Then .Nodes.Find(M_NodeKey_LVL3 & Convert.ToString(w_lngLvl3Idx), True)(0).Expand()
                        If String.IsNullOrEmpty(m_udtJob(w_lngLoop).strClassLvlCD(4)) = False Then .Nodes.Find(M_NodeKey_LVL4 & Convert.ToString(w_lngLvl4Idx), True)(0).Expand()
                        If String.IsNullOrEmpty(m_udtJob(w_lngLoop).strClassLvlCD(5)) = False Then .Nodes.Find(M_NodeKey_LVL5 & Convert.ToString(w_lngLvl5Idx), True)(0).Expand()
                        If (M_strNoConfCD).Equals(g_strSelJobCD) Then
                            '未確定だったら
                            .Nodes.Find(M_strNoConfCD, True)(0).Checked = True
                            .SelectedNode = .Nodes.Find(M_strNoConfCD, True)(0)
                            w_NodeSelectedFlg = True
                        ElseIf (M_strRetireCD).Equals(g_strSelJobCD) Then
                            '退職者だったら
                            .Nodes.Find(M_strRetireCD, True)(0).Checked = True
                            .SelectedNode = .Nodes.Find(M_strRetireCD, True)(0)
                            w_NodeSelectedFlg = True
                        ElseIf (M_strSearchCD).Equals(g_strSelJobCD) Then
                            '検索だったら
                            .Nodes.Find(M_strSearchCD, True)(0).Checked = True
                            .SelectedNode = .Nodes.Find(M_strSearchCD, True)(0)
                            w_NodeSelectedFlg = True
                        Else
                            'それ以外だったら
                            .Nodes.Find(M_NodeKey_DEPT & Convert.ToString(w_lngLoop), True)(0).Checked = True
                            .SelectedNode = .Nodes.Find(M_NodeKey_DEPT & Convert.ToString(w_lngLoop), True)(0)
                            w_NodeSelectedFlg = True
                        End If

                        'デフォルトインデックス
                        m_lngDefDeptIdx = w_lngLoop
                    End If

                Next w_lngLoop

                'Nodeクリックイベントを発生させる
                If m_lngDefDeptIdx <> 0 Then
                    'SelectedNodeプロパティで値がセットされた場合、クリック処理が走っているので下記IF文内を通さない	
                    If w_NodeSelectedFlg = False Then
                        If (M_strNoConfCD).Equals(g_strSelJobCD) Then
                            '未確定だったら
                            Call tvwKinmuDept_NodeClick(tvwKinmuDept, New System.Windows.Forms.TreeViewEventArgs(.Nodes.Find(M_NodeKey_HOSP, True)(0)))
                        ElseIf (M_strRetireCD).Equals(g_strSelJobCD) Then
                            '退職者だったら
                            Call tvwKinmuDept_NodeClick(tvwKinmuDept, New System.Windows.Forms.TreeViewEventArgs(.Nodes.Find(M_NodeKey_HOSP, True)(0)))
                        ElseIf (M_strSearchCD).Equals(g_strSelJobCD) Then
                            '検索だったら
                            Call tvwKinmuDept_NodeClick(tvwKinmuDept, New System.Windows.Forms.TreeViewEventArgs(.Nodes.Find(M_NodeKey_HOSP, True)(0)))
                        Else
                            'それ以外だったら
                            Call tvwKinmuDept_NodeClick(tvwKinmuDept, New System.Windows.Forms.TreeViewEventArgs(.Nodes.Find(M_NodeKey_DEPT & Convert.ToString(m_lngDefDeptIdx), True)(0)))
                        End If
                    End If
                End If

                '最上位の階層を展開する
                .Nodes.Find(M_NodeKey_HOSP, True)(0).Expand()

            End With

            vstKinmuDept.Visible = False

        Catch ex As Exception
            Call General.paTrpMsg(Convert.ToString(Err.Number), W_SUBNAME)
        End Try
    End Sub

    Private Sub subGetPlanNo(ByRef p_lngPlan As Integer, ByRef p_lngBeforePlan As Integer, ByVal p_lngFrom As Integer, ByVal p_lngTo As Integer)
        '*****************************************************************************/
        '*  関数名　　　: subGetPlanNo
        '*  概要　　　　: 受け取った年月日を元にその期間が対象となっている計画番号と前月の計画番号を取得
        '*  パラメータ　: IN/OUT : 計画番号(p_lngPlan)
        '*             : IN/OUT : 前回の計画番号(p_lngBeforePlan)
        '*             : IN     : 開始年月日(p_lngFrom)
        '*             : IN     : 終了年月日(p_lngTo)
        '*  戻り値　　　: なし
        '*****************************************************************************/
        Try

            Dim w_strPreErrorProc As String
            Dim w_strSql As String
            Dim w_Rs As ADODB.Recordset
            Dim w_PlanNO_F As ADODB.Field

            w_strPreErrorProc = General.g_ErrorProc
            General.g_ErrorProc = "NSC0000HA subGetPlanNo"

            p_lngPlan = 0
            p_lngBeforePlan = 0

            '***** 計画番号を取得　********
            '前計画番号取得
            w_strSql = ""
            w_strSql = w_strSql & "SELECT MAX(PLANNO) AS 最大計画番号"
            w_strSql = w_strSql & " FROM NS_PLANCONTROL_F"
            w_strSql = w_strSql & " WHERE PLANPERIODTO >= " & p_lngFrom
            w_strSql = w_strSql & " AND PLANPERIODFROM <= " & p_lngTo
            w_strSql = w_strSql & " AND HOSPITALCD = '" & Trim(General.g_strHospitalCD) & "'"
            w_strSql = w_strSql & " GROUP BY HOSPITALCD"

            'カーソル作成
            w_Rs = General.paDBRecordSetOpen(w_strSql)

            With w_Rs
                If .RecordCount <= 0 Then
                    p_lngBeforePlan = 0
                Else
                    w_PlanNO_F = .Fields("最大計画番号")
                    p_lngPlan = w_PlanNO_F.Value
                    If p_lngPlan - 1 < 0 Then
                        p_lngBeforePlan = 0
                    Else
                        p_lngBeforePlan = p_lngPlan - 1
                    End If
                End If
                .Close()
            End With
            w_Rs = Nothing

            General.g_ErrorProc = w_strPreErrorProc

        Catch ex As Exception
            Throw
        End Try
    End Sub

    '職員暦 取得
    Private Sub subGetStaffHistory(ByVal p_lngPlan As Integer)
        Try

            Dim w_strPreErrorProc As String
            Dim w_strSql As String
            Dim w_Rs As ADODB.Recordset
            Dim w_StaffMngID_F As ADODB.Field
            Dim w_KinmuDeptCD_F As ADODB.Field
            Dim w_DispNo_F As ADODB.Field
            Dim w_lngKensuu As Integer
            Dim w_lngLoop As Integer

            w_strPreErrorProc = General.g_ErrorProc
            General.g_ErrorProc = "NSC0000HA subGetStaffHistory"

            '配列初期化
            ReDim m_StaffHistory(0)

            '職員歴Ｆを取得
            w_strSql = ""
            w_strSql = w_strSql & "SELECT STAFFMNGID, KINMUDEPTCD, DISPNO "
            w_strSql = w_strSql & "FROM   NS_STAFFHISTORY_F "
            w_strSql = w_strSql & "WHERE  PLANNO      = " & p_lngPlan & " "
            w_strSql = w_strSql & "AND    HOSPITALCD  = '" & Trim(General.g_strHospitalCD) & "' "
            w_strSql = w_strSql & "ORDER BY KINMUDEPTCD, DISPNO, STAFFMNGID"

            'カーソル作成
            w_Rs = General.paDBRecordSetOpen(w_strSql)

            With w_Rs
                If .RecordCount <= 0 Then
                Else
                    .MoveLast()
                    w_lngKensuu = .RecordCount
                    .MoveFirst()

                    w_StaffMngID_F = .Fields("STAFFMNGID")
                    w_KinmuDeptCD_F = .Fields("KINMUDEPTCD")
                    w_DispNo_F = .Fields("DISPNO")

                    ReDim m_StaffHistory(w_lngKensuu)
                    For w_lngLoop = 1 To w_lngKensuu
                        '職員管理番号
                        m_StaffHistory(w_lngLoop).ID = w_StaffMngID_F.Value
                        '看護単位CD
                        m_StaffHistory(w_lngLoop).DeptCD = w_KinmuDeptCD_F.Value
                        '表示No
                        m_StaffHistory(w_lngLoop).No = w_DispNo_F.Value
                        .MoveNext()
                    Next w_lngLoop
                End If
                .Close()
            End With
            w_Rs = Nothing

            General.g_ErrorProc = w_strPreErrorProc

        Catch ex As Exception
            Throw
        End Try
    End Sub

    '========================================
    '役職ツリービュー
    '========================================
    Private Sub sSetPostTreeView()

        Const W_SUBNAME As String = "NSC0000HA sSetPostTreeView"

        Try
            Dim w_Node As System.Windows.Forms.TreeNode
            Dim w_lngLoop As Integer

            Dim w_lngLvl1Idx As Integer
            Dim w_lngLvl2Idx As Integer
            Dim w_lngLvl3Idx As Integer
            Dim w_lngLvl4Idx As Integer
            Dim w_lngLvl5Idx As Integer
            Dim w_NodeSelectedFlg As Boolean = False    'tvwKinmuDept.SelectedNode プロパティに値の設定有無の判定フラグ
            m_lngDefDeptIdx = 0

            With tvwKinmuDept

                m_strRefreshList = ""

                'TreeViewのｸﾘｱ
                .Nodes.Clear()

                '施設名
                w_Node = .Nodes.Add(M_NodeKey_HOSP, "役職")
                w_Node.Expand()

                For w_lngLoop = 1 To UBound(m_udtPost)

                    '階層レベル１追加
                    w_lngLvl1Idx = w_lngLvl1Idx + 1
                    If M_strNoConfCD.Equals(m_udtPost(w_lngLoop).strDeptCD) = False AndAlso M_strRetireCD.Equals(m_udtPost(w_lngLoop).strDeptCD) = False AndAlso w_lngLoop <> UBound(m_udtPost) Then
                        'Node追加
                        w_Node = .Nodes.Find(M_NodeKey_HOSP, True)(0).Nodes.Add(M_NodeKey_DEPT & Convert.ToString(w_lngLvl1Idx), m_udtPost(w_lngLoop).strDeptName)
                    End If

                    '退職者・未確定への対応
                    If (M_strNoConfCD).Equals(m_udtPost(w_lngLoop).strDeptCD) Then
                        '階層レベル１追加
                        'Node追加
                        w_Node = .Nodes.Find(M_NodeKey_HOSP, True)(0).Nodes.Add(m_udtPost(w_lngLoop).strDeptCD, M_strNoConfName)
                    End If
                    If (M_strRetireCD).Equals(m_udtPost(w_lngLoop).strDeptCD) Then
                        '階層レベル１追加
                        'Node追加
                        w_Node = .Nodes.Find(M_NodeKey_HOSP, True)(0).Nodes.Add(m_udtPost(w_lngLoop).strDeptCD, M_strRetireName)
                    End If
                    '検索への対応
                    If w_lngLoop = UBound(m_udtPost) Then
                        '階層レベル１追加
                        'Node追加
                        w_Node = .Nodes.Find(M_NodeKey_HOSP, True)(0).Nodes.Add(M_strSearchCD, M_strSearchName)
                    End If

                    '前回選択部署の場合、OPENにする
                    If (m_udtPost(w_lngLoop).strDeptCD).Equals(g_strSelPostCD) Then
                        If String.IsNullOrEmpty(m_udtPost(w_lngLoop).strClassLvlCD(1)) = False Then .Nodes.Find(M_NodeKey_HOSP & Convert.ToString(w_lngLvl1Idx), True)(0).Expand()
                        If String.IsNullOrEmpty(m_udtPost(w_lngLoop).strClassLvlCD(2)) = False Then .Nodes.Find(M_NodeKey_LVL2 & Convert.ToString(w_lngLvl2Idx), True)(0).Expand()
                        If String.IsNullOrEmpty(m_udtPost(w_lngLoop).strClassLvlCD(3)) = False Then .Nodes.Find(M_NodeKey_LVL3 & Convert.ToString(w_lngLvl3Idx), True)(0).Expand()
                        If String.IsNullOrEmpty(m_udtPost(w_lngLoop).strClassLvlCD(4)) = False Then .Nodes.Find(M_NodeKey_LVL4 & Convert.ToString(w_lngLvl4Idx), True)(0).Expand()
                        If String.IsNullOrEmpty(m_udtPost(w_lngLoop).strClassLvlCD(5)) = False Then .Nodes.Find(M_NodeKey_LVL5 & Convert.ToString(w_lngLvl5Idx), True)(0).Expand()
                        If g_strSelPostCD = M_strNoConfCD Then
                            '未確定だったら
                            .Nodes.Find(M_strNoConfCD, True)(0).Checked = True
                            .SelectedNode = .Nodes.Find(M_strNoConfCD, True)(0)
                            w_NodeSelectedFlg = True
                        ElseIf (M_strRetireCD).Equals(g_strSelPostCD) Then
                            '退職者だったら
                            .Nodes.Find(M_strRetireCD, True)(0).Checked = True
                            .SelectedNode = .Nodes.Find(M_strRetireCD, True)(0)
                            w_NodeSelectedFlg = True
                        ElseIf (M_strSearchCD).Equals(g_strSelPostCD) Then
                            '検索だったら
                            .Nodes.Find(M_strSearchCD, True)(0).Checked = True
                            .SelectedNode = .Nodes.Find(M_strSearchCD, True)(0)
                            w_NodeSelectedFlg = True
                        Else
                            'それ以外だったら
                            .Nodes.Find(M_NodeKey_DEPT & Convert.ToString(w_lngLoop), True)(0).Checked = True
                            .SelectedNode = .Nodes.Find(M_NodeKey_DEPT & Convert.ToString(w_lngLoop), True)(0)
                            w_NodeSelectedFlg = True
                        End If

                        'デフォルトインデックス
                        m_lngDefDeptIdx = w_lngLoop
                    End If

                Next w_lngLoop

                'Nodeクリックイベントを発生させる
                If m_lngDefDeptIdx <> 0 Then
                    'SelectedNodeプロパティで値がセットされた場合、クリック処理が走っているので下記IF文内を通さない
                    If w_NodeSelectedFlg = False Then
                        If (M_strNoConfCD).Equals(g_strSelPostCD) Then
                            '未確定だったら
                            Call tvwKinmuDept_NodeClick(tvwKinmuDept, New System.Windows.Forms.TreeViewEventArgs(.Nodes.Find(M_NodeKey_HOSP, True)(0)))
                        ElseIf (M_strRetireCD).Equals(g_strSelPostCD) Then
                            '退職者だったら
                            Call tvwKinmuDept_NodeClick(tvwKinmuDept, New System.Windows.Forms.TreeViewEventArgs(.Nodes.Find(M_NodeKey_HOSP, True)(0)))
                        ElseIf (M_strSearchCD).Equals(g_strSelPostCD) Then
                            '検索だったら
                            Call tvwKinmuDept_NodeClick(tvwKinmuDept, New System.Windows.Forms.TreeViewEventArgs(.Nodes.Find(M_NodeKey_HOSP, True)(0)))
                        Else
                            'それ以外だったら
                            Call tvwKinmuDept_NodeClick(tvwKinmuDept, New System.Windows.Forms.TreeViewEventArgs(.Nodes.Find(M_NodeKey_DEPT & Convert.ToString(m_lngDefDeptIdx), True)(0)))
                        End If
                    End If
                End If

                '最上位の階層を展開する
                .Nodes.Find(M_NodeKey_HOSP, True)(0).Expand()

            End With

            vstKinmuDept.Visible = False

        Catch ex As Exception
            Call General.paTrpMsg(Convert.ToString(Err.Number), W_SUBNAME)
        End Try
    End Sub

    Private Function sGetPersonalOverAppliData(ByVal p_strStaffMngID As String, ByVal p_lngFromDate As Integer, ByVal p_lngToDate As Integer) As Boolean
        Const W_SUBNAME As String = "NSC0000HA sGetPersonalOverAppliData"

        Try
            Dim w_lngRecCnt As Integer
            Dim w_lngLoop As Integer
            Dim w_lngIdx As Integer

            Const W_strListALL As String = "0000"

            ReDim m_udtApproveData(0)

            '======================
            '未承認一覧取得
            '======================

            With General.g_objSyouninData

                '承認者職員管理番号
                .pApproveStaffMngID = General.g_strUserMngID
                .mNA_GetKbn = "2" '全表示
                .mNA_DateKbn = "1" '取得区分(取得期間)
                .mNA_DateFrom = p_lngFromDate '年月日FROM
                .mNA_DateTo = p_lngToDate '年月日TO
                .mNA_KikanKbn = "1"
                .pTargetStaffMngID = p_strStaffMngID    'データ取得対象の職員管理番号
                If .mGetNotApproveList = False Then

                Else
                    '届出件数
                    w_lngRecCnt = .fNA_Count

                    For w_lngLoop = 1 To w_lngRecCnt
                        '索引
                        .mNA_Idx = w_lngLoop

                        If (M_STRJIKANGAI).Equals(.fNA_AppliCD) AndAlso ((m_strSelBusyoCD).Equals(W_strListALL) OrElse m_strSelBusyoCD.Equals(.fNA_ApproveKinmuDeptCD)) AndAlso (p_strStaffMngID).Equals(.fNA_AppliStaffMngID) Then

                            w_lngIdx = UBound(m_udtApproveData) + 1
                            ReDim Preserve m_udtApproveData(w_lngIdx)

                            '●UNIQUESEQNO
                            m_udtApproveData(w_lngIdx).strUNIQUESEQNO = .fNA_UNIQUESEQNO
                            '●届出コード
                            m_udtApproveData(w_lngIdx).strAppliCD = .fNA_AppliCD
                            '●届出名称
                            m_udtApproveData(w_lngIdx).strAppliNm = .fNA_AppliName
                            '●申請者職員管理番号
                            m_udtApproveData(w_lngIdx).strAppliStaffMngID = .fNA_AppliStaffMngID
                            '●申請者職員番号
                            m_udtApproveData(w_lngIdx).strAppliStaffID = .fNA_AppliStaffID
                            '●申請者氏名
                            m_udtApproveData(w_lngIdx).strAppliStaffName = .fNA_AppliStaffName
                            '●申請年月日
                            m_udtApproveData(w_lngIdx).lngAppliDate = .fNA_AppliDate
                            '●期間開始年月日
                            m_udtApproveData(w_lngIdx).lngPeriodFromDate = .fNA_PeriodFromDate
                            '●期間終了年月日
                            m_udtApproveData(w_lngIdx).lngPeriodToDate = .fNA_PeriodToDate
                            '●開始時間
                            m_udtApproveData(w_lngIdx).lngFromTime = .fNA_FromTime
                            '●終了時間
                            m_udtApproveData(w_lngIdx).lngToTime = .fNA_ToTime
                            '●翌日フラグ
                            m_udtApproveData(w_lngIdx).strNextDayFlg = .fNA_NextDayFlg
                            '●内容
                            m_udtApproveData(w_lngIdx).strContents = .fNA_Contents
                            '●理由
                            m_udtApproveData(w_lngIdx).strReasonNote = .fNA_ReasonNote
                            '●申請者承認状態区分
                            m_udtApproveData(w_lngIdx).strAppliApproveStatusKbn = .fNA_AppliApproveStatusKbn
                            '●申請者承認状態表示
                            m_udtApproveData(w_lngIdx).strAppliApproveStatusDisp = .fNA_AppliApproveStatusDisp
                            '●コメント
                            m_udtApproveData(w_lngIdx).strComment = .fNA_Comment
                            '●汎用エリア
                            m_udtApproveData(w_lngIdx).strHanyouArea = .fNA_HanyouArea
                            '●破棄年月日
                            m_udtApproveData(w_lngIdx).dblCancelDate = .fNA_CancelDate
                            '●最終更新年月日
                            m_udtApproveData(w_lngIdx).dblLastUpdTimeDate = .fNA_LastUpdTimeDate
                            '●画面制御区分
                            m_udtApproveData(w_lngIdx).strScreenCtrlKbn = .fNA_ScreenCtrlKbn
                            '●承認階層レベル
                            m_udtApproveData(w_lngIdx).lngApproveClassLvl = .fNA_ApproveClassLevel
                            '●承認者職員管理番号
                            m_udtApproveData(w_lngIdx).strApproveStaffMngID = .fNA_ApproveStaffMngID
                            '●承認者職員番号
                            m_udtApproveData(w_lngIdx).strApproveStaffID = .fNA_ApproveStaffID
                            '●承認者氏名
                            m_udtApproveData(w_lngIdx).strApproveStaffNm = .fNA_ApproveStaffName
                            '●承認状態区分(レベル別)
                            m_udtApproveData(w_lngIdx).strApproveStatusKbn = .fNA_ApproveStatusKbn
                            '●承認状態表示(レベル別)
                            m_udtApproveData(w_lngIdx).strApproveStatusDisp = .fNA_ApproveStatusDisp
                            '●申請者勤務部署コード
                            m_udtApproveData(w_lngIdx).strKinmuDeptCD = .fNA_ApproveKinmuDeptCD

                        End If

                    Next w_lngLoop
                End If
            End With

        Catch ex As Exception
            Call General.paTrpMsg(Convert.ToString(Err.Number), W_SUBNAME)
        End Try
    End Function

    '集計項目/集計対象勤務の取得
    Private Sub subGetMatrix()
        Const W_SUBNAME As String = "NSC0010HA subGetMatrix"

        Try
            Dim w_i As Integer
            Dim w_RecCnt As Integer 'ﾚｺｰﾄﾞ･ｶｳﾝﾄ
            'ﾏﾄﾘｯｸｽ別 変数
            Dim w_SumID As String '集計ID
            Dim w_str As String
            Dim w_Var As Object
            Dim w_j As Integer

            '一度も呼ばれていない場合のみ呼び出す
            If m_blnGetMatrix = True Then

                w_SumID = "NSC0000H"

                '各配列の初期化
                ReDim m_VMtrx(0) '･･･縦軸
                ReDim m_lngVMtrxCnt(0)

                '集計ID
                General.g_objGetMaster.pMtrx_SumID = w_SumID

                '取得実行
                If General.g_objGetMaster.mGetMatrix = False Then

                Else
                    'ﾃﾞｰﾀが存在した場合

                    '=================部品取得縦を横で取得する======================-
                    '縦集計件数取得
                    '横集計件数取得
                    w_RecCnt = General.g_objGetMaster.fMtrx_HSumCount

                    'ﾏﾄﾘｯｸｽ配列 一時的に確保
                    ReDim m_VMtrx(w_RecCnt)
                    ReDim m_lngVMtrxCnt(w_RecCnt)

                    '縦集計件数分ﾙｰﾌﾟ
                    For w_i = 1 To w_RecCnt

                        'ｲﾝﾃﾞｯｸｽ引渡し
                        General.g_objGetMaster.mMtrx_HSumIdx = w_i

                        m_VMtrx(w_i).MtrxName = General.g_objGetMaster.fMtrx_HSumName
                        m_VMtrx(w_i).BunruiCD = General.g_objGetMaster.fMtrx_HSumBunruiCD
                        m_VMtrx(w_i).CntKbn = General.g_objGetMaster.fMtrx_HSumKbn
                        w_str = General.g_objGetMaster.fMtrx_HSumKinmuCD

                        If String.IsNullOrEmpty(Trim(w_str)) = False Then
                            w_Var = General.paSplit(w_str, ",")

                            '集計勤務コード配列確保
                            ReDim m_VMtrx(w_i).Calc(UBound(w_Var))

                            '集計勤務コード格納
                            For w_j = 1 To UBound(w_Var)
                                m_VMtrx(w_i).Calc(w_j).strKinmuCD = Convert.ToString(w_Var(w_j - 1))
                            Next w_j
                        End If

                        w_str = General.g_objGetMaster.fMtrx_HSumHiritsu
                        If String.IsNullOrEmpty(Trim(w_str)) = False Then
                            w_Var = General.paSplit(w_str, ",")

                            '集計比率格納
                            For w_j = 1 To UBound(w_Var)
                                m_VMtrx(w_i).Calc(w_j).sinRatio = CSng(w_Var(w_j - 1))
                            Next w_j
                        End If
                    Next w_i

                End If

                m_blnGetMatrix = False
            End If

        Catch ex As Exception
            Call General.paTrpMsg(Convert.ToString(Err.Number), W_SUBNAME)
        End Try
    End Sub

    '=====================
    '算定時間データ 取得
    '=====================
    Private Function fncGetSanteiTime(ByVal p_intIndex As Integer) As Boolean
        Const W_SUBNAME As String = "NSC0000HA fncGetSanteiTime"

        Try
            Dim w_i As Integer
            Dim w_KinmuIdx As Integer
            Dim w_intMax As Integer
            Dim w_blnResult As Boolean

            fncGetSanteiTime = False

            With General.g_objGetData
                .p病院CD = General.g_strHospitalCD
                .p看護単位CD = g_udtStaffHistory(p_intIndex).strKangoTaniCD
                .p採用条件CD = g_udtStaffHistory(p_intIndex).strSaiyouCD
                .p勤務CD = ""
                w_blnResult = .mGetKinmuTime '--- 勤務時間マスタデータ取得

                If w_blnResult = False Then
                    '時間マスタデータ取得できないので計算しない(ありえない)
                    Exit Function
                Else
                    '--- .f勤務時間件数
                    w_intMax = .f勤務時間件数

                    '時間マスタ取得条件に一致した場合
                    For w_i = 1 To w_intMax
                        '----------------------
                        '   各算定時間 取得
                        '----------------------
                        .p勤務時間索引 = w_i

                        '--- .f勤務CD
                        w_KinmuIdx = .f勤務CD

                        '--- .f当日休日算定時間
                        g_udtHistory(p_intIndex).SanteiTime(w_KinmuIdx).TodayOff = .f当日休日算定時間
                        '--- .f翌日休日算定時間
                        g_udtHistory(p_intIndex).SanteiTime(w_KinmuIdx).NextOff = .f翌日休日算定時間
                        '--- .f当日夜間算定時間
                        g_udtHistory(p_intIndex).SanteiTime(w_KinmuIdx).Tonight = .f当日夜間算定時間
                        '--- .f翌日夜間算定時間
                        g_udtHistory(p_intIndex).SanteiTime(w_KinmuIdx).NextNight = .f翌日夜間算定時間
                        '--- .f前半開始時刻
                        g_udtHistory(p_intIndex).SanteiTime(w_KinmuIdx).FormalTimeFrom = .f前半開始時刻
                        '--- .f後半終了時刻
                        g_udtHistory(p_intIndex).SanteiTime(w_KinmuIdx).FormalTimeTo = .f後半終了時刻
                        '--- .f実勤務時間
                        g_udtHistory(p_intIndex).SanteiTime(w_KinmuIdx).JituKinmuTime = .f実勤務時間
                    Next w_i
                End If
            End With

            '正常終了
            fncGetSanteiTime = True

        Catch ex As Exception
            Call General.paTrpMsg(Convert.ToString(Err.Number), W_SUBNAME)
        End Try
    End Function

    '========================
    '   代休管理データ 取得
    '========================
    Private Function fncGetDaikyuData(ByVal p_lngFrom As Integer, ByVal p_lngTo As Integer, ByVal p_StaffMngID As Object) As Boolean
        Dim w_PreErrorProc As String
        w_PreErrorProc = General.g_ErrorProc 'ﾌﾟﾛｼｰｼﾞｬ名の一時待避
        General.g_ErrorProc = "NSC0000HA fncGetDaikyuData"

        Dim w_strSql As String
        Dim w_Rs As ADODB.Recordset

        Try
            Dim w_lngDataCnt As Integer
            Dim w_Idx As Integer
            Dim w_YMD_F As ADODB.Field

            fncGetDaikyuData = False
            ReDim m_DaikyuDate(0)

            w_strSql = ""
            w_strSql = w_strSql & "SELECT"
            w_strSql = w_strSql & " WORKHOLKINMUDATE "
            w_strSql = w_strSql & "FROM"
            w_strSql = w_strSql & " NS_DAIKYUMNG_F "
            w_strSql = w_strSql & "WHERE HOSPITALCD = '" & General.g_strHospitalCD & "'"
            w_strSql = w_strSql & "  AND STAFFMNGID = '" & p_StaffMngID & "'"
            w_strSql = w_strSql & "  AND WORKHOLKINMUDATE >= " & p_lngFrom & " "
            w_strSql = w_strSql & "  AND WORKHOLKINMUDATE <= " & p_lngTo & " "
            w_strSql = w_strSql & "ORDER BY"
            w_strSql = w_strSql & " WORKHOLKINMUDATE "

            'カーソル作成
            w_Rs = General.paDBRecordSetOpen(w_strSql)

            With w_Rs
                If .RecordCount <= 0 Then
                    w_lngDataCnt = 0
                Else
                    .MoveLast()
                    w_lngDataCnt = .RecordCount
                    .MoveFirst()

                    w_YMD_F = .Fields("WORKHOLKINMUDATE")
                End If

                ReDim m_DaikyuDate(w_lngDataCnt)

                For w_Idx = 1 To w_lngDataCnt
                    m_DaikyuDate(w_Idx) = Integer.Parse(General.paGetDbFieldVal(w_YMD_F, 0))
                    .MoveNext()
                Next w_Idx

                .Close()
            End With

            w_Rs = Nothing

            fncGetDaikyuData = True

            General.g_ErrorProc = w_PreErrorProc '待避ﾌﾟﾛｼｰｼﾞｬ名を元に戻す

        Catch ex As Exception
            w_Rs = Nothing
            Throw
        End Try
    End Function

    Private Function fncChangeStrTime(ByVal p_strTime As String) As String
        Const W_SUBNAME As String = "frmNSC0000HA fncChangeStrTime"

        Try
            Dim w_WorkTime As String
            Dim w_strTime As String

            If String.IsNullOrEmpty(p_strTime) Then
                p_strTime = "0000"
            End If

            w_WorkTime = General.paSetFrontSpase(General.paFormatZero(Integer.Parse(p_strTime), 4), 4)

            w_strTime = General.paLeft(w_WorkTime, 2) & ":" & General.paRight(w_WorkTime, 2)

            fncChangeStrTime = w_strTime

        Catch ex As Exception
            Call General.paTrpMsg(Convert.ToString(Err.Number), W_SUBNAME)
        End Try
    End Function

    '==============================================================
    '確定済みかを検索する
    '   戻り値：True（確定済），False（未確定）
    '==============================================================
    Private Function SearchDeptKakuteiData(ByVal p_PlanNo As Integer, ByRef p_strSelKinmuDeptCD As String, ByRef p_strHospitalCD As String) As Boolean
        Const W_SUBNAME As String = "NSC0000HA SearchDeptKakuteiData"

        Try
            Dim w_Sql As String
            Dim w_Rs As ADODB.Recordset
            Dim w_Bool As Boolean

            w_Sql = "SELECT DECISIONDATE"
            w_Sql = w_Sql & " FROM NS_PLANDECISION_F"
            w_Sql = w_Sql & " WHERE PLANNO = " & Convert.ToString(p_PlanNo)
            w_Sql = w_Sql & " AND KINMUDEPTCD = '" & p_strSelKinmuDeptCD & "'"
            w_Sql = w_Sql & " AND HOSPITALCD = '" & p_strHospitalCD & "'"
            w_Sql = w_Sql & " "
            w_Rs = General.paDBRecordSetOpen(w_Sql)

            With w_Rs
                If .RecordCount <= 0 Then
                    'ﾃﾞｰﾀ無しの場合は未確定
                    w_Bool = False
                Else
                    'ﾃﾞｰﾀありの場合は未確定（1件のみ）
                    w_Bool = True
                End If
            End With
            w_Rs.Close()

            '戻り値設定
            SearchDeptKakuteiData = w_Bool

        Catch ex As Exception
            Call General.paTrpMsg(Convert.ToString(Err.Number), W_SUBNAME)
        End Try
    End Function

    '---------------------------------------------------
    '日当直取得(１日)
    '引数　 ・・・・Byval p_lngDate          (年月日)
    '       ・・・・Byval p_strStaffMngID    (職員管理番号)
    '       ・・・・Byref p_strKinmuCD       (勤務コード)
    '       ・・・・Byref p_strKinmuNm       (勤務名称)
    '       ・・・・Byref p_strGroupCD       (グループコード)
    '       ・・・・Byref p_strGroupNm       (グループ名称)
    '       ・・・・Byval p_strTargetGroupCD (対象グループコード)
    '戻り値 データ有り：True
    '       データ無し：False
    '---------------------------------------------------
    Public Function fncDayDuty(ByVal p_lngDate As Integer, ByVal p_strStaffMngID As String, ByRef p_strKinmuCD() As String, ByRef p_strKinmuNm() As String, ByRef p_strGroupCD() As String, ByRef p_strGroupNm() As String, ByVal p_strTargetGroupCD As String) As Boolean
        Const W_SUBNAME As String = "frmNSC0000HA fncDayDuty"

        Try
            Dim w_lngDutyDayCnt As Integer
            Dim w_lngDutyDayLoop As Integer
            Dim w_lngIdx As Integer
            Const W_strGroupALL As String = "00"

            '初期値
            fncDayDuty = False
            ReDim p_strKinmuCD(0)
            ReDim p_strKinmuNm(0)
            ReDim p_strGroupCD(0)
            ReDim p_strGroupNm(0)
            w_lngIdx = 0

            With General.g_objGetData
                .p病院CD = General.g_strHospitalCD '施設コード
                .p職員区分 = 0 '職員管理番号指定
                .p職員番号 = p_strStaffMngID '職員管理番号
                .p日付区分 = 0 '単一日
                .p開始年月日 = p_lngDate '開始日
                '当日の日当直を取得
                If .mGetDuty = False Then
                    'ﾃﾞｰﾀがない場合
                    Exit Function
                Else
                    'ﾃﾞｰﾀが存在する場合（条件がｷｰ項目一意のため１件のみ）
                    .p日当直年月日 = p_lngDate
                    '日別件数(１日に２件あり)
                    w_lngDutyDayCnt = .f日当直日別件数

                    For w_lngDutyDayLoop = 1 To w_lngDutyDayCnt
                        .p日当直日別索引 = w_lngDutyDayLoop

                        If .f日当直年月日 > 0 Then
                            '指定された日当直グループコードがすべての場合か、
                            '指定された日当直グループコードの場合
                            If (W_strGroupALL).Equals(p_strTargetGroupCD) OrElse p_strTargetGroupCD.Equals(.f日当直勤務グループCD) Then
                                '配列インデックス加算
                                w_lngIdx = w_lngIdx + 1
                                ReDim Preserve p_strKinmuCD(w_lngIdx)
                                ReDim Preserve p_strKinmuNm(w_lngIdx)
                                ReDim Preserve p_strGroupCD(w_lngIdx)
                                ReDim Preserve p_strGroupNm(w_lngIdx)

                                p_strKinmuCD(w_lngIdx) = .f日当直勤務CD
                                p_strKinmuNm(w_lngIdx) = .f日当直勤務名称
                                p_strGroupCD(w_lngIdx) = .f日当直勤務グループCD
                                p_strGroupNm(w_lngIdx) = .f日当直勤務グループ名称
                            End If
                        End If
                    Next w_lngDutyDayLoop
                End If
            End With

            '正常終了
            fncDayDuty = True

        Catch ex As Exception
            Call General.paTrpMsg(Convert.ToString(Err.Number), W_SUBNAME)
        End Try
    End Function

    '---------------------------------------------------
    '日当直用出退勤取得(１日)
    '引数　 ・・・・Byval p_lngDate         (年月日)
    '       ・・・・Byval p_lngTime         (指定時刻)
    '       ・・・・Byval p_strStaffIndex   (職員管理番号)
    '戻り値 データ有り：True
    '       データ無し：False
    '---------------------------------------------------
    Public Function fncDutyDakoku(ByVal p_lngDate As Integer, ByVal p_lngTime As Integer, ByVal p_strStaffIndex As Integer) As Boolean
        Const W_SUBNAME As String = "frmNSC0000HA fncDutyDakoku"

        Try
            Dim w_lngDayCnt As Integer
            Dim w_lngLoop As Integer
            Dim w_lngIdx As Integer

            '初期値
            fncDutyDakoku = False

            w_lngIdx = 0

            With General.g_objGetData
                .p病院CD = General.g_strHospitalCD '施設コード
                .p職員区分 = 0 '職員管理番号指定
                .p職員番号 = m_udtDayDutyStaff(p_strStaffIndex).strStaffMngID '職員管理番号
                .p指定年月日 = p_lngDate '指定年月日
                .p在院FLG = 0 '0：在院状況を確認する、1：在院状況を確認しない
                .p指定時間 = p_lngTime '指定時刻
                .p打刻区分 = 0 '0：勤務を元として取得（規定値）1：ｶﾚﾝﾀﾞｰを元として取得
                '打刻を取得
                If .mGetDakoku = False Then
                    'ﾃﾞｰﾀがない場合
                    m_udtDayDutyStaff(p_strStaffIndex).blnZaiinFlg = False
                    Exit Function
                Else

                    '打刻件数
                    w_lngDayCnt = .f打刻件数

                    For w_lngLoop = 1 To w_lngDayCnt
                        '索引
                        .p打刻索引 = w_lngLoop

                        '取得
                        m_udtDayDutyStaff(p_strStaffIndex).blnZaiinFlg = .f在院状況

                    Next w_lngLoop
                End If
            End With

            '正常終了
            fncDutyDakoku = True

        Catch ex As Exception
            Call General.paTrpMsg(Convert.ToString(Err.Number), W_SUBNAME)
        End Try
    End Function

    '===================================================================
    '【部署業務】 or 【出退勤】
    '===================================================================
    Private Sub tvwKinmuDept_NodeClick(ByVal eventSender As System.Object, ByVal eventArgs As System.Windows.Forms.TreeViewEventArgs) Handles tvwKinmuDept.AfterSelect
        Dim Node As System.Windows.Forms.TreeNode = eventArgs.Node
        Const W_SUBNAME As String = "NSC0000HA tvwKinmuDept_NodeClick"

        Try
            Dim w_strNodeKey As String
            Dim w_RegStr As String
            Dim w_lngDate As Integer
            Dim w_lngLoop As Integer
            Dim w_lngLoop2 As Integer
            Dim w_strStaffMngID As String
            Dim w_strKinmuCD As String = String.Empty
            Dim w_strKinmuNm As String = String.Empty
            Dim w_strKinmuSecNm As String = String.Empty
            Dim w_strKinmuMark As String = String.Empty
            Dim w_strKinmuResonKbn As String = String.Empty
            Dim w_lngTime As Integer
            Dim w_lngDakokuDate() As Integer
            Dim w_lngDakokuSEQ() As Integer
            Dim w_lngDakokuTime() As Integer
            Dim w_strDakokuKbn() As String
            Dim w_strTekiyoCD() As String
            Dim w_strTekiyoNm() As String
            Dim w_strFinFlg() As String
            Dim w_blnZainFlg() As Boolean
            Dim w_lngPreFrom As Integer '対象期間開始年月日前日
            Dim w_lngTo As Integer '対象期間終了年月日
            Dim w_lng125 As Integer '125/100
            Dim w_lng150 As Integer '150/100
            Dim w_lng135 As Integer '135/100
            Dim w_lng160 As Integer '160/100
            Dim w_lng100 As Integer '100/100
            Dim w_Sql As String
            Dim w_Cnt As Integer
            Dim w_i As Integer
            Dim w_Persent As Integer
            Dim w_PersentTemp As Integer
            Dim w_Persent2 As Integer
            Dim w_Total As Integer
            Dim w_SumNum As Integer
            Dim w_NowDate As Integer
            Dim w_OldText As String
            Dim w_StaffID As String

            Dim w_Rs As ADODB.Recordset
            Dim w_職員管理番号_F As ADODB.Field
            Dim w_職員番号_F As ADODB.Field
            Dim w_氏名_F As ADODB.Field
            Dim w_性別_F As ADODB.Field
            Dim w_生年月日_F As ADODB.Field
            Dim w_採用年月日_F As ADODB.Field
            Dim w_転退年月日_F As ADODB.Field
            Dim w_経験年数_F As ADODB.Field
            Dim w_氏名カナ_F As ADODB.Field

            Dim w_strHalfKinmuFlg As String = String.Empty
            Dim w_lngBeforeTotal As Integer
            Dim w_lngAfterTotal As Integer
            Dim w_JissekiGotFlg As Boolean = False '時間外選択時の勤務実績有無フラグ 

            Dim w_WarddeptFlg As String '勤務＝配属フラグ（"1"：勤務＝配属、"0"：勤務≠配属)

            '選択ノートがなければ動作しない
            If IsNothing(tvwKinmuDept.SelectedNode) Then
                Exit Sub
            End If

            w_WarddeptFlg = General.paGetItemValue(General.G_STRMAINKEY1, General.G_STRSECTION1, "WORDDEPTFLG", "0", General.g_strHospitalCD)
            m_selNoConfFlg = False

            'ﾏｳｽﾎﾟｲﾝﾀを砂時計に
            Me.Cursor = System.Windows.Forms.Cursors.WaitCursor

            'ノードキー
            w_strNodeKey = Node.Name

            m_strRefreshList = Node.Name

            If (M_DEPT_RESCD).Equals(g_MenuM(g_lngGroupIdx).ListBarMenu(g_lngListIdx).strResCD) Then
                '=======================
                '部署業務
                '=======================
                '勤務部署選択時のみ
                If (M_NodeKey_DEPT).Equals(General.paLeft(w_strNodeKey, 4)) Then

                    '選択部署インデックス
                    m_lngDefDeptIdx = Integer.Parse(Mid(w_strNodeKey, 5))

                    '●選択勤務部署コード
                    General.g_strSelKinmuDeptCD = m_udtKinmuDept(m_lngDefDeptIdx).strDeptCD
                    '●選択勤務部署名称
                    General.g_strSelKinmuDeptNm = m_udtKinmuDept(m_lngDefDeptIdx).strDeptName

                    g_strSelSaikeiFlg = m_udtKinmuDept(m_lngDefDeptIdx).strSaikeiFlg

                    '●リストビュー初期設定
                    Call sSetListView()

                    '●勤務部署職員 取得
                    Call sGetKinmuDeptStaff()

                    ReDim m_udtDayKinmuJisseki(UBound(m_udtStaffData)) '勤務実績取得(１日取得用)
                    ReDim m_udtOverKinmuTotal(UBound(m_udtStaffData)) '時間外状況取得

                    If (M_DEPT_KINMUINFO).Equals(m_strSelChildMenu) Then
                        '===============
                        '■勤務状況
                        '===============
                        '対象日
                        w_lngDate = General.paGetDateIntegerFromDate(m_CalDate)
                        For w_lngLoop = 1 To UBound(m_udtStaffData)
                            '職員管理番号
                            w_strStaffMngID = m_udtStaffData(w_lngLoop).strStaffMngID
                            If fncDayKinmuJisseki(w_lngDate, w_strStaffMngID, w_strKinmuCD, w_strKinmuNm, w_strKinmuSecNm, w_strKinmuMark, w_strKinmuResonKbn, w_strHalfKinmuFlg) = False Then

                                '勤務コード
                                m_udtDayKinmuJisseki(w_lngLoop).strKinmuCD = ""
                                '勤務名称
                                m_udtDayKinmuJisseki(w_lngLoop).strKinmuNm = ""
                                '勤務略称
                                m_udtDayKinmuJisseki(w_lngLoop).strKinmuSecNm = ""
                                '勤務記号
                                m_udtDayKinmuJisseki(w_lngLoop).strKinmuMark = ""
                                '勤務理由
                                m_udtDayKinmuJisseki(w_lngLoop).strKinmuReasonKbn = ""
                                '半日勤務FLG
                                m_udtDayKinmuJisseki(w_lngLoop).strHalfKinmuFlg = ""
                            Else
                                '勤務コード
                                m_udtDayKinmuJisseki(w_lngLoop).strKinmuCD = w_strKinmuCD
                                '勤務名称
                                m_udtDayKinmuJisseki(w_lngLoop).strKinmuNm = w_strKinmuNm
                                '勤務略称
                                m_udtDayKinmuJisseki(w_lngLoop).strKinmuSecNm = w_strKinmuSecNm
                                '勤務記号
                                m_udtDayKinmuJisseki(w_lngLoop).strKinmuMark = w_strKinmuMark
                                '勤務理由
                                m_udtDayKinmuJisseki(w_lngLoop).strKinmuReasonKbn = w_strKinmuResonKbn
                                '半日勤務FLG
                                m_udtDayKinmuJisseki(w_lngLoop).strHalfKinmuFlg = w_strHalfKinmuFlg
                            End If
                        Next w_lngLoop

                        '部署コード　＆　部署名称
                        lblSearchData.Text = m_udtKinmuDept(m_lngDefDeptIdx).strDeptName & Space(1) & Format(m_CalDate, "MM月dd日") & "(" & General.paGetWeekName(m_CalDate) & ")" & "　勤務状況"
                        lblSearchData.ForeColor = System.Drawing.Color.Blue
                        'lblSearchData.Font = New Font("ＭＳ ゴシック", 11.25F, FontStyle.Bold)
                    Else
                        '===============
                        '■時間外状況
                        '===============
                        w_lngPreFrom = General.paGetDateIntegerFromDate(DateAdd(Microsoft.VisualBasic.DateInterval.Day, -1, m_DateFrom))
                        w_lngTo = General.paGetDateIntegerFromDate(m_DateTo)

                        For w_lngLoop = 1 To UBound(m_udtStaffData)
                            w_lng125 = 0
                            w_lng150 = 0
                            w_lng135 = 0
                            w_lng160 = 0
                            w_lng100 = 0


                            w_lngBeforeTotal = 0
                            w_lngAfterTotal = 0
                            w_strStaffMngID = m_udtStaffData(w_lngLoop).strStaffMngID
                            If fncOverKinmuTotal(w_lngPreFrom, w_lngTo, w_lngLoop, w_lng125, w_lng150, w_lng135, w_lng160, w_lng100, w_lngBeforeTotal, w_lngAfterTotal) = True Then
                                '●125/100
                                m_udtOverKinmuTotal(w_lngLoop).lng125 = w_lng125
                                '●150/100
                                m_udtOverKinmuTotal(w_lngLoop).lng150 = w_lng150
                                '●135/100
                                m_udtOverKinmuTotal(w_lngLoop).lng135 = w_lng135
                                '●160/100
                                m_udtOverKinmuTotal(w_lngLoop).lng160 = w_lng160
                                '●100/100
                                m_udtOverKinmuTotal(w_lngLoop).lng100 = w_lng100
                                '●合計
                                m_udtOverKinmuTotal(w_lngLoop).lngTotal = w_lng125 + w_lng150 + w_lng135 + w_lng160 + w_lng100
                            End If
                        Next w_lngLoop

                        '部署コード　＆　部署名称
                        lblSearchData.Text = m_udtKinmuDept(m_lngDefDeptIdx).strDeptName & Space(1) & Format(m_DateTo, "MM月") & "　時間外状況"
                        lblSearchData.ForeColor = System.Drawing.Color.Blue
                        'lblSearchData.Font = New Font("ＭＳ ゴシック", 11.25F, FontStyle.Bold)
                        '============================================================================================================================================

                    End If

                    '●リストビュー 表示
                    Call sDispListView()

                    '勤務部署設定の計画作成区分="2"の場合は、計画作成/計画変更を非表示にする
                    '　　　　　〃　　　　　　　="1"の場合は、勤務自動作成バッチを非表示にする
                    For w_lngLoop = 1 To UBound(m_udtChildMenu)
                        If (M_DEPT_MAKEKINMU_NEW).Equals(m_udtChildMenu(w_lngLoop).strResCD) OrElse (M_DEPT_MAKEKINMU_CHG).Equals(m_udtChildMenu(w_lngLoop).strResCD) Then

                            If "1".Equals(m_udtKinmuDept(m_lngDefDeptIdx).strPlanMakeFlg) Then
                                stbMenuMain.Items(w_lngLoop - 1).Visible = True
                            Else
                                stbMenuMain.Items(w_lngLoop - 1).Visible = False
                            End If
                        ElseIf (M_DEPT_MAKEKINMU_NIGHTCREATE).Equals(m_udtChildMenu(w_lngLoop).strResCD) Then
                            If "1".Equals(m_udtKinmuDept(m_lngDefDeptIdx).strPlanMakeFlg) Then
                                stbMenuMain.Items(w_lngLoop - 1).Visible = False
                            Else
                                stbMenuMain.Items(w_lngLoop - 1).Visible = True
                            End If

                            '実績変更ﾎﾞﾀﾝを表示しない
                        ElseIf (M_DEPT_MAKEKINMU_RESULT).Equals(m_udtChildMenu(w_lngLoop).strResCD) Then
                            stbMenuMain.Items(w_lngLoop - 1).Visible = False
                        End If
                    Next w_lngLoop

                    '選択部署レジストリ書き込み
                    w_RegStr = General.G_SYSTEM_WIN7 & "\" & General.G_STRMAINKEY1
                    '●選択勤務部署コード
                    Call General.paSaveSetting(w_RegStr, "Current", "KINMUDEPTCD", General.g_strSelKinmuDeptCD)
                    '●選択勤務部署名称
                    Call General.paSaveSetting(w_RegStr, "Current", "KINMUDEPTNM", General.g_strSelKinmuDeptNm)
                End If


            ElseIf (M_DAKOKU_RESCD).Equals(g_MenuM(g_lngGroupIdx).ListBarMenu(g_lngListIdx).strResCD) Then
                '=======================
                '出退勤業務
                '=======================
                '時刻を更新
                If m_selectTimeMenuFlg = True Then
                    m_selectTimeMenuFlg = False
                    imtSelectTime.Text = Format(Now, "HH:mm")
                    lblTime.Text = imtSelectTime.Text
                End If
                '基準時刻
                w_lngTime = Integer.Parse(imtSelectTime.GetHourTime & imtSelectTime.GetMinTime)

                '勤務部署選択時のみ ★注意★ 後で部署以外を選択時の対応をする
                If M_NodeKey_DEPT.Equals(General.paLeft(w_strNodeKey, 4)) Then

                    '選択部署インデックス
                    m_lngDefDeptIdx = Integer.Parse(Mid(w_strNodeKey, 5))

                    '●選択勤務部署コード
                    General.g_strSelKinmuDeptCD = m_udtKinmuDept(m_lngDefDeptIdx).strDeptCD
                    '●選択勤務部署名称
                    General.g_strSelKinmuDeptNm = m_udtKinmuDept(m_lngDefDeptIdx).strDeptName

                    g_strSelSaikeiFlg = m_udtKinmuDept(m_lngDefDeptIdx).strSaikeiFlg

                    '●リストビュー初期設定
                    Call sSetListView()

                    '●勤務部署職員 取得
                    Call sGetKinmuDeptStaff()

                    '●勤務実績取得(１日取得用)
                    ReDim m_udtDayKinmuJisseki(UBound(m_udtStaffData))
                    '対象日
                    w_lngDate = General.paGetDateIntegerFromDate(m_CalDate)
                    For w_lngLoop = 1 To UBound(m_udtStaffData)
                        '職員管理番号
                        w_strStaffMngID = m_udtStaffData(w_lngLoop).strStaffMngID
                        If fncDayKinmuJisseki(w_lngDate, w_strStaffMngID, w_strKinmuCD, w_strKinmuNm, w_strKinmuSecNm, w_strKinmuMark, w_strKinmuResonKbn, w_strHalfKinmuFlg) = False Then
                            '勤務コード
                            m_udtDayKinmuJisseki(w_lngLoop).strKinmuCD = ""
                            '勤務名称
                            m_udtDayKinmuJisseki(w_lngLoop).strKinmuNm = ""
                            '勤務略称
                            m_udtDayKinmuJisseki(w_lngLoop).strKinmuSecNm = ""
                            '勤務記号
                            m_udtDayKinmuJisseki(w_lngLoop).strKinmuMark = ""
                            '勤務理由
                            m_udtDayKinmuJisseki(w_lngLoop).strKinmuReasonKbn = ""
                            '半日勤務FLG
                            m_udtDayKinmuJisseki(w_lngLoop).strHalfKinmuFlg = ""
                        Else
                            '勤務コード
                            m_udtDayKinmuJisseki(w_lngLoop).strKinmuCD = w_strKinmuCD
                            '勤務名称
                            m_udtDayKinmuJisseki(w_lngLoop).strKinmuNm = w_strKinmuNm
                            '勤務略称
                            m_udtDayKinmuJisseki(w_lngLoop).strKinmuSecNm = w_strKinmuSecNm
                            '勤務記号
                            m_udtDayKinmuJisseki(w_lngLoop).strKinmuMark = w_strKinmuMark
                            '勤務理由
                            m_udtDayKinmuJisseki(w_lngLoop).strKinmuReasonKbn = w_strKinmuResonKbn
                            '半日勤務FLG
                            m_udtDayKinmuJisseki(w_lngLoop).strHalfKinmuFlg = w_strHalfKinmuFlg
                        End If
                    Next w_lngLoop


                    '●出退勤取得(１日取得用)
                    ReDim m_udtDayDakokuData(UBound(m_udtStaffData))
                    For w_lngLoop = 1 To UBound(m_udtStaffData)
                        '職員管理番号
                        w_strStaffMngID = m_udtStaffData(w_lngLoop).strStaffMngID
                        If fncDayDakoku(w_lngDate, w_lngTime, w_strStaffMngID, w_lngDakokuDate, w_lngDakokuSEQ, w_lngDakokuTime, w_strDakokuKbn, w_strTekiyoCD, w_strTekiyoNm, w_strFinFlg, w_blnZainFlg) = False Then
                            '打刻なし
                            ReDim m_udtDayDakokuData(w_lngLoop).Detail(0)
                        Else
                            '打刻用配列確保
                            ReDim m_udtDayDakokuData(w_lngLoop).Detail(UBound(w_lngDakokuDate))

                            For w_lngLoop2 = 1 To UBound(w_lngDakokuDate)
                                '打刻年月日
                                m_udtDayDakokuData(w_lngLoop).Detail(w_lngLoop2).lngDakokuDate = w_lngDakokuDate(w_lngLoop2)
                                '打刻SEQ
                                m_udtDayDakokuData(w_lngLoop).Detail(w_lngLoop2).lngSEQ = w_lngDakokuSEQ(w_lngLoop2)
                                '打刻時間
                                m_udtDayDakokuData(w_lngLoop).Detail(w_lngLoop2).lngTime = w_lngDakokuTime(w_lngLoop2)
                                '打刻区分
                                m_udtDayDakokuData(w_lngLoop).Detail(w_lngLoop2).strKBN = w_strDakokuKbn(w_lngLoop2)
                                '打刻摘要コード
                                m_udtDayDakokuData(w_lngLoop).Detail(w_lngLoop2).strTekiyoCD = w_strTekiyoCD(w_lngLoop2)
                                '打刻摘要名称
                                m_udtDayDakokuData(w_lngLoop).Detail(w_lngLoop2).strTekiyoNm = w_strTekiyoNm(w_lngLoop2)
                                '処理済みフラグ
                                m_udtDayDakokuData(w_lngLoop).Detail(w_lngLoop2).strManageFinish = w_strFinFlg(w_lngLoop2)
                                '在院フラグ
                                m_udtDayDakokuData(w_lngLoop).blnZaiinFlg = w_blnZainFlg(w_lngLoop2)

                            Next w_lngLoop2
                        End If
                    Next w_lngLoop

                    'エラーチェックの場合のみ呼出
                    If m_strSelChildMenu = M_DAKOKU_ERROR_DSP Then
                        Call sCheckDakoku()
                    End If

                    '●リストビュー 表示
                    Call sDispListView()

                    '日付
                    lblSearchData.Text = Format(m_CalDate, "yyyy年MM月dd日") & "(" & General.paGetWeekName(m_CalDate) & ")" & Space(2) & Format(w_lngTime, "00:00") & " 現在"
                    lblSearchData.ForeColor = System.Drawing.Color.Blue
                    'lblSearchData.Font = New Font("ＭＳ ゴシック", 11.25F, FontStyle.Bold)

                End If


            ElseIf (M_ZAIIN_RESCD).Equals(g_MenuM(g_lngGroupIdx).ListBarMenu(g_lngListIdx).strResCD) Then
                '=======================
                '在院照会
                '=======================
                If m_selectTimeMenuFlg = True Then
                    m_selectTimeMenuFlg = False
                    imtSelectTime.Text = Format(Now, "HH:mm")
                    lblTime.Text = imtSelectTime.Text
                End If
                '基準時刻
                w_lngTime = Integer.Parse(imtSelectTime.GetHourTime & imtSelectTime.GetMinTime)

                '勤務部署選択時のみ ★注意★ 後で部署以外を選択時の対応をする
                If M_NodeKey_DEPT.Equals(General.paLeft(w_strNodeKey, 4)) Then

                    '選択部署インデックス
                    m_lngDefDeptIdx = Integer.Parse(Mid(w_strNodeKey, 5))

                    '●選択勤務部署コード
                    General.g_strSelKinmuDeptCD = m_udtKinmuDept(m_lngDefDeptIdx).strDeptCD
                    '●選択勤務部署名称
                    General.g_strSelKinmuDeptNm = m_udtKinmuDept(m_lngDefDeptIdx).strDeptName
                    g_strSelSaikeiFlg = m_udtKinmuDept(m_lngDefDeptIdx).strSaikeiFlg

                    '●リストビュー初期設定
                    Call sSetListView()

                    '●勤務部署職員 取得
                    Call sGetKinmuDeptStaff()

                    '●勤務実績取得(１日取得用)
                    ReDim m_udtDayKinmuJisseki(UBound(m_udtStaffData))
                    '対象日
                    w_lngDate = General.paGetDateIntegerFromDate(m_CalDate)
                    For w_lngLoop = 1 To UBound(m_udtStaffData)
                        '職員管理番号
                        w_strStaffMngID = m_udtStaffData(w_lngLoop).strStaffMngID
                        If fncDayKinmuJisseki(w_lngDate, w_strStaffMngID, w_strKinmuCD, w_strKinmuNm, w_strKinmuSecNm, w_strKinmuMark, w_strKinmuResonKbn, w_strHalfKinmuFlg) = False Then
                            '勤務コード
                            m_udtDayKinmuJisseki(w_lngLoop).strKinmuCD = ""
                            '勤務名称
                            m_udtDayKinmuJisseki(w_lngLoop).strKinmuNm = ""
                            '勤務略称
                            m_udtDayKinmuJisseki(w_lngLoop).strKinmuSecNm = ""
                            '勤務記号
                            m_udtDayKinmuJisseki(w_lngLoop).strKinmuMark = ""
                            '勤務理由
                            m_udtDayKinmuJisseki(w_lngLoop).strKinmuReasonKbn = ""
                            '半日勤務FLG
                            m_udtDayKinmuJisseki(w_lngLoop).strHalfKinmuFlg = ""
                        Else
                            '勤務コード
                            m_udtDayKinmuJisseki(w_lngLoop).strKinmuCD = w_strKinmuCD
                            '勤務名称
                            m_udtDayKinmuJisseki(w_lngLoop).strKinmuNm = w_strKinmuNm
                            '勤務略称
                            m_udtDayKinmuJisseki(w_lngLoop).strKinmuSecNm = w_strKinmuSecNm
                            '勤務記号
                            m_udtDayKinmuJisseki(w_lngLoop).strKinmuMark = w_strKinmuMark
                            '勤務理由
                            m_udtDayKinmuJisseki(w_lngLoop).strKinmuReasonKbn = w_strKinmuResonKbn
                            '半日勤務FLG
                            m_udtDayKinmuJisseki(w_lngLoop).strHalfKinmuFlg = w_strHalfKinmuFlg
                        End If
                    Next w_lngLoop

                    '●出退勤取得(１日取得用)
                    ReDim m_udtDayDakokuData(UBound(m_udtStaffData))
                    For w_lngLoop = 1 To UBound(m_udtStaffData)
                        '職員管理番号
                        w_strStaffMngID = m_udtStaffData(w_lngLoop).strStaffMngID
                        If fncDayDakoku(w_lngDate, w_lngTime, w_strStaffMngID, w_lngDakokuDate, w_lngDakokuSEQ, w_lngDakokuTime, w_strDakokuKbn, w_strTekiyoCD, w_strTekiyoNm, w_strFinFlg, w_blnZainFlg) = False Then
                            '打刻なし
                            ReDim m_udtDayDakokuData(w_lngLoop).Detail(0)
                        Else
                            '打刻用配列確保
                            ReDim m_udtDayDakokuData(w_lngLoop).Detail(UBound(w_lngDakokuDate))

                            For w_lngLoop2 = 1 To UBound(w_lngDakokuDate)
                                '打刻年月日
                                m_udtDayDakokuData(w_lngLoop).Detail(w_lngLoop2).lngDakokuDate = w_lngDakokuDate(w_lngLoop2)
                                '打刻SEQ
                                m_udtDayDakokuData(w_lngLoop).Detail(w_lngLoop2).lngSEQ = w_lngDakokuSEQ(w_lngLoop2)
                                '打刻時間
                                m_udtDayDakokuData(w_lngLoop).Detail(w_lngLoop2).lngTime = w_lngDakokuTime(w_lngLoop2)
                                '打刻区分
                                m_udtDayDakokuData(w_lngLoop).Detail(w_lngLoop2).strKBN = w_strDakokuKbn(w_lngLoop2)
                                '打刻摘要コード
                                m_udtDayDakokuData(w_lngLoop).Detail(w_lngLoop2).strTekiyoCD = w_strTekiyoCD(w_lngLoop2)
                                '打刻摘要名称
                                m_udtDayDakokuData(w_lngLoop).Detail(w_lngLoop2).strTekiyoNm = w_strTekiyoNm(w_lngLoop2)
                                '処理済みフラグ
                                m_udtDayDakokuData(w_lngLoop).Detail(w_lngLoop2).strManageFinish = w_strFinFlg(w_lngLoop2)
                                '在院フラグ
                                m_udtDayDakokuData(w_lngLoop).blnZaiinFlg = w_blnZainFlg(w_lngLoop2)
                            Next w_lngLoop2
                        End If
                    Next w_lngLoop

                    '●リストビュー 表示
                    Call sDispListView()

                    '日付

                    lblSearchData.Text = Format(m_CalDate, "yyyy年MM月dd日") & "(" & General.paGetWeekName(m_CalDate) & ")" & Space(2) & Format(w_lngTime, "00:00") & " 現在"
                    lblSearchData.ForeColor = System.Drawing.Color.Blue
                    'lblSearchData.Font = New Font("ＭＳ ゴシック", 11.25F, FontStyle.Bold)

                End If

            ElseIf (M_STAFFIDO_RESCD).Equals(g_MenuM(g_lngGroupIdx).ListBarMenu(g_lngListIdx).strResCD) Then
                '=======================
                '職員管理
                '=======================
                If m_intNowTab <> 0 Then
                    tvwKinmuDept.Enabled = False
                End If

                'ﾂｰﾙﾊﾞｰ設定
                m_LoopFlg = 1
                Call sSetTbrMenu()
                m_LoopFlg = 0

                '検索の場合
                If (M_strSearchCD).Equals(tvwKinmuDept.SelectedNode.Name) Then

                    If IsDate(Format(g_SearchDate, "0000/00/00")) = True Then
                        tvwKinmuDept.Nodes.Find(M_strSearchCD, True)(0).Text = "検索結果(基準日:" & General.DateUtil.paGetDateStringFromInteger(g_SearchDate) & ")"
                    End If

                    '日付取得
                    w_NowDate = General.paGetDateIntegerFromDate(Now)
                    '対象職員取得

                    If General.g_InstallType = General.BasGeneral.gInstall_Enum.AccessType_PassThrough OrElse General.g_InstallType = General.BasGeneral.gInstall_Enum.AccessType_Oo4o Then
                        w_Sql = "SELECT S.STAFFMNGID, B.STAFFNAME, B.SEXCD, B.BIRTHDAY, "
                        w_Sql = w_Sql & "R.EMPDATE, R.RETIREDATE, B.SKILLYEARS, R.STAFFID "
                        w_Sql = w_Sql & ", B.STAFFKANANAME "
                        w_Sql = w_Sql & "FROM NS_SEARCH_F S, NS_STAFFBASISINFO_F B, NS_STAFFMNGHISTORY_F R, "
                        w_Sql = w_Sql & "(SELECT C.HOSPITALCD, C.STAFFMNGID, MAX(C.EMPDATE) AS EMPDATE FROM NS_STAFFMNGHISTORY_F C "
                        w_Sql = w_Sql & " WHERE C.HOSPITALCD = '" & General.g_strHospitalCD & "'"
                        w_Sql = w_Sql & " AND C.EMPDATE <= " & g_SearchDate
                        w_Sql = w_Sql & " GROUP BY C.HOSPITALCD, C.STAFFMNGID"
                        w_Sql = w_Sql & ") TMP "
                        w_Sql = w_Sql & "WHERE S.USERID = '" & General.g_strUserID & "' "
                        w_Sql = w_Sql & "AND S.HOSPITALCD = '" & General.g_strHospitalCD & "' "
                        w_Sql = w_Sql & "AND S.STAFFMNGID = B.STAFFMNGID "
                        w_Sql = w_Sql & "AND S.HOSPITALCD = B.HOSPITALCD "
                        w_Sql = w_Sql & "AND B.STAFFMNGID = R.STAFFMNGID "
                        w_Sql = w_Sql & "AND B.HOSPITALCD = R.HOSPITALCD "
                        w_Sql = w_Sql & "AND R.EMPDATE = TMP.EMPDATE "
                        w_Sql = w_Sql & "AND R.STAFFMNGID = TMP.STAFFMNGID "
                        w_Sql = w_Sql & "AND R.HOSPITALCD = TMP.HOSPITALCD "
                        w_Sql = w_Sql & "ORDER BY S.STAFFMNGID"

                    Else
                        w_Sql = "SELECT S.STAFFMNGID, B.STAFFNAME, B.SEXCD, B.BIRTHDAY, "
                        w_Sql = w_Sql & "R.EMPDATE, R.RETIREDATE, B.SKILLYEARS, R.STAFFID "
                        w_Sql = w_Sql & ", B.STAFFKANANAME "
                        w_Sql = w_Sql & "FROM "
                        w_Sql = w_Sql & "((("
                        w_Sql = w_Sql & "  NS_SEARCH_F S INNER JOIN NS_STAFFBASISINFO_F B "
                        w_Sql = w_Sql & "  ON (S.STAFFMNGID = B.STAFFMNGID) AND (S.HOSPITALCD = B.HOSPITALCD)"
                        w_Sql = w_Sql & " ) "
                        w_Sql = w_Sql & " INNER JOIN NS_STAFFMNGHISTORY_F R "
                        w_Sql = w_Sql & " ON (B.STAFFMNGID = R.STAFFMNGID) AND (B.HOSPITALCD = R.HOSPITALCD)"
                        w_Sql = w_Sql & ")"
                        w_Sql = w_Sql & " INNER JOIN ("
                        w_Sql = w_Sql & " SELECT C.HOSPITALCD, C.STAFFMNGID, MAX(C.EMPDATE) AS EMPDATE FROM NS_STAFFMNGHISTORY_F C "
                        w_Sql = w_Sql & " WHERE C.HOSPITALCD = '" & General.g_strHospitalCD & "' "
                        w_Sql = w_Sql & " AND C.EMPDATE <= " & g_SearchDate
                        w_Sql = w_Sql & " GROUP BY C.HOSPITALCD, C.STAFFMNGID"
                        w_Sql = w_Sql & " ) TMP "
                        w_Sql = w_Sql & " ON (R.EMPDATE = TMP.EMPDATE) AND (R.STAFFMNGID = TMP.STAFFMNGID) AND (R.HOSPITALCD = TMP.HOSPITALCD)"
                        w_Sql = w_Sql & ") "
                        w_Sql = w_Sql & "WHERE S.USERID = '" & General.g_strUserID & "' "
                        w_Sql = w_Sql & "AND S.HOSPITALCD = '" & General.g_strHospitalCD & "'  "
                        w_Sql = w_Sql & "ORDER BY B.STAFFMNGID"
                    End If
                    'ﾚｺｰﾄﾞｾｯﾄｵﾌﾞｼﾞｪｸﾄ
                    w_Rs = General.paDBRecordSetOpen(w_Sql)

                    With w_Rs

                        If .RecordCount <= 0 Then
                            'ﾃﾞｰﾀがないとき
                            w_Cnt = 0

                            '職員が存在しない場合はリストのクリア
                            ReDim m_udtStaffData(w_Cnt)
                            lvwDeptInfo.Items.Clear()

                        Else
                            'ﾃﾞｰﾀがあるとき
                            .MoveLast()
                            w_Cnt = .RecordCount
                            .MoveFirst()
                            w_職員管理番号_F = .Fields("STAFFMNGID")
                            w_職員番号_F = .Fields("STAFFID")
                            w_氏名_F = .Fields("STAFFNAME")
                            w_性別_F = .Fields("SEXCD")
                            w_生年月日_F = .Fields("BIRTHDAY")
                            w_採用年月日_F = .Fields("EMPDATE")
                            w_転退年月日_F = .Fields("RETIREDATE")
                            w_経験年数_F = .Fields("SKILLYEARS")
                            w_氏名カナ_F = .Fields("STAFFKANANAME")

                        End If

                        Dim m_SyokuinInf(w_Cnt) As Object

                        w_SumNum = 0
                        w_Persent2 = -1
                        w_Total = Integer.Parse(w_Cnt)

                        ReDim m_udtStaffData(w_Cnt)
                        lvwDeptInfo.Items.Clear()

                        For w_i = 1 To w_Cnt

                            w_StaffID = w_職員管理番号_F.Value

                            '●職員管理番号
                            m_udtStaffData(w_i).strStaffMngID = w_StaffID
                            '●職員番号
                            m_udtStaffData(w_i).strStaffID = Trim(w_職員番号_F.Value & "")
                            '●氏名
                            m_udtStaffData(w_i).strName = General.paGetDbFieldVal(w_氏名_F, "")
                            '●氏名カナ
                            m_udtStaffData(w_i).strKana = General.paGetDbFieldVal(w_氏名カナ_F, "")
                            '●性別
                            m_udtStaffData(w_i).strSex = General.paGetDbFieldVal(w_性別_F, "2")

                            With General.g_objIdoData
                                .pHospitalCD = General.g_strHospitalCD '施設コード
                                .pStaffMngID = w_StaffID '職員管理番号
                                .pDateFlg = 0 '日付区分(単一日)
                                .pDateFrom = g_SearchDate '開始年月日
                                .pDateTo = 0 '終了年月日
                                .pSortFlg = 1 'ソート順(降順)

                                '--データ検索
                                If .mGetKinmuDeptIdo() = True Then
                                    '勤務部署異動歴
                                    .mKI_KinmuDeptIdx = 1
                                    '●勤務部署コード
                                    m_udtStaffData(w_i).strKinmuDeptCD = .fKI_CD
                                    '●勤務部署名称
                                    m_udtStaffData(w_i).strKinmuDeptName = .fKI_Name
                                Else
                                    '●勤務部署コード
                                    m_udtStaffData(w_i).strKinmuDeptCD = ""
                                    '●勤務部署名称
                                    m_udtStaffData(w_i).strKinmuDeptName = ""
                                End If

                                If .mGetWardDeptIdo() = True Then
                                    '配属部署異動歴
                                    .mWI_WardDeptIdx = 1
                                    '●配属部署コード
                                    m_udtStaffData(w_i).strWardDeptCD = .fWI_CD
                                    '●配属部署名称
                                    m_udtStaffData(w_i).strWardDeptName = .fWI_Name
                                Else
                                    '●配属部署コード
                                    m_udtStaffData(w_i).strWardDeptCD = ""
                                    '●配属部署名称
                                    m_udtStaffData(w_i).strWardDeptName = ""
                                End If

                                If .mGetPostIdo() = True Then
                                    '役職異動歴
                                    .mPI_PostIdx = 1
                                    '●役職コード
                                    m_udtStaffData(w_i).strPostCD = .fPI_CD
                                    '●役職名称
                                    m_udtStaffData(w_i).strPostNm = .fPI_Name
                                Else
                                    '●役職コード
                                    m_udtStaffData(w_i).strPostCD = ""
                                    '●役職名称
                                    m_udtStaffData(w_i).strPostNm = ""
                                End If

                                If .mGetJobIdo() = True Then
                                    '職種異動歴
                                    .mJI_JobIdx = 1
                                    '●職種コード
                                    m_udtStaffData(w_i).strJocCD = .fJI_CD
                                    '●職種名称
                                    m_udtStaffData(w_i).strJocNm = .fJI_Name
                                Else
                                    '●職種コード
                                    m_udtStaffData(w_i).strJocCD = ""
                                    '●職種名称
                                    m_udtStaffData(w_i).strJocNm = ""
                                End If
                            End With
                            .MoveNext()

                            w_SumNum = w_SumNum + 1
                            w_PersentTemp = (100 * w_SumNum) \ w_Total
                            w_Persent = Integer.Parse(Int(CSng(w_PersentTemp)))
                            If w_Persent2 <> w_Persent Then
                                Call Set_StatusBarText("職員を抽出中" & "  " & Convert.ToString(w_Persent) & "％", w_OldText)
                                w_Persent2 = w_Persent
                            End If

                        Next w_i

                        ''ｽﾃｰﾀｽﾊﾞｰのﾃｷｽﾄ削除
                        ToolStripStatusLabel1.Text = ""
                        StatusStrip1.Refresh()
                    End With

                    w_Rs.Close()
                    w_Rs = Nothing

                    '検索以外
                Else

                    If "0".Equals(w_WarddeptFlg) Then

                        Select Case m_intNowTab

                            Case 0
                                '勤務部署選択時のみ ★注意★ 後で部署以外を選択時の対応をする
                                '未確定・・
                                If M_NodeKey_DEPT.Equals(General.paLeft(w_strNodeKey, 4)) OrElse (M_strNoConfCD).Equals(w_strNodeKey) OrElse (M_strRetireCD).Equals(w_strNodeKey) OrElse (M_strSearchCD).Equals(w_strNodeKey) Then

                                    If (M_strNoConfCD).Equals(w_strNodeKey) Then

                                        '●選択勤務部署コード
                                        General.g_strSelKinmuDeptCD = M_strNoConfCD
                                        '●選択勤務部署名称
                                        General.g_strSelKinmuDeptNm = M_strNoConfName
                                        m_selNoConfFlg = True

                                    ElseIf (M_strRetireCD).Equals(w_strNodeKey) Then

                                        '●選択勤務部署コード
                                        General.g_strSelKinmuDeptCD = M_strRetireCD
                                        '●選択勤務部署名称
                                        General.g_strSelKinmuDeptNm = M_strRetireName

                                    ElseIf (M_strSearchCD).Equals(w_strNodeKey) Then

                                        '●選択勤務部署コード
                                        General.g_strSelKinmuDeptCD = M_strSearchCD
                                        '●選択勤務部署名称
                                        General.g_strSelKinmuDeptNm = M_strSearchName

                                    Else

                                        '選択部署インデックス
                                        m_lngDefDeptIdx = Integer.Parse(Mid(w_strNodeKey, 5))

                                        '●選択勤務部署コード
                                        General.g_strSelKinmuDeptCD = m_udtKinmuDept(m_lngDefDeptIdx).strDeptCD
                                        '●選択勤務部署名称
                                        General.g_strSelKinmuDeptNm = m_udtKinmuDept(m_lngDefDeptIdx).strDeptName

                                        g_strSelSaikeiFlg = m_udtKinmuDept(m_lngDefDeptIdx).strSaikeiFlg


                                    End If

                                    '●リストビュー初期設定
                                    Call sSetListView()

                                    '●勤務部署職員 取得
                                    Call sGetKinmuDeptStaff()

                                Else
                                    ReDim m_udtStaffData(0)
                                End If

                            Case 1
                                '配属部署
                                '未確定・・
                                If M_NodeKey_DEPT.Equals(General.paLeft(w_strNodeKey, 4)) OrElse (M_strNoConfCD).Equals(w_strNodeKey) OrElse (M_strRetireCD).Equals(w_strNodeKey) OrElse (M_strSearchCD).Equals(w_strNodeKey) Then

                                    If (M_strNoConfCD).Equals(w_strNodeKey) Then

                                        '●選択配属部署コード
                                        g_strSelWardDeptCD = M_strNoConfCD
                                        '●選択配属部署名称
                                        g_strSelWardDeptNm = M_strNoConfName
                                        m_selNoConfFlg = True

                                    ElseIf (M_strRetireCD).Equals(w_strNodeKey) Then

                                        '●選択配属部署コード
                                        g_strSelWardDeptCD = M_strRetireCD
                                        '●選択配属部署名称
                                        g_strSelWardDeptNm = M_strRetireName

                                    ElseIf (M_strSearchCD).Equals(w_strNodeKey) Then

                                        '●選択配属部署コード
                                        g_strSelWardDeptCD = M_strSearchCD
                                        '●選択配属部署名称
                                        g_strSelWardDeptNm = M_strSearchName
                                    Else
                                        '選択部署インデックス
                                        m_lngDefDeptIdx = Integer.Parse(Mid(w_strNodeKey, 5))

                                        '●選択配属部署コード
                                        g_strSelWardDeptCD = m_udtWardDept(m_lngDefDeptIdx).strDeptCD
                                        '●選択配属部署名称
                                        g_strSelWardDeptNm = m_udtWardDept(m_lngDefDeptIdx).strDeptName

                                        g_strSelSaikeiFlg = ""
                                    End If

                                    '●リストビュー初期設定
                                    Call sSetListView()

                                    '●職員 取得
                                    Call sGetSelTabStaff1(1)


                                Else
                                    ReDim m_udtStaffData(0)
                                End If

                                tvwPersonal.Visible = False
                                tvwPersonal.Enabled = False

                                lvwDeptStaff.Visible = False
                                lvwDeptStaff.Enabled = False

                            Case 2
                                '役職
                                '未確定・・
                                If M_NodeKey_DEPT.Equals(General.paLeft(w_strNodeKey, 4)) OrElse (M_strNoConfCD).Equals(w_strNodeKey) OrElse (M_strRetireCD).Equals(w_strNodeKey) OrElse (M_strSearchCD).Equals(w_strNodeKey) Then

                                    If (M_strNoConfCD).Equals(w_strNodeKey) Then

                                        '●選択役職コード
                                        g_strSelPostCD = M_strNoConfCD
                                        '●選択役職名称
                                        g_strSelPostNm = M_strNoConfName
                                        m_selNoConfFlg = True

                                    ElseIf (M_strRetireCD).Equals(w_strNodeKey) Then

                                        '●選択役職コード
                                        g_strSelPostCD = M_strRetireCD
                                        '●選択役職名称
                                        g_strSelPostNm = M_strRetireName

                                    ElseIf (M_strSearchCD).Equals(w_strNodeKey) Then

                                        '●選択役職コード
                                        g_strSelPostCD = M_strSearchCD
                                        '●選択役職名称
                                        g_strSelPostNm = M_strSearchName

                                    Else

                                        '選択部署インデックス
                                        m_lngDefDeptIdx = Integer.Parse(Mid(w_strNodeKey, 5))

                                        '●選択役職コード
                                        g_strSelPostCD = m_udtPost(m_lngDefDeptIdx).strDeptCD
                                        '●選択役職名称
                                        g_strSelPostNm = m_udtPost(m_lngDefDeptIdx).strDeptName

                                        g_strSelSaikeiFlg = ""

                                    End If

                                    '●リストビュー初期設定
                                    Call sSetListView()

                                    '●職員 取得
                                    Call sGetSelTabStaff1(2)

                                Else
                                    ReDim m_udtStaffData(0)
                                End If

                                tvwPersonal.Visible = False
                                tvwPersonal.Enabled = False

                                lvwDeptStaff.Visible = False
                                lvwDeptStaff.Enabled = False

                            Case 3
                                '職種
                                '未確定・・
                                If M_NodeKey_DEPT.Equals(General.paLeft(w_strNodeKey, 4)) OrElse (M_strNoConfCD).Equals(w_strNodeKey) OrElse (M_strRetireCD).Equals(w_strNodeKey) OrElse (M_strSearchCD).Equals(w_strNodeKey) Then

                                    If (M_strNoConfCD).Equals(w_strNodeKey) Then

                                        '●選択職種コード
                                        g_strSelJobCD = M_strNoConfCD
                                        '●選択職種名称
                                        g_strSelJobNm = M_strNoConfName
                                        m_selNoConfFlg = True

                                    ElseIf (M_strRetireCD).Equals(w_strNodeKey) Then

                                        '●選択職種コード
                                        g_strSelJobCD = M_strRetireCD
                                        '●選択職種名称
                                        g_strSelJobNm = M_strRetireName

                                    ElseIf (M_strSearchCD).Equals(w_strNodeKey) Then

                                        '●選択職種コード
                                        g_strSelJobCD = M_strSearchCD
                                        '●選択職種名称
                                        g_strSelJobNm = M_strSearchName

                                    Else

                                        '選択部署インデックス
                                        m_lngDefDeptIdx = Integer.Parse(Mid(w_strNodeKey, 5))

                                        '●選択職種コード
                                        g_strSelJobCD = m_udtJob(m_lngDefDeptIdx).strDeptCD
                                        '●選択職種名称
                                        g_strSelJobNm = m_udtJob(m_lngDefDeptIdx).strDeptName

                                        g_strSelSaikeiFlg = ""
                                    End If

                                    '●リストビュー初期設定
                                    Call sSetListView()

                                    '●職員 取得
                                    Call sGetSelTabStaff1(3)

                                Else
                                    ReDim m_udtStaffData(0)
                                End If

                                tvwPersonal.Visible = False
                                tvwPersonal.Enabled = False

                                lvwDeptStaff.Visible = False
                                lvwDeptStaff.Enabled = False
                        End Select
                    Else
                        Select Case m_intNowTab

                            Case 0
                                '勤務部署選択時のみ ★注意★ 後で部署以外を選択時の対応をする
                                '未確定・・
                                If M_NodeKey_DEPT.Equals(General.paLeft(w_strNodeKey, 4)) OrElse (M_strNoConfCD).Equals(w_strNodeKey) OrElse (M_strRetireCD).Equals(w_strNodeKey) OrElse (M_strSearchCD).Equals(w_strNodeKey) Then

                                    If (M_strNoConfCD).Equals(w_strNodeKey) Then

                                        '●選択勤務部署コード
                                        General.g_strSelKinmuDeptCD = M_strNoConfCD
                                        '●選択勤務部署名称
                                        General.g_strSelKinmuDeptNm = M_strNoConfName
                                        m_selNoConfFlg = True

                                    ElseIf (M_strRetireCD).Equals(w_strNodeKey) Then

                                        '●選択勤務部署コード
                                        General.g_strSelKinmuDeptCD = M_strRetireCD
                                        '●選択勤務部署名称
                                        General.g_strSelKinmuDeptNm = M_strRetireName

                                    ElseIf (M_strSearchCD).Equals(w_strNodeKey) Then

                                        '●選択勤務部署コード
                                        General.g_strSelKinmuDeptCD = M_strSearchCD
                                        '●選択勤務部署名称
                                        General.g_strSelKinmuDeptNm = M_strSearchName

                                    Else

                                        '選択部署インデックス
                                        m_lngDefDeptIdx = Integer.Parse(Mid(w_strNodeKey, 5))

                                        '●選択勤務部署コード
                                        General.g_strSelKinmuDeptCD = m_udtKinmuDept(m_lngDefDeptIdx).strDeptCD
                                        '●選択勤務部署名称
                                        General.g_strSelKinmuDeptNm = m_udtKinmuDept(m_lngDefDeptIdx).strDeptName

                                        g_strSelSaikeiFlg = m_udtKinmuDept(m_lngDefDeptIdx).strSaikeiFlg


                                    End If

                                    '●リストビュー初期設定
                                    Call sSetListView()

                                    '●勤務部署職員 取得
                                    Call sGetKinmuDeptStaff()

                                Else
                                    ReDim m_udtStaffData(0)
                                End If

                            Case 1
                                '役職
                                '未確定・・
                                If M_NodeKey_DEPT.Equals(General.paLeft(w_strNodeKey, 4)) OrElse (M_strNoConfCD).Equals(w_strNodeKey) OrElse (M_strRetireCD).Equals(w_strNodeKey) OrElse (M_strSearchCD).Equals(w_strNodeKey) Then

                                    If (M_strNoConfCD).Equals(w_strNodeKey) Then

                                        '●選択役職コード
                                        g_strSelPostCD = M_strNoConfCD
                                        '●選択役職名称
                                        g_strSelPostNm = M_strNoConfName
                                        m_selNoConfFlg = True

                                    ElseIf (M_strRetireCD).Equals(w_strNodeKey) Then

                                        '●選択役職コード
                                        g_strSelPostCD = M_strRetireCD
                                        '●選択役職名称
                                        g_strSelPostNm = M_strRetireName

                                    ElseIf (M_strSearchCD).Equals(w_strNodeKey) Then

                                        '●選択役職コード
                                        g_strSelPostCD = M_strSearchCD
                                        '●選択役職名称
                                        g_strSelPostNm = M_strSearchName

                                    Else

                                        '選択部署インデックス
                                        m_lngDefDeptIdx = Integer.Parse(Mid(w_strNodeKey, 5))

                                        '●選択役職コード
                                        g_strSelPostCD = m_udtPost(m_lngDefDeptIdx).strDeptCD
                                        '●選択役職名称
                                        g_strSelPostNm = m_udtPost(m_lngDefDeptIdx).strDeptName

                                        g_strSelSaikeiFlg = ""

                                    End If

                                    '●リストビュー初期設定
                                    Call sSetListView()

                                    '●職員 取得
                                    Call sGetSelTabStaff2(1)

                                Else
                                    ReDim m_udtStaffData(0)
                                End If

                                tvwPersonal.Visible = False
                                tvwPersonal.Enabled = False

                                lvwDeptStaff.Visible = False
                                lvwDeptStaff.Enabled = False

                            Case 2
                                '職種
                                '未確定・・
                                If M_NodeKey_DEPT.Equals(General.paLeft(w_strNodeKey, 4)) OrElse (M_strNoConfCD).Equals(w_strNodeKey) OrElse (M_strRetireCD).Equals(w_strNodeKey) OrElse (M_strSearchCD).Equals(w_strNodeKey) Then

                                    If (M_strNoConfCD).Equals(w_strNodeKey) Then

                                        '●選択職種コード
                                        g_strSelJobCD = M_strNoConfCD
                                        '●選択職種名称
                                        g_strSelJobNm = M_strNoConfName
                                        m_selNoConfFlg = True

                                    ElseIf (M_strRetireCD).Equals(w_strNodeKey) Then

                                        '●選択職種コード
                                        g_strSelJobCD = M_strRetireCD
                                        '●選択職種名称
                                        g_strSelJobNm = M_strRetireName

                                    ElseIf (M_strSearchCD).Equals(w_strNodeKey) Then

                                        '●選択職種コード
                                        g_strSelJobCD = M_strSearchCD
                                        '●選択職種名称
                                        g_strSelJobNm = M_strSearchName

                                    Else

                                        '選択部署インデックス
                                        m_lngDefDeptIdx = Integer.Parse(Mid(w_strNodeKey, 5))

                                        '●選択職種コード
                                        g_strSelJobCD = m_udtJob(m_lngDefDeptIdx).strDeptCD
                                        '●選択職種名称
                                        g_strSelJobNm = m_udtJob(m_lngDefDeptIdx).strDeptName

                                        g_strSelSaikeiFlg = ""
                                    End If

                                    '●リストビュー初期設定
                                    Call sSetListView()

                                    '●職員 取得
                                    Call sGetSelTabStaff2(2)

                                Else
                                    ReDim m_udtStaffData(0)
                                End If

                                tvwPersonal.Visible = False
                                tvwPersonal.Enabled = False

                                lvwDeptStaff.Visible = False
                                lvwDeptStaff.Enabled = False
                        End Select

                    End If

                End If

                If m_intNowTab <> 0 Then
                    'sptMain.Enabled = True
                    tvwKinmuDept.Enabled = True
                    Call Me.tvwKinmuDept.Focus()
                End If

                '●リストビュー 表示
                Call sDispListView()

                lblSearchData.Text = ""

            ElseIf (M_OVERKINMU_RESCD).Equals(g_MenuM(g_lngGroupIdx).ListBarMenu(g_lngListIdx).strResCD) Then
                '=======================
                '時間外
                '=======================
                '勤務部署選択時のみ
                If M_NodeKey_DEPT.Equals(General.paLeft(w_strNodeKey, 4)) Then

                    '選択部署インデックス
                    m_lngDefDeptIdx = Integer.Parse(Mid(w_strNodeKey, 5))

                    '●選択勤務部署コード
                    General.g_strSelKinmuDeptCD = m_udtKinmuDept(m_lngDefDeptIdx).strDeptCD
                    '●選択勤務部署名称
                    General.g_strSelKinmuDeptNm = m_udtKinmuDept(m_lngDefDeptIdx).strDeptName

                    g_strSelSaikeiFlg = m_udtKinmuDept(m_lngDefDeptIdx).strSaikeiFlg

                    '●勤務部署職員 取得
                    ReDim m_udtDayKinmuJisseki(UBound(m_udtStaffData)) '勤務実績取得(１日取得用)
                    ReDim m_udtOverKinmuTotal(UBound(m_udtStaffData)) '時間外状況取得

                    If (M_APPRO_DAY_OVER).Equals(m_strSelChildMenu) Then

                        m_strSelBusyoCD = General.g_strSelKinmuDeptCD
                        m_strSelBusyoNM = General.g_strSelKinmuDeptNm

                        '●日別超過勤務入力用職員 取得
                        Call sGetDayOverStaff()

                        w_JissekiGotFlg = fncChkJissekiExist()
                        If w_JissekiGotFlg Then
                            '勤務実績（勤務が確定されている）がある
                            '●日別超過勤務入力データ 取得
                            Call sGetDayOver()

                            '●日別超過勤務入力データ 表示
                            'Call sDispListView()

                            Call sSetTbrMenu()
                        End If
                        '選択日付の設定
                        subSetlblSearchData_DayOver()
                    Else

                    End If

                    '●リストビュー 表示
                    Call sSetListView()
                    If w_JissekiGotFlg Then
                        Call sDispListView()
                    End If


                    '選択部署レジストリ書き込み
                    w_RegStr = General.G_SYSTEM_WIN7 & "\" & General.G_STRMAINKEY1
                    '●選択勤務部署コード
                    Call General.paSaveSetting(w_RegStr, "Current", "KINMUDEPTCD", General.g_strSelKinmuDeptCD)
                    '●選択勤務部署名称
                    Call General.paSaveSetting(w_RegStr, "Current", "KINMUDEPTNM", General.g_strSelKinmuDeptNm)
                End If

            End If

            'リストビューの幅を設定
            Call General.paSetFieldWidth(lvwDeptInfo, General.G_STRMAINKEY1 & "\" & G_PROJECTID, m_strSelChildMenu, False)

            'ﾏｳｽﾎﾟｲﾝﾀを元に戻す
            Me.Cursor = System.Windows.Forms.Cursors.Default
            m_selNoConfFlg = False

        Catch ex As Exception
            'ﾏｳｽﾎﾟｲﾝﾀを元に戻す
            Me.Cursor = System.Windows.Forms.Cursors.Default
            Call General.paTrpMsg(Convert.ToString(Err.Number), W_SUBNAME)
        End Try
    End Sub

    '====================================
    'リストビュー幅レジストリ保存処理
    '====================================
    Private Sub sSaveFieldWidth()
        Const W_SUBNAME As String = "NSC0000HA sSaveFieldWidth"

        Try
            Dim w_ID As String
            Dim w_lngLoop As Integer
            Dim lvwMainHol As System.Windows.Forms.ListView

            If g_lngGroupIdx = 0 OrElse g_lngListIdx = 0 Then
                '選択業務もしくはリストメニューが取得できなかった場合

            Else
                Select Case g_MenuM(g_lngGroupIdx).ListBarMenu(g_lngListIdx).strResCD

                    Case M_PERSONAL_RESCD
                        '-------------
                        '■個人業務
                        '-------------
                        For w_lngLoop = 1 To UBound(m_udtChildMenu)
                            If m_strSelChildMenu = m_udtChildMenu(w_lngLoop).strResCD Then
                                w_ID = m_udtChildMenu(w_lngLoop).strResCD
                                Exit For
                            End If
                        Next w_lngLoop

                        'フィールドサイズをレジストリに書き込み
                        If (M_PER_HOLIDAY_DSP).Equals(w_ID) Then
                            '休暇情報
                            Call General.paSaveFieldWidth(lvwMainHol, General.G_STRMAINKEY1 & "\" & G_PROJECTID, w_ID)
                        Else
                            Call General.paSaveFieldWidth(lvwMain, General.G_STRMAINKEY1 & "\" & G_PROJECTID, w_ID)
                        End If

                    Case M_DEPT_RESCD, M_DUTY_RESCD
                        '---------------------
                        '■部署業務 ■日当直
                        '---------------------
                        w_ID = g_MenuM(g_lngGroupIdx).ListBarMenu(g_lngListIdx).strResCD

                        If (M_DEPT_RESCD).Equals(g_MenuM(g_lngGroupIdx).ListBarMenu(g_lngListIdx).strResCD) Then
                            w_ID = m_strSelChildMenu
                        End If

                        Call General.paSaveFieldWidth(lvwDeptInfo, General.G_STRMAINKEY1 & "\" & G_PROJECTID, w_ID)

                    Case M_APPROVE_RESCD
                        '---------------------
                        '■未承認
                        '---------------------
                        For w_lngLoop = 1 To UBound(m_udtChildMenu)
                            If (m_udtChildMenu(w_lngLoop).strResCD).Equals(m_strSelChildMenu) Then
                                w_ID = m_udtChildMenu(w_lngLoop).strResCD
                                Exit For
                            End If
                        Next w_lngLoop

                        Call General.paSaveFieldWidth(lvwDeptInfo, General.G_STRMAINKEY1 & "\" & G_PROJECTID, w_ID)

                    Case M_DAKOKU_RESCD
                        '---------------------
                        '■出退勤
                        '---------------------
                        For w_lngLoop = 1 To UBound(m_udtChildMenu)
                            If (m_udtChildMenu(w_lngLoop).strResCD).Equals(m_strSelChildMenu) Then
                                w_ID = m_udtChildMenu(w_lngLoop).strResCD
                                Exit For
                            End If
                        Next w_lngLoop

                        Call General.paSaveFieldWidth(lvwDeptInfo, General.G_STRMAINKEY1 & "\" & G_PROJECTID, w_ID)

                    Case M_ZAIIN_RESCD
                        Call General.paSaveFieldWidth(lvwDeptInfo, General.G_STRMAINKEY1 & "\" & G_PROJECTID, m_strSelChildMenu)

                    Case M_STAFFIDO_RESCD
                        Call General.paSaveFieldWidth(lvwDeptInfo, General.G_STRMAINKEY1 & "\" & G_PROJECTID, m_strSelChildMenu)

                    Case M_OVERKINMU_RESCD
                        Call General.paSaveFieldWidth(lvwDeptInfo, General.G_STRMAINKEY1 & "\" & G_PROJECTID, m_strSelChildMenu)
                        Call General.paSaveFieldWidth(lvwMain, General.G_STRMAINKEY1 & "\" & G_PROJECTID, m_strSelChildMenu)

                End Select
            End If

            '選択部署レジストリ書き込み
            '●選択勤務部署コード
            Call General.paSaveSetting(General.G_SYSTEM_WIN7 & "\" & General.G_STRMAINKEY1, "Current", "KINMUDEPTCD", General.g_strSelKinmuDeptCD)
            '●選択勤務部署名称
            Call General.paSaveSetting(General.G_SYSTEM_WIN7 & "\" & General.G_STRMAINKEY1, "Current", "KINMUDEPTNM", IIf(IsNothing(General.g_strSelKinmuDeptNm), "", General.g_strSelKinmuDeptNm))
            '========================================================================================================

        Catch ex As Exception
            Call General.paTrpMsg(Convert.ToString(Err.Number), W_SUBNAME)
        End Try
    End Sub

    '==================================
    '勤務部署職員 取得
    '==================================
    Private Sub sGetKinmuDeptStaff()
        Const W_SUBNAME As String = "NSC0000HA sGetKinmuDeptStaff"

        Try
            Dim w_lngDate As Integer
            Dim w_lngRecCnt As Integer
            Dim w_lngLoop As Integer
            Dim w_strStaffMngID As String
            Dim w_strStaffID_bk As String '退避用
            Dim w_StaffCount As Integer
            Dim w_lngSaiyoCnt As Integer
            Dim w_lngIdoCnt As Integer
            Dim w_lngFrom As Integer
            Dim w_lngTo As Integer

            '基準日
            '職員管理の場合は、カレンダー日付は使用しない
            If (M_STAFFIDO_RESCD).Equals(g_MenuM(g_lngGroupIdx).ListBarMenu(g_lngListIdx).strResCD) Then
                w_lngDate = General.paGetDateIntegerFromDate(Today)
            Else
                w_lngDate = General.paGetDateIntegerFromDate(m_CalDate)
            End If
            w_lngFrom = General.paGetDateIntegerFromDate(m_DateFrom)
            w_lngTo = General.paGetDateIntegerFromDate(m_DateTo)

            '採用情報配列/勤務部署異動配列 初期化
            ReDim m_udtStaffData(0)

            '==================================
            '職員情報 取得
            '==================================
            With General.g_objGetData
                .p病院CD = General.g_strHospitalCD

                '職員取得FLG
                If (M_strNoConfCD).Equals(General.g_strSelKinmuDeptCD) Then
                    .p職員取得FLG = 3
                ElseIf (M_strRetireCD).Equals(General.g_strSelKinmuDeptCD) Then
                    .p職員取得FLG = 1
                Else
                    .p職員取得FLG = 0
                End If

                .pソート順 = 0 'ソート順
                If (M_DEPT_OVERTIME).Equals(m_strSelChildMenu) Then
                    .p日付区分 = 1 '期間
                    .p開始年月日 = w_lngFrom '開始年月日
                    .p終了年月日 = w_lngTo '終了年月日
                Else
                    .p日付区分 = 0 '単一日
                    .p開始年月日 = w_lngDate '開始年月日
                    .p終了年月日 = 0
                End If
                .p勤務対象FLG = 0 '全員

                If "1".Equals(g_strSelSaikeiFlg) Then
                    .p優先順位 = 9 '再掲部署CD優先
                Else
                    .p優先順位 = 0 '勤務部署CD優先
                End If
                '------------------
                .p対象CD = General.g_strSelKinmuDeptCD '勤務部署CD
                .pチーム区分 = 0 '考慮しない
                .pシステム区分 = 0 '職員歴必要
                If .mGetStaff = False Then

                Else
                    '●職員件数
                    w_lngRecCnt = .f職員件数
                    ReDim m_udtStaffData(w_lngRecCnt)

                    For w_lngLoop = 1 To w_lngRecCnt
                        '索引
                        .p職員索引 = w_lngLoop

                        w_strStaffMngID = .f職員管理番号2

                        If w_strStaffMngID.Equals(w_strStaffID_bk) = False Then
                            w_StaffCount = w_StaffCount + 1 '対象職員数カウント
                            '●勤務地異動歴
                            ReDim m_udtStaffData(w_StaffCount).IdoHistory(0)
                            '●採用歴
                            ReDim m_udtStaffData(w_StaffCount).SaiyoHistory(0)
                        End If

                        '●職員管理番号
                        m_udtStaffData(w_StaffCount).strStaffMngID = w_strStaffMngID
                        '●職員番号
                        m_udtStaffData(w_StaffCount).strStaffID = .f職員番号2
                        '●氏名
                        m_udtStaffData(w_StaffCount).strName = .f氏名2
                        '●カナ
                        m_udtStaffData(w_StaffCount).strKana = .f氏名カナ2
                        '●性別
                        m_udtStaffData(w_StaffCount).strSex = .f性別2
                        '●PHS番号
                        m_udtStaffData(w_StaffCount).strPHS = .fPHS電話番号2
                        '●職種コード/名称
                        m_udtStaffData(w_StaffCount).strJocCD = .f職種CD2
                        m_udtStaffData(w_StaffCount).strJocNm = .f職種名称2
                        '●役職コード/名称
                        m_udtStaffData(w_StaffCount).strPostCD = .f役職CD2
                        m_udtStaffData(w_StaffCount).strPostNm = .f役職名称2

                        '●勤務部署コード
                        m_udtStaffData(w_StaffCount).strKinmuDeptCD = .f在職看護単位CD
                        '●勤務部署名称
                        m_udtStaffData(w_StaffCount).strKinmuDeptName = .f在職看護単位名称
                        '●配属部署コード
                        m_udtStaffData(w_StaffCount).strWardDeptCD = .f配属部署CD2
                        '●配属部署名称
                        m_udtStaffData(w_StaffCount).strWardDeptName = .f配属部署名称2

                        '--- 採用年月日の設定
                        w_lngSaiyoCnt = UBound(m_udtStaffData(w_StaffCount).SaiyoHistory) + 1
                        ReDim Preserve m_udtStaffData(w_StaffCount).SaiyoHistory(w_lngSaiyoCnt)
                        '●採用年月日
                        m_udtStaffData(w_StaffCount).SaiyoHistory(w_lngSaiyoCnt).lngStartDate = .f採用年月日2
                        '●採用条件コード
                        m_udtStaffData(w_StaffCount).SaiyoHistory(w_lngSaiyoCnt).strCD = .f採用条件CD2
                        '●転退年月日
                        m_udtStaffData(w_StaffCount).SaiyoHistory(w_lngSaiyoCnt).lngEndDate = .f転退年月日2
                        '--- 異動年月日の設定
                        w_lngIdoCnt = UBound(m_udtStaffData(w_StaffCount).IdoHistory) + 1
                        ReDim Preserve m_udtStaffData(w_StaffCount).IdoHistory(w_lngIdoCnt)
                        '●異動年月日
                        m_udtStaffData(w_StaffCount).IdoHistory(w_lngIdoCnt).lngStartDate = .f異動年月日
                        '●異動終了年月日
                        m_udtStaffData(w_StaffCount).IdoHistory(w_lngIdoCnt).lngEndDate = .f終了年月日

                        '職員管理番号 退避
                        w_strStaffID_bk = w_strStaffMngID
                    Next w_lngLoop
                End If

                If General.g_strSelKinmuDeptCD = M_strNoConfCD Then

                    '職員取得FLG
                    .p職員取得FLG = 4
                    .pソート順 = 0 'ソート順
                    If m_strSelChildMenu = M_DEPT_OVERTIME Then
                        .p日付区分 = 1 '期間
                        .p開始年月日 = w_lngFrom '開始年月日
                        .p終了年月日 = w_lngTo '終了年月日
                    Else
                        .p日付区分 = 0 '単一日
                        .p開始年月日 = w_lngDate '開始年月日
                        .p終了年月日 = 0
                    End If
                    .p勤務対象FLG = 0 '全員
                    If "1".Equals(g_strSelSaikeiFlg) Then
                        .p優先順位 = 9 '再掲部署CD優先
                    Else
                        .p優先順位 = 0 '勤務部署CD優先
                    End If
                    .p対象CD = General.g_strSelKinmuDeptCD '勤務部署CD
                    .pチーム区分 = 0 '考慮しない
                    .pシステム区分 = 0 '職員歴必要
                    If .mGetStaff = False Then

                    Else
                        '●職員件数
                        w_lngRecCnt = .f職員件数
                        w_strStaffID_bk = ""
                        For w_lngLoop = 1 To w_lngRecCnt
                            '索引
                            .p職員索引 = w_lngLoop

                            w_strStaffMngID = .f職員管理番号2

                            If w_strStaffMngID.Equals(w_strStaffID_bk) = False Then
                                w_StaffCount = UBound(m_udtStaffData) + 1 '対象職員数カウント
                                ReDim Preserve m_udtStaffData(w_StaffCount)

                                '●勤務地異動歴
                                ReDim m_udtStaffData(w_StaffCount).IdoHistory(0)
                                '●採用歴
                                ReDim m_udtStaffData(w_StaffCount).SaiyoHistory(0)
                            End If

                            '●職員管理番号
                            m_udtStaffData(w_StaffCount).strStaffMngID = w_strStaffMngID
                            '●職員番号
                            m_udtStaffData(w_StaffCount).strStaffID = .f職員番号2
                            '●氏名
                            m_udtStaffData(w_StaffCount).strName = .f氏名2
                            '●カナ
                            m_udtStaffData(w_StaffCount).strKana = .f氏名カナ2
                            '●性別
                            m_udtStaffData(w_StaffCount).strSex = .f性別2
                            '●PHS番号
                            m_udtStaffData(w_StaffCount).strPHS = .fPHS電話番号2
                            '●職種コード/名称
                            m_udtStaffData(w_StaffCount).strJocCD = .f職種CD2
                            m_udtStaffData(w_StaffCount).strJocNm = .f職種名称2
                            '●役職コード/名称
                            m_udtStaffData(w_StaffCount).strPostCD = .f役職CD2
                            m_udtStaffData(w_StaffCount).strPostNm = .f役職名称2

                            '●勤務部署コード
                            m_udtStaffData(w_StaffCount).strKinmuDeptCD = .f在職看護単位CD
                            '●勤務部署名称
                            m_udtStaffData(w_StaffCount).strKinmuDeptName = .f在職看護単位名称
                            '●配属部署コード
                            m_udtStaffData(w_StaffCount).strWardDeptCD = .f配属部署CD2
                            '●配属部署名称
                            m_udtStaffData(w_StaffCount).strWardDeptName = .f配属部署名称2

                            '--- 採用年月日の設定
                            w_lngSaiyoCnt = UBound(m_udtStaffData(w_StaffCount).SaiyoHistory) + 1
                            ReDim Preserve m_udtStaffData(w_StaffCount).SaiyoHistory(w_lngSaiyoCnt)
                            '●採用年月日
                            m_udtStaffData(w_StaffCount).SaiyoHistory(w_lngSaiyoCnt).lngStartDate = .f採用年月日2
                            '●採用条件コード
                            m_udtStaffData(w_StaffCount).SaiyoHistory(w_lngSaiyoCnt).strCD = .f採用条件CD2
                            '●転退年月日
                            m_udtStaffData(w_StaffCount).SaiyoHistory(w_lngSaiyoCnt).lngEndDate = .f転退年月日2
                            '--- 異動年月日の設定
                            w_lngIdoCnt = UBound(m_udtStaffData(w_StaffCount).IdoHistory) + 1
                            ReDim Preserve m_udtStaffData(w_StaffCount).IdoHistory(w_lngIdoCnt)
                            '●異動年月日
                            m_udtStaffData(w_StaffCount).IdoHistory(w_lngIdoCnt).lngStartDate = .f異動年月日
                            '●異動終了年月日
                            m_udtStaffData(w_StaffCount).IdoHistory(w_lngIdoCnt).lngEndDate = .f終了年月日

                            '職員管理番号 退避
                            w_strStaffID_bk = w_strStaffMngID
                        Next w_lngLoop
                    End If
                End If
            End With

        Catch ex As Exception
            Call General.paTrpMsg(Convert.ToString(Err.Number), W_SUBNAME)
            End
        End Try
    End Sub

    Public Function fncDayKinmuJisseki(ByVal p_lngDate As Integer, ByVal p_strStaffMngID As String, ByRef p_strKinmuCD As String, ByRef p_strKinmuNm As String, ByRef p_strKinmuSecNm As String, ByRef p_strKinmuMark As String, ByRef p_strKinmuReasonKbn As String, ByRef p_strHalfKinmuFlg As String) As Boolean

        Const W_SUBNAME As String = "frmNSC0000HA fncDayKinmuJisseki"

        Try
            '初期値
            fncDayKinmuJisseki = False

            With General.g_objGetData
                .p病院CD = General.g_strHospitalCD '施設コード
                .p職員区分 = 0 '職員管理番号指定
                .p職員番号 = p_strStaffMngID '職員管理番号
                .p勤務取得区分 = 1 '実績
                .p確定部署CD = ""
                .p日付区分 = 0 '単一日
                .p開始年月日 = p_lngDate '開始日
                '当日の勤務を取得
                If .mGetKinmu = False Then
                    'ﾃﾞｰﾀがない場合
                    p_strKinmuCD = ""
                    p_strKinmuNm = ""
                    p_strKinmuSecNm = ""
                    p_strKinmuMark = ""
                    p_strKinmuReasonKbn = ""
                    p_strHalfKinmuFlg = ""
                    Exit Function
                Else
                    'ﾃﾞｰﾀが存在する場合（条件がｷｰ項目一意のため１件のみ）
                    .p実績年月日 = p_lngDate

                    p_strKinmuCD = .f実績勤務CD
                    p_strKinmuNm = .f実績勤務名称
                    p_strKinmuSecNm = .f実績理由区分
                    p_strKinmuMark = .f実績勤務記号
                    p_strKinmuReasonKbn = .f実績理由区分
                    p_strHalfKinmuFlg = .f実績半日勤務FLG
                End If
            End With

            '正常終了
            fncDayKinmuJisseki = True

        Catch ex As Exception
            Call General.paTrpMsg(Convert.ToString(Err.Number), W_SUBNAME)
        End Try
    End Function

    Public Function fncOverKinmuTotal(ByVal p_lngFrom As Integer, ByVal p_lngTo As Integer, ByVal p_lngStaffIdx As Integer, ByRef p_lng125 As Integer, ByRef p_lng150 As Integer, ByRef p_lng135 As Integer, ByRef p_lng160 As Integer, ByRef p_lng100 As Integer, ByRef p_lngBeforeTotal As Integer, ByRef p_lngAfterTotal As Integer) As Boolean
        Const W_SUBNAME As String = "frmNSC0000HA fncOverKinmuTotal"

        Try
            Dim w_lngLoop As Integer
            Dim w_lngRecCnt As Integer
            Dim w_lngOverKCnt As Integer
            Dim w_lngDate As Integer
            Dim w_DayIdx As Integer
            Dim w_blnSaiyoFlg As Boolean
            Dim w_lngOverKLoop As Integer
            Dim w_lngSaiyoLoop As Integer
            Dim w_lngStartDate As Integer
            Dim w_lngOneBeforeDate As Integer
            Dim w_BeforeTo As Integer
            Dim w_lngDayTotal As Integer

            '初期値
            fncOverKinmuTotal = False
            p_lng125 = 0
            p_lng150 = 0
            p_lng135 = 0
            p_lng160 = 0

            w_lngStartDate = General.DateUtil.paGetDateIntegerFromDate(DateAdd(Microsoft.VisualBasic.DateInterval.Day, 1, General.DateUtil.paGetDateFromDateInteger(p_lngFrom)))

            w_lngOneBeforeDate = p_lngFrom
            '半月ﾁｪｯｸ期間の前半の終了日を取得
            w_BeforeTo = General.DateUtil.paGetDateIntegerFromDate(DateAdd(Microsoft.VisualBasic.DateInterval.Day, 14, General.DateUtil.paGetDateFromDateInteger(w_lngStartDate)), )

            With General.g_objComCyokin
                .p日付区分 = 1 '期間
                .p開始年月日 = p_lngFrom
                .p終了年月日 = p_lngTo
                If .mOverKinmuInit(General.paGetItemValue(General.G_STRMAINKEY3, General.G_STRSUBKEY1, "DATEJUDGMENT", "0", General.g_strHospitalCD)) = False Then
                    .pStopFlg = True
                End If
            End With

            With General.g_objComCyokin
                .p病院CD = General.g_strHospitalCD
                .p職員区分 = 0 '職員管理番号
                .p職員番号 = m_udtStaffData(p_lngStaffIdx).strStaffMngID
                .p日付区分 = 1 '期間
                .p開始年月日 = p_lngFrom '開始年月日前日
                .p終了年月日 = p_lngTo '終了年月日
                If .mGetOverKinmuData = False Then

                Else
                    w_lngRecCnt = .f実績超勤件数
                    .p年月日 = p_lngFrom

                    For w_lngLoop = 0 To w_lngRecCnt
                        w_lngDate = .f年月日

                        If w_lngDate > 0 Then
                            ''配列に格納すべきIndexを取得
                            w_DayIdx = DateDiff(Microsoft.VisualBasic.DateInterval.Day, m_DateFrom, General.DateUtil.paGetDateFromDateInteger(w_lngDate)) + 1

                            '採用期間内であるか
                            w_blnSaiyoFlg = False
                            For w_lngSaiyoLoop = 1 To UBound(m_udtStaffData(p_lngStaffIdx).SaiyoHistory)
                                If m_udtStaffData(p_lngStaffIdx).SaiyoHistory(w_lngSaiyoLoop).lngStartDate <= w_lngDate AndAlso w_lngDate <= m_udtStaffData(p_lngStaffIdx).SaiyoHistory(w_lngSaiyoLoop).lngEndDate Then
                                    'ﾌﾗｸﾞをTrue(在職期間内である)
                                    w_blnSaiyoFlg = True
                                    Exit For
                                End If
                            Next w_lngSaiyoLoop

                            '-----------------------------
                            '在職期間内の場合のみ格納
                            '-----------------------------
                            w_lngDayTotal = 0

                            If w_blnSaiyoFlg = True Then
                                '*** 時間外 ***
                                w_lngOverKCnt = .f超勤時間件数
                                For w_lngOverKLoop = 1 To w_lngOverKCnt
                                    '最初の１件のみ格納
                                    .p超勤時間索引 = w_lngOverKLoop

                                    If .f超勤状態区分 <> 4 Then

                                        '●125/100
                                        p_lng125 = p_lng125 + .f超過勤務時間125
                                        '●150/100
                                        p_lng150 = p_lng150 + .f超過勤務時間150
                                        '●135/100
                                        p_lng135 = p_lng135 + .f超過勤務時間135
                                        '●160/100
                                        p_lng160 = p_lng160 + .f超過勤務時間160
                                        '●100/100
                                        p_lng100 = p_lng100 + .f超過勤務時間100

                                    End If

                                    w_lngDayTotal = w_lngDayTotal + .f超過勤務時間125 + .f超過勤務時間150 + .f超過勤務時間135 + .f超過勤務時間160 + .f超過勤務時間100
                                Next w_lngOverKLoop

                                If w_lngStartDate <= w_lngDate AndAlso w_lngDate <= w_BeforeTo Then
                                    '前半月の場合
                                    p_lngBeforeTotal = p_lngBeforeTotal + w_lngDayTotal
                                Else
                                    '後半月の場合
                                    p_lngAfterTotal = p_lngAfterTotal + w_lngDayTotal
                                End If

                            End If '--- 在職期間内？
                        End If '--- 勤務実績が存在？

                        .m翌日超勤()
                    Next w_lngLoop
                End If
            End With

            '正常終了
            fncOverKinmuTotal = True

        Catch ex As Exception
            Call General.paTrpMsg(Convert.ToString(Err.Number), W_SUBNAME)
        End Try
    End Function

    Public Function fncDayDakoku(ByVal p_lngDate As Integer, ByVal p_lngTime As Integer, ByVal p_strStaffMngID As String, ByRef p_lngDakokuDate() As Integer, ByRef p_lngDakokuSEQ() As Integer, ByRef p_lngDakokuTime() As Integer, ByRef p_strDakokuKbn() As String, ByRef p_strTekiyoCD() As String, ByRef p_strTekiyoNm() As String, ByRef p_strFinFlg() As String, ByRef p_blnZainFlg() As Boolean) As Boolean
        Const W_SUBNAME As String = "frmNSC0000HA fncDayDakoku"

        Try
            Dim w_lngDayCnt As Integer
            Dim w_lngLoop As Integer

            Dim w_lngIdx As Integer

            '初期値
            fncDayDakoku = False

            ReDim p_lngDakokuDate(0)
            ReDim p_lngDakokuSEQ(0)
            ReDim p_lngDakokuTime(0)
            ReDim p_strDakokuKbn(0)
            ReDim p_strTekiyoCD(0)
            ReDim p_strTekiyoNm(0)
            ReDim p_strFinFlg(0)
            Dim p_strZainFlg(0) As Object

            w_lngIdx = 0

            With General.g_objGetData
                .p病院CD = General.g_strHospitalCD '施設コード
                .p職員区分 = 0 '職員管理番号指定
                .p職員番号 = p_strStaffMngID '職員管理番号
                .p指定年月日 = p_lngDate '指定年月日
                .p在院FLG = 0 '0：在院状況を確認する、1：在院状況を確認しない
                .p指定時間 = p_lngTime '指定時刻
                .p打刻区分 = 0 '0：勤務を元として取得（規定値）1：ｶﾚﾝﾀﾞｰを元として取得
                '打刻を取得
                If .mGetDakoku = False Then
                    'ﾃﾞｰﾀがない場合
                    Exit Function
                Else

                    '打刻件数
                    w_lngDayCnt = .f打刻件数

                    ReDim p_lngDakokuDate(w_lngDayCnt)
                    ReDim p_lngDakokuSEQ(w_lngDayCnt)
                    ReDim p_lngDakokuTime(w_lngDayCnt)
                    ReDim p_strDakokuKbn(w_lngDayCnt)
                    ReDim p_strTekiyoCD(w_lngDayCnt)
                    ReDim p_strTekiyoNm(w_lngDayCnt)
                    ReDim p_strFinFlg(w_lngDayCnt)
                    ReDim p_blnZainFlg(w_lngDayCnt)

                    For w_lngLoop = 1 To w_lngDayCnt
                        '索引
                        .p打刻索引 = w_lngLoop

                        p_lngDakokuDate(w_lngLoop) = .f打刻年月日
                        p_lngDakokuSEQ(w_lngLoop) = .f打刻SEQ
                        p_lngDakokuTime(w_lngLoop) = .f打刻時刻
                        p_strDakokuKbn(w_lngLoop) = .f出退区分
                        p_strTekiyoCD(w_lngLoop) = .f摘要CD
                        p_strTekiyoNm(w_lngLoop) = .f摘要名称
                        p_strFinFlg(w_lngLoop) = .f処理済FLG
                        p_blnZainFlg(w_lngLoop) = .f在院状況

                    Next w_lngLoop
                End If
            End With

            '正常終了
            fncDayDakoku = True

        Catch ex As Exception
            Call General.paTrpMsg(Convert.ToString(Err.Number), W_SUBNAME)
        End Try
    End Function

    '====================================
    '打刻チェック
    '====================================
    Private Sub sCheckDakoku()
        Const W_SUBNAME As String = "NSC0000HA sCheckDakoku"

        Try
            Dim w_lngLoop As Integer
            Dim w_lngLoop2 As Integer
            Dim w_lngKensu As Integer
            Dim w_lngStaffIdx As Integer
            Dim w_workStaff() As Staff_Type
            Dim w_workDayJisseki() As Kinmu_Type
            Dim w_workDayDakoku() As Dakoku_Type
            Dim w_blnResult As Boolean

            '★検索条件画面を表示する

            'ﾜｰｸ配列に退避
            ReDim w_workStaff(UBound(m_udtStaffData))
            For w_lngLoop = 1 To UBound(m_udtStaffData)
                w_workStaff(w_lngLoop) = m_udtStaffData(w_lngLoop)
            Next w_lngLoop
            ReDim m_udtStaffData(0)

            ReDim w_workDayJisseki(UBound(m_udtDayKinmuJisseki))
            For w_lngLoop = 1 To UBound(m_udtDayKinmuJisseki)
                w_workDayJisseki(w_lngLoop) = m_udtDayKinmuJisseki(w_lngLoop)
            Next w_lngLoop
            ReDim m_udtDayKinmuJisseki(0)

            ReDim w_workDayDakoku(UBound(m_udtDayDakokuData))
            For w_lngLoop = 1 To UBound(m_udtDayDakokuData)
                w_workDayDakoku(w_lngLoop) = m_udtDayDakokuData(w_lngLoop)
            Next w_lngLoop
            ReDim m_udtDayDakokuData(0)

            '出退勤チェック用配列初期化
            Dim m_udtDayDakokuChk(0) As Object

            w_lngStaffIdx = 0

            For w_lngLoop = 1 To UBound(w_workStaff)

                With General.g_objGetData
                    .p病院CD = General.g_strHospitalCD
                    .p職員区分 = 0
                    .p職員番号 = w_workStaff(w_lngLoop).strStaffMngID
                    .p指定年月日 = General.paGetDateIntegerFromDate(m_CalDate)

                    w_blnResult = .mCheckDakoku
                    If w_blnResult Then
                        w_lngKensu = .f打刻エラー件数

                        'エラーがあれば対象者
                        w_lngStaffIdx = w_lngStaffIdx + 1
                        '職員情報
                        ReDim Preserve m_udtStaffData(w_lngStaffIdx)
                        m_udtStaffData(w_lngStaffIdx) = w_workStaff(w_lngLoop)
                        '勤務実績情報
                        ReDim Preserve m_udtDayKinmuJisseki(w_lngStaffIdx)
                        m_udtDayKinmuJisseki(w_lngStaffIdx) = w_workDayJisseki(w_lngLoop)
                        '打刻情報
                        ReDim Preserve m_udtDayDakokuData(w_lngStaffIdx)
                        m_udtDayDakokuData(w_lngStaffIdx) = w_workDayDakoku(w_lngLoop)
                        ReDim m_udtDayDakokuData(w_lngStaffIdx).strChkMsg(w_lngKensu)

                        For w_lngLoop2 = 1 To w_lngKensu
                            .p打刻エラー索引 = w_lngLoop2
                            m_udtDayDakokuData(w_lngStaffIdx).strChkMsg(w_lngLoop2) = .f打刻エラー
                        Next w_lngLoop2
                    End If
                End With
            Next w_lngLoop

        Catch ex As Exception
            Call General.paTrpMsg(Convert.ToString(Err.Number), W_SUBNAME)
        End Try
    End Sub

    Public Sub Set_StatusBarText(ByVal p_SetText As String, ByRef p_OldText As String)
        Const W_SUBNAME As String = "frmNSC0000HA Set_StatusBarText"

        Try
            '現在のｽﾃｰﾀｽﾊﾞｰﾃｷｽﾄ取得
            p_OldText = ToolStripStatusLabel1.Text

            ''ｽﾃｰﾀｽﾊﾞｰ編集
            ToolStripStatusLabel1.Text = p_SetText
            StatusStrip1.Refresh()

        Catch ex As Exception
            Call General.paTrpMsg(Convert.ToString(Err.Number), W_SUBNAME)
        End Try
    End Sub

    '==================================
    'タブで選択された職員を取得
    '==================================
    Private Sub sGetSelTabStaff1(ByVal p_intTab As Integer)
        Const W_SUBNAME As String = "NSC0000HA sGetSelTabStaff1"

        Try
            Dim w_lngDate As Integer
            Dim w_lngRecCnt As Integer
            Dim w_lngLoop As Integer
            Dim w_strStaffMngID As String
            Dim w_strStaffID_bk As String '退避用
            Dim w_StaffCount As Integer
            Dim w_lngSaiyoCnt As Integer
            Dim w_lngIdoCnt As Integer
            Dim w_lngFrom As Integer
            Dim w_lngTo As Integer
            Dim w_blnOKFlg As Boolean
            Dim w_lngKinmuLoop As Integer
            Dim w_WorkTbl As Staff_Type
            Dim w_Int As Integer
            Dim w_Int2 As Integer
            Dim w_strCD As String

            Dim w_WarddeptFlg As String '勤務＝配属フラグ（"1"：勤務＝配属、"0"：勤務≠配属)
            w_WarddeptFlg = General.paGetItemValue(General.G_STRMAINKEY1, General.G_STRSECTION1, "WORDDEPTFLG", "0", General.g_strHospitalCD)

            '基準日
            '職員管理の場合は、カレンダー日付は使用しない
            If g_MenuM(g_lngGroupIdx).ListBarMenu(g_lngListIdx).strResCD = M_STAFFIDO_RESCD Then
                w_lngDate = General.paGetDateIntegerFromDate(Today)
            Else
                w_lngDate = General.paGetDateIntegerFromDate(m_CalDate)
            End If
            w_lngFrom = General.paGetDateIntegerFromDate(m_DateFrom)
            w_lngTo = General.paGetDateIntegerFromDate(m_DateTo)

            '採用情報配列/勤務部署異動配列 初期化
            ReDim m_udtStaffData(0)

            '==================================
            '職員情報 取得
            '==================================
            With General.g_objGetData
                .p病院CD = General.g_strHospitalCD

                '職員取得FLG
                Select Case p_intTab
                    Case 1
                        If (M_strNoConfCD).Equals(g_strSelWardDeptCD) Then
                            .p職員取得FLG = 3
                        ElseIf (M_strRetireCD).Equals(g_strSelWardDeptCD) Then
                            .p職員取得FLG = 1
                        Else
                            .p職員取得FLG = 0
                        End If
                        .p優先順位 = 3 '配属部署CD優先
                        .p対象CD = g_strSelWardDeptCD '配属部署CD
                    Case 2
                        If (M_strNoConfCD).Equals(g_strSelPostCD) Then
                            .p職員取得FLG = 3
                        ElseIf (M_strRetireCD).Equals(g_strSelPostCD) Then
                            .p職員取得FLG = 1
                        Else
                            .p職員取得FLG = 0
                        End If
                        .p優先順位 = 1 '役職優先
                        .p対象CD = g_strSelPostCD '役職CD
                    Case 3
                        If (M_strNoConfCD).Equals(g_strSelJobCD) Then
                            .p職員取得FLG = 3
                        ElseIf (M_strRetireCD).Equals(g_strSelJobCD) Then
                            .p職員取得FLG = 1
                        Else
                            .p職員取得FLG = 0
                        End If
                        .p優先順位 = 2 '職種
                        .p対象CD = g_strSelJobCD '職種CD
                    Case Else
                        Exit Sub
                End Select

                .pソート順 = 0 'ソート順
                If (M_DEPT_OVERTIME).Equals(m_strSelChildMenu) Then
                    .p日付区分 = 1 '期間
                    .p開始年月日 = w_lngFrom '開始年月日
                    .p終了年月日 = w_lngTo '終了年月日
                Else
                    .p日付区分 = 0 '単一日
                    .p開始年月日 = w_lngDate '開始年月日
                    .p終了年月日 = 0
                End If
                .p勤務対象FLG = 0 '全員
                .pチーム区分 = 0 '考慮しない
                .pシステム区分 = 0 '職員歴必要
                If .mGetStaff = False Then

                Else
                    '●職員件数
                    w_lngRecCnt = .f職員件数
                    For w_lngLoop = 1 To w_lngRecCnt
                        '索引
                        .p職員索引 = w_lngLoop

                        w_strStaffMngID = .f職員管理番号2

                        '※表示可能な職員かどうかをチェックする
                        Select Case p_intTab
                            Case 1
                                '配属部署
                                w_strCD = .f配属部署CD2
                                w_blnOKFlg = False
                                For w_lngKinmuLoop = 1 To UBound(m_udtWardDept)
                                    If m_udtWardDept(w_lngKinmuLoop).strDeptCD = w_strCD Then
                                        w_blnOKFlg = True
                                        Exit For
                                    End If
                                Next w_lngKinmuLoop

                            Case 2
                                '役職
                                w_strCD = .f役職CD2
                                w_blnOKFlg = False
                                For w_lngKinmuLoop = 1 To UBound(m_udtPost)
                                    If m_udtPost(w_lngKinmuLoop).strDeptCD = w_strCD Then
                                        w_blnOKFlg = True
                                        Exit For
                                    End If
                                Next w_lngKinmuLoop

                            Case 3
                                '職種
                                w_strCD = .f職種CD2
                                w_blnOKFlg = False
                                For w_lngKinmuLoop = 1 To UBound(m_udtJob)
                                    If m_udtJob(w_lngKinmuLoop).strDeptCD = w_strCD Then
                                        w_blnOKFlg = True
                                        Exit For
                                    End If
                                Next w_lngKinmuLoop

                            Case Else
                                Exit Sub
                        End Select

                        If m_selNoConfFlg Then
                            '未確定選択時のみブランクでも対象とする
                            If String.IsNullOrEmpty(w_strCD) Then
                                w_blnOKFlg = True
                            End If
                        End If

                        If w_blnOKFlg = True Then
                            If w_strStaffMngID.Equals(w_strStaffID_bk) = False Then
                                w_StaffCount = w_StaffCount + 1 '対象職員数カウント

                                ReDim Preserve m_udtStaffData(w_StaffCount)

                                '●勤務地異動歴
                                ReDim m_udtStaffData(w_StaffCount).IdoHistory(0)
                                '●採用歴
                                ReDim m_udtStaffData(w_StaffCount).SaiyoHistory(0)
                            End If

                            '●職員管理番号
                            m_udtStaffData(w_StaffCount).strStaffMngID = w_strStaffMngID
                            '●職員番号
                            m_udtStaffData(w_StaffCount).strStaffID = .f職員番号2
                            '●職員表示順
                            m_udtStaffData(w_StaffCount).lngStaffDispNo = w_lngLoop
                            '●氏名
                            m_udtStaffData(w_StaffCount).strName = .f氏名2
                            '●カナ
                            m_udtStaffData(w_StaffCount).strKana = .f氏名カナ2
                            '●性別
                            m_udtStaffData(w_StaffCount).strSex = .f性別2
                            '●PHS番号
                            m_udtStaffData(w_StaffCount).strPHS = .fPHS電話番号2
                            '●職種コード/名称
                            m_udtStaffData(w_StaffCount).strJocCD = .f職種CD2
                            m_udtStaffData(w_StaffCount).strJocNm = .f職種名称2
                            m_udtStaffData(w_StaffCount).lngJobNo = .f職種表示順

                            '●役職コード/名称
                            m_udtStaffData(w_StaffCount).strPostCD = .f役職CD2
                            m_udtStaffData(w_StaffCount).strPostNm = .f役職名称2
                            m_udtStaffData(w_StaffCount).lngPostNo = .f役職表示順

                            '●勤務部署コード
                            m_udtStaffData(w_StaffCount).strKinmuDeptCD = .f在職看護単位CD
                            '●勤務部署名称
                            m_udtStaffData(w_StaffCount).strKinmuDeptName = .f在職看護単位名称

                            m_udtStaffData(w_StaffCount).lngKinmuDeptNo = .f在職看護単位表示順
                            '●配属部署コード
                            m_udtStaffData(w_StaffCount).strWardDeptCD = .f配属部署CD2
                            '●配属部署名称
                            m_udtStaffData(w_StaffCount).strWardDeptName = .f配属部署名称2

                            m_udtStaffData(w_StaffCount).lngWardDeptNo = .f配属部署表示順

                            '--- 採用年月日の設定
                            w_lngSaiyoCnt = UBound(m_udtStaffData(w_StaffCount).SaiyoHistory) + 1
                            ReDim Preserve m_udtStaffData(w_StaffCount).SaiyoHistory(w_lngSaiyoCnt)
                            '●採用年月日
                            m_udtStaffData(w_StaffCount).SaiyoHistory(w_lngSaiyoCnt).lngStartDate = .f採用年月日2
                            '●採用条件コード
                            m_udtStaffData(w_StaffCount).SaiyoHistory(w_lngSaiyoCnt).strCD = .f採用条件CD2
                            '●転退年月日
                            m_udtStaffData(w_StaffCount).SaiyoHistory(w_lngSaiyoCnt).lngEndDate = .f転退年月日2
                            '--- 異動年月日の設定
                            w_lngIdoCnt = UBound(m_udtStaffData(w_StaffCount).IdoHistory) + 1
                            ReDim Preserve m_udtStaffData(w_StaffCount).IdoHistory(w_lngIdoCnt)
                            '●異動年月日
                            m_udtStaffData(w_StaffCount).IdoHistory(w_lngIdoCnt).lngStartDate = .f異動年月日
                            '●異動終了年月日
                            m_udtStaffData(w_StaffCount).IdoHistory(w_lngIdoCnt).lngEndDate = .f終了年月日
                            '職員管理番号 退避
                            w_strStaffID_bk = w_strStaffMngID
                        End If

                    Next w_lngLoop

                End If

                If ((M_strNoConfCD).Equals(g_strSelWardDeptCD) AndAlso p_intTab = 1) OrElse ((M_strNoConfCD).Equals(g_strSelJobCD) AndAlso p_intTab = 3) OrElse ((M_strNoConfCD).Equals(g_strSelPostCD) AndAlso p_intTab = 2) Then

                    .p病院CD = General.g_strHospitalCD
                    .p職員取得FLG = 4
                    '職員取得FLG
                    Select Case p_intTab
                        Case 1
                            .p優先順位 = 3 '配属部署CD優先
                            .p対象CD = g_strSelWardDeptCD '配属部署CD
                        Case 2
                            .p優先順位 = 1 '役職優先
                            .p対象CD = g_strSelPostCD '役職CD
                        Case 3
                            .p優先順位 = 2 '職種
                            .p対象CD = g_strSelJobCD '職種CD
                        Case Else
                            Exit Sub
                    End Select
                    .pソート順 = 0 'ソート順
                    If (M_DEPT_OVERTIME).Equals(m_strSelChildMenu) Then
                        .p日付区分 = 1 '期間
                        .p開始年月日 = w_lngFrom '開始年月日
                        .p終了年月日 = w_lngTo '終了年月日
                    Else
                        .p日付区分 = 0 '単一日
                        .p開始年月日 = w_lngDate '開始年月日
                        .p終了年月日 = 0
                    End If
                    .p勤務対象FLG = 0 '全員
                    .pチーム区分 = 0 '考慮しない
                    .pシステム区分 = 0 '職員歴必要
                    If .mGetStaff = False Then

                    Else
                        '●職員件数
                        w_lngRecCnt = .f職員件数
                        For w_lngLoop = 1 To w_lngRecCnt
                            '索引
                            .p職員索引 = w_lngLoop

                            w_strStaffMngID = .f職員管理番号2

                            '※表示可能な職員かどうかをチェックする
                            Select Case p_intTab
                                Case 1
                                    '配属部署
                                    w_strCD = .f配属部署CD2
                                    w_blnOKFlg = False
                                    For w_lngKinmuLoop = 1 To UBound(m_udtWardDept)
                                        If (w_strCD).Equals(m_udtWardDept(w_lngKinmuLoop).strDeptCD) Then
                                            w_blnOKFlg = True
                                            Exit For
                                        End If
                                    Next w_lngKinmuLoop

                                Case 2
                                    '役職
                                    w_strCD = .f役職CD2
                                    w_blnOKFlg = False
                                    For w_lngKinmuLoop = 1 To UBound(m_udtPost)
                                        If (w_strCD).Equals(m_udtPost(w_lngKinmuLoop).strDeptCD) Then
                                            w_blnOKFlg = True
                                            Exit For
                                        End If
                                    Next w_lngKinmuLoop

                                Case 3
                                    '職種
                                    w_strCD = .f職種CD2
                                    w_blnOKFlg = False
                                    For w_lngKinmuLoop = 1 To UBound(m_udtJob)
                                        If (w_strCD).Equals(m_udtJob(w_lngKinmuLoop).strDeptCD) Then
                                            w_blnOKFlg = True
                                            Exit For
                                        End If
                                    Next w_lngKinmuLoop

                                Case Else
                                    Exit Sub
                            End Select

                            If m_selNoConfFlg Then
                                '未確定選択時のみブランクでも対象とする
                                If String.IsNullOrEmpty(w_strCD) Then
                                    w_blnOKFlg = True
                                End If
                            End If

                            If w_blnOKFlg = True Then
                                If w_strStaffMngID.Equals(w_strStaffID_bk) = False Then
                                    w_StaffCount = UBound(m_udtStaffData) + 1 '対象職員数カウント

                                    ReDim Preserve m_udtStaffData(w_StaffCount)

                                    '●勤務地異動歴
                                    ReDim m_udtStaffData(w_StaffCount).IdoHistory(0)
                                    '●採用歴
                                    ReDim m_udtStaffData(w_StaffCount).SaiyoHistory(0)
                                End If

                                '●職員管理番号
                                m_udtStaffData(w_StaffCount).strStaffMngID = w_strStaffMngID
                                '●職員番号
                                m_udtStaffData(w_StaffCount).strStaffID = .f職員番号2
                                '●職員表示順
                                m_udtStaffData(w_StaffCount).lngStaffDispNo = w_lngLoop
                                '●氏名
                                m_udtStaffData(w_StaffCount).strName = .f氏名2
                                '●カナ
                                m_udtStaffData(w_StaffCount).strKana = .f氏名カナ2
                                '=========================================================================
                                '●性別
                                m_udtStaffData(w_StaffCount).strSex = .f性別2
                                '●PHS番号
                                m_udtStaffData(w_StaffCount).strPHS = .fPHS電話番号2
                                '●職種コード/名称
                                m_udtStaffData(w_StaffCount).strJocCD = .f職種CD2
                                m_udtStaffData(w_StaffCount).strJocNm = .f職種名称2
                                m_udtStaffData(w_StaffCount).lngJobNo = .f職種表示順

                                '●役職コード/名称
                                m_udtStaffData(w_StaffCount).strPostCD = .f役職CD2
                                m_udtStaffData(w_StaffCount).strPostNm = .f役職名称2
                                m_udtStaffData(w_StaffCount).lngPostNo = .f役職表示順

                                '●勤務部署コード
                                m_udtStaffData(w_StaffCount).strKinmuDeptCD = .f在職看護単位CD
                                '●勤務部署名称
                                m_udtStaffData(w_StaffCount).strKinmuDeptName = .f在職看護単位名称

                                m_udtStaffData(w_StaffCount).lngKinmuDeptNo = .f在職看護単位表示順
                                '●配属部署コード
                                m_udtStaffData(w_StaffCount).strWardDeptCD = .f配属部署CD2
                                '●配属部署名称
                                m_udtStaffData(w_StaffCount).strWardDeptName = .f配属部署名称2

                                m_udtStaffData(w_StaffCount).lngWardDeptNo = .f配属部署表示順

                                '--- 採用年月日の設定
                                w_lngSaiyoCnt = UBound(m_udtStaffData(w_StaffCount).SaiyoHistory) + 1
                                ReDim Preserve m_udtStaffData(w_StaffCount).SaiyoHistory(w_lngSaiyoCnt)
                                '●採用年月日
                                m_udtStaffData(w_StaffCount).SaiyoHistory(w_lngSaiyoCnt).lngStartDate = .f採用年月日2
                                '●採用条件コード
                                m_udtStaffData(w_StaffCount).SaiyoHistory(w_lngSaiyoCnt).strCD = .f採用条件CD2
                                '●転退年月日
                                m_udtStaffData(w_StaffCount).SaiyoHistory(w_lngSaiyoCnt).lngEndDate = .f転退年月日2
                                '--- 異動年月日の設定
                                w_lngIdoCnt = UBound(m_udtStaffData(w_StaffCount).IdoHistory) + 1
                                ReDim Preserve m_udtStaffData(w_StaffCount).IdoHistory(w_lngIdoCnt)
                                '●異動年月日
                                m_udtStaffData(w_StaffCount).IdoHistory(w_lngIdoCnt).lngStartDate = .f異動年月日
                                '●異動終了年月日
                                m_udtStaffData(w_StaffCount).IdoHistory(w_lngIdoCnt).lngEndDate = .f終了年月日
                                '職員管理番号 退避
                                w_strStaffID_bk = w_strStaffMngID
                            End If

                        Next w_lngLoop

                    End If
                End If

            End With

            '職員のｿｰﾄ
            Select Case p_intTab

                Case 1
                    '配属部署表示順＞勤務部署表示順＞役職表示順＞職種表示順>職員表示順

                    '職員人数分 繰り返し
                    For w_Int = 1 To UBound(m_udtStaffData)
                        '(職員人数 - ｿｰﾄ終了人数) 繰り返し
                        For w_Int2 = 1 To UBound(m_udtStaffData) - w_Int
                            '並び替え 実行 ?
                            If (m_udtStaffData(w_Int).lngWardDeptNo > m_udtStaffData(w_Int + w_Int2).lngWardDeptNo) Then

                                w_WorkTbl = m_udtStaffData(w_Int)
                                m_udtStaffData(w_Int) = m_udtStaffData(w_Int + w_Int2)
                                m_udtStaffData(w_Int + w_Int2) = w_WorkTbl

                            ElseIf (m_udtStaffData(w_Int).lngWardDeptNo = m_udtStaffData(w_Int + w_Int2).lngWardDeptNo) AndAlso m_udtStaffData(w_Int).lngKinmuDeptNo > m_udtStaffData(w_Int + w_Int2).lngKinmuDeptNo Then

                                w_WorkTbl = m_udtStaffData(w_Int)
                                m_udtStaffData(w_Int) = m_udtStaffData(w_Int + w_Int2)
                                m_udtStaffData(w_Int + w_Int2) = w_WorkTbl

                            ElseIf (m_udtStaffData(w_Int).lngWardDeptNo = m_udtStaffData(w_Int + w_Int2).lngWardDeptNo) AndAlso m_udtStaffData(w_Int).lngKinmuDeptNo = m_udtStaffData(w_Int + w_Int2).lngKinmuDeptNo AndAlso m_udtStaffData(w_Int).lngPostNo > m_udtStaffData(w_Int + w_Int2).lngPostNo Then

                                w_WorkTbl = m_udtStaffData(w_Int)
                                m_udtStaffData(w_Int) = m_udtStaffData(w_Int + w_Int2)
                                m_udtStaffData(w_Int + w_Int2) = w_WorkTbl

                            ElseIf (m_udtStaffData(w_Int).lngWardDeptNo = m_udtStaffData(w_Int + w_Int2).lngWardDeptNo) AndAlso m_udtStaffData(w_Int).lngKinmuDeptNo = m_udtStaffData(w_Int + w_Int2).lngKinmuDeptNo AndAlso m_udtStaffData(w_Int).lngPostNo = m_udtStaffData(w_Int + w_Int2).lngPostNo AndAlso m_udtStaffData(w_Int).lngJobNo > m_udtStaffData(w_Int + w_Int2).lngJobNo Then

                                w_WorkTbl = m_udtStaffData(w_Int)
                                m_udtStaffData(w_Int) = m_udtStaffData(w_Int + w_Int2)
                                m_udtStaffData(w_Int + w_Int2) = w_WorkTbl

                            ElseIf (m_udtStaffData(w_Int).lngWardDeptNo = m_udtStaffData(w_Int + w_Int2).lngWardDeptNo) AndAlso m_udtStaffData(w_Int).lngKinmuDeptNo = m_udtStaffData(w_Int + w_Int2).lngKinmuDeptNo AndAlso m_udtStaffData(w_Int).lngPostNo = m_udtStaffData(w_Int + w_Int2).lngPostNo AndAlso m_udtStaffData(w_Int).lngJobNo = m_udtStaffData(w_Int + w_Int2).lngJobNo AndAlso m_udtStaffData(w_Int).lngStaffDispNo > m_udtStaffData(w_Int + w_Int2).lngStaffDispNo Then

                                w_WorkTbl = m_udtStaffData(w_Int)
                                m_udtStaffData(w_Int) = m_udtStaffData(w_Int + w_Int2)
                                m_udtStaffData(w_Int + w_Int2) = w_WorkTbl

                            End If
                        Next w_Int2
                        '待ち処理
                        System.Windows.Forms.Application.DoEvents()
                    Next w_Int

                Case 2
                    '役職表示順＞勤務部署表示順＞配属部署表示順＞職種表示順>職員表示順

                    '職員人数分 繰り返し
                    For w_Int = 1 To UBound(m_udtStaffData)
                        '(職員人数 - ｿｰﾄ終了人数) 繰り返し
                        For w_Int2 = 1 To UBound(m_udtStaffData) - w_Int
                            '並び替え 実行 ?
                            If (m_udtStaffData(w_Int).lngPostNo > m_udtStaffData(w_Int + w_Int2).lngPostNo) Then

                                w_WorkTbl = m_udtStaffData(w_Int)
                                m_udtStaffData(w_Int) = m_udtStaffData(w_Int + w_Int2)
                                m_udtStaffData(w_Int + w_Int2) = w_WorkTbl

                            ElseIf (m_udtStaffData(w_Int).lngPostNo = m_udtStaffData(w_Int + w_Int2).lngPostNo) AndAlso m_udtStaffData(w_Int).lngKinmuDeptNo > m_udtStaffData(w_Int + w_Int2).lngKinmuDeptNo Then

                                w_WorkTbl = m_udtStaffData(w_Int)
                                m_udtStaffData(w_Int) = m_udtStaffData(w_Int + w_Int2)
                                m_udtStaffData(w_Int + w_Int2) = w_WorkTbl

                            ElseIf (m_udtStaffData(w_Int).lngPostNo = m_udtStaffData(w_Int + w_Int2).lngPostNo) AndAlso m_udtStaffData(w_Int).lngKinmuDeptNo = m_udtStaffData(w_Int + w_Int2).lngKinmuDeptNo AndAlso m_udtStaffData(w_Int).lngWardDeptNo > m_udtStaffData(w_Int + w_Int2).lngWardDeptNo Then

                                w_WorkTbl = m_udtStaffData(w_Int)
                                m_udtStaffData(w_Int) = m_udtStaffData(w_Int + w_Int2)
                                m_udtStaffData(w_Int + w_Int2) = w_WorkTbl

                            ElseIf (m_udtStaffData(w_Int).lngPostNo = m_udtStaffData(w_Int + w_Int2).lngPostNo) AndAlso m_udtStaffData(w_Int).lngKinmuDeptNo = m_udtStaffData(w_Int + w_Int2).lngKinmuDeptNo AndAlso m_udtStaffData(w_Int).lngWardDeptNo = m_udtStaffData(w_Int + w_Int2).lngWardDeptNo AndAlso m_udtStaffData(w_Int).lngJobNo > m_udtStaffData(w_Int + w_Int2).lngJobNo Then

                                w_WorkTbl = m_udtStaffData(w_Int)
                                m_udtStaffData(w_Int) = m_udtStaffData(w_Int + w_Int2)
                                m_udtStaffData(w_Int + w_Int2) = w_WorkTbl

                            ElseIf (m_udtStaffData(w_Int).lngPostNo = m_udtStaffData(w_Int + w_Int2).lngPostNo) AndAlso m_udtStaffData(w_Int).lngKinmuDeptNo = m_udtStaffData(w_Int + w_Int2).lngKinmuDeptNo AndAlso m_udtStaffData(w_Int).lngWardDeptNo = m_udtStaffData(w_Int + w_Int2).lngWardDeptNo AndAlso m_udtStaffData(w_Int).lngJobNo = m_udtStaffData(w_Int + w_Int2).lngJobNo AndAlso m_udtStaffData(w_Int).lngStaffDispNo > m_udtStaffData(w_Int + w_Int2).lngStaffDispNo Then

                                w_WorkTbl = m_udtStaffData(w_Int)
                                m_udtStaffData(w_Int) = m_udtStaffData(w_Int + w_Int2)
                                m_udtStaffData(w_Int + w_Int2) = w_WorkTbl

                            End If
                        Next w_Int2
                        '待ち処理
                        System.Windows.Forms.Application.DoEvents()
                    Next w_Int

                Case 3
                    '職種表示順>勤務部署表示順＞役職表示順＞配属部署表示順＞職員表示順

                    '職員人数分 繰り返し
                    For w_Int = 1 To UBound(m_udtStaffData)
                        '(職員人数 - ｿｰﾄ終了人数) 繰り返し
                        For w_Int2 = 1 To UBound(m_udtStaffData) - w_Int
                            '並び替え 実行 ?
                            If (m_udtStaffData(w_Int).lngJobNo > m_udtStaffData(w_Int + w_Int2).lngJobNo) Then

                                w_WorkTbl = m_udtStaffData(w_Int)
                                m_udtStaffData(w_Int) = m_udtStaffData(w_Int + w_Int2)
                                m_udtStaffData(w_Int + w_Int2) = w_WorkTbl

                            ElseIf (m_udtStaffData(w_Int).lngJobNo = m_udtStaffData(w_Int + w_Int2).lngJobNo) AndAlso m_udtStaffData(w_Int).lngKinmuDeptNo > m_udtStaffData(w_Int + w_Int2).lngKinmuDeptNo Then

                                w_WorkTbl = m_udtStaffData(w_Int)
                                m_udtStaffData(w_Int) = m_udtStaffData(w_Int + w_Int2)
                                m_udtStaffData(w_Int + w_Int2) = w_WorkTbl

                            ElseIf (m_udtStaffData(w_Int).lngJobNo = m_udtStaffData(w_Int + w_Int2).lngJobNo) AndAlso m_udtStaffData(w_Int).lngKinmuDeptNo = m_udtStaffData(w_Int + w_Int2).lngKinmuDeptNo AndAlso m_udtStaffData(w_Int).lngWardDeptNo > m_udtStaffData(w_Int + w_Int2).lngWardDeptNo Then

                                w_WorkTbl = m_udtStaffData(w_Int)
                                m_udtStaffData(w_Int) = m_udtStaffData(w_Int + w_Int2)
                                m_udtStaffData(w_Int + w_Int2) = w_WorkTbl

                            ElseIf (m_udtStaffData(w_Int).lngJobNo = m_udtStaffData(w_Int + w_Int2).lngJobNo) AndAlso m_udtStaffData(w_Int).lngKinmuDeptNo = m_udtStaffData(w_Int + w_Int2).lngKinmuDeptNo AndAlso m_udtStaffData(w_Int).lngWardDeptNo = m_udtStaffData(w_Int + w_Int2).lngWardDeptNo AndAlso m_udtStaffData(w_Int).lngPostNo > m_udtStaffData(w_Int + w_Int2).lngPostNo Then

                                w_WorkTbl = m_udtStaffData(w_Int)
                                m_udtStaffData(w_Int) = m_udtStaffData(w_Int + w_Int2)
                                m_udtStaffData(w_Int + w_Int2) = w_WorkTbl

                            ElseIf (m_udtStaffData(w_Int).lngJobNo = m_udtStaffData(w_Int + w_Int2).lngJobNo) AndAlso m_udtStaffData(w_Int).lngKinmuDeptNo = m_udtStaffData(w_Int + w_Int2).lngKinmuDeptNo AndAlso m_udtStaffData(w_Int).lngWardDeptNo = m_udtStaffData(w_Int + w_Int2).lngWardDeptNo AndAlso m_udtStaffData(w_Int).lngPostNo = m_udtStaffData(w_Int + w_Int2).lngPostNo AndAlso m_udtStaffData(w_Int).lngStaffDispNo > m_udtStaffData(w_Int + w_Int2).lngStaffDispNo Then

                                w_WorkTbl = m_udtStaffData(w_Int)
                                m_udtStaffData(w_Int) = m_udtStaffData(w_Int + w_Int2)
                                m_udtStaffData(w_Int + w_Int2) = w_WorkTbl

                            End If
                        Next w_Int2
                        '待ち処理
                        System.Windows.Forms.Application.DoEvents()
                    Next w_Int

            End Select

        Catch ex As Exception
            Call General.paTrpMsg(Convert.ToString(Err.Number), W_SUBNAME)
        End Try
    End Sub

    '==================================
    'タブで選択された職員を取得
    '==================================
    Private Sub sGetSelTabStaff2(ByVal p_intTab As Integer)
        Const W_SUBNAME As String = "NSC0000HA sGetSelTabStaff2"

        Try
            Dim w_lngDate As Integer
            Dim w_lngRecCnt As Integer
            Dim w_lngLoop As Integer
            Dim w_strStaffMngID As String
            Dim w_strStaffID_bk As String '退避用
            Dim w_StaffCount As Integer
            Dim w_lngSaiyoCnt As Integer
            Dim w_lngIdoCnt As Integer
            Dim w_lngFrom As Integer
            Dim w_lngTo As Integer
            Dim w_blnOKFlg As Boolean
            Dim w_lngKinmuLoop As Integer
            Dim w_WorkTbl As Staff_Type
            Dim w_Int As Integer
            Dim w_Int2 As Integer
            Dim w_strCD As String

            Dim w_WarddeptFlg As String '勤務＝配属フラグ（"1"：勤務＝配属、"0"：勤務≠配属)
            w_WarddeptFlg = General.paGetItemValue(General.G_STRMAINKEY1, General.G_STRSECTION1, "WORDDEPTFLG", "0", General.g_strHospitalCD)

            '基準日
            '職員管理の場合は、カレンダー日付は使用しない
            If g_MenuM(g_lngGroupIdx).ListBarMenu(g_lngListIdx).strResCD = M_STAFFIDO_RESCD Then
                w_lngDate = General.paGetDateIntegerFromDate(Today)
            Else
                w_lngDate = General.paGetDateIntegerFromDate(m_CalDate)
            End If
            w_lngFrom = General.paGetDateIntegerFromDate(m_DateFrom)
            w_lngTo = General.paGetDateIntegerFromDate(m_DateTo)

            '採用情報配列/勤務部署異動配列 初期化
            ReDim m_udtStaffData(0)

            '==================================
            '職員情報 取得
            '==================================
            With General.g_objGetData
                .p病院CD = General.g_strHospitalCD

                '職員取得FLG
                Select Case p_intTab
                    Case 1
                        If (M_strNoConfCD).Equals(g_strSelPostCD) Then
                            .p職員取得FLG = 3
                        ElseIf (M_strRetireCD).Equals(g_strSelPostCD) Then
                            .p職員取得FLG = 1
                        Else
                            .p職員取得FLG = 0
                        End If
                        .p優先順位 = 1 '役職優先
                        .p対象CD = g_strSelPostCD '役職CD
                    Case 2
                        If (M_strNoConfCD).Equals(g_strSelJobCD) Then
                            .p職員取得FLG = 3
                        ElseIf (M_strRetireCD).Equals(g_strSelJobCD) Then
                            .p職員取得FLG = 1
                        Else
                            .p職員取得FLG = 0
                        End If
                        .p優先順位 = 2 '職種
                        .p対象CD = g_strSelJobCD '職種CD
                    Case Else
                        Exit Sub
                End Select

                .pソート順 = 0 'ソート順
                If (M_DEPT_OVERTIME).Equals(m_strSelChildMenu) Then
                    .p日付区分 = 1 '期間
                    .p開始年月日 = w_lngFrom '開始年月日
                    .p終了年月日 = w_lngTo '終了年月日
                Else
                    .p日付区分 = 0 '単一日
                    .p開始年月日 = w_lngDate '開始年月日
                    .p終了年月日 = 0
                End If
                .p勤務対象FLG = 0 '全員
                .pチーム区分 = 0 '考慮しない
                .pシステム区分 = 0 '職員歴必要
                If .mGetStaff = False Then

                Else
                    '●職員件数
                    w_lngRecCnt = .f職員件数
                    For w_lngLoop = 1 To w_lngRecCnt
                        '索引
                        .p職員索引 = w_lngLoop

                        w_strStaffMngID = .f職員管理番号2

                        '※表示可能な職員かどうかをチェックする
                        Select Case p_intTab
                            Case 1
                                '役職
                                w_strCD = .f役職CD2
                                w_blnOKFlg = False
                                For w_lngKinmuLoop = 1 To UBound(m_udtPost)
                                    If (w_strCD).Equals(m_udtPost(w_lngKinmuLoop).strDeptCD) Then
                                        w_blnOKFlg = True
                                        Exit For
                                    End If
                                Next w_lngKinmuLoop

                            Case 2
                                '職種
                                w_strCD = .f職種CD2
                                w_blnOKFlg = False
                                For w_lngKinmuLoop = 1 To UBound(m_udtJob)
                                    If (w_strCD).Equals(m_udtJob(w_lngKinmuLoop).strDeptCD) Then
                                        w_blnOKFlg = True
                                        Exit For
                                    End If
                                Next w_lngKinmuLoop

                            Case Else
                                Exit Sub
                        End Select

                        If m_selNoConfFlg Then
                            '未確定選択時のみブランクでも対象とする
                            If String.IsNullOrEmpty(w_strCD) Then
                                w_blnOKFlg = True
                            End If
                        End If

                        If w_blnOKFlg = True Then
                            If w_strStaffMngID.Equals(w_strStaffID_bk) = False Then
                                w_StaffCount = w_StaffCount + 1 '対象職員数カウント

                                ReDim Preserve m_udtStaffData(w_StaffCount)

                                '●勤務地異動歴
                                ReDim m_udtStaffData(w_StaffCount).IdoHistory(0)
                                '●採用歴
                                ReDim m_udtStaffData(w_StaffCount).SaiyoHistory(0)
                            End If

                            '●職員管理番号
                            m_udtStaffData(w_StaffCount).strStaffMngID = w_strStaffMngID
                            '●職員番号
                            m_udtStaffData(w_StaffCount).strStaffID = .f職員番号2
                            '●職員表示順
                            m_udtStaffData(w_StaffCount).lngStaffDispNo = w_lngLoop
                            '●氏名
                            m_udtStaffData(w_StaffCount).strName = .f氏名2
                            '●カナ
                            m_udtStaffData(w_StaffCount).strKana = .f氏名カナ2
                            '●性別
                            m_udtStaffData(w_StaffCount).strSex = .f性別2
                            '●PHS番号
                            m_udtStaffData(w_StaffCount).strPHS = .fPHS電話番号2
                            '●職種コード/名称
                            m_udtStaffData(w_StaffCount).strJocCD = .f職種CD2
                            m_udtStaffData(w_StaffCount).strJocNm = .f職種名称2
                            m_udtStaffData(w_StaffCount).lngJobNo = .f職種表示順

                            '●役職コード/名称
                            m_udtStaffData(w_StaffCount).strPostCD = .f役職CD2
                            m_udtStaffData(w_StaffCount).strPostNm = .f役職名称2
                            m_udtStaffData(w_StaffCount).lngPostNo = .f役職表示順

                            '●勤務部署コード
                            m_udtStaffData(w_StaffCount).strKinmuDeptCD = .f在職看護単位CD
                            '●勤務部署名称
                            m_udtStaffData(w_StaffCount).strKinmuDeptName = .f在職看護単位名称

                            m_udtStaffData(w_StaffCount).lngKinmuDeptNo = .f在職看護単位表示順
                            '●配属部署コード
                            m_udtStaffData(w_StaffCount).strWardDeptCD = .f配属部署CD2
                            '●配属部署名称
                            m_udtStaffData(w_StaffCount).strWardDeptName = .f配属部署名称2

                            m_udtStaffData(w_StaffCount).lngWardDeptNo = .f配属部署表示順

                            '--- 採用年月日の設定
                            w_lngSaiyoCnt = UBound(m_udtStaffData(w_StaffCount).SaiyoHistory) + 1
                            ReDim Preserve m_udtStaffData(w_StaffCount).SaiyoHistory(w_lngSaiyoCnt)
                            '●採用年月日
                            m_udtStaffData(w_StaffCount).SaiyoHistory(w_lngSaiyoCnt).lngStartDate = .f採用年月日2
                            '●採用条件コード
                            m_udtStaffData(w_StaffCount).SaiyoHistory(w_lngSaiyoCnt).strCD = .f採用条件CD2
                            '●転退年月日
                            m_udtStaffData(w_StaffCount).SaiyoHistory(w_lngSaiyoCnt).lngEndDate = .f転退年月日2
                            '--- 異動年月日の設定
                            w_lngIdoCnt = UBound(m_udtStaffData(w_StaffCount).IdoHistory) + 1
                            ReDim Preserve m_udtStaffData(w_StaffCount).IdoHistory(w_lngIdoCnt)
                            '●異動年月日
                            m_udtStaffData(w_StaffCount).IdoHistory(w_lngIdoCnt).lngStartDate = .f異動年月日
                            '●異動終了年月日
                            m_udtStaffData(w_StaffCount).IdoHistory(w_lngIdoCnt).lngEndDate = .f終了年月日
                            '職員管理番号 退避
                            w_strStaffID_bk = w_strStaffMngID
                        End If

                    Next w_lngLoop

                End If

                If (((M_strNoConfCD).Equals(g_strSelJobCD) AndAlso p_intTab = 2) OrElse ((M_strNoConfCD).Equals(g_strSelPostCD) AndAlso p_intTab = 1)) Then

                    .p病院CD = General.g_strHospitalCD
                    .p職員取得FLG = 4
                    '職員取得FLG
                    Select Case p_intTab
                        Case 1
                            .p優先順位 = 1 '役職優先
                            .p対象CD = g_strSelPostCD '役職CD
                        Case 2
                            .p優先順位 = 2 '職種
                            .p対象CD = g_strSelJobCD '職種CD
                        Case Else
                            Exit Sub
                    End Select
                    .pソート順 = 0 'ソート順
                    If (M_DEPT_OVERTIME).Equals(m_strSelChildMenu) Then
                        .p日付区分 = 1 '期間
                        .p開始年月日 = w_lngFrom '開始年月日
                        .p終了年月日 = w_lngTo '終了年月日
                    Else
                        .p日付区分 = 0 '単一日
                        .p開始年月日 = w_lngDate '開始年月日
                        .p終了年月日 = 0
                    End If
                    .p勤務対象FLG = 0 '全員
                    .pチーム区分 = 0 '考慮しない
                    .pシステム区分 = 0 '職員歴必要
                    If .mGetStaff = False Then

                    Else
                        '●職員件数
                        w_lngRecCnt = .f職員件数
                        For w_lngLoop = 1 To w_lngRecCnt
                            '索引
                            .p職員索引 = w_lngLoop

                            w_strStaffMngID = .f職員管理番号2

                            '※表示可能な職員かどうかをチェックする
                            Select Case p_intTab
                                Case 1
                                    '役職
                                    w_strCD = .f役職CD2
                                    w_blnOKFlg = False
                                    For w_lngKinmuLoop = 1 To UBound(m_udtPost)
                                        If (w_strCD).Equals(m_udtPost(w_lngKinmuLoop).strDeptCD) Then
                                            w_blnOKFlg = True
                                            Exit For
                                        End If
                                    Next w_lngKinmuLoop

                                Case 2
                                    '職種
                                    w_strCD = .f職種CD2
                                    w_blnOKFlg = False
                                    For w_lngKinmuLoop = 1 To UBound(m_udtJob)
                                        If (w_strCD).Equals(m_udtJob(w_lngKinmuLoop).strDeptCD) Then
                                            w_blnOKFlg = True
                                            Exit For
                                        End If
                                    Next w_lngKinmuLoop

                                Case Else
                                    Exit Sub
                            End Select

                            If m_selNoConfFlg Then
                                '未確定選択時のみブランクでも対象とする
                                If String.IsNullOrEmpty(w_strCD) Then
                                    w_blnOKFlg = True
                                End If
                            End If

                            If w_blnOKFlg = True Then
                                If w_strStaffMngID.Equals(w_strStaffID_bk) = False Then
                                    w_StaffCount = UBound(m_udtStaffData) + 1 '対象職員数カウント

                                    ReDim Preserve m_udtStaffData(w_StaffCount)

                                    '●勤務地異動歴
                                    ReDim m_udtStaffData(w_StaffCount).IdoHistory(0)
                                    '●採用歴
                                    ReDim m_udtStaffData(w_StaffCount).SaiyoHistory(0)
                                End If

                                '●職員管理番号
                                m_udtStaffData(w_StaffCount).strStaffMngID = w_strStaffMngID
                                '●職員番号
                                m_udtStaffData(w_StaffCount).strStaffID = .f職員番号2
                                '●職員表示順
                                m_udtStaffData(w_StaffCount).lngStaffDispNo = w_lngLoop
                                '●氏名
                                m_udtStaffData(w_StaffCount).strName = .f氏名2
                                '●カナ
                                m_udtStaffData(w_StaffCount).strKana = .f氏名カナ2
                                '=========================================================================
                                '●性別
                                m_udtStaffData(w_StaffCount).strSex = .f性別2
                                '●PHS番号
                                m_udtStaffData(w_StaffCount).strPHS = .fPHS電話番号2
                                '●職種コード/名称
                                m_udtStaffData(w_StaffCount).strJocCD = .f職種CD2
                                m_udtStaffData(w_StaffCount).strJocNm = .f職種名称2
                                m_udtStaffData(w_StaffCount).lngJobNo = .f職種表示順

                                '●役職コード/名称
                                m_udtStaffData(w_StaffCount).strPostCD = .f役職CD2
                                m_udtStaffData(w_StaffCount).strPostNm = .f役職名称2
                                m_udtStaffData(w_StaffCount).lngPostNo = .f役職表示順

                                '●勤務部署コード
                                m_udtStaffData(w_StaffCount).strKinmuDeptCD = .f在職看護単位CD
                                '●勤務部署名称
                                m_udtStaffData(w_StaffCount).strKinmuDeptName = .f在職看護単位名称

                                m_udtStaffData(w_StaffCount).lngKinmuDeptNo = .f在職看護単位表示順
                                '●配属部署コード
                                m_udtStaffData(w_StaffCount).strWardDeptCD = .f配属部署CD2
                                '●配属部署名称
                                m_udtStaffData(w_StaffCount).strWardDeptName = .f配属部署名称2

                                m_udtStaffData(w_StaffCount).lngWardDeptNo = .f配属部署表示順

                                '--- 採用年月日の設定
                                w_lngSaiyoCnt = UBound(m_udtStaffData(w_StaffCount).SaiyoHistory) + 1
                                ReDim Preserve m_udtStaffData(w_StaffCount).SaiyoHistory(w_lngSaiyoCnt)
                                '●採用年月日
                                m_udtStaffData(w_StaffCount).SaiyoHistory(w_lngSaiyoCnt).lngStartDate = .f採用年月日2
                                '●採用条件コード
                                m_udtStaffData(w_StaffCount).SaiyoHistory(w_lngSaiyoCnt).strCD = .f採用条件CD2
                                '●転退年月日
                                m_udtStaffData(w_StaffCount).SaiyoHistory(w_lngSaiyoCnt).lngEndDate = .f転退年月日2
                                '--- 異動年月日の設定
                                w_lngIdoCnt = UBound(m_udtStaffData(w_StaffCount).IdoHistory) + 1
                                ReDim Preserve m_udtStaffData(w_StaffCount).IdoHistory(w_lngIdoCnt)
                                '●異動年月日
                                m_udtStaffData(w_StaffCount).IdoHistory(w_lngIdoCnt).lngStartDate = .f異動年月日
                                '●異動終了年月日
                                m_udtStaffData(w_StaffCount).IdoHistory(w_lngIdoCnt).lngEndDate = .f終了年月日
                                '職員管理番号 退避
                                w_strStaffID_bk = w_strStaffMngID
                            End If

                        Next w_lngLoop

                    End If
                End If

            End With

            '職員のｿｰﾄ
            Select Case p_intTab

                Case 1
                    '役職表示順＞勤務部署表示順＞配属部署表示順＞職種表示順>職員表示順

                    '職員人数分 繰り返し
                    For w_Int = 1 To UBound(m_udtStaffData)
                        '(職員人数 - ｿｰﾄ終了人数) 繰り返し
                        For w_Int2 = 1 To UBound(m_udtStaffData) - w_Int
                            '並び替え 実行 ?
                            If (m_udtStaffData(w_Int).lngPostNo > m_udtStaffData(w_Int + w_Int2).lngPostNo) Then

                                w_WorkTbl = m_udtStaffData(w_Int)
                                m_udtStaffData(w_Int) = m_udtStaffData(w_Int + w_Int2)
                                m_udtStaffData(w_Int + w_Int2) = w_WorkTbl

                            ElseIf (m_udtStaffData(w_Int).lngPostNo = m_udtStaffData(w_Int + w_Int2).lngPostNo) AndAlso m_udtStaffData(w_Int).lngKinmuDeptNo > m_udtStaffData(w_Int + w_Int2).lngKinmuDeptNo Then

                                w_WorkTbl = m_udtStaffData(w_Int)
                                m_udtStaffData(w_Int) = m_udtStaffData(w_Int + w_Int2)
                                m_udtStaffData(w_Int + w_Int2) = w_WorkTbl

                            ElseIf (m_udtStaffData(w_Int).lngPostNo = m_udtStaffData(w_Int + w_Int2).lngPostNo) AndAlso m_udtStaffData(w_Int).lngKinmuDeptNo = m_udtStaffData(w_Int + w_Int2).lngKinmuDeptNo AndAlso m_udtStaffData(w_Int).lngWardDeptNo > m_udtStaffData(w_Int + w_Int2).lngWardDeptNo Then

                                w_WorkTbl = m_udtStaffData(w_Int)
                                m_udtStaffData(w_Int) = m_udtStaffData(w_Int + w_Int2)
                                m_udtStaffData(w_Int + w_Int2) = w_WorkTbl

                            ElseIf (m_udtStaffData(w_Int).lngPostNo = m_udtStaffData(w_Int + w_Int2).lngPostNo) AndAlso m_udtStaffData(w_Int).lngKinmuDeptNo = m_udtStaffData(w_Int + w_Int2).lngKinmuDeptNo AndAlso m_udtStaffData(w_Int).lngWardDeptNo = m_udtStaffData(w_Int + w_Int2).lngWardDeptNo AndAlso m_udtStaffData(w_Int).lngJobNo > m_udtStaffData(w_Int + w_Int2).lngJobNo Then

                                w_WorkTbl = m_udtStaffData(w_Int)
                                m_udtStaffData(w_Int) = m_udtStaffData(w_Int + w_Int2)
                                m_udtStaffData(w_Int + w_Int2) = w_WorkTbl

                            ElseIf (m_udtStaffData(w_Int).lngPostNo = m_udtStaffData(w_Int + w_Int2).lngPostNo) AndAlso m_udtStaffData(w_Int).lngKinmuDeptNo = m_udtStaffData(w_Int + w_Int2).lngKinmuDeptNo AndAlso m_udtStaffData(w_Int).lngWardDeptNo = m_udtStaffData(w_Int + w_Int2).lngWardDeptNo AndAlso m_udtStaffData(w_Int).lngJobNo = m_udtStaffData(w_Int + w_Int2).lngJobNo AndAlso m_udtStaffData(w_Int).lngStaffDispNo > m_udtStaffData(w_Int + w_Int2).lngStaffDispNo Then

                                w_WorkTbl = m_udtStaffData(w_Int)
                                m_udtStaffData(w_Int) = m_udtStaffData(w_Int + w_Int2)
                                m_udtStaffData(w_Int + w_Int2) = w_WorkTbl

                            End If
                        Next w_Int2
                        '待ち処理
                        System.Windows.Forms.Application.DoEvents()
                    Next w_Int

                Case 2
                    '職種表示順>勤務部署表示順＞役職表示順＞配属部署表示順＞職員表示順

                    '職員人数分 繰り返し
                    For w_Int = 1 To UBound(m_udtStaffData)
                        '(職員人数 - ｿｰﾄ終了人数) 繰り返し
                        For w_Int2 = 1 To UBound(m_udtStaffData) - w_Int
                            '並び替え 実行 ?
                            If (m_udtStaffData(w_Int).lngJobNo > m_udtStaffData(w_Int + w_Int2).lngJobNo) Then

                                w_WorkTbl = m_udtStaffData(w_Int)
                                m_udtStaffData(w_Int) = m_udtStaffData(w_Int + w_Int2)
                                m_udtStaffData(w_Int + w_Int2) = w_WorkTbl

                            ElseIf (m_udtStaffData(w_Int).lngJobNo = m_udtStaffData(w_Int + w_Int2).lngJobNo) AndAlso m_udtStaffData(w_Int).lngKinmuDeptNo > m_udtStaffData(w_Int + w_Int2).lngKinmuDeptNo Then

                                w_WorkTbl = m_udtStaffData(w_Int)
                                m_udtStaffData(w_Int) = m_udtStaffData(w_Int + w_Int2)
                                m_udtStaffData(w_Int + w_Int2) = w_WorkTbl

                            ElseIf (m_udtStaffData(w_Int).lngJobNo = m_udtStaffData(w_Int + w_Int2).lngJobNo) AndAlso m_udtStaffData(w_Int).lngKinmuDeptNo = m_udtStaffData(w_Int + w_Int2).lngKinmuDeptNo AndAlso m_udtStaffData(w_Int).lngWardDeptNo > m_udtStaffData(w_Int + w_Int2).lngWardDeptNo Then

                                w_WorkTbl = m_udtStaffData(w_Int)
                                m_udtStaffData(w_Int) = m_udtStaffData(w_Int + w_Int2)
                                m_udtStaffData(w_Int + w_Int2) = w_WorkTbl

                            ElseIf (m_udtStaffData(w_Int).lngJobNo = m_udtStaffData(w_Int + w_Int2).lngJobNo) AndAlso m_udtStaffData(w_Int).lngKinmuDeptNo = m_udtStaffData(w_Int + w_Int2).lngKinmuDeptNo AndAlso m_udtStaffData(w_Int).lngWardDeptNo = m_udtStaffData(w_Int + w_Int2).lngWardDeptNo AndAlso m_udtStaffData(w_Int).lngPostNo > m_udtStaffData(w_Int + w_Int2).lngPostNo Then

                                w_WorkTbl = m_udtStaffData(w_Int)
                                m_udtStaffData(w_Int) = m_udtStaffData(w_Int + w_Int2)
                                m_udtStaffData(w_Int + w_Int2) = w_WorkTbl

                            ElseIf (m_udtStaffData(w_Int).lngJobNo = m_udtStaffData(w_Int + w_Int2).lngJobNo) AndAlso m_udtStaffData(w_Int).lngKinmuDeptNo = m_udtStaffData(w_Int + w_Int2).lngKinmuDeptNo AndAlso m_udtStaffData(w_Int).lngWardDeptNo = m_udtStaffData(w_Int + w_Int2).lngWardDeptNo AndAlso m_udtStaffData(w_Int).lngPostNo = m_udtStaffData(w_Int + w_Int2).lngPostNo AndAlso m_udtStaffData(w_Int).lngStaffDispNo > m_udtStaffData(w_Int + w_Int2).lngStaffDispNo Then

                                w_WorkTbl = m_udtStaffData(w_Int)
                                m_udtStaffData(w_Int) = m_udtStaffData(w_Int + w_Int2)
                                m_udtStaffData(w_Int + w_Int2) = w_WorkTbl

                            End If
                        Next w_Int2
                        '待ち処理
                        System.Windows.Forms.Application.DoEvents()
                    Next w_Int

            End Select

        Catch ex As Exception
            Call General.paTrpMsg(Convert.ToString(Err.Number), W_SUBNAME)
        End Try
    End Sub


    '==================================
    '日別超過勤務入力用職員 取得
    '==================================
    Private Sub sGetDayOverStaff()
        Const W_SUBNAME As String = "NSC0000HA sGetDayOverStaff"
        Const W_strListALL As String = "0000"

        Try
            Dim w_lngDate As Integer
            Dim w_lngRecCnt As Integer
            Dim w_lngLoop As Integer
            Dim w_strStaffMngID As String
            Dim w_strStaffID_bk As String '退避用
            Dim w_StaffCount As Integer
            Dim w_lngSaiyoCnt As Integer
            Dim w_lngIdoCnt As Integer
            Dim w_strKinmuDeptCD As String
            Dim w_Int As Integer
            Dim w_Int2 As Integer
            Dim w_WorkTbl As Staff_Type
            Dim w_strSelBusyoCD As String
            Dim w_strAuthRangeKbn As String
            Dim w_lngDataCnt As Integer

            '基準日
            w_lngDate = General.paGetDateIntegerFromDate(m_DayOverSelectDate)

            If W_strListALL.Equals(m_strSelBusyoCD) = False Then
                w_strSelBusyoCD = General.paFormatSpace(m_strSelBusyoCD, 10)
            Else
                '表示範囲取得
                With General.g_objSecurity
                    '権限範囲区分を取得する
                    If .mGetResource(g_MenuM(g_lngGroupIdx).ListBarMenu(g_lngListIdx).strResCD) = False Then
                        w_strAuthRangeKbn = ""
                    Else
                        w_strAuthRangeKbn = .fR_UpdAuthRangeKbn
                    End If

                    If .mGetAuthKinmuDept(w_strAuthRangeKbn) = False Then
                        w_strSelBusyoCD = ""
                    Else
                        w_lngDataCnt = .fAK_KinmuDeptCount


                        For w_lngLoop = 1 To w_lngDataCnt
                            .mAK_KinmuDeptIdx = w_lngLoop
                            w_strKinmuDeptCD = .fAK_KinmuDeptCD

                            If "NOCONF".Equals(w_strKinmuDeptCD) = False AndAlso "RETIRE".Equals(w_strKinmuDeptCD) = False Then
                                w_strSelBusyoCD = w_strSelBusyoCD & "," & General.paFormatSpace(w_strKinmuDeptCD, 10)
                            End If
                        Next w_lngLoop
                    End If
                End With
            End If

            ' 初期化
            ReDim m_udtStaffData(0)

            '==================================
            '職員情報 取得
            '==================================
            With General.g_objGetData
                .p病院CD = General.g_strHospitalCD
                .p日付区分 = 0
                .pソート順 = 0
                .p開始年月日 = w_lngDate
                .p終了年月日 = w_lngDate
                .p勤務対象FLG = 2
                If "1".Equals(g_strSelSaikeiFlg) Then
                    .p優先順位 = 9 '再掲部署CD優先
                Else
                    .p優先順位 = 0 '勤務部署CD優先
                End If
                If W_strListALL.Equals(m_strSelBusyoCD) = False Then
                    .p職員取得FLG = 0
                    .p対象CD = m_strSelBusyoCD
                Else
                    .p職員取得FLG = 2
                    .p対象CD = ""
                End If
                .pチーム区分 = 0
                .pシステム区分 = 0

                If .mGetStaff = False Then

                Else
                    '●職員件数
                    w_lngRecCnt = .f職員件数

                    For w_lngLoop = 1 To w_lngRecCnt
                        '索引
                        .p職員索引 = w_lngLoop

                        w_strKinmuDeptCD = .f在職看護単位CD

                        '対象部署のみ
                        If InStr(w_strSelBusyoCD, General.paFormatSpace(w_strKinmuDeptCD, 10)) > 0 AndAlso String.IsNullOrEmpty(Trim(w_strKinmuDeptCD)) = False Then

                            ReDim Preserve m_udtStaffData(UBound(m_udtStaffData) + 1)

                            w_strStaffMngID = .f職員管理番号2

                            If w_strStaffMngID.Equals(w_strStaffID_bk) = False Then
                                w_StaffCount = w_StaffCount + 1 '対象職員数カウント
                                '●勤務地異動歴
                                ReDim m_udtStaffData(w_StaffCount).IdoHistory(0)
                                '●採用歴
                                ReDim m_udtStaffData(w_StaffCount).SaiyoHistory(0)
                            End If

                            '●職員管理番号
                            m_udtStaffData(w_StaffCount).strStaffMngID = w_strStaffMngID
                            '●職員番号
                            m_udtStaffData(w_StaffCount).strStaffID = .f職員番号2
                            '●氏名
                            m_udtStaffData(w_StaffCount).strName = .f氏名2
                            '●カナ
                            m_udtStaffData(w_StaffCount).strKana = .f氏名カナ2
                            '●性別
                            m_udtStaffData(w_StaffCount).strSex = .f性別2
                            '●PHS番号
                            m_udtStaffData(w_StaffCount).strPHS = .fPHS電話番号2
                            '●職種コード/名称
                            m_udtStaffData(w_StaffCount).strJocCD = .f職種CD2
                            m_udtStaffData(w_StaffCount).strJocNm = .f職種名称2
                            '●役職コード/名称
                            m_udtStaffData(w_StaffCount).strPostCD = .f役職CD2
                            m_udtStaffData(w_StaffCount).strPostNm = .f役職名称2

                            '●勤務部署コード
                            m_udtStaffData(w_StaffCount).strKinmuDeptCD = w_strKinmuDeptCD
                            '●勤務部署名称
                            m_udtStaffData(w_StaffCount).strKinmuDeptName = .f在職看護単位名称
                            '●配属部署コード
                            m_udtStaffData(w_StaffCount).strWardDeptCD = .f配属部署CD2
                            '●配属部署名称
                            m_udtStaffData(w_StaffCount).strWardDeptName = .f配属部署名称2

                            '--- 採用年月日の設定
                            w_lngSaiyoCnt = UBound(m_udtStaffData(w_StaffCount).SaiyoHistory) + 1
                            ReDim Preserve m_udtStaffData(w_StaffCount).SaiyoHistory(w_lngSaiyoCnt)
                            '●採用年月日
                            m_udtStaffData(w_StaffCount).SaiyoHistory(w_lngSaiyoCnt).lngStartDate = .f採用年月日2
                            '●採用条件コード
                            m_udtStaffData(w_StaffCount).SaiyoHistory(w_lngSaiyoCnt).strCD = .f採用条件CD2
                            '●転退年月日
                            m_udtStaffData(w_StaffCount).SaiyoHistory(w_lngSaiyoCnt).lngEndDate = .f転退年月日2
                            '--- 異動年月日の設定
                            w_lngIdoCnt = UBound(m_udtStaffData(w_StaffCount).IdoHistory) + 1
                            ReDim Preserve m_udtStaffData(w_StaffCount).IdoHistory(w_lngIdoCnt)
                            '●異動年月日
                            m_udtStaffData(w_StaffCount).IdoHistory(w_lngIdoCnt).lngStartDate = .f異動年月日
                            '●異動終了年月日
                            m_udtStaffData(w_StaffCount).IdoHistory(w_lngIdoCnt).lngEndDate = .f終了年月日

                            '●勤務部署コード
                            m_udtStaffData(w_StaffCount).IdoHistory(w_lngIdoCnt).strCD = w_strKinmuDeptCD

                            m_udtStaffData(w_StaffCount).lngJobNo = .f職種表示順
                            m_udtStaffData(w_StaffCount).lngPostNo = .f役職表示順
                            m_udtStaffData(w_StaffCount).lngKinmuDeptNo = .f在職看護単位表示順
                            '●配属部署名称
                            m_udtStaffData(w_StaffCount).strWardDeptName = .f配属部署名称2
                            '●表示NO
                            For w_Int = 1 To UBound(m_StaffHistory)
                                If (m_udtStaffData(w_StaffCount).strStaffMngID).Equals(m_StaffHistory(w_Int).ID) AndAlso (m_udtStaffData(w_StaffCount).strKinmuDeptCD).Equals(m_StaffHistory(w_Int).DeptCD) Then
                                    m_udtStaffData(w_StaffCount).lngStaffDispNo = m_StaffHistory(w_Int).No
                                    Exit For
                                End If
                            Next w_Int

                            '表示Noがない場合、計画がないので出力しない
                            If m_udtStaffData(w_StaffCount).lngStaffDispNo = 0 Then
                                ReDim Preserve m_udtStaffData(UBound(m_udtStaffData) - 1)
                                w_StaffCount = w_StaffCount - 1
                            End If

                            '職員管理番号 退避
                            w_strStaffID_bk = w_strStaffMngID

                        End If


                    Next w_lngLoop
                End If
            End With

            '勤務部署表示順＞職員表示順

            '職員人数分 繰り返し
            For w_Int = 1 To UBound(m_udtStaffData)
                '(職員人数 - ｿｰﾄ終了人数) 繰り返し
                For w_Int2 = 1 To UBound(m_udtStaffData) - w_Int
                    '並び替え 実行 ?

                    If m_udtStaffData(w_Int).lngKinmuDeptNo > m_udtStaffData(w_Int + w_Int2).lngKinmuDeptNo Then

                        w_WorkTbl = m_udtStaffData(w_Int)
                        m_udtStaffData(w_Int) = m_udtStaffData(w_Int + w_Int2)
                        m_udtStaffData(w_Int + w_Int2) = w_WorkTbl

                    ElseIf m_udtStaffData(w_Int).lngKinmuDeptNo = m_udtStaffData(w_Int + w_Int2).lngKinmuDeptNo AndAlso m_udtStaffData(w_Int).lngStaffDispNo > m_udtStaffData(w_Int + w_Int2).lngStaffDispNo Then

                        w_WorkTbl = m_udtStaffData(w_Int)
                        m_udtStaffData(w_Int) = m_udtStaffData(w_Int + w_Int2)
                        m_udtStaffData(w_Int + w_Int2) = w_WorkTbl

                    End If
                Next w_Int2
                '待ち処理
                System.Windows.Forms.Application.DoEvents()
            Next w_Int

        Catch ex As Exception
            Call General.paTrpMsg(Convert.ToString(Err.Number), W_SUBNAME)
        End Try
    End Sub

    '==============================
    '【未承認業務】- 日別超過勤務入力 取得
    '==============================
    Private Sub sGetDayOver()
        Const W_SUBNAME As String = "NSC0000HA sGetDayOver"
        Const W_strListALL As String = "0000"

        Try

            Dim w_lngLoop As Integer
            Dim w_lngPreFrom As Integer
            Dim w_lngTo As Integer
            Dim w_lngDate As Integer
            Dim w_lngRecCnt As Integer
            Dim w_lngIdx As Integer



            Dim w_datDateFrom As Date
            Dim w_datDateTo As Date

            ReDim m_udtOverKinmuTotal(UBound(m_udtStaffData))
            ReDim m_udtDayOverKinmu(UBound(m_udtStaffData))
            ReDim m_udtDayKinmuJisseki(UBound(m_udtStaffData))
            ReDim m_udtApproveData(0)

            '======================
            '未承認一覧取得
            '======================
            '対象日
            w_lngDate = General.paGetDateIntegerFromDate(m_DayOverSelectDate)
            With General.g_objSyouninData

                '承認者職員管理番号
                .pApproveStaffMngID = General.g_strUserMngID
                .mNA_GetKbn = "2" '全表示
                .mNA_DateKbn = "1" '取得区分(取得期間)
                .mNA_DateFrom = w_lngDate '年月日FROM
                .mNA_DateTo = w_lngDate '年月日TO
                .mNA_KikanKbn = "1"

                If .mGetNotApproveList = False Then

                Else
                    '届出件数
                    w_lngRecCnt = .fNA_Count

                    For w_lngLoop = 1 To w_lngRecCnt
                        '索引
                        .mNA_Idx = w_lngLoop

                        If (.fNA_AppliCD).Equals(M_STRJIKANGAI) AndAlso ((W_strListALL).Equals(m_strSelBusyoCD) OrElse m_strSelBusyoCD.Equals(.fNA_ApproveKinmuDeptCD)) Then

                            w_lngIdx = UBound(m_udtApproveData) + 1
                            ReDim Preserve m_udtApproveData(w_lngIdx)

                            '●UNIQUESEQNO
                            m_udtApproveData(w_lngIdx).strUNIQUESEQNO = .fNA_UNIQUESEQNO
                            '●届出コード
                            m_udtApproveData(w_lngIdx).strAppliCD = .fNA_AppliCD
                            '●届出名称
                            m_udtApproveData(w_lngIdx).strAppliNm = .fNA_AppliName
                            '●申請者職員管理番号
                            m_udtApproveData(w_lngIdx).strAppliStaffMngID = .fNA_AppliStaffMngID
                            '●申請者職員番号
                            m_udtApproveData(w_lngIdx).strAppliStaffID = .fNA_AppliStaffID
                            '●申請者氏名
                            m_udtApproveData(w_lngIdx).strAppliStaffName = .fNA_AppliStaffName
                            '●申請年月日
                            m_udtApproveData(w_lngIdx).lngAppliDate = .fNA_AppliDate
                            '●期間開始年月日
                            m_udtApproveData(w_lngIdx).lngPeriodFromDate = .fNA_PeriodFromDate
                            '●期間終了年月日
                            m_udtApproveData(w_lngIdx).lngPeriodToDate = .fNA_PeriodToDate
                            '●開始時間
                            m_udtApproveData(w_lngIdx).lngFromTime = .fNA_FromTime
                            '●終了時間
                            m_udtApproveData(w_lngIdx).lngToTime = .fNA_ToTime
                            '●翌日フラグ
                            m_udtApproveData(w_lngIdx).strNextDayFlg = .fNA_NextDayFlg
                            '●内容
                            m_udtApproveData(w_lngIdx).strContents = .fNA_Contents
                            '●理由
                            m_udtApproveData(w_lngIdx).strReasonNote = .fNA_ReasonNote
                            '●申請者承認状態区分
                            m_udtApproveData(w_lngIdx).strAppliApproveStatusKbn = .fNA_AppliApproveStatusKbn
                            '●申請者承認状態表示
                            m_udtApproveData(w_lngIdx).strAppliApproveStatusDisp = .fNA_AppliApproveStatusDisp
                            '●コメント
                            m_udtApproveData(w_lngIdx).strComment = .fNA_Comment
                            '●汎用エリア
                            m_udtApproveData(w_lngIdx).strHanyouArea = .fNA_HanyouArea
                            '●破棄年月日
                            m_udtApproveData(w_lngIdx).dblCancelDate = .fNA_CancelDate
                            '●最終更新年月日
                            m_udtApproveData(w_lngIdx).dblLastUpdTimeDate = .fNA_LastUpdTimeDate
                            '●画面制御区分
                            m_udtApproveData(w_lngIdx).strScreenCtrlKbn = .fNA_ScreenCtrlKbn
                            '●承認階層レベル
                            m_udtApproveData(w_lngIdx).lngApproveClassLvl = .fNA_ApproveClassLevel
                            '●承認者職員管理番号
                            m_udtApproveData(w_lngIdx).strApproveStaffMngID = .fNA_ApproveStaffMngID
                            '●承認者職員番号
                            m_udtApproveData(w_lngIdx).strApproveStaffID = .fNA_ApproveStaffID
                            '●承認者氏名
                            m_udtApproveData(w_lngIdx).strApproveStaffNm = .fNA_ApproveStaffName
                            '●承認状態区分(レベル別)
                            m_udtApproveData(w_lngIdx).strApproveStatusKbn = .fNA_ApproveStatusKbn
                            '●承認状態表示(レベル別)
                            m_udtApproveData(w_lngIdx).strApproveStatusDisp = .fNA_ApproveStatusDisp
                            '●申請者勤務部署コード
                            m_udtApproveData(w_lngIdx).strKinmuDeptCD = .fNA_ApproveKinmuDeptCD

                        End If

                    Next w_lngLoop
                End If
            End With

            '======================
            '勤務実績
            '======================
            w_datDateFrom = New Date(m_DayOverSelectDate.Year, m_DayOverSelectDate.Month, 1)

            w_datDateTo = DateAdd(Microsoft.VisualBasic.DateInterval.Day, -1, DateAdd(Microsoft.VisualBasic.DateInterval.Month, 1, w_datDateFrom))
            w_lngTo = General.paGetDateIntegerFromDate(w_datDateTo)
            w_lngPreFrom = General.paGetDateIntegerFromDate(DateAdd(Microsoft.VisualBasic.DateInterval.Day, -1, w_datDateFrom))
            w_lngTo = General.paGetDateIntegerFromDate(w_datDateTo)

            m_DayOverSelectFrom = w_datDateFrom
            m_DayOverSelectTo = w_datDateTo



            '並列処理判定
            Dim w_staffCount As Integer = UBound(m_udtStaffData)
            Dim th_count As Integer
            th_count = (w_staffCount \ M_LIMIT_THREAD) + 1
            Dim w_strInit As String = General.paGetItemValue(General.G_STRMAINKEY3, General.G_STRSUBKEY1, "DATEJUDGMENT", "0", General.g_strHospitalCD)
            Dim w_lngStandardDate As Integer = General.paGetDateIntegerFromDate(m_DayOverSelectDate)
            Dim w_lngBeforeDay As Integer = General.paGetDateIntegerFromDate(DateAdd(Microsoft.VisualBasic.DateInterval.Day, -1, m_DayOverSelectDate))

            '職員データ取得前の超勤オブジェクトの初期化
            subOverKinmuInit(w_lngBeforeDay, w_lngStandardDate, w_strInit)

            If 1 = th_count Then
                'スレッド数１の場合、並列化を行わない
                For w_lngLoop = 1 To UBound(m_udtStaffData)

                    '1日の超過勤務取得
                    Call subDayOverKinmu(w_lngLoop)
                    If String.IsNullOrEmpty(m_udtDayKinmuJisseki(w_lngLoop).strKinmuCD) = False Then
                        '======================
                        '勤務時間
                        '======================
                        Call Get_KinmuTime(w_lngLoop)
                    End If
                    '-------------------------------------------------------
                    With General.g_objWorkBaseInfo
                        .p職員番号 = m_udtStaffData(w_lngLoop).strStaffMngID
                        .p開始年月日 = General.paGetDateIntegerFromDate(m_DayOverSelectDate)


                        If .mGetOKAppliRuikei Then
                            m_udtDayOverKinmu(w_lngLoop).AprYetTimeTotal = .f申請時間
                            m_udtDayOverKinmu(w_lngLoop).AprOverTimeTotal = .f確定時間
                        Else
                            m_udtDayOverKinmu(w_lngLoop).AprYetTimeTotal = 0
                            m_udtDayOverKinmu(w_lngLoop).AprOverTimeTotal = 0
                        End If
                    End With
                Next w_lngLoop

            ElseIf 1 < th_count Then
                '並列処理

                Dim th(th_count - 1) As System.Threading.Thread
                Dim intStart As New List(Of Integer)
                Dim intEnd As New List(Of Integer)
                Dim w_startcount As Integer = 1
                '並列処理の開始、終了INDEXの設定
                If 0 < th_count Then
                    For i As Integer = 0 To th_count - 1

                        intStart.Add(w_startcount)
                        w_startcount = (w_staffCount / th_count) * (i + 1)
                        intEnd.Add(w_startcount - 1)
                    Next
                    intEnd.RemoveAt(th_count - 1)
                    intEnd.Add(w_staffCount)
                End If



                For i As Integer = 0 To th_count - 1
                    Dim para As Parallel_NSC0000H = New Parallel_NSC0000H(intStart(i), intEnd(i), w_strInit, w_lngStandardDate, w_lngBeforeDay, m_udtDayKinmuJisseki, m_udtDayOverKinmu, m_udtStaffData, m_udtApproveData, General.paDeepCopy(General.g_objComCyokin), General.paDeepCopy(General.g_objGetData), General.paDeepCopy(General.g_objWorkBaseInfo), m_DayOverSelectDate, General.paDeepCopy(General.g_objSyouninData))
                    th(i) = New System.Threading.Thread(AddressOf para.Execute)
                    th(i).Start()
                Next

                '並列処理終了まで元スレッドの停止
                For i As Integer = 0 To th_count - 1
                    th(i).Join()
                Next

            End If

        Catch ex As Exception
            Call General.paTrpMsg(Convert.ToString(Err.Number), W_SUBNAME)
        End Try
    End Sub

    Public Sub subDayOverKinmu(ByVal p_lngStaffIdx As Integer)
        Const W_SUBNAME As String = "frmNSC0000HA subDayOverKinmu"

        Try
            Dim w_lngLoop As Integer
            Dim w_lngRecCnt As Integer
            Dim w_lngOverKCnt As Integer
            Dim w_lngDate As Integer
            Dim w_blnSaiyoFlg As Boolean
            Dim w_lngOverKLoop As Integer
            Dim w_lngSaiyoLoop As Integer
            Dim w_lngStandardDate As Integer
            Dim w_lngWorkLoop As Integer
            Dim w_lngBeforeDay As Integer

            Dim w_lngAppLoop As Integer
            Dim w_lngAppCnt As Integer
            Dim w_strSaiyoCD As String
            Dim w_strKinmuDeptCD As String

            '初期値設定
            '勤務コード
            m_udtDayKinmuJisseki(p_lngStaffIdx).strKinmuCD = ""
            '勤務名称
            m_udtDayKinmuJisseki(p_lngStaffIdx).strKinmuNm = ""
            '勤務略称
            m_udtDayKinmuJisseki(p_lngStaffIdx).strKinmuSecNm = ""
            '勤務記号
            m_udtDayKinmuJisseki(p_lngStaffIdx).strKinmuMark = ""
            '勤務理由
            m_udtDayKinmuJisseki(p_lngStaffIdx).strKinmuReasonKbn = ""
            '半日勤務FLG
            m_udtDayKinmuJisseki(p_lngStaffIdx).strHalfKinmuFlg = ""
            '---------------------------------------------------------

            '基準日
            w_lngStandardDate = General.paGetDateIntegerFromDate(m_DayOverSelectDate)

            '前日
            w_lngBeforeDay = General.paGetDateIntegerFromDate(DateAdd(Microsoft.VisualBasic.DateInterval.Day, -1, m_DayOverSelectDate))

            ReDim m_udtDayOverKinmu(p_lngStaffIdx).OverKinmuData(0)

            General.g_objGetData.pUniqueSeqNo = ""

            w_strSaiyoCD = ""
            w_strKinmuDeptCD = ""
            For w_lngWorkLoop = 1 To UBound(m_udtStaffData(p_lngStaffIdx).SaiyoHistory)
                If m_udtStaffData(p_lngStaffIdx).SaiyoHistory(w_lngWorkLoop).lngStartDate <= w_lngStandardDate AndAlso w_lngStandardDate <= m_udtStaffData(p_lngStaffIdx).SaiyoHistory(w_lngWorkLoop).lngEndDate Then

                    w_strSaiyoCD = m_udtStaffData(p_lngStaffIdx).SaiyoHistory(w_lngWorkLoop).strCD

                End If
            Next w_lngWorkLoop

            For w_lngWorkLoop = 1 To UBound(m_udtStaffData(p_lngStaffIdx).IdoHistory)
                If m_udtStaffData(p_lngStaffIdx).IdoHistory(w_lngWorkLoop).lngStartDate <= w_lngStandardDate AndAlso w_lngStandardDate <= m_udtStaffData(p_lngStaffIdx).IdoHistory(w_lngWorkLoop).lngEndDate Then

                    w_strKinmuDeptCD = m_udtStaffData(p_lngStaffIdx).IdoHistory(w_lngWorkLoop).strCD

                End If
            Next w_lngWorkLoop

            With General.g_objComCyokin
                .p病院CD = General.g_strHospitalCD
                .p職員区分 = 0 '職員管理番号
                .p職員番号 = m_udtStaffData(p_lngStaffIdx).strStaffMngID
                .p日付区分 = 1
                .p開始年月日 = w_lngBeforeDay '開始年月日前日
                .p終了年月日 = w_lngStandardDate '終了年月日
                .p採用CD = w_strSaiyoCD
                .p勤務部署CD = w_strKinmuDeptCD
                If .mGetOverKinmuDataOneDay = False Then

                Else
                    w_lngRecCnt = .f実績超勤件数

                    .p年月日 = w_lngStandardDate

                    For w_lngLoop = 1 To w_lngRecCnt
                        w_lngDate = .f年月日

                        If w_lngStandardDate = w_lngDate Then

                            '実績年月日がある場合(勤務実績がある場合)
                            If w_lngDate > 0 Then
                                '採用期間内であるか
                                w_blnSaiyoFlg = False
                                For w_lngSaiyoLoop = 1 To UBound(m_udtStaffData(p_lngStaffIdx).SaiyoHistory)
                                    If m_udtStaffData(p_lngStaffIdx).SaiyoHistory(w_lngSaiyoLoop).lngStartDate <= w_lngDate AndAlso w_lngDate <= m_udtStaffData(p_lngStaffIdx).SaiyoHistory(w_lngSaiyoLoop).lngEndDate Then
                                        'ﾌﾗｸﾞをTrue(在職期間内である)
                                        w_blnSaiyoFlg = True
                                        Exit For
                                    End If
                                Next w_lngSaiyoLoop

                                '-----------------------------
                                '在職期間内の場合のみ格納
                                '-----------------------------
                                If w_blnSaiyoFlg = True Then
                                    '勤務コード
                                    m_udtDayKinmuJisseki(p_lngStaffIdx).strKinmuCD = .f実績勤務CD
                                    '勤務名称
                                    m_udtDayKinmuJisseki(p_lngStaffIdx).strKinmuNm = .f実績勤務名称
                                    '勤務略称
                                    m_udtDayKinmuJisseki(p_lngStaffIdx).strKinmuSecNm = ""
                                    '勤務記号
                                    m_udtDayKinmuJisseki(p_lngStaffIdx).strKinmuMark = .f実績勤務記号
                                    '勤務理由
                                    m_udtDayKinmuJisseki(p_lngStaffIdx).strKinmuReasonKbn = .f実績理由区分
                                    '半日勤務FLG
                                    m_udtDayKinmuJisseki(p_lngStaffIdx).strHalfKinmuFlg = .f実績半日勤務FLG
                                    w_lngOverKCnt = .f超勤時間件数
                                    For w_lngOverKLoop = 1 To w_lngOverKCnt
                                        .p超勤時間索引 = w_lngOverKLoop
                                        ReDim Preserve m_udtDayOverKinmu(p_lngStaffIdx).OverKinmuData(UBound(m_udtDayOverKinmu(p_lngStaffIdx).OverKinmuData) + 1)

                                        If "2".Equals(.f超勤状態区分) = False OrElse "4".Equals(.f超勤状態区分) = False OrElse "".Equals(.f超勤状態区分) = False Then
                                            m_udtDayOverKinmu(p_lngStaffIdx).lng100Day = m_udtDayOverKinmu(p_lngStaffIdx).lng100Day + .f超過勤務時間100
                                            m_udtDayOverKinmu(p_lngStaffIdx).lng125Day = m_udtDayOverKinmu(p_lngStaffIdx).lng125Day + .f超過勤務時間125
                                            m_udtDayOverKinmu(p_lngStaffIdx).lng150Day = m_udtDayOverKinmu(p_lngStaffIdx).lng150Day + .f超過勤務時間150
                                            m_udtDayOverKinmu(p_lngStaffIdx).lng135Day = m_udtDayOverKinmu(p_lngStaffIdx).lng135Day + .f超過勤務時間135
                                            m_udtDayOverKinmu(p_lngStaffIdx).lng160Day = m_udtDayOverKinmu(p_lngStaffIdx).lng160Day + .f超過勤務時間160

                                            m_udtDayOverKinmu(p_lngStaffIdx).OverKinmuData(w_lngOverKLoop).lngFromTime = .f超勤時間FROM
                                            m_udtDayOverKinmu(p_lngStaffIdx).OverKinmuData(w_lngOverKLoop).lngToTime = .f超勤時間TO
                                            m_udtDayOverKinmu(p_lngStaffIdx).OverKinmuData(w_lngOverKLoop).strReasonSNm = .f超勤理由略称
                                            m_udtDayOverKinmu(p_lngStaffIdx).OverKinmuData(w_lngOverKLoop).strStateKbn = .f超勤状態区分
                                        Else
                                            m_udtDayOverKinmu(p_lngStaffIdx).lng100Day = m_udtDayOverKinmu(p_lngStaffIdx).lng100Day + 0
                                            m_udtDayOverKinmu(p_lngStaffIdx).lng125Day = m_udtDayOverKinmu(p_lngStaffIdx).lng125Day + 0
                                            m_udtDayOverKinmu(p_lngStaffIdx).lng150Day = m_udtDayOverKinmu(p_lngStaffIdx).lng150Day + 0
                                            m_udtDayOverKinmu(p_lngStaffIdx).lng135Day = m_udtDayOverKinmu(p_lngStaffIdx).lng135Day + 0
                                            m_udtDayOverKinmu(p_lngStaffIdx).lng160Day = m_udtDayOverKinmu(p_lngStaffIdx).lng160Day + 0

                                            m_udtDayOverKinmu(p_lngStaffIdx).OverKinmuData(w_lngOverKLoop).lngFromTime = 0
                                            m_udtDayOverKinmu(p_lngStaffIdx).OverKinmuData(w_lngOverKLoop).lngToTime = 0
                                            m_udtDayOverKinmu(p_lngStaffIdx).OverKinmuData(w_lngOverKLoop).strReasonSNm = ""
                                            m_udtDayOverKinmu(p_lngStaffIdx).OverKinmuData(w_lngOverKLoop).strStateKbn = .f超勤状態区分
                                        End If

                                    Next w_lngOverKLoop

                                    m_udtDayOverKinmu(p_lngStaffIdx).UNIQUESEQNO = .f超勤UNIQUESEQNO
                                    m_udtDayOverKinmu(p_lngStaffIdx).ApproveLevel = 0

                                    w_lngAppCnt = UBound(m_udtApproveData)
                                    For w_lngAppLoop = 1 To w_lngAppCnt

                                        If (m_udtApproveData(w_lngAppLoop).strUNIQUESEQNO).Equals(m_udtDayOverKinmu(p_lngStaffIdx).UNIQUESEQNO) Then

                                            m_udtDayOverKinmu(p_lngStaffIdx).ApproveLevel = m_udtApproveData(w_lngAppLoop).lngApproveClassLvl
                                            m_udtDayOverKinmu(p_lngStaffIdx).LastUpdDate = m_udtApproveData(w_lngAppLoop).dblLastUpdTimeDate
                                            m_udtDayOverKinmu(p_lngStaffIdx).AppliDate = m_udtApproveData(w_lngAppLoop).lngPeriodFromDate
                                            m_udtDayOverKinmu(p_lngStaffIdx).AppliStaffMngID = m_udtApproveData(w_lngAppLoop).strAppliStaffMngID

                                            Exit For

                                        End If

                                    Next w_lngAppLoop

                                    If m_udtDayOverKinmu(p_lngStaffIdx).ApproveLevel = 0 Then

                                        m_udtDayOverKinmu(p_lngStaffIdx).IconStatus = M_NO_ICON

                                    Else

                                        General.g_objSyouninData.pAppliCD = M_STRJIKANGAI '届出CD
                                        General.g_objSyouninData.pAppliStaffMngID = m_udtStaffData(p_lngStaffIdx).strStaffMngID '申請者の職員管理番号
                                        General.g_objSyouninData.pAppliDate = w_lngStandardDate '申請日付
                                        General.g_objSyouninData.pUniqueSeqNo = m_udtDayOverKinmu(p_lngStaffIdx).UNIQUESEQNO 'UNIQUESEQNO
                                        General.g_objSyouninData.pDispMode = "2" '表示ﾓｰﾄﾞ
                                        General.g_objSyouninData.pSyoriKbn = "2" '処理区分
                                        General.g_objSyouninData.pApproveStaffMngID = General.g_strUserMngID '承認者職員管理番号

                                        General.g_objSyouninData.mJEV_ApproveClassLevel = Convert.ToString(m_udtDayOverKinmu(p_lngStaffIdx).ApproveLevel)
                                        General.g_objSyouninData.mJEV_ApproveStaffMngID = General.g_strUserMngID

                                        If General.g_objSyouninData.mJudgeVisibleEnable = False Then
                                            m_udtDayOverKinmu(p_lngStaffIdx).IconStatus = M_NO_ICON
                                        Else

                                            If "1".Equals(.f超勤状態区分) Then
                                                m_udtDayOverKinmu(p_lngStaffIdx).IconStatus = M_NOT_APPROVE_DUE

                                                '承認ボタンが使えるとき
                                                '→操作待ち　未承認状態
                                            ElseIf "1".Equals(General.g_objSyouninData.fJEV_ApproveB) Then
                                                m_udtDayOverKinmu(p_lngStaffIdx).IconStatus = M_OK_APPROVE

                                                '引き上げ承認ボタンが使えるとき
                                                '→操作不能　未承認状態
                                            ElseIf "1".Equals(General.g_objSyouninData.fJEV_ApproveUpB) Then
                                                m_udtDayOverKinmu(p_lngStaffIdx).IconStatus = M_NOT_APPROVE_BEFORE

                                                'データが存在し、確定されていなくて承認ボタンと引き上げ承認ボタンが使えないとき
                                                '→操作不能　未確定承認状態
                                            Else
                                                m_udtDayOverKinmu(p_lngStaffIdx).IconStatus = M_NOT_APPROVE_AFTER
                                            End If
                                        End If
                                    End If
                                End If
                            End If
                        End If

                        .m翌日超勤()
                    Next w_lngLoop
                End If
            End With

        Catch ex As Exception
            Call General.paTrpMsg(Convert.ToString(Err.Number), W_SUBNAME)
        End Try
    End Sub

    '勤務時間の取得
    Private Sub Get_KinmuTime(ByVal p_StaffIdx As Integer)
        Const W_SUBNAME As String = "frmNSC0000HA Get_KinmuTime"

        Try

            Dim w_StartTime_AM As Integer
            Dim w_StartTime_PM As Integer
            Dim w_EndTime_AM As Integer
            Dim w_EndTime_PM As Integer
            Dim w_strSaiyoCD As String
            Dim w_lngWorkLoop As Integer
            Dim w_lngStandardDate As Integer

            w_strSaiyoCD = ""
            '基準日
            w_lngStandardDate = General.paGetDateIntegerFromDate(m_DayOverSelectDate)

            For w_lngWorkLoop = 1 To UBound(m_udtStaffData(p_StaffIdx).SaiyoHistory)
                If m_udtStaffData(p_StaffIdx).SaiyoHistory(w_lngWorkLoop).lngStartDate <= w_lngStandardDate AndAlso m_udtStaffData(p_StaffIdx).SaiyoHistory(w_lngWorkLoop).lngEndDate >= w_lngStandardDate Then
                    w_strSaiyoCD = m_udtStaffData(p_StaffIdx).SaiyoHistory(w_lngWorkLoop).strCD
                    Exit For
                End If
            Next

            With General.g_objGetData
                .p病院CD = General.g_strHospitalCD
                .p看護単位CD = m_udtStaffData(p_StaffIdx).strKinmuDeptCD
                .p採用条件CD = w_strSaiyoCD
                .p勤務CD = m_udtDayKinmuJisseki(p_StaffIdx).strKinmuCD

                If .mGetKinmuTime = False Then
                    m_udtDayKinmuJisseki(p_StaffIdx).strKinmuFrom = ""
                    m_udtDayKinmuJisseki(p_StaffIdx).strKinmuTo = ""
                    m_udtDayKinmuJisseki(p_StaffIdx).strInputOKTimeChkFlg = ""
                    Exit Sub
                Else
                    .p勤務時間索引 = 1
                    '半日勤務の場合
                    If "2".Equals(m_udtDayKinmuJisseki(p_StaffIdx).strHalfKinmuFlg) Then
                        '半日勤務の場合は前半開始時間と後半開始時間を見て、入力されているほうの終了時間を取得(両方とも入力があった場合は全日と同じ扱いにする)
                        w_StartTime_AM = .f前半開始時刻
                        w_EndTime_AM = .f前半終了時刻
                        w_StartTime_PM = .f後半開始時刻
                        w_EndTime_PM = .f後半終了時刻

                        If w_StartTime_AM = 0 AndAlso w_EndTime_AM = 0 Then
                            '前半勤務時間が両方とも０の場合は後半勤務時間を設定(半日勤務で０時〜０時はありえない)
                            m_udtDayKinmuJisseki(p_StaffIdx).strKinmuFrom = Convert.ToString(w_StartTime_PM)
                            m_udtDayKinmuJisseki(p_StaffIdx).strKinmuTo = Convert.ToString(w_EndTime_PM)
                        ElseIf w_EndTime_PM = 0 AndAlso w_EndTime_PM = 0 Then
                            '後半勤務時間が両方とも０の場合は前半勤務時間を設定(半日勤務で０時〜０時はありえない)
                            m_udtDayKinmuJisseki(p_StaffIdx).strKinmuFrom = Convert.ToString(w_StartTime_AM)
                            m_udtDayKinmuJisseki(p_StaffIdx).strKinmuTo = Convert.ToString(w_EndTime_AM)
                        Else
                            '前半・後半勤務時間内、どちらかが０以外の場合は全日勤務と同じ扱いとする
                            m_udtDayKinmuJisseki(p_StaffIdx).strKinmuFrom = Convert.ToString(w_StartTime_AM)
                            m_udtDayKinmuJisseki(p_StaffIdx).strKinmuTo = Convert.ToString(w_EndTime_PM)
                        End If
                    Else
                        '前半開始時刻
                        m_udtDayKinmuJisseki(p_StaffIdx).strKinmuFrom = .f前半開始時刻
                        '後半終了時刻
                        m_udtDayKinmuJisseki(p_StaffIdx).strKinmuTo = .f後半終了時刻
                    End If
                    '超勤入力可否
                    m_udtDayKinmuJisseki(p_StaffIdx).strInputOKTimeChkFlg = .f超勤入力可否
                End If
            End With

        Catch ex As Exception
            Call General.paTrpMsg(Convert.ToString(Err.Number), W_SUBNAME)
        End Try
    End Sub

    '引数に、分と端数処理区分を受け取り
    '端数処理後の分を返す
    Private Function TimeRound(ByVal p_lngMinute As Integer, ByVal p_strKBN As String) As Integer
        Try
            Dim w_PreErrorProc As String
            w_PreErrorProc = General.g_ErrorProc 'ﾌﾟﾛｼｰｼﾞｬ名の一時待避
            General.g_ErrorProc = "NSC0000HA TimeRound"

            Dim w_lngHH As Integer
            Dim w_lngMM As Integer

            w_lngHH = p_lngMinute \ 60
            w_lngMM = p_lngMinute Mod 60

            Select Case p_strKBN
                '切上げ
                Case "2"
                    If w_lngMM > 0 Then
                        w_lngHH = w_lngHH + 1
                        w_lngMM = 0
                    End If
                    '切捨て
                Case "3"
                    If w_lngMM > 0 Then
                        w_lngMM = 0
                    End If
                    'そのまま
                Case Else

            End Select

            TimeRound = w_lngHH * 60 + w_lngMM

            General.g_ErrorProc = w_PreErrorProc '待避ﾌﾟﾛｼｰｼﾞｬ名を元に戻す

        Catch ex As Exception
            Throw
        End Try
    End Function

    Private Sub albTitleButton_Click(ByVal sender As System.Object, ByVal e As System.EventArgs)
        Const W_SUBNAME As String = "NSC0000HA albTitleButton_Click"
        Try
            sender.Checked = False

        Catch ex As Exception
            Call General.paTrpMsg(Convert.ToString(Err.Number), W_SUBNAME)
        End Try

    End Sub

    Private Sub albMenuButton_Click(ByVal sender As System.Object, ByVal e As System.EventArgs)
        Const W_SUBNAME As String = "NSC0000HA albMenuButton_Click"

        Try
            Dim w_lngGroupIdx As Integer 'グループインデックス
            Dim w_lngListIdx As Integer 'リストアイテムインデックス
            Dim w_str As String
            Dim w_strCmdLine As String
            Dim w_strExePath As String
            Dim w_lngLoop As Integer
            Dim w_lngLoop2 As Integer
            Dim w_clsObj As Object
            Dim w_blnFlg As Boolean

            Call sSaveFieldWidth()

            'メニュー配列と比較してインデックスを取得する
            For w_lngLoop = 1 To UBound(g_MenuM)
                For w_lngLoop2 = 1 To UBound(g_MenuM(w_lngLoop).ListBarMenu)
                    If (g_MenuM(w_lngLoop).ListBarMenu(w_lngLoop2).strTitle.Equals(Replace(sender.text, vbCrLf, ""))) Then
                        'グループインデックス
                        w_lngGroupIdx = w_lngLoop
                        'リストアイテムインデックス
                        w_lngListIdx = w_lngLoop2
                        '
                        w_str = g_MenuM(w_lngLoop).ListBarMenu(w_lngLoop2).strResCD

                        Exit For
                    End If
                Next w_lngLoop2
            Next w_lngLoop

            '現在表示中と同じ場合は処理終了
            If g_lngGroupIdx = 0 OrElse g_lngListIdx = 0 Then
                '選択業務もしくはリストメニューが取得できなかった場合

            ElseIf "1".Equals(g_MenuM(g_lngGroupIdx).ListBarMenu(g_lngListIdx).strObjKbn) OrElse "2".Equals(g_MenuM(g_lngGroupIdx).ListBarMenu(g_lngListIdx).strObjKbn) Then
                'EXEおよびDLLは毎回呼び出す

            ElseIf g_lngGroupIdx = w_lngGroupIdx AndAlso g_lngListIdx = w_lngListIdx Then
                '本人表示中で対象者と利用者管理番号が同じ場合は処理終了(勤務部署業務から内部的に本人業務を呼び出しているため)
                If (M_PERSONAL_RESCD).Equals(g_MenuM(g_lngGroupIdx).ListBarMenu(g_lngListIdx).strResCD) Then
                    If General.g_strUserMngID = g_strTargetStaffMngID Then
                        Exit Sub
                    End If
                Else
                    Exit Sub
                End If
            End If

            If "1".Equals(g_MenuM(w_lngGroupIdx).ListBarMenu(w_lngListIdx).strObjKbn) Then
                '--------------------
                '■EXE呼び出し処理
                '--------------------
                If GetProcesses() = True Then

                    m_blnFormCloseFlg = False

                    Select Case g_MenuM(w_lngGroupIdx).ListBarMenu(w_lngListIdx).strResCD
                        Case M_MASTER_RESCD
                            '====================
                            'マスタ設定
                            '====================
                            'ｺﾏﾝﾄﾞﾗｲﾝ
                            w_strCmdLine = General.g_strHospitalCD '施設コード
                            w_strCmdLine = w_strCmdLine & "," & General.g_strUserID '利用者ID
                            w_strCmdLine = w_strCmdLine & "," & G_PROJECTID '呼出元ID

                        Case M_KOUMOKUSET_RESCD
                            '====================
                            '項目設定
                            '====================
                            'ｺﾏﾝﾄﾞﾗｲﾝ
                            w_strCmdLine = General.g_strHospitalCD '施設コード
                            w_strCmdLine = w_strCmdLine & "," & General.g_strHospitalNm '施設名称
                            w_strCmdLine = w_strCmdLine & "," & G_PROJECTID '呼出元ID
                            w_strCmdLine = w_strCmdLine & "," & General.g_strUserID '利用者ID
                            w_strCmdLine = w_strCmdLine & "," & General.g_InstallType 'インストールタイプ

                        Case M_ERRORUSERDATECHECK_RESCD
                            '====================
                            '項目設定
                            '====================
                            'ｺﾏﾝﾄﾞﾗｲﾝ
                            w_strCmdLine = General.g_strHospitalCD '施設コード
                            w_strCmdLine = w_strCmdLine & "," & General.g_strUserID '利用者ID
                            w_strCmdLine = w_strCmdLine & "," & G_PROJECTID '呼出元ID
                    End Select

                    'Exe Pathの取得
                    w_strExePath = General.paGetIniSetting(General.G_STRININAME, General.G_STRSECTION1, "ExePath", "")
                    'Exe起動
                    Call Shell(w_strExePath & g_MenuM(w_lngGroupIdx).ListBarMenu(w_lngListIdx).strObjNm & " " & w_strCmdLine, AppWinStyle.NormalFocus)

                End If

                'アンロード
                Me.Close()

                Call sSetListBarMenu()

            ElseIf "2".Equals(g_MenuM(w_lngGroupIdx).ListBarMenu(w_lngListIdx).strObjKbn) Then
                '-----------
                '■DLL
                '-----------
                '各分岐にて画面インスタンス作成
                Select Case g_MenuM(w_lngGroupIdx).ListBarMenu(w_lngListIdx).strResCD

                    Case M_COMMONINFO_RESCD
                        '-------------------
                        '●共通情報設定画面
                        '-------------------
                        'プロパティ設定
                        w_clsObj = New NsAid_NSC0100H.clsNSC0100H
                        With w_clsObj
                            .pInstallType = General.g_InstallType 'インストールタイプ
                            .pHospitalCD = General.g_strHospitalCD '施設情報
                            .pUserInfo(General.g_strUserID) = General.g_strUserName '利用者情報
                            .pSelectDateObj = General.g_objSelectDate 'カレンダー部品
                            .pGetMasterObj = General.g_objGetMaster 'マスタ取得部品
                            .pSecurityObj = General.g_objSecurity 'セキュリティ部品
                        End With

                    Case M_SECURITY_RESCD
                        '-------------------
                        '●セキュリティ画面
                        '-------------------
                        'プロパティ設定
                        w_clsObj = New NsAid_NSC0020H.clsNSC0020H
                        With w_clsObj
                            .pInstallType = General.g_InstallType 'インストールタイプ
                            .pHospitalInfo = General.g_strHospitalCD '施設情報
                            .pUserInfo(General.g_strUserID) = General.g_strUserName '利用者情報
                            .pGetDataObj = General.g_objGetData '職員取得部品
                            .pSecurityObj = General.g_objSecurity 'セキュリティ部品
                            .pGetMasterObj = General.g_objGetMaster 'マスタ取得部品
                            .pSelectDeptObj = General.g_objSelectDept '部署ポップアップ部品
                            .pSelectStaffObj = General.g_objSelectStaff '職員ポップアップ部品
                            .pSelectDateObj = General.g_objSelectDate 'カレンダー部品
                            .pUserKinmuDeptCD = General.g_strUserKinmuDeptCD '利用者所属勤務部署コード
                            .pUserSecGroup = General.g_strUserGroupCD '利用者グループコード
                            .pUserStaffMngID = General.g_strUserMngID '利用者職員管理番号
                        End With

                    Case M_NEWSTAFF_RESCD
                        '-------------------
                        '●新規職員登録画面
                        '-------------------
                        'プロパティ設定
                        w_clsObj = New NsAid_NSC0020H.clsNSC0020H
                        With w_clsObj
                            .pInstallType = General.g_InstallType 'インストールタイプ
                            .pHospitalInfo(General.g_strHospitalCD) = General.g_strHospitalNm '施設情報
                            .pUserInfo(General.g_strUserID) = General.g_strUserName '利用者情報
                            .pSelectDateObj = General.g_objSelectDate 'カレンダー部品
                        End With

                    Case M_SUMMANTE_RESCD
                        '-----------------------
                        '●集計メンテナンス画面
                        '-----------------------
                        'プロパティ設定
                        w_clsObj = New NsAid_NSC0120H.clsNSC0120H
                        With w_clsObj
                            .pInstallType = General.g_InstallType 'インストールタイプ
                            .pHospitalInfo = General.g_strHospitalCD '施設情報
                            .pUserID = General.g_strUserID '利用者情報
                            .pGetMasterObj = General.g_objGetMaster 'マスタ部品
                            .pSelectDeptObj = General.g_objSelectDept 'マスタ系ポップアップ
                        End With

                    Case M_YAKANKANGO_RESCD
                        '-----------------------
                        '●夜間看護加算画面
                        '-----------------------
                        'プロパティ設定
                        w_clsObj = New NsAid_NSN0010H.clsNSN0010H
                        With w_clsObj
                            .pInstallType = General.g_InstallType 'インストールタイプ
                            .pHospitalInfo = General.g_strHospitalCD '施設情報
                            .pKangoTaniInfo(General.g_strSelKinmuDeptCD) = General.g_strSelKinmuDeptNm '選択勤務部署情報
                            .pUserInfo(General.g_strUserID) = General.g_strUserName '利用者情報
                            .pGetMasterObj = General.g_objGetMaster 'マスタ部品
                            .pGetDataObj = General.g_objGetData '職員取得部品
                            .pGetSelectDateObj = General.g_objSelectDate
                        End With

                    Case M_APPROCLASS_RESCD
                        '----------------------------------
                        '●承認階層画面(NSA0020Hを呼び出し)
                        '----------------------------------
                        'プロパティ設定
                        w_clsObj = New NsAid_NSA0020H.clsNSA0020H
                        With w_clsObj
                            .pInstallType = General.g_InstallType 'インストールタイプ
                            .pHospitalInfo = General.g_strHospitalCD '施設情報
                            .pUserInfo(General.g_strUserID) = General.g_strUserName '利用者情報
                            .pUserKinmuDeptCD = General.g_strUserKinmuDeptCD '利用者所属勤務部署コード
                            .pUserSecGroup = General.g_strUserGroupCD '利用者グループコード
                            .pUserStaffMngID = General.g_strUserMngID '利用者職員管理番号
                            .pDutyMngID = "" '申請者職員管理番号(承認階層設定呼出時は不要)
                            .pDispMode = "2" '表示モード(1:申請、2:選択、3:コピー元選択)
                            .pAppliCD = "" '届出コード(承認階層設定呼出時は不要)
                            .pGetDataObj = General.g_objGetData '職員取得部品
                            .pSecurityObj = General.g_objSecurity 'セキュリティ部品
                            .pGetMasterObj = General.g_objGetMaster 'マスタ取得部品
                            .pSelectDeptObj = General.g_objSelectDept '部署ポップアップ部品
                            .pSelectStaffObj = General.g_objSelectStaff '職員ポップアップ部品
                        End With

                    Case M_DUTYSTAFF_RESCD
                        '----------------------------------
                        '●日当直グループ登録画面
                        '----------------------------------
                        'プロパティ設定
                        w_clsObj = New NsAid_NSD0020H.clsNSD0020H
                        With w_clsObj
                            .pInstallType = General.g_InstallType 'インストールタイプ
                            .pHospitalInfo = General.g_strHospitalCD '施設情報
                            .pUserInfo(General.g_strUserID) = General.g_strUserName '利用者情報
                            .pUserGroupCD = General.g_strUserGroupCD '利用者グループコード
                            .pUserStaffMngID = General.g_strUserMngID '利用者職員管理番号
                            .pDutyGroupObj = General.g_objDutyGroup '職員取得部品
                            .pSelectDeptObj = General.g_objSelectDept '部署ポップアップ部品
                            .pSelectStaffObj = General.g_objSelectStaff '職員ポップアップ部品
                            .pSelectDateObj = General.g_objSelectDate 'カレンダー部品
                        End With

                    Case M_STUDY_RESCD
                        '----------------------------------
                        '●研修登録画面
                        '----------------------------------
                        w_clsObj = New NsAid_NSS0010H.clsNSS0010H
                        Call subKensyu(w_clsObj, False)

                    Case M_INFORMATION_RESCD
                        '----------------------------------
                        '●お知らせ設定画面
                        '----------------------------------
                        'プロパティ設定
                        w_blnFlg = False
                        If g_intUseNAVIFlg = 1 Then
                            'NAVI有りの場合
                            w_str = "1" & ":"
                            w_str = w_str & General.g_strHospitalCD & ":"
                            w_str = w_str & General.g_strUserID & ":"
                            w_str = w_str & ""

                            'ナースナビ起動スクリプトファイル呼び出し
                            Call Shell("cscript " & System.IO.Path.GetDirectoryName(System.Reflection.Assembly.GetExecutingAssembly().Location) _
                                & "\NurseNAVIInfo.wsf " & w_str)
                            w_blnFlg = True
                        Else
                            w_clsObj = New NsAid_NSC0130H.clsNSC0130H
                            With w_clsObj
                                .pDateInfo = General.paGetDateStringFromDate(m_CalDate, General.G_DATE_ENUM.yyyyMM)
                                .pHospitalInfo = General.g_strHospitalCD '施設情報
                                .pInstallType = General.g_InstallType 'インストールタイプ
                                .pSelectDateObj = General.g_objSelectDate 'カレンダー部品
                                .pUniqueSeq = ""

                                '更新権限がある場合
                                If "0".Equals(m_InformationUpdKbn) Then
                                    .pUpdMode = "1"
                                    'ない場合
                                Else
                                    .pUpdMode = "2"
                                End If

                                .pUserInfo = General.g_strUserID '利用者情報

                            End With
                        End If

                    Case M_LIMIT_RESCD
                        '----------------------------------
                        '●締め切り設定画面
                        '----------------------------------
                        'プロパティ設定
                        w_clsObj = New NsAid_NSW0050H.clsNSW0050H
                        With w_clsObj
                            .pInstallType = General.g_InstallType 'インストールタイプ
                            .pSecurityObj = General.g_objSecurity 'セキュリティ部品
                            .pSelectDateObj = General.g_objSelectDate 'カレンダー部品
                            .pHospitalInfo = General.g_strHospitalCD '施設情報
                            .pUserInfo = General.g_strUserID '利用者情報
                        End With

                    Case M_LADDER_RESCD
                        '----------------------------------
                        '●評価項目設定画面
                        '----------------------------------
                        'プロパティ設定
                        w_clsObj = New NsAid_NSE0010H.clsNSE0010H
                        With w_clsObj
                            .pSelectDateObj = General.g_objSelectDate
                            .pInstallType = General.g_InstallType
                            '施設情報
                            .pHospitalInfo(General.g_strHospitalCD) = General.g_strHospitalNm
                            'ユーザ情報
                            .pUserInfo(General.g_strUserID) = General.g_strUserName
                        End With

                    Case M_FDOUTPUT_RESCD
                        '----------------------------------
                        '●ＦＤ出力設定画面
                        '----------------------------------
                        w_clsObj = New NsAid_NSW0030H.clsNSW0030H
                        With w_clsObj
                            'ユーザ情報
                            .pUserInfo = General.g_strUserID
                            'インストールタイプ
                            .pInstallType = General.g_InstallType
                            '施設情報
                            .pHospitalInfo = General.g_strHospitalCD
                        End With

                    Case M_ACCESSLOG_RESCD
                        '----------------------------------
                        '●アクセスログ画面
                        '----------------------------------
                        w_clsObj = New NsAid_NSC0090H.clsNSC0090H
                        With w_clsObj
                            'ユーザ情報
                            .pUserInfo = General.g_strUserID
                            'インストールタイプ
                            .pInstallType = General.g_InstallType
                            '施設情報
                            .pHospitalInfo = General.g_strHospitalCD
                            .pSelectDateObj = General.g_objSelectDate 'カレンダー部品
                            .pGetDataObj = General.g_objGetData '職員取得部品
                        End With

                    Case M_SETCOLOR_RESCD
                        '----------------------------------
                        '●色設定画面
                        '----------------------------------
                        w_clsObj = New NsAid_NSC0150H.clsNSC0150H
                        With w_clsObj
                            'インストールタイプ
                            .pInstallType = General.g_InstallType
                            '施設情報
                            .pHospitalInfo = General.g_strHospitalCD
                        End With

                End Select

                If w_blnFlg = True Then
                    'お知らせの場合
                    w_blnFlg = False
                Else
                    w_clsObj.pProcessObj = Me
                    '画面表示
                    w_clsObj.mShowWindow()

                    'お知らせ設定の場合は、お知らせ情報を再表示
                    If (M_INFORMATION_RESCD).Equals(g_MenuM(w_lngGroupIdx).ListBarMenu(w_lngListIdx).strResCD) Then
                        If w_clsObj.pEndStatus = True Then
                            If g_intUseNAVIFlg = 1 Then
                            Else
                                Call sGetInformation()
                            End If
                            '===========================================
                        End If
                    ElseIf (M_SUMMANTE_RESCD).Equals(g_MenuM(w_lngGroupIdx).ListBarMenu(w_lngListIdx).strResCD) Then

                        m_blnGetMatrix = True

                        Call subGetMatrix()

                        '共通情報の場合は、カレンダーの再表示
                    ElseIf (M_COMMONINFO_RESCD).Equals(g_MenuM(w_lngGroupIdx).ListBarMenu(w_lngListIdx).strResCD) Then
                        Call AidGeneral.subShowDateForm2()
                        Call setCustomCalendar()
                        Call sSetCalendar()
                    End If
                End If

            ElseIf "3".Equals(g_MenuM(w_lngGroupIdx).ListBarMenu(w_lngListIdx).strObjKbn) Then

                '必要情報チェック
                If (M_PERSONAL_RESCD).Equals(g_MenuM(w_lngGroupIdx).ListBarMenu(w_lngListIdx).strResCD) Then
                    '-----------
                    '個人業務
                    '-----------
                    '選択職員管理番号がない場合は処理終了(部署リストビューに職員が存在しない場合など)
                    If String.IsNullOrEmpty(General.g_strUserMngID) Then
                        Exit Sub
                    End If

                ElseIf (M_DEPT_RESCD).Equals(g_MenuM(w_lngGroupIdx).ListBarMenu(w_lngListIdx).strResCD) Then
                    '-----------
                    '部署業務
                    '-----------

                End If

                Call subObjectVisibleFalse()

                '選択グループインデックス
                g_lngGroupIdx = w_lngGroupIdx
                '選択リストインデックス
                g_lngListIdx = w_lngListIdx

                '-----------
                '■フォーム
                '-----------
                Select Case g_MenuM(g_lngGroupIdx).ListBarMenu(g_lngListIdx).strResCD

                    Case M_PERSONAL_RESCD
                        '-----------
                        '個人業務
                        '-----------
                        '子画面メニューキー
                        m_strSelChildMenu = ""

                        m_strDispMenu = M_PERSONAL_RESCD

                        g_strTargetStaffMngID = General.g_strUserMngID
                        m_blnKinmuDeptDspFlg = False

                        m_ResCD_Kbn = 1
                        m_blnSelOverDay = False
                        Call sList_Personal()

                        Call sSetListBarMenu()

                    Case M_DEPT_RESCD
                        '-----------
                        '部署業務
                        '-----------
                        '子画面メニューキー
                        m_strSelChildMenu = ""
                        m_strDispMenu = M_DEPT_RESCD
                        m_blnSelOverDay = False
                        m_ResCD_Kbn = 2

                        'Call sList_DeptInfo()

                        If vstKinmuDept.SelectedIndex = 0 Then
                            Call sList_DeptInfo()
                        Else
                            vstKinmuDept.SelectedIndex = 0
                        End If

                        Call sSetListBarMenu()

                    Case M_APPROVE_RESCD
                        '-----------
                        '未承認一覧
                        '-----------
                        m_strSelChildMenu = ""

                        m_strDispMenu = M_APPROVE_RESCD
                        m_strAppliChange = M_DISP_MISYONIN
                        m_blnSelOverDay = False
                        m_strSelBusyoCD = General.g_strUserKinmuDeptCD
                        m_strSelBusyoNM = General.g_strUserKinmuDeptNm
                        If String.IsNullOrEmpty(m_strSelBusyoCD) Then
                            lblKinmuti.Text = "すべて"
                            m_strSelBusyoNM = "すべて"
                            m_strSelBusyoCD = "0000"
                        Else
                            lblKinmuti.Text = m_strSelBusyoNM
                        End If

                        m_strDispApplCD = "000000"
                        Call GetApplMaster()

                        Call sList_ApproveInfo()

                        cmdChgDate_0.Visible = False
                        cmdSelDate.Visible = False
                        cmdChgDate_1.Visible = False

                        Call sSetListBarMenu()

                    Case M_DAKOKU_RESCD
                        '-----------
                        '出退勤業務
                        '-----------
                        '子画面メニューキー
                        m_strSelChildMenu = ""
                        m_strDispMenu = M_DAKOKU_RESCD
                        m_blnSelOverDay = False
                        If vstKinmuDept.SelectedIndex = 0 Then
                            m_selectTimeMenuFlg = True
                            Call sList_DeptInfo()
                        Else
                            vstKinmuDept.SelectedIndex = 0
                        End If

                        Call sSetListBarMenu()

                    Case M_DUTY_RESCD
                        '-----------
                        '日当直
                        '-----------
                        '子画面メニューキー
                        m_strSelChildMenu = ""
                        m_blnSelOverDay = False
                        '日当直マスタ取得
                        m_strDispDutyGroupCD = "00"
                        Call GetDutyMaster()

                        Call sList_DutyInfo()

                        Call sSetListBarMenu()

                    Case M_ZAIIN_RESCD
                        '-----------
                        '在院照会
                        '-----------
                        m_strSelChildMenu = ""
                        m_strDispMenu = M_ZAIIN_RESCD
                        m_blnSelOverDay = False
                        If vstKinmuDept.SelectedIndex = 0 Then
                            m_selectTimeMenuFlg = True
                            Call sList_ZaiinInfo()
                        Else
                            vstKinmuDept.SelectedIndex = 0
                        End If

                        Call sSetListBarMenu()

                    Case M_STAFFIDO_RESCD
                        '-----------
                        '職員管理
                        '-----------
                        m_strSelChildMenu = ""
                        m_strDispMenu = M_STAFFIDO_RESCD
                        m_blnSelOverDay = False
                        m_strBusyoHaichi = M_DISP_BUSYO

                        vstKinmuDept.SelectedIndex = 0

                        m_LoopFlg = 3

                        Call sList_SyokuinKanriInfo(0)

                        m_LoopFlg = 0

                        Call sSetListBarMenu()

                    Case M_OVERKINMU_RESCD
                        '-----------
                        '時間外
                        '-----------
                        '子画面メニューキー
                        m_strSelChildMenu = ""
                        m_strDispMenu = M_OVERKINMU_RESCD
                        m_strOverKinmuDispType = M_STR_DAY

                        If vstKinmuDept.SelectedIndex = 0 Then
                            'Call sList_DeptInfo()
                            m_strSelBusyoCD = General.g_strSelKinmuDeptCD
                            m_strSelBusyoNM = General.g_strSelKinmuDeptNm
                            If String.IsNullOrEmpty(m_strSelBusyoCD) Then
                                m_strSelBusyoCD = General.g_strUserKinmuDeptCD
                                m_strSelBusyoNM = General.g_strUserKinmuDeptNm
                            End If
                            Call sList_DayOver()
                        Else
                            vstKinmuDept.SelectedIndex = 0
                        End If

                        Call sSetListBarMenu()

                End Select

                'フォームキャプション
                If General.paGetItemValue(General.G_STRMAINKEY1, "PACKAGETYPE", "INSTALLPACKAGE", "0", General.g_strHospitalCD).Equals("0") Then
                    'MedWorks
                    w_str = G_PACKAGENAME_MED
                ElseIf General.paGetItemValue(General.G_STRMAINKEY1, "PACKAGETYPE", "INSTALLPACKAGE", "0", General.g_strHospitalCD).Equals("1") Then
                    'NsAid
                    w_str = G_PACKAGENAME_NSAID
                End If
                Me.Text = w_str & Space(2) & "【" & g_MenuM(g_lngGroupIdx).strMenuNm & "】 - " & g_MenuM(g_lngGroupIdx).ListBarMenu(g_lngListIdx).strTitle

            End If

            'リストビューの幅を設定
            Call General.paSetFieldWidth(lvwDeptInfo, General.G_STRMAINKEY1 & "\" & G_PROJECTID, m_strSelChildMenu, False)
            Call General.paSetFieldWidth(lvwMain, General.G_STRMAINKEY1 & "\" & G_PROJECTID, m_strSelChildMenu, False)

        Catch ex As Exception
            Call General.paTrpMsg(Convert.ToString(Err.Number), W_SUBNAME)
        End Try
    End Sub

    Public Sub sbtMenuMain_Click(ByVal sender As Object, ByVal e As EventArgs)
        Const W_SUBNAME As String = "NSC0000HA sbtMenuMain_Click"

        Try
            stbMenuMain.Enabled = False

            Call subMenuMainSetData(sender.Name)

            stbMenuMain.Enabled = True

        Catch ex As Exception
            Call General.paTrpMsg(Convert.ToString(Err.Description), W_SUBNAME)
        End Try
    End Sub

    Private Sub subMenuMainSetData(ByVal p_Str As String)
        Const W_SUBNAME As String = "NSC0000HA subMenuMainSetData"

        Try
            Dim w_clsObj As Object
            Dim w_lngLoop As Integer
            Dim w_strButtonKbn As String
            Dim w_intSelIdx As Integer
            Dim w_DayIdx As Integer

            Dim w_strCmdLine As String
            Dim w_strExePath As String
            Dim w_intStaffIdx As Integer

            Const W_NENKYU As String = "1"
            Const W_OVERTIME As String = "2"

            Dim w_strMsg() As String
            Dim w_lngSelDate As Integer
            Dim w_strMsgCD As String

            Dim w_strSelStaffMngID As String

            Const W_INSERT As String = "1"
            Const W_DELETE As String = "2"

            'Dim w_MsgResult As VbMsgBoxResult
            Dim w_MsgResult As MsgBoxResult
            Dim w_blnOKFlg As Boolean

            Dim w_lngListLoop As Integer
            Dim w_lngListCnt As Integer
            Dim w_blnListFlg As Boolean

            Dim w_strDateDeptCD As String
            Dim w_strDateDeptName As String
            Dim w_blnDateDeptFlg As Boolean
            Dim w_hopeMode As String = String.Empty

            '初期化
            m_blnHopeFlg = False

            'リストビューサイズ保存
            Call sSaveFieldWidth()

            If (p_Str).Equals(m_strSelChildMenu) Then
                '表示中画面の場合は処理終了
                Exit Sub
            End If

            For w_lngLoop = 1 To UBound(m_udtChildMenu)
                If (m_udtChildMenu(w_lngLoop).strResCD).Equals(p_Str) Then
                    'オブジェクト区分
                    w_strButtonKbn = m_udtChildMenu(w_lngLoop).strObjKbn
                    Exit For
                End If
            Next w_lngLoop

            Select Case g_MenuM(g_lngGroupIdx).ListBarMenu(g_lngListIdx).strResCD
                Case M_PERSONAL_RESCD
                    '個人_/_/_/_/_/_/_/_/_/_/_/_/_/_/_/_/_/_/_/_/_/_/_/_/_/_/_/_/_/_/_/_/_/_/_/_/_/_/_/_/_/

                    Select Case w_strButtonKbn

                        Case G_OBJECTKBN_DLL
                            'DLL呼び出し

                            '実績変更画面(実績状況画面表示中のみ有効)
                            If (M_PER_JISSEKI_CHG).Equals(p_Str) Then
                                If M_PER_JISSEKI_DSP.Equals(m_strSelChildMenu) = False Then
                                    Exit Sub
                                End If
                            End If

                            '届出詳細画面(届出状況画面表示中のみ有効)
                            If (M_PER_APPLI_CHG).Equals(p_Str) Then
                                If M_PER_APPLI_DSP.Equals(m_strSelChildMenu) = False Then
                                    Exit Sub
                                End If
                                'リストに情報があるかどうか確認する
                                If lvwMain.Items.Count <= 0 Then
                                    Exit Sub
                                End If
                            End If

                            '届出入力画面(届出状況画面表示中のみ有効)
                            If (M_PER_APPLI_NEW).Equals(p_Str) Then
                                If M_PER_APPLI_DSP.Equals(m_strSelChildMenu) = False Then
                                    Exit Sub
                                End If
                            End If
                            Select Case p_Str

                                Case M_PER_JISSEKI_CHG
                                    '--------------
                                    '実績変更画面
                                    '--------------
                                    '勤務実績がない場合は処理終了
                                    If lvwMain.Items.Count = 0 Then
                                        Exit Sub
                                    End If
                                    If IsNothing(lvwMain.FocusedItem) Then
                                        w_DayIdx = 1
                                    Else
                                        w_DayIdx = lvwMain.FocusedItem.Index + 1
                                    End If

                                    If String.IsNullOrEmpty(m_udtKinmuData(w_DayIdx).strKinmuCD) Then
                                        Exit Sub
                                    End If

                                    If General.paCheckSelStaffAllAccount("NSW0020HA",
                                                              g_strTargetStaffMngID,
                                                              General.g_strSelKinmuDeptCD) = False Then

                                        ReDim w_strMsg(2)
                                        w_strMsg(1) = "職員"
                                        w_strMsg(2) = "操作"
                                        '選択した&1を&2する権限がありません。
                                        Call General.paMsgDsp("NS0093", w_strMsg)
                                        Exit Sub

                                    End If

                                    w_clsObj = New NsAid_NSW0020H.clsNSW0020H

                                    '個人or部署(個人:True、部署:False)
                                    If m_ResCD_Kbn = 1 Then
                                        w_clsObj.pPersonalChk = True
                                    Else
                                        w_clsObj.pPersonalChk = False
                                    End If

                                    '時間外入力可かどうか
                                    w_blnDateDeptFlg = funcChangeDeptCD(g_strTargetStaffMngID,
                                                                        m_udtKinmuData(w_DayIdx).lngDate,
                                                                        w_strDateDeptCD,
                                                                        w_strDateDeptName)

                                    w_clsObj.pHospitalInfo(General.g_strHospitalCD) = General.g_strHospitalNm                   '施設情報
                                    w_clsObj.pKangoTaniInfo(w_strDateDeptCD) = w_strDateDeptName                '選択勤務部署情報
                                    w_clsObj.pUserInfo(General.g_strUserID) = General.g_strUserName                             '利用者情報
                                    w_clsObj.pUserMngID = General.g_strUserMngID
                                    w_clsObj.pGetDataObj = General.g_objGetData                                         '職員取得部品
                                    w_clsObj.pGetMasterObj = General.g_objGetMaster                                     'マスタ取得部品
                                    w_clsObj.pSecurityObj = General.g_objSecurity                                       'セキュリティ部品
                                    w_clsObj.pSelectDateObj = General.g_objSelectDate                                   'カレンダー部品
                                    w_clsObj.pSyouninDataObj = General.g_objSyouninData                                 '承認部品
                                    w_clsObj.pComCyokinObj = General.g_objComCyokin
                                    w_clsObj.pSelectData(g_strTargetStaffMngID) = m_udtKinmuData(w_DayIdx).lngDate  '対象者職員管理番号/日付
                                    w_clsObj.pSelectButton = g_MenuM(g_lngGroupIdx).ListBarMenu(g_lngListIdx).strResCD  '2010/09/02 Y.N ADD


                                Case M_PER_APPLI_NEW
                                    '-------------
                                    '届出入力画面
                                    '-------------
                                    If General.paCheckSelStaffAccount(p_Str,
                                                              g_strTargetStaffMngID,
                                                              General.g_strUserKinmuDeptCD) = False Then

                                        ReDim w_strMsg(2)
                                        w_strMsg(1) = "職員"
                                        w_strMsg(2) = "操作"
                                        '選択した&1を&2する権限がありません。
                                        Call General.paMsgDsp("NS0093", w_strMsg)
                                        Exit Sub

                                    End If
                                    w_clsObj = New NsAid_NSA0020H.clsNSA0020H
                                    w_clsObj.pHospitalInfo = General.g_strHospitalCD                '施設情報
                                    w_clsObj.pUserInfo(General.g_strUserID) = General.g_strUserName         '利用者情報
                                    w_clsObj.pUserStaffMngID = General.g_strUserMngID               '利用者職員管理番号
                                    w_clsObj.pUserSecGroup = General.g_strUserGroupCD               '利用者グループコード
                                    w_clsObj.pUserKinmuDeptCD = General.g_strUserKinmuDeptCD        '利用者勤務部署コード
                                    w_clsObj.pDispMode = "1"                                '表示モード(1:申請、2:選択、3:コピー元選択)
                                    w_clsObj.pAppliCD = ""                                  '表示モードが３の場合のみ必須
                                    w_clsObj.pDutyMngID = g_strTargetStaffMngID             '申請者職員管理番号
                                    w_clsObj.pInstallType = General.g_InstallType                   'インストールタイプ
                                    w_clsObj.pGetDataObj = General.g_objGetData                 '職員取得部品
                                    w_clsObj.pSecurityObj = General.g_objSecurity               'セキュリティ部品
                                    w_clsObj.pGetMasterObj = General.g_objGetMaster             'マスタ取得部品
                                    w_clsObj.pSelectDeptObj = General.g_objSelectDept           '部署ポップアップ部品
                                    w_clsObj.pSelectStaffObj = General.g_objSelectStaff         '職員ポップアップ部品


                                Case M_PER_APPLI_CHG
                                    '-------------
                                    '届出詳細画面
                                    '-------------
                                    '届出選択情報
                                    w_intSelIdx = lvwMain.FocusedItem.Index + 1
                                    Select Case m_udtAppliData(w_intSelIdx).strScreenCtrlKbn

                                        Case W_NENKYU
                                            '-------------
                                            '年休
                                            '-------------
                                            If General.paCheckSelStaffAccount(p_Str,
                                                                      g_strTargetStaffMngID,
                                                                      General.g_strUserKinmuDeptCD) = False Then

                                                ReDim w_strMsg(2)
                                                w_strMsg(1) = "職員"
                                                w_strMsg(2) = "操作"
                                                '選択した&1を&2する権限がありません。
                                                Call General.paMsgDsp("NS0093", w_strMsg)
                                                Exit Sub

                                            End If
                                            w_clsObj = New NsAid_NSA0040H.clsNSA0040H
                                            w_clsObj.pInstallType = General.g_InstallType                               'インストールタイプ
                                            w_clsObj.pHospitalInfo = General.g_strHospitalCD                            '施設情報
                                            w_clsObj.pUserInfo(General.g_strUserID) = General.g_strUserName                     '利用者情報
                                            w_clsObj.pUserStaffMngID = General.g_strUserMngID                           '利用者職員管理番号
                                            w_clsObj.pUserSecGroup = General.g_strUserGroupCD                           '利用者グループコード
                                            w_clsObj.pUserKinmuDeptCD = General.g_strUserKinmuDeptCD                    '利用者勤務部署コード
                                            w_clsObj.pDispMode = "1"                                            '表示モード(1:申請、2:承認)
                                            w_clsObj.pSyoriKbn = "2"                                            '処理区分(1:新規、2:修正)
                                            w_clsObj.pAppliCD = m_udtAppliData(w_intSelIdx).strAppliCD          '届出コード

                                            If m_udtAppliData(w_intSelIdx).strAppliStaffMngID.Equals(g_strTargetStaffMngID) = False Then
                                                w_clsObj.pDutyMngID = m_udtAppliData(w_intSelIdx).strAppliStaffMngID    '申請者職員管理番号
                                            Else
                                                w_clsObj.pDutyMngID = g_strTargetStaffMngID                         '申請者職員管理番号
                                            End If

                                            w_clsObj.pDutyKinmuDeptCD = fncGetDeptCD(m_udtAppliData(w_intSelIdx).strAppliStaffMngID)   '勤務部署コード
                                            w_clsObj.pUniqueSeqNo = m_udtAppliData(w_intSelIdx).strUNIQUESEQNO  'UNIQUESEQNO
                                            w_clsObj.pGetDataObj = General.g_objGetData                             '職員取得部品
                                            w_clsObj.pSecurityObj = General.g_objSecurity                           'セキュリティ部品
                                            w_clsObj.pGetMasterObj = General.g_objGetMaster                         'マスタ取得部品
                                            w_clsObj.pSelectDeptObj = General.g_objSelectDept                       '部署ポップアップ部品
                                            w_clsObj.pSelectStaffObj = General.g_objSelectStaff                     '職員ポップアップ部品
                                            w_clsObj.pSyouninDataObj = General.g_objSyouninData                     '承認部品
                                            w_clsObj.pSelectDateObj = General.g_objSelectDate                       'カレンダー部品
                                    End Select

                                Case M_PER_STAFFINFO_DSP
                                    '-----------------
                                    '職員基本情報画面
                                    '-----------------
                                    If General.paCheckSelStaffAccount(p_Str,
                                                              g_strTargetStaffMngID,
                                                              General.g_strUserKinmuDeptCD) = False Then

                                        ReDim w_strMsg(2)
                                        w_strMsg(1) = "職員"
                                        w_strMsg(2) = "操作"
                                        '選択した&1を&2する権限がありません。
                                        Call General.paMsgDsp("NS0093", w_strMsg)
                                        Exit Sub

                                    End If

                                    w_clsObj = New NsAid_NSC0040H.clsNSC0040H
                                    w_clsObj.pHospitalCD = General.g_strHospitalCD                              '施設情報
                                    w_clsObj.pUserInfo(General.g_strUserID) = General.g_strUserName                     '利用者情報
                                    w_clsObj.pSelStaffMngID = g_strTargetStaffMngID                     '選択職員管理番号
                                    w_clsObj.pSelStaffNo = ""                                           '選択職員番号
                                    w_clsObj.pSelStaffKinmuDeptCD = ""                                  '選択職員勤務部署コード
                                    w_clsObj.pGetDataObj = General.g_objGetData                             '職員取得部品
                                    w_clsObj.pSecurityObj = General.g_objSecurity                           'セキュリティ部品
                                    w_clsObj.pSelectDateObj = General.g_objSelectDate                       'カレンダー部品

                                Case M_PER_STUDY
                                    '-----------------
                                    '研修申込画面
                                    '-----------------
                                    Call subKensyu(w_clsObj, True)

                            End Select
                            w_clsObj.pProcessObj = Me
                            '画面表示
                            w_clsObj.mShowWindow()

                            Select Case p_Str

                                Case M_PER_JISSEKI_CHG
                                    '個人業務
                                    If w_clsObj.pEndStatus = True Then
                                        Call sList_Personal()
                                    End If
                                Case M_PER_APPLI_NEW
                                    '届出新規
                                    If w_clsObj.pEndStatus = True Then
                                        Call sList_Personal()
                                    End If
                                Case M_PER_APPLI_CHG
                                    '届出詳細
                                    If w_clsObj.pEndStatus = True Then
                                        Call sList_Personal()
                                    End If
                            End Select

                        Case G_OBJECTKBN_EXE

                            'EXE呼び出し
                            If GetProcesses() = True Then

                                Select Case m_udtChildMenu(w_lngLoop).strResCD

                                    Case M_PER_MAKEKINMU_HOPE
                                        '================
                                        '計画画面
                                        '================

                                        m_blnHopeFlg = True

                                        Select Case m_udtChildMenu(w_lngLoop).strResCD
                                            Case M_PER_MAKEKINMU_HOPE
                                                m_strStartMode = General.G_PGMSTARTFLG_NEWPLAN
                                                w_hopeMode = M_MODE_HOPE
                                        End Select


                                        If General.paCheckSelStaffAccount(m_udtChildMenu(w_lngLoop).strResCD,
                                                                  "",
                                                                  General.g_strSelKinmuDeptCD) = False Then

                                            ReDim w_strMsg(2)
                                            w_strMsg(1) = "職員"
                                            w_strMsg(2) = "操作"
                                            '選択した&1を&2する権限がありません。
                                            Call General.paMsgDsp("NS0093", w_strMsg)
                                            Exit Sub

                                        End If

                                        '期間コンボボックス設定/表示
                                        If fncCheckMakeKinmu() = False Then
                                            Exit Sub
                                        End If

                                        'ｺﾏﾝﾄﾞﾗｲﾝ
                                        w_strCmdLine = General.g_strHospitalCD
                                        w_strCmdLine = w_strCmdLine & "," & General.g_strUserID
                                        w_strCmdLine = w_strCmdLine & "," & General.g_strUserName
                                        w_strCmdLine = w_strCmdLine & "," & General.g_strUserMngID
                                        w_strCmdLine = w_strCmdLine & "," & General.g_strUserGroupCD
                                        w_strCmdLine = w_strCmdLine & "," & General.g_strUserKinmuDeptCD
                                        w_strCmdLine = w_strCmdLine & "," & General.g_strSelKinmuDeptCD
                                        w_strCmdLine = w_strCmdLine & "," & m_lngPlanNo
                                        w_strCmdLine = w_strCmdLine & "," & m_strStartMode
                                        w_strCmdLine = w_strCmdLine & "," & G_PROJECTID
                                        w_strCmdLine = w_strCmdLine & "," & w_hopeMode
                                        'Exe Pathの取得
                                        w_strExePath = General.paGetIniSetting(General.G_STRININAME, General.G_STRSECTION1, "ExePath", "")

                                        '非表示にする
                                        Me.Hide()
                                        'Exe起動
                                        Call Shell(w_strExePath & m_udtChildMenu(w_lngLoop).strObjNm & " " & w_strCmdLine, vbNormalFocus)
                                End Select
                            End If

                            m_blnFormCloseFlg = False

                            'アンロード
                            Me.Close()

                        Case G_OBJECTKBN_FORM

                            Call subObjectVisibleFalse()

                            '選択ツールバーインデックス(DLL作成の場合は変更しない)
                            m_strSelChildMenu = p_Str

                            m_strDispApplCD = "000000"
                            Call GetApplMaster()

                            '個人業務
                            Call sList_Personal()

                        Case Else

                    End Select

                Case M_DEPT_RESCD
                    '部署_/_/_/_/_/_/_/_/_/_/_/_/_/_/_/_/_/_/_/_/_/_/_/_/_/_/_/_/_/_/_/_/_/_/_/_/_/_/_/_/_/

                    Select Case w_strButtonKbn

                        Case G_OBJECTKBN_DLL
                            'DLL呼び出し

                            If p_Str = M_DEPT_JISSEKI_CHG Then
                                '--------------
                                '実績詳細画面
                                '--------------
                                '勤務実績がない場合は処理終了
                                If lvwDeptInfo.Items.Count <= 0 Then
                                    Exit Sub
                                End If

                                '勤務状況表示中のみ
                                If M_DEPT_KINMUINFO.Equals(m_strSelChildMenu) = False Then
                                    Exit Sub
                                End If

                                If IsNothing(lvwDeptInfo.FocusedItem) Then
                                    w_intStaffIdx = lvwDeptInfo.Items(0).Tag
                                Else
                                    w_intStaffIdx = lvwDeptInfo.Items(lvwDeptInfo.FocusedItem.Index).Tag
                                End If

                                '利用者と選択職員のセキュリティ
                                If General.paCheckSelStaffAllAccount("NSW0020HA",
                                                          Trim$(m_udtStaffData(w_intStaffIdx).strStaffMngID),
                                                          General.g_strSelKinmuDeptCD) = False Then

                                    ReDim w_strMsg(2)
                                    w_strMsg(1) = "職員"
                                    w_strMsg(2) = "操作"
                                    '選択した&1を&2する権限がありません。
                                    Call General.paMsgDsp("NS0093", w_strMsg)
                                    Exit Sub

                                End If

                                w_blnDateDeptFlg = funcChangeDeptCD(m_udtStaffData(w_intStaffIdx).strStaffMngID,
                                                                    General.paGetDateStringFromDate(m_CalDate, General.G_DATE_ENUM.yyyyMMdd),
                                                                    w_strDateDeptCD,
                                                                    w_strDateDeptName)

                                w_clsObj = New NsAid_NSW0020H.clsNSW0020H

                                w_clsObj.pHospitalInfo(General.g_strHospitalCD) = General.g_strHospitalNm                       '施設情報
                                w_clsObj.pKangoTaniInfo(w_strDateDeptCD) = w_strDateDeptName                    '選択勤務部署情報
                                w_clsObj.pUserInfo(General.g_strUserID) = General.g_strUserName
                                w_clsObj.pUserMngID = General.g_strUserMngID
                                w_clsObj.pPersonalChk = False                                                    '個人or部署(個人:True、部署:False)  --- 2007/07/20 Muraoka Add
                                '利用者情報
                                w_clsObj.pGetDataObj = General.g_objGetData                                         '職員取得部品
                                w_clsObj.pGetMasterObj = General.g_objGetMaster                                     'マスタ取得部品
                                w_clsObj.pSecurityObj = General.g_objSecurity                                       'セキュリティ部品
                                w_clsObj.pSelectDateObj = General.g_objSelectDate                                   'カレンダー部品
                                w_clsObj.pSyouninDataObj = General.g_objSyouninData                                 '承認部品
                                w_clsObj.pSelectData(m_udtStaffData(w_intStaffIdx).strStaffMngID) = General.DateUtil.paGetDateIntegerFromDate(m_CalDate)    '対象者職員管理番号/日付
                                w_clsObj.pComCyokinObj = General.g_objComCyokin
                                w_clsObj.pSelectButton = g_MenuM(g_lngGroupIdx).ListBarMenu(g_lngListIdx).strResCD

                            ElseIf (M_DEPT_STAFFINFO).Equals(p_Str) Then
                                '--------------
                                '職員情報画面
                                '--------------
                                If General.paCheckSelStaffAccount(p_Str,
                                                          "",
                                                          General.g_strSelKinmuDeptCD) = False Then

                                    ReDim w_strMsg(2)
                                    w_strMsg(1) = "職員"
                                    w_strMsg(2) = "操作"
                                    '選択した&1を&2する権限がありません。
                                    Call General.paMsgDsp("NS0093", w_strMsg)
                                    Exit Sub

                                End If

                                '必須チェック
                                '勤務部署選択ﾁｪｯｸ
                                If String.IsNullOrEmpty(Trim(General.g_strSelKinmuDeptCD)) Then
                                    ReDim w_strMsg(1)
                                    w_strMsg(1) = "勤務部署"
                                    Call General.paMsgDsp("NS0002", w_strMsg)
                                    Exit Sub
                                End If

                                w_clsObj = New NsAid_NSC0140H.clsNSC0140H
                                w_clsObj.pHospitalInfo = General.g_strHospitalCD                        '施設情報
                                w_clsObj.pUserInfo = General.g_strUserID                                '利用者情報
                                w_clsObj.pKangoTaniInfo = General.g_strSelKinmuDeptCD                   '選択勤務部署コード
                                w_clsObj.pCallExe = "1"                                         '初期画面から呼び出し
                                w_clsObj.pDateInfo(General.paGetDateIntegerFromDate(m_CalDate)) = 0
                                w_clsObj.pGetDataObj = General.g_objGetData                         '職員取得部品
                                w_clsObj.pGetMasterObj = General.g_objGetMaster                     'マスタ取得部品

                            ElseIf (M_DEPT_DEPTINFO).Equals(p_Str) Then
                                '--------------
                                '勤務部署設定
                                '--------------
                                '必須チェック
                                '勤務部署選択ﾁｪｯｸ
                                If String.IsNullOrEmpty(Trim(General.g_strSelKinmuDeptCD)) Then
                                    ReDim w_strMsg(1)
                                    w_strMsg(1) = "勤務部署"
                                    Call General.paMsgDsp("NS0002", w_strMsg)
                                    Exit Sub
                                Else

                                    If General.paCheckSelStaffAccount(p_Str,
                                                              "",
                                                              General.g_strSelKinmuDeptCD) = False Then

                                        ReDim w_strMsg(2)
                                        w_strMsg(1) = "職員"
                                        w_strMsg(2) = "操作"
                                        '選択した&1を&2する権限がありません。
                                        Call General.paMsgDsp("NS0093", w_strMsg)
                                        Exit Sub

                                    End If

                                    w_clsObj = New NsAid_NSC0110H.clsNSC0110H

                                    w_clsObj.pHospitalInfo(General.g_strHospitalCD) = General.g_strHospitalNm             '施設情報
                                    w_clsObj.pUserInfo(General.g_strUserID) = General.g_strUserName                       '利用者情報
                                    w_clsObj.pKangoTaniInfo(General.g_strSelKinmuDeptCD) = General.g_strSelKinmuDeptNm    '選択勤務部署情報
                                    w_clsObj.pGetMasterObj = General.g_objGetMaster                           'マスタ取得部品
                                    w_clsObj.pGetDataObj = General.g_objGetData                               'マスタ取得部品
                                End If
                            ElseIf (M_DEPT_NENKYU).Equals(p_Str) Then
                                '--------------
                                '年休一覧画面
                                '--------------
                                If General.paCheckSelStaffAccount(p_Str,
                                                          "",
                                                          General.g_strSelKinmuDeptCD) = False Then

                                    ReDim w_strMsg(2)
                                    w_strMsg(1) = "職員"
                                    w_strMsg(2) = "操作"
                                    '選択した&1を&2する権限がありません。
                                    Call General.paMsgDsp("NS0093", w_strMsg)
                                    Exit Sub

                                End If

                                w_clsObj = New NsAid_NSH0010H.clsNSH0010H
                                w_clsObj.pHospitalInfo(General.g_strHospitalCD) = General.g_strHospitalNm             '施設情報
                                w_clsObj.pUserInfo(General.g_strUserID) = General.g_strUserName                       '利用者情報
                                w_clsObj.pKangoTaniInfo(General.g_strSelKinmuDeptCD) = General.g_strSelKinmuDeptNm    '選択勤務部署情報
                                w_clsObj.pUserKinmuDeptCD = General.g_strUserKinmuDeptCD                      '利用者所属勤務部署コード
                                w_clsObj.pUserSecGroup = General.g_strUserGroupCD                             '利用者グループコード
                                w_clsObj.pUserStaffMngID = General.g_strUserMngID                             '利用者職員管理番号
                                w_clsObj.pGetMasterObj = General.g_objGetMaster                           'マスタ取得部品
                                w_clsObj.pGetDataObj = General.g_objGetData                               'マスタ取得部品
                                w_clsObj.pSecurityObj = General.g_objSecurity                             'セキュリティ部品
                                w_clsObj.pSelectDeptObj = General.g_objSelectDept                         'セキュリティ部品
                                w_clsObj.pSelectDateObj = General.g_objSelectDate                         '日付設定ダイアログObject

                            ElseIf (M_DEPT_OVERKINMUINFO).Equals(p_Str) Then
                                '--------------
                                '超過勤務状況照会
                                '--------------
                                w_clsObj = New NsAid_NSW0060H.clsNSW0060H
                                w_clsObj.pHospitalCD = General.g_strHospitalCD                  '施設情報
                                w_clsObj.pUserID = General.g_strUserMngID                       '利用者職員管理番号
                                w_clsObj.pKangoTCD = General.g_strSelKinmuDeptCD                '勤務部署CD
                                w_clsObj.pKangoTNM = General.g_strSelKinmuDeptNm                '勤務部署名称
                                w_clsObj.pYear = General.paLeft(AidGeneral.SelectDate.ToString, 4)          '年
                                w_clsObj.pMonth = General.paRight(AidGeneral.SelectDate.ToString, 2)          '月
                                w_clsObj.pGetDataObj = General.g_objGetData

                            End If

                            'ﾌﾟﾛﾊﾟﾃｨ設定
                            w_clsObj.pInstallType = General.g_InstallType                               'インストールタイプ

                            w_clsObj.pProcessObj = Me
                            '画面表示
                            w_clsObj.mShowWindow()

                            Select Case p_Str

                                Case M_DEPT_JISSEKI_CHG
                                    '実績(再表示)
                                    If w_clsObj.pEndStatus = True Then
                                        Call sList_DeptInfo()
                                    End If
                                Case M_DEPT_STAFFINFO
                                    '再表示
                                    Call sList_DeptInfo()
                            End Select

                        Case G_OBJECTKBN_EXE
                            'EXE呼び出し
                            If GetProcesses() = True Then

                                Select Case m_udtChildMenu(w_lngLoop).strResCD

                                    Case M_DEPT_MAKEKINMU_NEW, M_DEPT_MAKEKINMU_CHG, M_DEPT_MAKEKINMU_RESULT
                                        '================
                                        '計画画面
                                        '================
                                        Select Case m_udtChildMenu(w_lngLoop).strResCD

                                            Case M_DEPT_MAKEKINMU_NEW
                                                m_strStartMode = General.G_PGMSTARTFLG_NEWPLAN
                                            Case M_DEPT_MAKEKINMU_CHG
                                                m_strStartMode = General.G_PGMSTARTFLG_CHANGEPLAN
                                            Case M_DEPT_MAKEKINMU_RESULT
                                                m_strStartMode = General.G_PGMSTARTFLG_CHANGEJISSEKI
                                        End Select

                                        If General.paCheckSelStaffAccount(m_udtChildMenu(w_lngLoop).strResCD,
                                                                  "",
                                                                  General.g_strSelKinmuDeptCD) = False Then

                                            ReDim w_strMsg(2)
                                            w_strMsg(1) = "職員"
                                            w_strMsg(2) = "操作"
                                            '選択した&1を&2する権限がありません。
                                            Call General.paMsgDsp("NS0093", w_strMsg)
                                            Exit Sub

                                        End If

                                        '期間コンボボックス設定/表示
                                        If fncCheckMakeKinmu() = False Then
                                            Exit Sub
                                        End If

                                        '新規作成の場合、期間中に超勤データがある場合は画面を表示させない
                                        If fncChkOverKinmuData(w_strMsgCD) = False Then
                                            If "NS0008".Equals(w_strMsgCD) Then
                                                ReDim w_strMsg(1)
                                                w_strMsg(0) = "職員"
                                            Else
                                                ReDim w_strMsg(0)
                                            End If

                                            If (M_DEPT_MAKEKINMU_NEW).Equals(m_udtChildMenu(w_lngLoop).strResCD) OrElse "NS0008".Equals(w_strMsgCD) Then
                                                Call General.paMsgDsp(w_strMsgCD, w_strMsg)
                                                Exit Sub
                                            End If

                                        End If

                                        'ｺﾏﾝﾄﾞﾗｲﾝ
                                        w_strCmdLine = General.g_strHospitalCD
                                        w_strCmdLine = w_strCmdLine & "," & General.g_strUserID
                                        w_strCmdLine = w_strCmdLine & "," & General.g_strUserName
                                        w_strCmdLine = w_strCmdLine & "," & General.g_strUserMngID
                                        w_strCmdLine = w_strCmdLine & "," & General.g_strUserGroupCD
                                        w_strCmdLine = w_strCmdLine & "," & General.g_strUserKinmuDeptCD
                                        w_strCmdLine = w_strCmdLine & "," & General.g_strSelKinmuDeptCD
                                        w_strCmdLine = w_strCmdLine & "," & m_lngPlanNo
                                        w_strCmdLine = w_strCmdLine & "," & m_strStartMode
                                        w_strCmdLine = w_strCmdLine & "," & G_PROJECTID
                                        'Exe Pathの取得
                                        w_strExePath = General.paGetIniSetting(General.G_STRININAME, General.G_STRSECTION1, "ExePath", "")

                                        '非表示にする
                                        Me.Hide()
                                        'Exe起動
                                        Call Shell(w_strExePath & m_udtChildMenu(w_lngLoop).strObjNm & " " & w_strCmdLine, vbNormalFocus)

                                    Case M_DEPT_MAKEKINMU_NIGHTCREATE
                                        'ｺﾏﾝﾄﾞﾗｲﾝ
                                        w_strCmdLine = General.g_strHospitalCD                              '施設コード
                                        w_strCmdLine = w_strCmdLine & "," & General.g_strUserID             '利用者コード
                                        w_strCmdLine = w_strCmdLine & "," & General.g_strUserMngID          '利用者職員管理番号
                                        w_strCmdLine = w_strCmdLine & "," & General.g_strUserGroupCD        '利用者セキュリティグループ
                                        w_strCmdLine = w_strCmdLine & "," & General.g_strUserKinmuDeptCD    '利用者の勤務部署コード
                                        w_strCmdLine = w_strCmdLine & "," & General.DateUtil.paGetDateStringFromDate(Now, General.G_DATE_ENUM.yyyyMMdd)  '処理日付
                                        w_strCmdLine = w_strCmdLine & "," & G_PROJECTID             '呼出元

                                        'Exe Pathの取得
                                        w_strExePath = General.paGetIniSetting(General.G_STRININAME, General.G_STRSECTION1, "ExePath", "")

                                        '非表示にする
                                        Me.Hide()
                                        'Exe起動
                                        Call Shell(w_strExePath & m_udtChildMenu(w_lngLoop).strObjNm & " " & w_strCmdLine, vbNormalFocus)

                                End Select
                            End If

                            m_blnFormCloseFlg = False

                            'アンロード
                            Me.Close()

                        Case G_OBJECTKBN_FORM

                            '必須チェック
                            '勤務部署選択ﾁｪｯｸ
                            If String.IsNullOrEmpty(Trim(General.g_strSelKinmuDeptCD)) Then
                                ReDim w_strMsg(1)
                                w_strMsg(1) = "勤務部署"
                                Call General.paMsgDsp("NS0002", w_strMsg)
                                Exit Sub
                            End If

                            If lvwDeptInfo.Items.Count = 0 Then
                                Exit Sub
                            End If

                            Call subObjectVisibleFalse()

                            'フォーム（自画面）
                            m_strSelChildMenu = p_Str
                            '======================
                            '勤務状況 or 時間外状況
                            '======================

                            If IsNothing(lvwDeptInfo.FocusedItem) Then
                                w_intStaffIdx = lvwDeptInfo.Items(0).Tag
                            Else
                                w_intStaffIdx = lvwDeptInfo.Items(lvwDeptInfo.FocusedItem.Index).Tag
                            End If

                            If General.paCheckSelStaffAccount(m_strSelChildMenu,
                                                      Trim$(m_udtStaffData(w_intStaffIdx).strStaffMngID),
                                                      General.g_strSelKinmuDeptCD) = False Then

                                ReDim w_strMsg(2)
                                w_strMsg(1) = "職員"
                                w_strMsg(2) = "操作"
                                '選択した&1を&2する権限がありません。
                                Call General.paMsgDsp("NS0093", w_strMsg)
                                Exit Sub

                            End If

                            Call sList_DeptInfo()

                        Case Else

                    End Select


                Case M_APPROVE_RESCD
                    '未承認_/_/_/_/_/_/_/_/_/_/_/_/_/_/_/_/_/_/_/_/_/_/_/_/_/_/_/_/_/_/_/_/_/_/_/_/_/_/_/_/

                    If (M_APPRO_DAYOVER_IN).Equals(p_Str) Then

                        '勤務実績がない場合は処理終了
                        If lvwDeptInfo.Items.Count <= 0 Then
                            Exit Sub
                        End If

                        If IsNothing(lvwDeptInfo.FocusedItem) Then
                            w_intStaffIdx = lvwDeptInfo.Items(0).Tag
                        Else
                            w_intStaffIdx = lvwDeptInfo.Items(lvwDeptInfo.FocusedItem.Index).Tag
                        End If

                        Call CallOverKinmuDisp(w_intStaffIdx)

                    Else

                        Select Case w_strButtonKbn

                            Case G_OBJECTKBN_DLL
                                'DLL呼び出し

                                If (M_APPRO_DAYOVER_CHG).Equals(p_Str) Then
                                    '---------------
                                    '日別時間外入力詳細
                                    '---------------
                                    '勤務実績がない場合は処理終了
                                    If lvwDeptInfo.Items.Count <= 0 Then
                                        Exit Sub
                                    End If

                                    If IsNothing(lvwDeptInfo.FocusedItem) Then
                                        w_intStaffIdx = lvwDeptInfo.Items(0).Tag
                                    Else
                                        w_intStaffIdx = lvwDeptInfo.Items(lvwDeptInfo.FocusedItem.Index).Tag
                                    End If

                                    Call CallOverKinmuDisp(w_intStaffIdx)

                                    Exit Sub
                                End If

                                '対象データがない場合は処理終了
                                If UBound(m_udtApproveData) <= 0 Then
                                    Exit Sub
                                End If

                                If p_Str = M_APPRO_APPLI_CHG Then
                                    '---------------
                                    '届出詳細画面
                                    '---------------
                                    If IsNothing(lvwDeptInfo.FocusedItem) Then
                                        w_intSelIdx = lvwDeptInfo.Items(0).Tag
                                    Else
                                        w_intSelIdx = lvwDeptInfo.Items(lvwDeptInfo.FocusedItem.Index).Tag
                                    End If

                                    Select Case m_udtApproveData(w_intSelIdx).strScreenCtrlKbn

                                        Case W_NENKYU
                                            '-------------
                                            '年休
                                            '-------------
                                            w_clsObj = New NsAid_NSA0040H.clsNSA0040H
                                            w_clsObj.pInstallType = General.g_InstallType                                           'インストールタイプ
                                            w_clsObj.pHospitalInfo = General.g_strHospitalCD                                        '施設情報
                                            w_clsObj.pUserInfo(General.g_strUserID) = General.g_strUserName                                 '利用者情報
                                            w_clsObj.pUserStaffMngID = General.g_strUserMngID                                       '利用者職員管理番号
                                            w_clsObj.pUserSecGroup = General.g_strUserGroupCD                                       '利用者グループコード
                                            w_clsObj.pUserKinmuDeptCD = General.g_strUserKinmuDeptCD                                '利用者勤務部署コード
                                            w_clsObj.pDispMode = "2"                                                        '表示モード(1:申請、2:承認)
                                            w_clsObj.pSyoriKbn = "2"                                                        '処理区分(1:新規、2:修正)
                                            w_clsObj.pAppliCD = m_udtApproveData(w_intSelIdx).strAppliCD                    '届出コード
                                            w_clsObj.pDutyMngID = m_udtApproveData(w_intSelIdx).strAppliStaffMngID          '申請者職員管理番号
                                            w_clsObj.pDutyKinmuDeptCD = fncGetDeptCD(m_udtApproveData(w_intSelIdx).strAppliStaffMngID)   '勤務部署コード
                                            w_clsObj.pUniqueSeqNo = m_udtApproveData(w_intSelIdx).strUNIQUESEQNO            'UNIQUESEQNO
                                            w_clsObj.pApproveMngID = General.g_strUserMngID                                         '承認者職員管理番号
                                            w_clsObj.pApproveClassLevel = m_udtApproveData(w_intSelIdx).lngApproveClassLvl  '承認階層レベルコード
                                            w_clsObj.pGetDataObj = General.g_objGetData                                         '職員取得部品
                                            w_clsObj.pSecurityObj = General.g_objSecurity                                       'セキュリティ部品
                                            w_clsObj.pGetMasterObj = General.g_objGetMaster                                     'マスタ取得部品
                                            w_clsObj.pSelectDeptObj = General.g_objSelectDept                                   '部署ポップアップ部品
                                            w_clsObj.pSelectStaffObj = General.g_objSelectStaff                                 '職員ポップアップ部品
                                            w_clsObj.pSyouninDataObj = General.g_objSyouninData                                 '承認部品
                                            w_clsObj.pSelectDateObj = General.g_objSelectDate                                   'カレンダー部品

                                        Case W_OVERTIME
                                            '-------------
                                            '時間外
                                            '-------------
                                            General.g_objGetData.pUniqueSeqNo = ""            'UNIQUESEQNO

                                            w_clsObj = New NsAid_NSW0020H.clsNSW0020H
                                            w_clsObj.pInstallType = General.g_InstallType                                           'インストールタイプ
                                            w_clsObj.pHospitalInfo(General.g_strHospitalCD) = General.g_strHospitalNm                       '施設情報
                                            w_clsObj.pKangoTaniInfo(General.g_strSelKinmuDeptCD) = General.g_strSelKinmuDeptNm              '選択勤務部署情報
                                            w_clsObj.pUserInfo(General.g_strUserID) = General.g_strUserName                                 '利用者情報
                                            w_clsObj.pUserMngID = General.g_strUserMngID
                                            w_clsObj.pPersonalChk = False
                                            w_clsObj.pGetDataObj = General.g_objGetData                                         '職員取得部品
                                            w_clsObj.pGetMasterObj = General.g_objGetMaster                                     'マスタ取得部品
                                            w_clsObj.pSecurityObj = General.g_objSecurity                                       'セキュリティ部品
                                            w_clsObj.pSelectDateObj = General.g_objSelectDate                                   'カレンダー部品
                                            w_clsObj.pSyouninDataObj = General.g_objSyouninData                                 '承認部品
                                            w_clsObj.pComCyokinObj = General.g_objComCyokin
                                            w_clsObj.pSelectData(m_udtApproveData(w_intSelIdx).strAppliStaffMngID) = m_udtApproveData(w_intSelIdx).lngPeriodFromDate    '対象者職員管理番号/日付

                                            '*** 未承認届出詳細画面 ***
                                            w_clsObj.pSelectButton = g_MenuM(g_lngGroupIdx).ListBarMenu(g_lngListIdx).strResCD

                                    End Select

                                ElseIf p_Str = M_APPRO_APPLI_NEW Then
                                    '---------------
                                    '届出入力画面
                                    '---------------
                                    If IsNothing(lvwDeptInfo.FocusedItem) Then
                                        w_intSelIdx = lvwDeptInfo.Items(0).Tag
                                    Else
                                        w_intSelIdx = lvwDeptInfo.Items(lvwDeptInfo.FocusedItem.Index).Tag
                                    End If

                                    If General.paCheckSelStaffAccount(p_Str,
                                                              Trim$(m_udtApproveData(w_intSelIdx).strAppliStaffMngID),
                                                              Trim$(m_udtApproveData(w_intSelIdx).strKinmuDeptCD)) = False Then

                                        ReDim w_strMsg(2)
                                        w_strMsg(1) = "職員"
                                        w_strMsg(2) = "操作"
                                        '選択した&1を&2する権限がありません。
                                        Call General.paMsgDsp("NS0093", w_strMsg)
                                        Exit Sub

                                    End If
                                    w_clsObj = New NsAid_NSA0020H.clsNSA0020H

                                    w_clsObj.pHospitalInfo = General.g_strHospitalCD                                '施設情報
                                    w_clsObj.pUserInfo(General.g_strUserID) = General.g_strUserName                         '利用者情報
                                    w_clsObj.pUserStaffMngID = General.g_strUserMngID                               '利用者職員管理番号
                                    w_clsObj.pUserSecGroup = General.g_strUserGroupCD                               '利用者グループコード
                                    w_clsObj.pUserKinmuDeptCD = General.g_strUserKinmuDeptCD                        '利用者勤務部署コード
                                    w_clsObj.pDispMode = "1"                                                '表示モード(1:申請、2:選択、3:コピー元選択)
                                    w_clsObj.pAppliCD = ""                                                  '表示モードが３の場合のみ必須
                                    w_clsObj.pDutyMngID = m_udtApproveData(w_intSelIdx).strAppliStaffMngID  '申請者職員管理番号
                                    w_clsObj.pInstallType = General.g_InstallType                                   'インストールタイプ
                                    w_clsObj.pGetDataObj = General.g_objGetData                                 '職員取得部品
                                    w_clsObj.pSecurityObj = General.g_objSecurity                               'セキュリティ部品
                                    w_clsObj.pGetMasterObj = General.g_objGetMaster                             'マスタ取得部品
                                    w_clsObj.pSelectDeptObj = General.g_objSelectDept                           '部署ポップアップ部品
                                    w_clsObj.pSelectStaffObj = General.g_objSelectStaff                         '職員ポップアップ部品
                                End If
                                w_clsObj.pProcessObj = Me
                                '画面表示
                                w_clsObj.mShowWindow()


                                Select Case p_Str

                                    Case M_APPRO_APPLI_NEW
                                        '届出新規
                                        If w_clsObj.pEndStatus = True Then
                                            Call sList_ApproveInfo()
                                        End If
                                    Case M_APPRO_APPLI_CHG
                                        '届出詳細(年休の場合)
                                        If m_udtApproveData(w_intSelIdx).strScreenCtrlKbn = W_NENKYU Then
                                            If w_clsObj.pEndStatus = True Then
                                                Call sList_ApproveInfo()
                                            End If
                                        ElseIf m_udtApproveData(w_intSelIdx).strScreenCtrlKbn = W_OVERTIME Then
                                            '実績詳細の場合
                                            If w_clsObj.pEndStatus = True Then
                                                Call sList_ApproveInfo()
                                            End If
                                        End If
                                End Select

                            Case G_OBJECTKBN_EXE
                                'EXE呼び出し
                                m_blnFormCloseFlg = False

                            Case G_OBJECTKBN_FORM

                                Call subObjectVisibleFalse()

                                '画面切り替え
                                If (M_APPRO_DSP).Equals(p_Str) OrElse (M_APPRO_ALLDSP).Equals(p_Str) Then

                                    m_strAppliChange = M_DISP_MISYONIN

                                    '------------------------
                                    '未承認一覧/全件表示画面
                                    '------------------------
                                    '選択ツールバーインデックス
                                    m_strSelChildMenu = p_Str
                                    Call sList_ApproveInfo()

                                ElseIf (M_APPRO_DAYOVER).Equals(p_Str) Then

                                    m_strAppliChange = M_DISP_DAYOVER

                                    m_strSelChildMenu = p_Str
                                    Call sList_DayOver()

                                End If

                            Case G_OBJECTKBN_OTHER
                                'その他
                                If (M_APPRO_ALLAPPRO).Equals(p_Str) Then
                                    '=================
                                    '一括承認
                                    '=================
                                    '未承認一覧表示中のみ

                                    If (M_APPRO_DSP).Equals(m_strSelChildMenu) Then
                                        Call sUpdApprove()
                                    ElseIf (M_APPRO_DAYOVER).Equals(m_strSelChildMenu) Then
                                        '日別超過勤務入力更新
                                        'ﾃﾞｰﾀ保存の確認
                                        '自身が確定できる職員がいる場合
                                        If UBound(m_udtApproveData) <> 0 Then
                                            If RunEnd() = False Then
                                                Exit Sub
                                            End If
                                            '再取得
                                            Call sList_DayOver()
                                        End If
                                    End If

                                End If
                            Case Else

                        End Select
                    End If
                Case M_DAKOKU_RESCD
                    '出退勤_/_/_/_/_/_/_/_/_/_/_/_/_/_/_/_/_/_/_/_/_/_/_/_/_/_/_/_/_/_/_/_/_/_/_/_/_/_/_/_/

                    Select Case w_strButtonKbn

                        Case G_OBJECTKBN_DLL
                            'DLL呼び出し

                            If (M_DAKOKU_JISSEKI_DSP).Equals(p_Str) Then
                                '--------------
                                '実績詳細画面
                                '--------------
                                '勤務実績がない場合は処理終了
                                If lvwDeptInfo.Items.Count <= 0 Then
                                    Exit Sub
                                End If

                                w_clsObj = New NsAid_NSW0020H.clsNSW0020H

                                w_clsObj.pInstallType = General.g_InstallType

                                If IsNothing(lvwDeptInfo.FocusedItem) Then
                                    w_intStaffIdx = lvwDeptInfo.Items(0).Tag
                                Else
                                    w_intStaffIdx = lvwDeptInfo.Items(lvwDeptInfo.FocusedItem.Index).Tag
                                End If

                                If String.IsNullOrEmpty(m_udtDayKinmuJisseki(w_intStaffIdx).strKinmuCD) Then
                                    Exit Sub
                                End If

                                If General.paCheckSelStaffAccount(p_Str,
                                                          Trim$(m_udtStaffData(w_intStaffIdx).strStaffMngID),
                                                          General.g_strSelKinmuDeptCD) = False Then

                                    ReDim w_strMsg(2)
                                    w_strMsg(1) = "職員"
                                    w_strMsg(2) = "操作"
                                    '選択した&1を&2する権限がありません。
                                    Call General.paMsgDsp("NS0093", w_strMsg)
                                    Exit Sub

                                End If

                                w_clsObj.pHospitalInfo(General.g_strHospitalCD) = General.g_strHospitalNm                       '施設情報
                                w_clsObj.pKangoTaniInfo(General.g_strSelKinmuDeptCD) = General.g_strSelKinmuDeptNm              '選択勤務部署情報
                                w_clsObj.pUserInfo(General.g_strUserID) = General.g_strUserName                                 '利用者情報
                                w_clsObj.pUserMngID = General.g_strUserMngID
                                w_clsObj.pPersonalChk = False
                                w_clsObj.pGetDataObj = General.g_objGetData                                         '職員取得部品
                                w_clsObj.pGetMasterObj = General.g_objGetMaster                                     'マスタ取得部品
                                w_clsObj.pSecurityObj = General.g_objSecurity                                       'セキュリティ部品
                                w_clsObj.pSelectDateObj = General.g_objSelectDate                                   'カレンダー部品
                                w_clsObj.pSyouninDataObj = General.g_objSyouninData                                 '承認部品
                                w_clsObj.pSelectData(m_udtStaffData(w_intStaffIdx).strStaffMngID) = General.DateUtil.paGetDateIntegerFromDate(m_CalDate)    '対象者職員管理番号/日付
                                w_clsObj.pComCyokinObj = General.g_objComCyokin

                                '*** 出退勤実績詳細画面 ***
                                w_clsObj.pSelectButton = g_MenuM(g_lngGroupIdx).ListBarMenu(g_lngListIdx).strResCD
                                '**********************************

                            End If
                            w_clsObj.pProcessObj = Me
                            '画面表示
                            w_clsObj.mShowWindow()

                            Select Case p_Str

                                Case M_DAKOKU_JISSEKI_DSP
                                    If w_clsObj.pEndStatus = True Then
                                        Call sList_DakokuInfo()
                                    End If
                            End Select


                        Case G_OBJECTKBN_EXE
                            'EXE呼び出し

                            m_blnFormCloseFlg = False

                        Case G_OBJECTKBN_FORM

                            Call subObjectVisibleFalse()

                            'フォーム(自画面)
                            '選択ツールバーインデックス

                            If (M_DAKOKU_DSP).Equals(p_Str) OrElse (M_DAKOKU_ERROR_DSP).Equals(p_Str) Then
                                '==========================
                                '打刻状況 or エラー表示
                                '==========================
                                m_strSelChildMenu = p_Str
                                If General.paCheckSelStaffAccount(m_strSelChildMenu,
                                                          "",
                                                          General.g_strSelKinmuDeptCD) = False Then

                                    ReDim w_strMsg(2)
                                    w_strMsg(1) = "職員"
                                    w_strMsg(2) = "操作"
                                    '選択した&1を&2する権限がありません。
                                    Call General.paMsgDsp("NS0093", w_strMsg)
                                    Exit Sub

                                End If

                                Call sList_DakokuInfo()
                            End If

                        Case Else

                    End Select

                Case M_DUTY_RESCD
                    '日当直_/_/_/_/_/_/_/_/_/_/_/_/_/_/_/_/_/_/_/_/_/_/_/_/_/_/_/_/_/_/_/_/_/_/_/_/_/_/_/_/

                    Select Case w_strButtonKbn

                        Case G_OBJECTKBN_DLL
                            'DLL呼び出し

                            'ｸﾗｽｵﾌﾞｼﾞｪｸﾄを生成
                            w_clsObj = New NsAid_NSD0010H.clsNSD0010H
                            'ﾌﾟﾛﾊﾟﾃｨ設定
                            w_clsObj.pInstallType = General.g_InstallType                               'インストールタイプ

                            If (M_DUTY_MAKEDUTY).Equals(p_Str) Then
                                '--------------
                                '日当直割当画面
                                '--------------
                                If General.paCheckSelStaffAccount(p_Str,
                                                          "",
                                                          General.g_strSelKinmuDeptCD) = False Then

                                    ReDim w_strMsg(2)
                                    w_strMsg(1) = "職員"
                                    w_strMsg(2) = "操作"
                                    '選択した&1を&2する権限がありません。
                                    Call General.paMsgDsp("NS0093", w_strMsg)
                                    Exit Sub

                                End If

                                w_clsObj.pHospitalInfo = General.g_strHospitalCD            '施設情報
                                w_clsObj.pUserInfo(General.g_strUserID) = General.g_strUserName     '利用者情報
                                w_clsObj.pUserStaffMngID = General.g_strUserMngID           '利用者職員管理番号
                                w_clsObj.pUserGroupCD = General.g_strUserGroupCD            '利用者グループコード
                                w_clsObj.pGetDataObj = General.g_objGetData             '職員取得部品
                                w_clsObj.pGetMasterObj = General.g_objGetMaster         'マスタ取得部品
                                w_clsObj.pDutyGroupObj = General.g_objDutyGroup         '日当直者取得部品
                                w_clsObj.pSecurityObj = General.g_objSecurity           'セキュリティ部品
                                w_clsObj.pSyouninDataObj = General.g_objSyouninData
                            End If
                            w_clsObj.pProcessObj = Me
                            '画面表示
                            w_clsObj.mShowWindow()

                            Call sList_DutyInfo()

                        Case G_OBJECTKBN_EXE
                            'EXE呼び出し

                            m_blnFormCloseFlg = False

                        Case G_OBJECTKBN_FORM

                            Call subObjectVisibleFalse()

                        Case Else

                    End Select

                Case M_STAFFIDO_RESCD
                    '職員管理_/_/_/_/_/_/_/_/_/_/_/_/_/_/_/_/_/_/_/_/_/_/_/_/_/_/_/_/_/_/_/_/_/_/_/_/_/_/_/_/

                    Select Case w_strButtonKbn

                        Case G_OBJECTKBN_DLL
                            'DLL呼び出し

                            If (M_STAFFIDO_KIHON).Equals(p_Str) Then
                                '--------------
                                '職員基本情報画面
                                '--------------
                                Call subKihon_Click()
                            ElseIf (M_STAFFIDO_SINKI).Equals(p_Str) Then
                                '--------------
                                '新規登録画面
                                '--------------
                                Call subNewStaff_Click()
                            ElseIf (M_STAFFIDO_IKKATSU).Equals(p_Str) Then
                                '--------------
                                '一括取込画面
                                '--------------
                                Call subImport_Click()
                            ElseIf (M_STAFFIDO_SEARCH).Equals(p_Str) Then
                                '--------------
                                '職員検索画面
                                '--------------
                                Call subSearch_Click()
                            ElseIf (M_STAFFIDO_FILE).Equals(p_Str) Then
                                '--------------
                                'ＦＤ出力画面
                                '--------------
                                Call subFileOutPut_Click()
                            ElseIf (M_STAFFIDO_STUDY).Equals(p_Str) Then
                                '--------------
                                '研修申込画面
                                '--------------
                                Call subKensyu(w_clsObj, True)
                                w_clsObj.pProcessObj = Me
                                w_clsObj.mShowWindow()

                            ElseIf (M_STAFFIDO_IINKAI).Equals(p_Str) Then
                                '--------------
                                '委員会登録画面
                                '--------------
                                m_strIkkatsuButton = "13"    '委員会一括 (リソースコードを判定に使用します)Set .SetDateObject = General.g_objSelectDate    '日付表示Object
                                Call ShowIkkatsu(m_strIkkatsuButton)

                            ElseIf (M_STAFFIDO_MENKYO).Equals(p_Str) Then
                                '--------------
                                '免許登録画面
                                '--------------
                                m_strIkkatsuButton = "14"    '免許一括　(リソースコードを判定に使用します)
                                Call ShowIkkatsu(m_strIkkatsuButton)

                            ElseIf (M_STAFFIDO_SENMON).Equals(p_Str) Then
                                '--------------
                                '専門学歴登録画面
                                '--------------
                                m_strIkkatsuButton = "15"    '免許一括　(リソースコードを判定に使用します)
                                Call ShowIkkatsu(m_strIkkatsuButton)

                            ElseIf (M_STAFFIDO_IINKAINITTEI).Equals(p_Str) Then
                                '--------------
                                '委員会日程画面
                                '--------------
                                Call subIinkaiNittei_Click()

                            End If

                        Case G_OBJECTKBN_EXE
                            'EXE呼び出し

                            m_blnFormCloseFlg = False

                        Case G_OBJECTKBN_FORM


                            If (M_STAFFIDO_BUSYO).Equals(p_Str) Then

                                m_strBusyoHaichi = M_DISP_BUSYO

                                '-----------
                                '職員管理
                                '-----------
                                m_strSelChildMenu = ""
                                m_strDispMenu = M_STAFFIDO_RESCD
                                m_LoopFlg = 3

                                vstKinmuDept.SelectedIndex = 0
                                Call sList_SyokuinKanriInfo(0)

                                m_LoopFlg = 0

                            ElseIf (M_STAFFIDO_HAICHI).Equals(p_Str) Then

                                m_strBusyoHaichi = M_DISP_HAICHI

                                Call subObjectVisibleFalse()

                                'フォーム（自画面）
                                m_strSelChildMenu = p_Str

                                Call sList_HaichiInfo()

                            ElseIf (M_STAFFIDO_KOJIN).Equals(p_Str) Then

                                Call subPersonal_Click()

                            End If

                        Case Else

                    End Select

                Case M_OVERKINMU_RESCD
                    '時間外_/_/_/_/_/_/_/_/_/_/_/_/_/_/_/_/_/_/_/_/_/_/_/_/_/_/_/_/_/_/_/_/_/_/_/_/_/_/_/_/

                    Select Case w_strButtonKbn

                        Case G_OBJECTKBN_DLL
                            'DLL呼び出し

                            'ｸﾗｽｵﾌﾞｼﾞｪｸﾄを生成(届出詳細のみ遷移画面が変動するためここでは作成しない)
                            If M_PER_APPLI_CHG.Equals(p_Str) = False Then
                                w_clsObj = General.paCreateObject(m_udtChildMenu(w_lngLoop).strObjNm)

                                If M_PER_STUDY.Equals(p_Str) = False Then
                                    'ﾌﾟﾛﾊﾟﾃｨ設定
                                    w_clsObj.pInstallType = General.g_InstallType           'インストールタイプ
                                End If
                            End If

                            If (M_APPRO_DAY_OVER_JISSEKI_CHG).Equals(p_Str) Then
                                '--------------
                                '実績詳細画面
                                '--------------
                                If (M_STR_DAY).Equals(m_strOverKinmuDispType) Then
                                    '勤務実績がない場合は処理終了
                                    If lvwDeptInfo.Items.Count <= 0 Then
                                        Exit Sub
                                    End If

                                    If IsNothing(lvwDeptInfo.FocusedItem) Then
                                        w_intStaffIdx = lvwDeptInfo.Items(0).Tag
                                    Else
                                        w_intStaffIdx = lvwDeptInfo.Items(lvwDeptInfo.FocusedItem.Index).Tag
                                    End If

                                    w_strSelStaffMngID = m_udtStaffData(w_intStaffIdx).strStaffMngID
                                    w_lngSelDate = General.paGetDateIntegerFromDate(m_DayOverSelectDate)
                                Else
                                    If IsNothing(lvwMain.FocusedItem) Then
                                        w_DayIdx = 0
                                    Else
                                        w_DayIdx = lvwMain.FocusedItem.Index + 1
                                    End If

                                    If String.IsNullOrEmpty(m_udtKinmuData(w_DayIdx).strKinmuCD) Then
                                        Exit Sub
                                    End If

                                    w_strSelStaffMngID = g_strTargetStaffMngID
                                    w_lngSelDate = m_udtKinmuData(w_DayIdx).lngDate

                                End If

                                '利用者と選択職員のセキュリティ
                                If General.paCheckSelStaffAllAccount("NSW0020HA",
                                                          Trim$(w_strSelStaffMngID),
                                                          General.g_strSelKinmuDeptCD) = False Then

                                    ReDim w_strMsg(2)
                                    w_strMsg(1) = "職員"
                                    w_strMsg(2) = "操作"
                                    '選択した&1を&2する権限がありません。
                                    Call General.paMsgDsp("NS0093", w_strMsg)
                                    Exit Sub

                                End If

                                w_blnDateDeptFlg = funcChangeDeptCD(w_strSelStaffMngID,
                                                                    w_lngSelDate,
                                                                    w_strDateDeptCD,
                                                                    w_strDateDeptName)

                                w_clsObj = New NsAid_NSW0020H.clsNSW0020H

                                w_clsObj.pHospitalInfo(General.g_strHospitalCD) = General.g_strHospitalNm                   '施設情報
                                w_clsObj.pKangoTaniInfo(w_strDateDeptCD) = w_strDateDeptName              '選択勤務部署情報
                                w_clsObj.pUserInfo(General.g_strUserID) = General.g_strUserName
                                w_clsObj.pUserMngID = General.g_strUserMngID
                                w_clsObj.pPersonalChk = False                                               '個人or部署(個人:True、部署:False)
                                '利用者情報
                                w_clsObj.pGetDataObj = General.g_objGetData                                         '職員取得部品
                                w_clsObj.pGetMasterObj = General.g_objGetMaster                                     'マスタ取得部品
                                w_clsObj.pSecurityObj = General.g_objSecurity                                       'セキュリティ部品
                                w_clsObj.pSelectDateObj = General.g_objSelectDate                                   'カレンダー部品
                                w_clsObj.pSyouninDataObj = General.g_objSyouninData                                 '承認部品
                                w_clsObj.pSelectData(m_udtStaffData(w_intStaffIdx).strStaffMngID) _
                                     = General.paGetDateIntegerFromDate(m_DayOverSelectDate)    '対象者職員管理番号/日付
                                w_clsObj.pComCyokinObj = General.g_objComCyokin
                                w_clsObj.pSelectData(w_strSelStaffMngID) = w_lngSelDate  '対象者職員管理番号/日付

                                '*** 時間外実績詳細画面 ***
                                w_clsObj.pSelectButton = g_MenuM(g_lngGroupIdx).ListBarMenu(g_lngListIdx).strResCD
                                '**********************************
                                w_clsObj.pProcessObj = Me
                                '画面表示
                                w_clsObj.mShowWindow()

                                Select Case m_strOverKinmuDispType

                                    Case M_STR_DAY
                                        '日別時間外再表示
                                        If w_clsObj.pEndStatus = True Then
                                            Call sList_DayOver()
                                        End If
                                    Case M_STR_PERSONAL
                                        '個人別時間外再表示
                                        Call sList_Personal()

                                End Select

                            ElseIf (M_DEPT_OVERKINMUINFO).Equals(p_Str) Then
                                '----------------------
                                '時間外勤務状況照会
                                '----------------------

                                w_clsObj = New NsAid_NSW0060H.clsNSW0060H

                                If M_PER_STUDY.Equals(p_Str) = False Then
                                    'ﾌﾟﾛﾊﾟﾃｨ設定
                                    w_clsObj.pInstallType = General.g_InstallType           'インストールタイプ
                                End If

                                w_clsObj.pHospitalCD = General.g_strHospitalCD                  '施設情報
                                w_clsObj.pUserID = General.g_strUserMngID                       '利用者職員管理番号
                                w_clsObj.pKangoTCD = General.g_strSelKinmuDeptCD                '勤務部署CD
                                w_clsObj.pKangoTNM = General.g_strSelKinmuDeptNm                '勤務部署名称
                                w_clsObj.pYear = General.paLeft(AidGeneral.SelectDate.ToString, 4)          '年
                                w_clsObj.pMonth = AidGeneral.SelectDate.ToString.Substring(4, 2)          '月
                                w_clsObj.pGetDataObj = General.g_objGetData
                                w_clsObj.pProcessObj = Me
                                '画面表示
                                w_clsObj.mShowWindow()



                            ElseIf (M_PER_STUDY).Equals(p_Str) Then
                                '-----------------
                                '研修申込画面
                                '-----------------
                                Call subKensyu(w_clsObj, True)
                                w_clsObj.pProcessObj = Me
                                '画面表示
                                w_clsObj.mShowWindow()


                            End If

                        Case G_OBJECTKBN_EXE
                            'EXE呼び出し

                            m_blnFormCloseFlg = False

                        Case G_OBJECTKBN_FORM


                            If (M_APPRO_DAY_OVER).Equals(p_Str) Then

                                vstKinmuDept.SelectedIndex = 0

                            ElseIf (M_APPRO_PERSONAL_OVER).Equals(p_Str) Then

                                vstKinmuDept.SelectedIndex = 1

                            End If

                        Case G_OBJECTKBN_OTHER

                            '全選択
                            If (M_APPRO_DAY_OVER_ALL_CHECK).Equals(p_Str) Then

                                '日別だったら
                                If (M_STR_DAY).Equals(m_strOverKinmuDispType) Then

                                    With lvwDeptInfo
                                        For w_lngLoop = 0 To .Items.Count - 1
                                            .Items(w_lngLoop).Checked = True
                                        Next w_lngLoop
                                    End With

                                    '個人別だったら
                                ElseIf (M_STR_PERSONAL).Equals(m_strOverKinmuDispType) Then

                                    With lvwMain
                                        For w_lngLoop = 0 To .Items.Count - 1
                                            .Items(w_lngLoop).Checked = True
                                        Next w_lngLoop
                                    End With

                                End If

                                '全解除
                            ElseIf (M_APPRO_DAY_OVER_NOT_CHECK).Equals(p_Str) Then

                                '日別だったら
                                If (M_STR_DAY).Equals(m_strOverKinmuDispType) Then

                                    With lvwDeptInfo
                                        For w_lngLoop = 0 To .Items.Count - 1
                                            .Items(w_lngLoop).Checked = False
                                        Next w_lngLoop
                                    End With

                                    '個人別だったら
                                ElseIf (M_STR_PERSONAL).Equals(m_strOverKinmuDispType) Then

                                    With lvwMain
                                        For w_lngLoop = 0 To .Items.Count - 1
                                            .Items(w_lngLoop).Checked = False
                                        Next w_lngLoop
                                    End With

                                End If

                                '承認操作
                            ElseIf (M_APPRO_DAY_OVER_APPROVE).Equals(p_Str) Then

                                '日別だったら
                                If (M_STR_DAY).Equals(m_strOverKinmuDispType) Then

                                    w_blnOKFlg = sUpdApproveDayOver()

                                    'ロックがかかっていない場合の承認操作後、ロックを促すメッセージ
                                    If m_blnOverKinmuLockFlg = True Then
                                        If w_blnOKFlg = True Then

                                            Call sList_DayOver()

                                        End If
                                    Else

                                        w_blnListFlg = False
                                        w_lngListCnt = lvwDeptInfo.Items.Count
                                        For w_lngListLoop = 0 To w_lngListCnt - 1

                                            If lvwDeptInfo.Items(w_lngListLoop).Checked = True Then

                                                w_blnListFlg = True
                                                Exit For

                                            End If

                                        Next w_lngListLoop

                                        If w_blnListFlg = True Then
                                            ReDim w_strMsg(0)
                                            '確認操作を行いますか？
                                            w_MsgResult = General.paMsgDsp("NS0284", w_strMsg)

                                            If w_MsgResult = vbYes Then

                                                Call sUpdateOverKinmuLock(W_INSERT)

                                                m_strAppliChange = M_DISP_DAYOVER

                                                m_strSelChildMenu = M_APPRO_DAY_OVER ' M_APPRO_DAYOVER
                                                Call sList_DayOver()

                                            Else

                                                If w_blnOKFlg = True Then

                                                    Call sList_DayOver()

                                                End If

                                            End If
                                        Else
                                            If w_blnOKFlg = True Then

                                                Call sList_DayOver()

                                            End If
                                        End If

                                    End If

                                    '個人別だったら
                                ElseIf (M_STR_PERSONAL).Equals(m_strOverKinmuDispType) Then

                                    Call sUpdApprovePersonalOver()

                                End If

                                '確定（ロック）
                            ElseIf (M_APPRO_DAY_OVER_LOCK).Equals(p_Str) Then

                                '日別画面
                                If (M_STR_DAY).Equals(m_strOverKinmuDispType) Then

                                    Call sUpdateOverKinmuLock(W_INSERT)

                                    m_strAppliChange = M_DISP_DAYOVER

                                    m_strSelChildMenu = M_APPRO_DAY_OVER ' M_APPRO_DAYOVER
                                    Call sList_DayOver()

                                End If

                                '確定（解除）
                            ElseIf (M_APPRO_DAY_OVER_LOCK_OUT).Equals(p_Str) Then

                                '日別画面
                                If (M_STR_DAY).Equals(m_strOverKinmuDispType) Then

                                    Call sUpdateOverKinmuLock(W_DELETE)
                                    m_strAppliChange = M_DISP_DAYOVER
                                    m_strSelChildMenu = M_APPRO_DAY_OVER ' M_APPRO_DAYOVER
                                    Call sList_DayOver()

                                End If
                            End If
                        Case Else
                    End Select
                Case Else
                    'どれにも該当しない場合はとりあえず個人のツールバーをセット_/_/_/_/_/_/_/_/_/_/_/_/_/_/
                    '個人_/_/_/_/_/_/_/_/_/_/_/_/_/_/_/_/_/_/_/_/_/_/_/_/_/_/_/_/_/_/_/_/_/_/_/_/_/_/_/_/_/

                    Select Case w_strButtonKbn

                        Case G_OBJECTKBN_DLL
                            'DLL呼び出し

                            '実績変更画面(実績状況画面表示中のみ有効)
                            If (M_PER_JISSEKI_CHG).Equals(p_Str) Then
                                If M_PER_JISSEKI_DSP.Equals(m_strSelChildMenu) = False Then
                                    Exit Sub
                                End If
                            End If

                            '届出詳細画面(届出状況画面表示中のみ有効)
                            If (M_PER_APPLI_CHG).Equals(p_Str) Then
                                If M_PER_APPLI_DSP.Equals(m_strSelChildMenu) = False Then
                                    Exit Sub
                                End If
                                'リストに情報があるかどうか確認する
                                If lvwMain.Items.Count <= 0 Then
                                    Exit Sub
                                End If
                            End If

                            '届出入力画面(届出状況画面表示中のみ有効)
                            If (M_PER_APPLI_NEW).Equals(p_Str) Then
                                If M_PER_APPLI_DSP.Equals(m_strSelChildMenu) = False Then
                                    Exit Sub
                                End If
                            End If

                            Select Case p_Str

                                Case M_PER_JISSEKI_CHG
                                    '--------------
                                    '実績変更画面
                                    '--------------
                                    '勤務実績がない場合は処理終了
                                    'w_DayIdx = lvwMain.SelectedItem.Index
                                    If String.IsNullOrEmpty(m_udtKinmuData(w_DayIdx).strKinmuCD) Then
                                        Exit Sub
                                    End If

                                    If General.paCheckSelStaffAccount(p_Str,
                                                              g_strTargetStaffMngID,
                                                              General.g_strUserKinmuDeptCD) = False Then

                                        ReDim w_strMsg(2)
                                        w_strMsg(1) = "職員"
                                        w_strMsg(2) = "操作"
                                        '選択した&1を&2する権限がありません。
                                        Call General.paMsgDsp("NS0093", w_strMsg)
                                        Exit Sub

                                    End If

                                    w_blnDateDeptFlg = funcChangeDeptCD(g_strTargetStaffMngID,
                                                                        m_udtKinmuData(w_DayIdx).lngDate,
                                                                        w_strDateDeptCD,
                                                                        w_strDateDeptName)

                                    w_clsObj.pHospitalInfo(General.g_strHospitalCD) = General.g_strHospitalNm                       '施設情報
                                    w_clsObj.pKangoTaniInfo(w_strDateDeptCD) = w_strDateDeptName              '選択勤務部署情報
                                    w_clsObj.pUserInfo(General.g_strUserID) = General.g_strUserName                                 '利用者情報
                                    w_clsObj.pUserMngID = General.g_strUserMngID
                                    w_clsObj.pPersonalChk = True                                                    '個人or部署(個人:True、部署:False)  --- 2007/07/20 Muraoka Add
                                    w_clsObj.pGetDataObj = General.g_objGetData                                         '職員取得部品
                                    w_clsObj.pGetMasterObj = General.g_objGetMaster                                     'マスタ取得部品
                                    w_clsObj.pSecurityObj = General.g_objSecurity                                       'セキュリティ部品
                                    w_clsObj.pSelectDateObj = General.g_objSelectDate                                   'カレンダー部品
                                    w_clsObj.pSyouninDataObj = General.g_objSyouninData                                 '承認部品
                                    w_clsObj.pSelectData(g_strTargetStaffMngID) = m_udtKinmuData(w_DayIdx).lngDate  '対象者職員管理番号/日付
                                    w_clsObj.pComCyokinObj = General.g_objComCyokin

                                Case M_PER_APPLI_NEW
                                    '-------------
                                    '届出入力画面
                                    '-------------
                                    If General.paCheckSelStaffAccount(p_Str,
                                                              g_strTargetStaffMngID,
                                                              General.g_strUserKinmuDeptCD) = False Then

                                        ReDim w_strMsg(2)
                                        w_strMsg(1) = "職員"
                                        w_strMsg(2) = "操作"
                                        '選択した&1を&2する権限がありません。
                                        Call General.paMsgDsp("NS0093", w_strMsg)
                                        Exit Sub

                                    End If

                                    w_clsObj.pHospitalInfo = General.g_strHospitalCD                '施設情報
                                    w_clsObj.pUserInfo(General.g_strUserID) = General.g_strUserName         '利用者情報
                                    w_clsObj.pUserStaffMngID = General.g_strUserMngID               '利用者職員管理番号
                                    w_clsObj.pUserSecGroup = General.g_strUserGroupCD               '利用者グループコード
                                    w_clsObj.pUserKinmuDeptCD = General.g_strUserKinmuDeptCD        '利用者勤務部署コード
                                    w_clsObj.pDispMode = "1"                                '表示モード(1:申請、2:選択、3:コピー元選択)
                                    w_clsObj.pAppliCD = ""                                  '表示モードが３の場合のみ必須
                                    w_clsObj.pDutyMngID = g_strTargetStaffMngID             '申請者職員管理番号
                                    w_clsObj.pInstallType = General.g_InstallType                   'インストールタイプ
                                    w_clsObj.pGetDataObj = General.g_objGetData                 '職員取得部品
                                    w_clsObj.pSecurityObj = General.g_objSecurity               'セキュリティ部品
                                    w_clsObj.pGetMasterObj = General.g_objGetMaster             'マスタ取得部品
                                    w_clsObj.pSelectDeptObj = General.g_objSelectDept           '部署ポップアップ部品
                                    w_clsObj.pSelectStaffObj = General.g_objSelectStaff         '職員ポップアップ部品


                                Case M_PER_APPLI_CHG
                                    '-------------
                                    '届出詳細画面
                                    '-------------
                                    '届出選択情報
                                    w_intSelIdx = lvwMain.FocusedItem.Index
                                    Select Case m_udtAppliData(w_intSelIdx).strScreenCtrlKbn

                                        Case W_NENKYU
                                            '-------------
                                            '年休
                                            '-------------
                                            If General.paCheckSelStaffAccount(p_Str,
                                                                      g_strTargetStaffMngID,
                                                                      General.g_strUserKinmuDeptCD) = False Then

                                                ReDim w_strMsg(2)
                                                w_strMsg(1) = "職員"
                                                w_strMsg(2) = "操作"
                                                '選択した&1を&2する権限がありません。
                                                Call General.paMsgDsp("NS0093", w_strMsg)
                                                Exit Sub

                                            End If

                                            w_clsObj = New NsAid_NSA0040H.clsNSA0040H
                                            w_clsObj.pInstallType = General.g_InstallType                               'インストールタイプ
                                            w_clsObj.pHospitalInfo = General.g_strHospitalCD                            '施設情報
                                            w_clsObj.pUserInfo(General.g_strUserID) = General.g_strUserName                     '利用者情報
                                            w_clsObj.pUserStaffMngID = General.g_strUserMngID                           '利用者職員管理番号
                                            w_clsObj.pUserSecGroup = General.g_strUserGroupCD                           '利用者グループコード
                                            w_clsObj.pUserKinmuDeptCD = General.g_strUserKinmuDeptCD                    '利用者勤務部署コード
                                            w_clsObj.pDispMode = "1"                                            '表示モード(1:申請、2:承認)
                                            w_clsObj.pSyoriKbn = "2"                                            '処理区分(1:新規、2:修正)
                                            w_clsObj.pAppliCD = m_udtAppliData(w_intSelIdx).strAppliCD          '届出コード

                                            If m_udtAppliData(w_intSelIdx).strAppliStaffMngID.Equals(g_strTargetStaffMngID) = False Then
                                                w_clsObj.pDutyMngID = m_udtAppliData(w_intSelIdx).strAppliStaffMngID    '申請者職員管理番号
                                            Else
                                                w_clsObj.pDutyMngID = g_strTargetStaffMngID                         '申請者職員管理番号
                                            End If

                                            w_clsObj.pDutyKinmuDeptCD = fncGetDeptCD(m_udtAppliData(w_intSelIdx).strAppliStaffMngID)   '勤務部署コード
                                            w_clsObj.pUniqueSeqNo = m_udtAppliData(w_intSelIdx).strUNIQUESEQNO  'UNIQUESEQNO
                                            w_clsObj.pGetDataObj = General.g_objGetData                             '職員取得部品
                                            w_clsObj.pSecurityObj = General.g_objSecurity                           'セキュリティ部品
                                            w_clsObj.pGetMasterObj = General.g_objGetMaster                         'マスタ取得部品
                                            w_clsObj.pSelectDeptObj = General.g_objSelectDept                       '部署ポップアップ部品
                                            w_clsObj.pSelectStaffObj = General.g_objSelectStaff                     '職員ポップアップ部品
                                            w_clsObj.pSyouninDataObj = General.g_objSyouninData                     '承認部品
                                            w_clsObj.pSelectDateObj = General.g_objSelectDate                       'カレンダー部品
                                    End Select

                                Case M_PER_STAFFINFO_DSP
                                    '-----------------
                                    '職員基本情報画面
                                    '-----------------
                                    If General.paCheckSelStaffAccount(p_Str,
                                                              g_strTargetStaffMngID,
                                                              General.g_strUserKinmuDeptCD) = False Then

                                        ReDim w_strMsg(2)
                                        w_strMsg(1) = "職員"
                                        w_strMsg(2) = "操作"
                                        '選択した&1を&2する権限がありません。
                                        Call General.paMsgDsp("NS0093", w_strMsg)
                                        Exit Sub

                                    End If
                                    w_clsObj = New NsAid_NSC0040H.clsNSC0040H
                                    w_clsObj.pHospitalCD = General.g_strHospitalCD                              '施設情報
                                    w_clsObj.pUserInfo(General.g_strUserID) = General.g_strUserName                     '利用者情報
                                    w_clsObj.pSelStaffMngID = g_strTargetStaffMngID                     '選択職員管理番号
                                    w_clsObj.pSelStaffNo = ""                                           '選択職員番号
                                    w_clsObj.pSelStaffKinmuDeptCD = ""                                  '選択職員勤務部署コード
                                    w_clsObj.pGetDataObj = General.g_objGetData                             '職員取得部品
                                    w_clsObj.pSecurityObj = General.g_objSecurity                           'セキュリティ部品
                                    w_clsObj.pSelectDateObj = General.g_objSelectDate                       'カレンダー部品

                                Case M_PER_STUDY
                                    '-----------------
                                    '研修申込画面
                                    '-----------------
                                    Call subKensyu(w_clsObj, True)

                            End Select
                            w_clsObj.pProcessObj = Me
                            '画面表示
                            w_clsObj.mShowWindow()

                            Select Case p_Str

                                Case M_PER_JISSEKI_CHG
                                    '個人業務
                                    If w_clsObj.pEndStatus = True Then
                                        Call sList_Personal()
                                    End If
                                Case M_PER_APPLI_NEW
                                    '届出新規
                                    If w_clsObj.pEndStatus = True Then
                                        Call sList_Personal()
                                    End If
                                Case M_PER_APPLI_CHG
                                    '届出詳細
                                    If w_clsObj.pEndStatus = True Then
                                        Call sList_Personal()
                                    End If
                            End Select

                        Case G_OBJECTKBN_EXE

                            'EXE呼び出し
                            If GetProcesses() = True Then

                                Select Case m_udtChildMenu(w_lngLoop).strResCD

                                    Case M_PER_MAKEKINMU_HOPE
                                        '================
                                        '計画画面
                                        '================
                                        Select Case m_udtChildMenu(w_lngLoop).strResCD
                                            Case M_PER_MAKEKINMU_HOPE
                                                m_strStartMode = General.G_PGMSTARTFLG_NEWPLAN
                                        End Select

                                        If General.paCheckSelStaffAccount(m_udtChildMenu(w_lngLoop).strResCD,
                                                                  "",
                                                                  General.g_strSelKinmuDeptCD) = False Then

                                            ReDim w_strMsg(2)
                                            w_strMsg(1) = "職員"
                                            w_strMsg(2) = "操作"
                                            '選択した&1を&2する権限がありません。
                                            Call General.paMsgDsp("NS0093", w_strMsg)
                                            Exit Sub

                                        End If

                                        '期間コンボボックス設定/表示
                                        If fncCheckMakeKinmu() = False Then
                                            Exit Sub
                                        End If

                                        'ｺﾏﾝﾄﾞﾗｲﾝ
                                        w_strCmdLine = General.g_strHospitalCD
                                        w_strCmdLine = w_strCmdLine & "," & General.g_strUserID
                                        w_strCmdLine = w_strCmdLine & "," & General.g_strUserName
                                        w_strCmdLine = w_strCmdLine & "," & General.g_strUserMngID
                                        w_strCmdLine = w_strCmdLine & "," & General.g_strUserGroupCD
                                        w_strCmdLine = w_strCmdLine & "," & General.g_strUserKinmuDeptCD
                                        w_strCmdLine = w_strCmdLine & "," & General.g_strSelKinmuDeptCD
                                        w_strCmdLine = w_strCmdLine & "," & m_lngPlanNo
                                        w_strCmdLine = w_strCmdLine & "," & m_strStartMode
                                        w_strCmdLine = w_strCmdLine & "," & G_PROJECTID
                                        'Exe Pathの取得
                                        w_strExePath = General.paGetIniSetting(General.G_STRININAME, General.G_STRSECTION1, "ExePath", "")

                                        '非表示にする
                                        Me.Hide()
                                        'Exe起動
                                        Call Shell(w_strExePath & m_udtChildMenu(w_lngLoop).strObjNm & " " & w_strCmdLine, vbNormalFocus)
                                End Select
                            End If

                            m_blnFormCloseFlg = False

                            'アンロード
                            'Unload(Me)

                        Case G_OBJECTKBN_FORM

                            Call subObjectVisibleFalse()

                            '選択ツールバーインデックス(DLL作成の場合は変更しない)
                            m_strSelChildMenu = p_Str
                            '個人業務
                            Call sList_Personal()

                        Case Else

                    End Select

            End Select

        Catch ex As Exception
            Call General.paTrpMsg(Convert.ToString(Err), W_SUBNAME)
        End Try
    End Sub

    '勤務部署CD 取得
    Private Function fncGetDeptCD(ByVal p_strMngID As String) As String
        Const W_SUBNAME As String = "NSK0000A fncGetDeptCD"

        Try
            Dim w_lngRecCnt As Integer

            '初期化
            fncGetDeptCD = ""

            With General.g_objGetData
                .p病院CD = General.g_strHospitalCD
                .p職員番号変換 = 0 '全ての情報
                .p職員区分 = 0 '職員管理番号指定
                .p職員番号 = p_strMngID '職員管理番号
                .p日付区分 = 0 '単一日
                .p開始年月日 = General.paGetDateIntegerFromDate(Now) '開始年月日
                .p履歴ソートFLG = 1 '降順
                .pシステム区分 = 1 '職員歴必要なし
                If .mStaffInit = False Then
                    Exit Function
                Else
                    w_lngRecCnt = .f勤務地異動件数

                    If w_lngRecCnt <> 0 Then
                        .p勤務地異動索引 = 1
                        '●勤務部署CD
                        fncGetDeptCD = .f看護単位CD1
                    End If
                End If
            End With

        Catch ex As Exception
            Call General.paTrpMsg(Convert.ToString(Err.Number), W_SUBNAME)
        End Try
    End Function

    '==================================================
    '各コントロールの表示やサイズを調整します。
    '==================================================
    Private Sub sSetControl()
        Const W_SUBNAME As String = "NSC0000HA sSetControl"

        Try
            Dim w_splHeight As Double
            Dim w_Control As Object
            Dim w_blnPersonalHol As Boolean '個人別休暇情報表示かどうか
            Dim w_blnSetFlg As Boolean 'なにかしらのオブジェクトがセットされているか
            Dim w_blnDeptTree As Boolean '個人表示で、届出状況の場合は、部署からの遷移でも部署ツリーは表示しない
            Dim w_WarddeptFlg As String
            Dim w_numDispHeight As Integer = System.Windows.Forms.Screen.GetBounds(Me).Height
            Dim w_numDispWidth As Integer = System.Windows.Forms.Screen.GetBounds(Me).Width
            Dim w_numFormHeight As Integer = Me.Height + 22
            Dim w_numFormWidth As Integer = Me.Width - 8

            w_blnPersonalHol = False

            w_blnSetFlg = False

            w_blnDeptTree = True

            System.Windows.Forms.Application.DoEvents()

            w_splHeight = albMenu.Height - vseMain.Height

            '各コントロールの横幅を解像度によって変更する。
            vseInformation.Width = w_numDispWidth - 356
            vseMain.Width = w_numDispWidth - 105
            picStatus.Width = w_numDispWidth + 2
            ContentPanel.Width = w_numDispWidth - 3
            ToolStripContainer2.Width = w_numDispWidth - 102
            MenuStrip1.Width = w_numDispWidth - 8

            '説明_/_/_/_/_/_/_/_/_/_/_/_/_/_/_/_/_/_/_/_/_/_/_/_/_/_/_/_/_/_/_/_/_/_/_/_/_/_/_/_/
            'パターン@
            '部署・日当直・出退勤・エラー・在院
            '---------------------------------------
            'カレンダー  |                         |
            ' 年月日     |                         |
            '            |                         |
            '            |                         |
            '------------|                         |
            '            |    リスト               |
            '部署等ツリー|                         |
            '            |                         |
            '            |                         |
            '            |                         |
            '            |                         |
            '            |                         |
            '---------------------------------------
            '
            'パターンA
            '時間外
            '---------------------------------------
            'カレンダー  |  検索条件               |
            '  年月      |                         |
            '--------------------------------------|
            '                                      |
            '                                      |
            '                                      |
            '                 リスト               |
            '                                      |
            '                                      |
            '                                      |
            '                                      |
            '                                      |
            '---------------------------------------
            '
            'パターンB
            '本人
            '---------------------------------------
            'カレンダー  |                         |
            '  年月      |                         |
            '------------|                         |
            '            |                         |
            '            |                         |
            '            |    リスト               |
            '個人詳細    |                         |
            '            |                         |
            '            |                         |
            '            |                         |
            '            |                         |
            '            |                         |
            '---------------------------------------
            '
            'パターンC
            '届出・未承認・全表示
            '---------------------------------------
            '(カレンダー)|  検索条件               |
            '(幅０にする)|                         |
            '--------------------------------------|
            '                                      |
            '                                      |
            '                                      |
            '                 リスト               |
            '                                      |
            '                                      |
            '                                      |
            '                                      |
            '                                      |
            '---------------------------------------
            '
            '説明_/_/_/_/_/_/_/_/_/_/_/_/_/_/_/_/_/_/_/_/_/_/_/_/_/_/_/_/_/_/_/_/_/_/_/_/_/_/_/_/

            '=====================
            '表示対象画面設定
            '=====================
            vseMain.Visible = True
            If g_lngGroupIdx = 0 OrElse g_lngListIdx = 0 Then
                '選択業務もしくはリストメニューが取得できなかった場合
                '部署ツリー非表示にする

                lblSearchData.Text = ""

                vseCalendar.Visible = True
                PnlCalendar.Visible = True
                vsePersonal.Visible = True
                vsePersonalData.Visible = True

            Else
                Select Case g_MenuM(g_lngGroupIdx).ListBarMenu(g_lngListIdx).strResCD

                    Case M_PERSONAL_RESCD
                        '============
                        '■個人業務
                        '============
                        vsePersonalData.Visible = False

                        Select Case m_strSelChildMenu

                            Case M_PER_JISSEKI_DSP
                                '-------------------------
                                '●実績状況　パターンB

                                '必要コントロールの表示
                                lvwMain.Visible = True
                                lvwMain.Enabled = True
                                vseCalendar.Visible = True
                                vsePersonal.Visible = True
                                sprKinmuCnt.Visible = True
                                sprMatrix.Visible = True
                                cmdSelMonth.Visible = True

                                If m_blnOverKinmuDispFlg = True Then
                                    If General.paGetItemValue(General.G_STRMAINKEY3, "WORKTIMESET", "PERSONALOVERKINMU", "0", General.g_strHospitalCD).Equals("0") Then
                                        sprTanka.Visible = False
                                        sprOverTime.Visible = False
                                    Else
                                        sprTanka.Visible = True
                                        sprOverTime.Visible = True
                                    End If

                                End If

                                vseInformation.Visible = True
                                vseInformation.Enabled = True
                                lvwInformation.Visible = True
                                lvwInformation.Enabled = True

                                'コントロールの非表示
                                lvwDeptInfo.Visible = False

                                '各PanelのLocationとSizeを設定
                                vseCalendar.Size = New Size(245, 35)

                                vsePersonal.Location = New Point(100, 172)
                                vsePersonal.Size = New Size(245, w_numFormHeight - 226 - m_numTaskBarHeight)
                                vsePersonal.Anchor = AnchorStyles.Top Or AnchorStyles.Left Or AnchorStyles.Bottom

                                StatusStrip1.Location = New Point(0, w_numFormHeight - 80)
                                StatusStrip1.Size = New Size(w_numFormWidth, 23)
                                ToolStripStatusLabel1.Size = New Size(w_numFormWidth - 215, 18)

                                vseInformation.Height = 77

                                '勤務情報ツリービューのリサイズ
                                lvwMain.Location = New Point(350, 215)
                                lvwMain.Size = New Size(w_numFormWidth - 355, w_numFormHeight - 264 - m_numTaskBarHeight)

                                'オブジェクトセット完了
                                w_blnSetFlg = True

                            Case M_PER_APPLI_DSP
                                '--------------------------
                                '●届出状況　パターンC
                                '--------------------------

                                '必要コントロールの表示
                                lvwMain.Visible = True
                                lvwMain.Enabled = True
                                imdFrom.Visible = True
                                imdTo.Visible = True
                                cmdPersonalFrom.Visible = True
                                cmdPersonalTo.Visible = True
                                cmbStatus.Visible = True
                                Label2.Visible = True
                                vsePersonal.Visible = True

                                '各PanelのLocationとSizeを設定
                                vsePersonal.Location = New Point(100, 138)
                                vsePersonal.Size = New Size(1175, 40)
                                vsePersonal.Anchor = AnchorStyles.Top Or AnchorStyles.Left

                                '勤務情報ツリービューのリサイズ
                                lvwMain.Location = New Point(100, 180)
                                lvwMain.Size = New Size(w_numFormWidth - 105, w_numFormHeight - 229 - m_numTaskBarHeight)

                                StatusStrip1.Location = New Point(0, w_numFormHeight - 80)
                                StatusStrip1.Size = New Size(w_numFormWidth, 23)
                                ToolStripStatusLabel1.Size = New Size(w_numFormWidth - 215, 18)

                                'オブジェクトセット完了
                                w_blnSetFlg = True

                                w_blnDeptTree = False

                            Case M_PER_HOLIDAY_DSP
                                'TODO 6.5未実装
                                '------------------------
                                '●休暇状況
                                '------------------------
                                'Paneに所定のControlを入れる
                                'vsePersonalHol.Height = .Height - M_PER_PANEHEIGHT_APPLI_Small

                                w_blnPersonalHol = True
                                'vsePersonalHol.Visible = True '個人業務-休暇情報のElasticを表示
                                vsePersonal.Visible = True

                                'オブジェクトセット完了
                                w_blnSetFlg = True

                        End Select

                        If m_blnKinmuDeptDspFlg Then
                            '部署ツリー表示にする
                            If w_blnDeptTree = True Then

                                '必要コントロールの表示
                                vstKinmuDept.Visible = True
                                vstKinmuDept.Enabled = True
                                lvwDeptInfo.Visible = False

                                '各PanelのLocationとSizeを設定
                                vseCalendar.Size = New Size(245, 35)

                                '勤務情報ツリービューのリサイズ
                                vstKinmuDept.Location = New Point(100, 380)
                                vstKinmuDept.Size = New Size(247, w_numFormHeight - 432 - m_numTaskBarHeight)
                                vsePersonal.Location = New Point(100, 172)
                                vsePersonal.Size = New Size(245, vstKinmuDept.Top - vsePersonal.Top)

                                StatusStrip1.Location = New Point(0, w_numFormHeight - 80)
                                StatusStrip1.Size = New Size(w_numFormWidth, 23)
                                ToolStripStatusLabel1.Size = New Size(w_numFormWidth - 215, 18)

                                '退避していたタブを一度Addし直す
                                Call subAddvstKinmuDept()

                                '非表示のタブはRemoveする
                                vstKinmuDept.TabPages.Remove(vstKinmuDept.TabPages.Item(G_TAB_JOB))
                                vstKinmuDept.TabPages.Remove(vstKinmuDept.TabPages.Item(G_TAB_POST))
                                vstKinmuDept.TabPages.Remove(vstKinmuDept.TabPages.Item(G_TAB_WARDDEPT))

                            End If
                        End If

                    Case M_DEPT_RESCD
                        '============
                        '■部署業務　パターン@
                        '============
                        '必要コントロールの表示
                        vstKinmuDept.Visible = True
                        vstKinmuDept.Enabled = True
                        vseCalendar.Visible = True
                        PnlCalendar.Visible = True
                        lvwDeptInfo.Visible = True
                        lvwDeptInfo.Enabled = True

                        vseInformation.Visible = True
                        vseInformation.Enabled = True
                        lvwInformation.Visible = True
                        lvwInformation.Enabled = True

                        '各PanelのLocationとSizeを設定
                        '勤務状況表示中
                        If (m_strSelChildMenu).Equals(M_DEPT_KINMUINFO) Then
                            vseCalendar.Height = 200

                            '時間外状況表示中
                        Else
                            vseCalendar.Height = 245
                        End If

                        vseInformation.Height = 77

                        '勤務情報ツリービューのリサイズ
                        vstKinmuDept.Location = New Point(100, 334)
                        vstKinmuDept.Size = New Size(247, w_numFormHeight - 384 - m_numTaskBarHeight)
                        lvwDeptInfo.Location = New Point(350, 215)
                        lvwDeptInfo.Size = New Size(w_numFormWidth - 356, w_numFormHeight - 264 - m_numTaskBarHeight)

                        StatusStrip1.Location = New Point(0, w_numFormHeight - 80)
                        StatusStrip1.Size = New Size(w_numFormWidth, 23)
                        ToolStripStatusLabel1.Size = New Size(w_numFormWidth - 215, 18)

                        '退避していたタブを一度Addし直す。
                        Call subAddvstKinmuDept()

                        '非表示のタブはRemoveする
                        vstKinmuDept.TabPages.Remove(vstKinmuDept.TabPages.Item(G_TAB_JOB))
                        vstKinmuDept.TabPages.Remove(vstKinmuDept.TabPages.Item(G_TAB_POST))
                        vstKinmuDept.TabPages.Remove(vstKinmuDept.TabPages.Item(G_TAB_WARDDEPT))
                        vstKinmuDept.TabPages.Remove(vstKinmuDept.TabPages.Item(G_TAB_DEPTSTAFF))

                        'オブジェクトセット完了
                        w_blnSetFlg = True

                    Case M_APPROVE_RESCD
                        '============
                        '■未承認
                        '============

                        '必要コントロールの表示
                        imdFrom.Visible = True
                        imdTo.Visible = True
                        lvwDeptInfo.Visible = True
                        lvwDeptInfo.Enabled = True
                        vseApproveInfo.Visible = True
                        cmbStatus.Visible = True

                        '未承認では不要なので個別に非表示設定
                        Label2.Visible = False


                        '各PanelのLocationとSizeを設定
                        vseApproveInfo.Location() = New Point(101, 138)
                        vseApproveInfo.Size = New Size(w_numDispWidth - 106, 80)

                        '勤務情報ツリービューのリサイズ
                        lvwDeptInfo.Location = New Point(100, 220)
                        lvwDeptInfo.Size = New Size(w_numFormWidth - 105, w_numFormHeight - 269 - m_numTaskBarHeight)

                        StatusStrip1.Location = New Point(0, w_numFormHeight - 80)
                        StatusStrip1.Size = New Size(w_numFormWidth, 23)
                        ToolStripStatusLabel1.Size = New Size(w_numFormWidth - 215, 18)

                        'オブジェクトセット完了
                        w_blnSetFlg = True

                    Case M_DAKOKU_RESCD
                        '============
                        '■出退勤
                        '============
                        '必要コントロールの表示
                        vstKinmuDept.Visible = True
                        vstKinmuDept.Enabled = True
                        vseCalendar.Visible = True
                        PnlCalendar.Visible = True
                        lvwDeptInfo.Visible = True
                        lvwDeptInfo.Enabled = True
                        lvwDeptStaff.Visible = True
                        lblTime.Visible = True

                        '勤務部署表示時には不要なので非表示
                        vsePersonal.Visible = False
                        vseInformation.Visible = False

                        '各PanelのLocationとSizeを設定
                        vseCalendar.Size = New Size(245, 245)

                        vstKinmuDept.Location = New Point(100, 380)
                        vstKinmuDept.Size = New Size(247, w_numFormHeight - 432 - m_numTaskBarHeight)

                        vsePersonal.Location = New Point(100, 172)
                        vsePersonal.Size = New Size(247, w_numFormHeight - 256 - m_numTaskBarHeight)

                        '勤務情報ツリービューのリサイズ
                        lvwDeptInfo.Location = New Point(350, 134)
                        lvwDeptInfo.Size = New Size(w_numFormWidth - 356, w_numFormHeight - 184 - m_numTaskBarHeight)

                        lvwMain.Location = New Point(350, 134)
                        lvwMain.Size = New Size(w_numFormWidth - 356, w_numFormHeight - 213 - m_numTaskBarHeight)

                        StatusStrip1.Location = New Point(0, w_numFormHeight - 80)
                        StatusStrip1.Size = New Size(w_numFormWidth, 23)
                        ToolStripStatusLabel1.Size = New Size(w_numFormWidth - 215, 18)

                        '退避していたタブを一度Addし直す。
                        Call subAddvstKinmuDept()

                        '非表示のタブはRemoveする
                        vstKinmuDept.TabPages.Remove(vstKinmuDept.TabPages.Item(G_TAB_JOB))
                        vstKinmuDept.TabPages.Remove(vstKinmuDept.TabPages.Item(G_TAB_POST))
                        vstKinmuDept.TabPages.Remove(vstKinmuDept.TabPages.Item(G_TAB_WARDDEPT))

                        'オブジェクトセット完了
                        w_blnSetFlg = True

                    Case M_DUTY_RESCD
                        '============
                        '■日当直
                        '============
                        '必要コントロールの表示
                        vseCalendar.Visible = True
                        PnlCalendar.Visible = True
                        lvwDeptInfo.Visible = True
                        lvwDeptInfo.Enabled = True
                        tvwDuty.Visible = True

                        '各PanelのLocationとSizeを設定
                        vseCalendar.Height = 200

                        '勤務情報ツリービューのリサイズ
                        tvwDuty.Location = New Point(100, 336)
                        tvwDuty.Size = New Size(247, w_numFormHeight - 386 - m_numTaskBarHeight)
                        lvwDeptInfo.Location = New Point(350, 134)
                        lvwDeptInfo.Size = New Size(w_numFormWidth - 356, w_numFormHeight - 154 - m_numTaskBarHeight)

                        StatusStrip1.Location = New Point(0, w_numFormHeight - 80)
                        StatusStrip1.Size = New Size(w_numFormWidth, 23)
                        ToolStripStatusLabel1.Size = New Size(w_numFormWidth - 215, 18)

                        'オブジェクトセット完了
                        w_blnSetFlg = True

                    Case M_ZAIIN_RESCD
                        '============
                        '■在院照会
                        '============
                        '配属部署設定フラグ取得
                        w_WarddeptFlg = General.paGetItemValue(General.G_STRMAINKEY1, General.G_STRSECTION1, "WORDDEPTFLG", "0", General.g_strHospitalCD)

                        '退避していたタブを一度Addし直す。
                        Call subAddvstKinmuDept()

                        '勤務部署＝配属部署
                        If "1".Equals(w_WarddeptFlg) Then
                            '配属部署非表示
                            vstKinmuDept.TabPages.Remove(vstKinmuDept.TabPages.Item(G_TAB_WARDDEPT))
                        End If

                        '非表示のタブはRemoveする
                        vstKinmuDept.TabPages.Remove(vstKinmuDept.TabPages.Item(G_TAB_DEPTSTAFF))

                        '必要コントロールの表示
                        vstKinmuDept.Visible = True
                        vstKinmuDept.Enabled = True
                        vseCalendar.Visible = True
                        PnlCalendar.Visible = True
                        lvwDeptInfo.Visible = True
                        lvwDeptInfo.Enabled = True
                        lvwDeptStaff.Visible = True
                        lblTime.Visible = True

                        '勤務部署表示時には不要なので非表示
                        vsePersonal.Visible = False
                        vseInformation.Visible = False

                        tvwKinmuDept.Parent = vstKinmuDept.SelectedTab

                        '各PanelのLocationとSizeを設定
                        vseCalendar.Size = New Size(245, 245)

                        vstKinmuDept.Location = New Point(100, 380)
                        vstKinmuDept.Size = New Size(247, w_numFormHeight - 432 - m_numTaskBarHeight)

                        vsePersonal.Location = New Point(100, 172)
                        vsePersonal.Size = New Size(247, w_numFormHeight - 256 - m_numTaskBarHeight)

                        '勤務情報ツリービューのリサイズ
                        lvwDeptInfo.Location = New Point(350, 134)
                        lvwDeptInfo.Size = New Size(w_numFormWidth - 356, w_numFormHeight - 184 - m_numTaskBarHeight)

                        lvwMain.Location = New Point(350, 134)
                        lvwMain.Size = New Size(w_numFormWidth - 356, w_numFormHeight - 213 - m_numTaskBarHeight)

                        StatusStrip1.Location = New Point(0, w_numFormHeight - 80)
                        StatusStrip1.Size = New Size(w_numFormWidth, 23)
                        ToolStripStatusLabel1.Size = New Size(w_numFormWidth - 215, 18)



                        'オブジェクトセット完了
                        w_blnSetFlg = True
                    Case M_STAFFIDO_RESCD

                        If m_strBusyoHaichi = M_DISP_BUSYO Then
                            '============
                            '■職員管理
                            '============
                            '配属部署設定フラグ取得
                            w_WarddeptFlg = General.paGetItemValue(General.G_STRMAINKEY1, General.G_STRSECTION1, "WORDDEPTFLG", "0", General.g_strHospitalCD)

                            Call subAddvstKinmuDept()

                            '勤務部署＝配属部署
                            If "1".Equals(w_WarddeptFlg) Then
                                '配属部署非表示
                                vstKinmuDept.TabPages.Remove(vstKinmuDept.TabPages.Item(G_TAB_WARDDEPT))
                            Else
                                'vstKinmuDept.set_TabVisible(G_TAB_WARDDEPT, True)
                            End If

                            vstKinmuDept.TabPages.Remove(vstKinmuDept.TabPages.Item(G_TAB_DEPTSTAFF))

                            'お知らせ情報を最小化(不可視化)
                            vseInformation.Visible = False
                            lvwInformation.Visible = False
                            vsePersonal.Visible = False
                            vsePersonalData.Visible = False

                            vstKinmuDept.Visible = True
                            vstKinmuDept.Enabled = True
                            lvwDeptInfo.Visible = True
                            lvwDeptInfo.Enabled = True

                            tvwKinmuDept.Parent = vstKinmuDept.SelectedTab

                            vstKinmuDept.Location = New Point(100, 135)
                            vstKinmuDept.Size = New Size(247, w_numFormHeight - 186 - m_numTaskBarHeight)
                            lvwDeptInfo.Location = New Point(350, 135)
                            lvwDeptInfo.Size = New Size(w_numFormWidth - 356, w_numFormHeight - 184 - m_numTaskBarHeight)

                            StatusStrip1.Location = New Point(0, w_numFormHeight - 80)
                            StatusStrip1.Size = New Size(w_numFormWidth, 23)
                            ToolStripStatusLabel1.Size = New Size(w_numFormWidth - 215, 18)

                            w_blnSetFlg = True

                        ElseIf (M_DISP_HAICHI).Equals(m_strBusyoHaichi) Then
                            '============
                            '■配置表
                            '============

                            Call subAddvstKinmuDept()

                            '部署ツリー表示にする
                            vstKinmuDept.TabPages.Remove(vstKinmuDept.TabPages.Item(G_TAB_DEPTSTAFF))

                            'お知らせ情報を最小化(不可視化)
                            vseInformation.Visible = False
                            lvwInformation.Visible = False
                            vsePersonal.Visible = False
                            vsePersonalData.Visible = False

                            vseHaichi.Height = w_splHeight - 150

                            vseHaichi.Visible = True
                            vseHaichi.Enabled = True

                            vseCalendar.Visible = False
                            PnlCalendar.Visible = False

                            vsePersonal.Visible = False
                            vsePersonalData.Visible = False
                            vstKinmuDept.Visible = False
                            vstKinmuDept.Enabled = False
                            lvwDeptInfo.Visible = False
                            lvwDeptInfo.Enabled = False

                            w_blnSetFlg = True

                        End If

                    Case M_STAFFIDO_HAICHI

                    Case M_OVERKINMU_RESCD
                        '============
                        '■時間外
                        '============
                        If (M_STR_DAY).Equals(m_strOverKinmuDispType) Then
                            lvwDeptInfo.Visible = True
                        Else
                            lvwMain.Visible = True
                        End If

                        'タブページの表示／非表示設定
                        Call subAddvstKinmuDept()

                        vstKinmuDept.TabPages.Remove(vstKinmuDept.TabPages.Item(G_TAB_JOB))
                        vstKinmuDept.TabPages.Remove(vstKinmuDept.TabPages.Item(G_TAB_POST))
                        vstKinmuDept.TabPages.Remove(vstKinmuDept.TabPages.Item(G_TAB_WARDDEPT))

                        vstKinmuDept.Visible = True
                        vstKinmuDept.Enabled = True
                        vseCalendar.Visible = True
                        PnlCalendar.Visible = True
                        lvwDeptStaff.Visible = True

                        '各Paneの高さと幅を設定
                        '勤務状況表示中
                        If (m_strSelChildMenu).Equals(M_APPRO_DAY_OVER) Then
                            vseCalendar.Height = 200
                            '時間外状況表示中
                        Else
                            vseCalendar.Height = 35
                        End If

                        vseInformation.Height = 77

                        If (M_STR_DAY).Equals(m_strOverKinmuDispType) Then
                            lvwMain.Visible = False
                            lvwMain.Enabled = False
                            lvwDeptInfo.Visible = True
                            lvwDeptInfo.Enabled = True

                            '勤務情報ツリービューのリサイズ
                            vstKinmuDept.Location = New Point(100, 334)
                            vstKinmuDept.Size = New Size(247, w_numFormHeight - 384 - m_numTaskBarHeight)
                            lvwDeptInfo.Location = New Point(350, 215)
                            lvwDeptInfo.Size = New Size(w_numFormWidth - 356, w_numFormHeight - 264 - m_numTaskBarHeight)
                        Else
                            lvwMain.Visible = True
                            lvwMain.Enabled = True
                            lvwDeptInfo.Visible = False
                            lvwDeptInfo.Enabled = False

                            '勤務情報ツリービューのリサイズ
                            lvwMain.Location = New Point(350, 215)
                            lvwMain.Size = New Size(w_numFormWidth - 356, w_numFormHeight - 264 - m_numTaskBarHeight)

                            vstKinmuDept.Location = New Point(100, 169)
                            vstKinmuDept.Size = New Size(247, w_numFormHeight - 220 - m_numTaskBarHeight)
                        End If
                        StatusStrip1.Location = New Point(0, w_numFormHeight - 80)
                        StatusStrip1.Size = New Size(w_numFormWidth, 23)
                        ToolStripStatusLabel1.Size = New Size(w_numFormWidth - 215, 18)

                        vseInformation.Visible = True
                        vseInformation.Enabled = True
                        lvwInformation.Visible = True
                        lvwInformation.Enabled = True

                        'オブジェクトセット完了
                        w_blnSetFlg = True

                    Case Else

                End Select
            End If

            If w_blnSetFlg = False Then
                'どこにも該当しない場合はとりあえずメインリストビューと個人用ツールバーをセット
                'Paneに所定のControlを入れる
                lvwMain.Height = M_PER_PANEHEIGHT_APPLI_Small

                vsePersonal.Visible = True
                lvwMain.Visible = True
                lvwMain.Enabled = True
            End If

            ''個人別休暇情報表示の場合は、sptPersonalHolのリサイズを行う
            'If w_blnPersonalHol = True Then
            '    sptPersonalHol.Panes("LVW").Height = M_PERSONALHOL_HEIGHT_LVW_Small
            '    sptPersonalHol.Panes("FRAME").Width = M_PERSONALHOL_WIDTH_FRAME
            'End If

            'tvwKinmuDept.Visible = True
            'tvwKinmuDept.Enabled = True
            'lvwDeptStaff.Visible = True        
            'lvwDeptStaff.Enabled = True

            ''Splitterを表示
            'sptMain.Visible = True


            w_Control = Nothing

            '背景色設定
            Call subSetBackColor()

        Catch ex As Exception
            Call General.paTrpMsg(Convert.ToString(Err.Number), W_SUBNAME)
        End Try
    End Sub

    Private Sub lvwDeptStaff_Click(ByVal eventSender As System.Object, ByVal eventArgs As System.EventArgs) Handles lvwDeptStaff.Click
        Const W_SUBNAME As String = "NSC0000HA lvwDeptStaff_Click"

        Try
            '選択アイテムがない場合
            If lvwDeptStaff.SelectedItems.Count < 0 Then
                Exit Sub
            End If

            '日単位の情報出力時のみ
            If (M_STR_DAY).Equals(m_strOverKinmuDispType) Then
                Exit Sub
            End If

            'タブスイッチイベント
            Call vstKinmuDept_Switch(G_TAB_DEPTSTAFF, G_TAB_DEPTSTAFF, False)

        Catch ex As Exception
            Call General.paTrpMsg(Convert.ToString(Err.Number), W_SUBNAME)
        End Try
    End Sub

    Private Sub lvwDeptStaff_ItemSelectionChanged(ByVal eventSender As System.Object, ByVal eventArgs As System.Windows.Forms.ListViewItemSelectionChangedEventArgs) Handles lvwDeptStaff.ItemSelectionChanged

        With lvwDeptStaff
            If IsNothing(.FocusedItem) Then
                Exit Sub
            End If

            If IsNothing(.FocusedItem) = False And .SelectedItems.Count = 0 Then
                .Items.Item(.FocusedItem.Index).Focused = True
                .Items.Item(.FocusedItem.Index).Selected = True
                .Select()
                Exit Sub
            End If
        End With

    End Sub

    Private Sub vstKinmuDept_SelectedIndexChanged(ByVal eventSender As System.Object, ByVal eventArgs As System.EventArgs) Handles vstKinmuDept.SelectedIndexChanged
        Const W_SUBNAME As String = "NSC0000HA vstKinmuDept_SelectedIndexChanged"

        Try
            vstKinmuDept_Switch(0, eventSender.selectedindex, False)

        Catch ex As Exception
            Call General.paTrpMsg(Convert.ToString(Err.Number), W_SUBNAME)
        End Try
    End Sub

    Private Sub vstKinmuDept_Switch(ByVal OldTab As Integer, ByVal NewTab As Integer, ByVal Cancel As Integer)
        Const W_SUBNAME As String = "NSC0000HA vstKinmuDept_Switch"

        Try
            m_LoopFlg = 2

            Call sSaveFieldWidth()

            If (M_DEPT_RESCD).Equals(m_strDispMenu) Then
                '-----------
                '勤務部署
                '-----------
                Select Case NewTab
                    Case 0
                        Call subSetTabKinmuDept(m_strDispMenu)
                End Select

            ElseIf (M_DAKOKU_RESCD).Equals(m_strDispMenu) Then
                '-----------
                '出退勤
                '-----------
                Select Case NewTab
                    Case 0
                        Call subSetTabKinmuDept(m_strDispMenu)

                    Case 1
                        Call subSetTabDeptStaff()
                End Select

            ElseIf (M_ZAIIN_RESCD).Equals(m_strDispMenu) Then
                '============
                '■在院照会
                '============
                Select Case NewTab
                    Case 0
                        Call subSetTabKinmuDept(m_strDispMenu)

                    Case Else
                        Call subSetOtherSearch(NewTab)
                End Select

            ElseIf (M_STAFFIDO_RESCD).Equals(m_strDispMenu) Then
                '-----------
                '職員管理
                '-----------
                m_intNowTab = NewTab

                m_strSelChildMenu = ""
                m_strDispMenu = M_STAFFIDO_RESCD

                Call sList_SyokuinKanriInfo(NewTab)

            ElseIf (M_OVERKINMU_RESCD).Equals(m_strDispMenu) Then
                '-----------
                '時間外
                '-----------
                Select Case NewTab
                    Case 0
                        Call subSetTabKinmuDept(m_strDispMenu)

                    Case 1
                        Call subSetTabDeptStaff()

                End Select
            End If

            m_LoopFlg = 0

            'リストビューの幅を設定
            Call General.paSetFieldWidth(lvwDeptInfo, General.G_STRMAINKEY1 & "\" & G_PROJECTID, m_strSelChildMenu, False)
            Call General.paSetFieldWidth(lvwMain, General.G_STRMAINKEY1 & "\" & G_PROJECTID, m_strSelChildMenu, False)

        Catch ex As Exception
            Call General.paTrpMsg(Convert.ToString(Err.Number), W_SUBNAME)
        End Try
    End Sub

    Private Sub subSetTabKinmuDept(ByVal p_strResCD As String)
        Const W_SUBNAME As String = "frmNSC0000HA subSetTabKinmuDept"

        Try
            Dim w_lngLoop As Integer
            Dim w_lngLoop2 As Integer
            Dim w_intGroupIdx As Integer
            Dim w_intListIdx As Integer

            m_intNowTab = G_TAB_KINMUDEPT

            'インデックスを取得する
            w_intGroupIdx = -1
            w_intListIdx = -1
            For w_lngLoop = 1 To UBound(g_MenuM)
                For w_lngLoop2 = 1 To UBound(g_MenuM(w_lngLoop).ListBarMenu)
                    If (g_MenuM(w_lngLoop).ListBarMenu(w_lngLoop2).strResCD).Equals(p_strResCD) Then
                        'グループインデックス
                        g_lngGroupIdx = w_lngLoop
                        'リストインデックス
                        g_lngListIdx = w_lngLoop2

                        Exit For
                    End If
                Next w_lngLoop2

                If g_lngGroupIdx <> -1 AndAlso g_lngListIdx <> -1 Then
                    Exit For
                End If
            Next w_lngLoop

            'グループインデックスorリストインデックスが見つからなかったら処理終了
            If g_lngGroupIdx = -1 OrElse g_lngListIdx = -1 Then
                Exit Sub
            End If

            m_strSelChildMenu = ""

            '各処理呼出
            Select Case p_strResCD
                Case M_DEPT_RESCD
                    Call sList_DeptInfo()

                Case M_DAKOKU_RESCD
                    Call sList_DakokuInfo()

                Case M_ZAIIN_RESCD
                    Call sList_ZaiinInfo()

                Case M_OVERKINMU_RESCD
                    m_strOverKinmuDispType = M_STR_DAY
                    AidGeneral.SelectDate = General.paGetDateIntegerFromDate(m_CalDate)
                    Call setCustomCalendar()
                    Call sSetCalendar()

                    '部署業務処理呼出→値を設定しないと職員別で月変更時もそのままないものになる
                    Call sList_DayOver()

            End Select

        Catch ex As Exception
            Call General.paTrpMsg(Convert.ToString(Err.Number), W_SUBNAME)
        End Try
    End Sub

    Private Sub subSetTabDeptStaff()
        Const W_SUBNAME As String = "frmNSC0000HA subSetTabDeptStaff"

        Try
            Dim w_intStaffIdx As Integer
            Dim w_lngLoop As Integer
            Dim w_lngLoop2 As Integer
            Dim w_intGroupIdx As Integer
            Dim w_intListIdx As Integer
            Dim w_strResCD As String

            '===========
            '職員一覧
            '===========
            If UBound(m_udtStaffData) <= 0 Then
                Exit Sub
            End If

            m_strOverKinmuDispType = M_STR_PERSONAL

            If (M_OVERKINMU_RESCD).Equals(m_strDispMenu) Then
                w_strResCD = M_OVERKINMU_RESCD
            Else
                w_strResCD = M_PERSONAL_RESCD
            End If

            '個人業務インデックスを取得する
            w_intGroupIdx = -1
            w_intListIdx = -1
            For w_lngLoop = 1 To UBound(g_MenuM)
                For w_lngLoop2 = 1 To UBound(g_MenuM(w_lngLoop).ListBarMenu)
                    If (w_strResCD).Equals(g_MenuM(w_lngLoop).ListBarMenu(w_lngLoop2).strResCD) Then
                        'グループインデックス
                        g_lngGroupIdx = w_lngLoop
                        'リストインデックス
                        g_lngListIdx = w_lngLoop2

                        Exit For
                    End If
                Next w_lngLoop2

                If g_lngGroupIdx <> -1 AndAlso g_lngListIdx <> -1 Then
                    Exit For
                End If
            Next w_lngLoop

            'グループインデックスorリストインデックスが見つからなかったら処理終了
            If g_lngGroupIdx = -1 OrElse g_lngListIdx = -1 Then
                Exit Sub
            End If

            If (M_OVERKINMU_RESCD).Equals(m_strDispMenu) Then
                m_strSelChildMenu = M_APPRO_PERSONAL_OVER
            Else
                m_strSelChildMenu = ""
            End If

            w_intStaffIdx = lvwDeptStaff.Items.Count
            m_blnKinmuDeptDspFlg = False
            If w_intStaffIdx > 0 Then

                w_intStaffIdx = lvwDeptStaff.SelectedItems(0).Index
                g_strTargetStaffMngID = m_udtStaffData(w_intStaffIdx + 1).strStaffMngID
                m_strSelectStaffMngID = g_strTargetStaffMngID
            Else
                w_intStaffIdx = 0
                g_strTargetStaffMngID = ""
                m_strSelectStaffMngID = ""
            End If

            m_blnKinmuDeptDspFlg = True
            '個人業務処理呼出
            Call sList_Personal()

            vstKinmuDept.Visible = True

        Catch ex As Exception
            Call General.paTrpMsg(Convert.ToString(Err.Number), W_SUBNAME)
        End Try
    End Sub

    Private Sub setCustomCalendar()

        Dim w_intYear As Integer
        Dim w_intMonth As Integer
        Dim w_intDate As Integer

        '一週間の曜日表示を設定
        Call AidGeneral.SetWeeklyLabels(lblDate2)

        w_intYear = Integer.Parse(Format(m_CalDate, "yyyy"))
        w_intMonth = Integer.Parse(Format(m_CalDate, "MM")) - 1
        w_intDate = General.paGetDateIntegerFromDate(m_CalDate)

        Call AidGeneral.paCalendarSelectedMonthsChanged2(w_intMonth, w_intDate, w_intYear, lblDate, lblDate2, lblDate3)

    End Sub

    Private Sub subSetControlList()

        lblDate = New List(Of Label)
        lblDate2 = New List(Of Label)
        lblDate3 = New List(Of Label)
        subSetControl("_lblDate_", lblDate)
        subSetControl("_lblDate2_", lblDate2)
        subSetControl("_lblDate3_", lblDate3)

        For Each w_control As Control In lblDate
            '日付表示部に対しイベントの追加
            AddHandler w_control.Click,
                        AddressOf lblDate_Click
        Next

    End Sub

    Private Sub subSetControl(ByVal p_strControlName As String, ByVal p_list As List(Of Label))

        Dim w_index As Integer = 0
        Dim w_control As Control

        While True
            w_control = PnlCalendar.Controls(p_strControlName & w_index)
            If w_control Is Nothing Then
                Exit While
            Else

                p_list.Add(w_control)
                w_index += 1
            End If
        End While
    End Sub


    Private Sub lblDate_Click(ByVal eventSender As System.Object, ByVal eventArgs As System.EventArgs)
        Dim Index As Integer = lblDate.IndexOf(eventSender)

        Dim w_intSelectDate As Integer
        Dim w_selDate As Date

        w_intSelectDate = AidGeneral.GetSelectDate4(lblDate, lblDate3, Index, AidGeneral.SelectDate)
        w_selDate = General.paGetDateFromDateInteger(w_intSelectDate)

        'ﾒｲﾝﾌｫｰﾑ ﾏｳｽﾎﾟｲﾝﾀ "砂時計"に変更
        Me.Cursor = System.Windows.Forms.Cursors.WaitCursor

        'ｶﾚﾝﾀﾞｰｸﾗｽへ変更後の日付書込み
        m_CalDate = w_selDate

        '日別超過勤務入力用日付
        m_DayOverSelectDate = w_selDate
        m_DayOverSelectFrom = w_selDate
        m_DayOverSelectTo = DateAdd(Microsoft.VisualBasic.DateInterval.Day, -1, DateAdd(Microsoft.VisualBasic.DateInterval.Month, 1, m_DayOverSelectFrom))
        '=============================================================================

        '選択している部署が無い場合は、処理しない
        If m_lngDefDeptIdx = 0 Then
            'ﾒｲﾝﾌｫｰﾑ ﾏｳｽﾎﾟｲﾝﾀ "既定値"に変更
            Me.Cursor = System.Windows.Forms.Cursors.Default
            Exit Sub
        End If

        Select Case g_MenuM(g_lngGroupIdx).ListBarMenu(g_lngListIdx).strResCD

            Case M_DEPT_RESCD
                If (M_DEPT_KINMUINFO).Equals(m_strSelChildMenu) Then
                    m_bolCarenderFlg = True
                    vseCover.Visible = True
                    vseCover.Left = albMenu.Left
                    vseCover.Width = Me.Width
                    vseCover.Top = 97
                    vseCover.Height = albMenu.Height
                    fraDataGet.Left = vseCover.Width / 3
                    fraDataGet.Top = vseCover.Height / 3
                    Call vseCover.BringToFront()
                    System.Windows.Forms.Application.DoEvents()
                    '勤務状況表示中の場合のみ
                    Call tvwKinmuDept_NodeClick(tvwKinmuDept, New System.Windows.Forms.TreeViewEventArgs(tvwKinmuDept.Nodes.Find(M_NodeKey_DEPT & Convert.ToString(m_lngDefDeptIdx), True)(0)))

                    '勤務部署ツリービュー 作成
                    Call sSetKinmuDeptTreeView()
                    vseCover.Visible = False
                    m_bolCarenderFlg = False
                End If

            Case M_DAKOKU_RESCD
                '出退勤 の場合 勤務者一覧ﾘｽﾄ変更
                Call tvwKinmuDept_NodeClick(tvwKinmuDept, New System.Windows.Forms.TreeViewEventArgs(tvwKinmuDept.Nodes.Find(M_NodeKey_DEPT & Convert.ToString(m_lngDefDeptIdx), True)(0)))

            Case M_ZAIIN_RESCD
                '在院状況 の場合 勤務者一覧ﾘｽﾄ変更
                Call tvwKinmuDept_NodeClick(tvwKinmuDept, New System.Windows.Forms.TreeViewEventArgs(tvwKinmuDept.Nodes.Find(M_NodeKey_DEPT & Convert.ToString(m_lngDefDeptIdx), True)(0)))

            Case M_DUTY_RESCD
                '日当直者一覧
                Call sList_DutyInfo()
            Case M_OVERKINMU_RESCD
                '時間外

                If (M_STR_DAY).Equals(m_strOverKinmuDispType) Then
                    m_strAppliChange = M_DISP_DAYOVER
                    m_strSelChildMenu = M_APPRO_DAY_OVER ' M_APPRO_DAYOVER

                    Call sList_DayOver()

                Else
                    '修正前は職員一覧タブ→職員一覧タブ遷移時に、遷移後の職員情報を取得せず
                    '(勤務部署タブ→勤務部署タブは遷移後に取得されている)
                    '遷移前の職員情報が遷移後に使われていたため
                    '修正後は勤務部署タブ→勤務部署タブ遷移時のスイッチイベントを呼ぶことによって
                    '遷移後の職員情報を一度取得した後、職員情報タブのスイッチイベントを呼び表示処理をする
                    Dim visible_bk As Boolean = lblSearchData.Visible
                    lblSearchData.Visible = False
                    Call vstKinmuDept_Switch(0, 0, 0)
                    Call vstKinmuDept_Switch(0, 1, 0)
                    lblSearchData.Visible = visible_bk
                End If

        End Select

        'ﾒｲﾝﾌｫｰﾑ ﾏｳｽﾎﾟｲﾝﾀ "既定値"に変更
        Me.Cursor = System.Windows.Forms.Cursors.Default

    End Sub

    '=================================
    'カレンダー初期処理
    '=================================
    Private Sub sSetCalendar()
        Const W_SUBNAME As String = "NSC0000HA sSetCalendar"

        Try
            Dim w_Year As Integer
            Dim w_Month As Integer
            Dim w_Day As Integer
            Dim w_Date As Date
            Dim w_SelMonth As Integer
            Dim w_MinDate As Integer
            Dim w_MaxDate As Integer
            Dim w_NowDate As Integer
            Dim w_MaxChg As Boolean

            '==============================
            '■ｶﾚﾝﾀﾞｰの設定
            '==============================

            'ｶﾚﾝﾀﾞｰ配色の取得
            Call sGetColorNo()

            '日付取得
            w_Date = m_CalDate
            w_Year = w_Date.Year
            w_Month = w_Date.Month
            w_Day = w_Date.Day

            w_MaxDate = General.paGetDateIntegerFromDate(DateSerial(w_Year, w_Month + 1, 1 - 1))
            w_MinDate = General.paGetDateIntegerFromDate(DateSerial(w_Year, w_Month, 1))
            w_NowDate = AidGeneral.SelectDate
            If w_NowDate < w_MinDate Then
                w_MaxChg = True
            ElseIf w_NowDate > w_MaxDate Then
                w_MaxChg = False
            Else
                w_MaxChg = True
            End If

            If w_MaxChg = False Then
                'ｶﾚﾝﾀﾞｰの表示期間の最小値設定(1ヶ月)
                AidGeneral.MinDate = General.DateUtil.paGetDateIntegerFromDate(DateSerial(w_Year, w_Month, 1))
                'ｼｽﾃﾑ日付をｶﾚﾝﾄとする
                AidGeneral.DefaultDate = General.DateUtil.paGetDateIntegerFromDate(DateSerial(w_Year, w_Month, w_Day))
                'ｶﾚﾝﾀﾞｰの表示期間の最大値設定(1ヶ月)
                AidGeneral.MaxDate = General.DateUtil.paGetDateIntegerFromDate(DateSerial(w_Year, w_Month + 1, 1 - 1))
            Else
                'ｶﾚﾝﾀﾞｰの表示期間の最大値設定(1ヶ月)
                AidGeneral.MaxDate = General.DateUtil.paGetDateIntegerFromDate(DateSerial(w_Year, w_Month + 1, 1 - 1))
                'ｼｽﾃﾑ日付をｶﾚﾝﾄとする
                AidGeneral.DefaultDate = General.DateUtil.paGetDateIntegerFromDate(DateSerial(w_Year, w_Month, w_Day))
                'ｶﾚﾝﾀﾞｰの表示期間の最小値設定(1ヶ月)
                AidGeneral.MinDate = General.DateUtil.paGetDateIntegerFromDate(DateSerial(w_Year, w_Month, 1))
            End If

            'カレンダーの日付指定
            w_SelMonth = AidGeneral.SelectMonth
            cmdSelMonth.Text = StrConv(Convert.ToString(w_SelMonth), VbStrConv.Wide) & "月" & Space(1) & General.paLeft(AidGeneral.SelectDate, 4)

            '休日マスタ 取得
            Call sGetHolidayM()

            '時間外ロック取得
            Call sGetOverKinmuLock()

            imdAppliFrom.Text = General.DateUtil.paGetDateStringFromDate(Now, General.G_DATE_ENUM.yyyy_MM) & "/01"
            imdAppliTo.Text = DateAdd(Microsoft.VisualBasic.DateInterval.Day, -1, DateAdd(Microsoft.VisualBasic.DateInterval.Month, 1, Date.Parse(Format(Now, "yyyy/MM"))))
            imdSearchFrom.Text = General.DateUtil.paGetDateStringFromDate(Now, General.G_DATE_ENUM.yyyy_MM) & "/01"
            imdSearchTo.Text = DateAdd(Microsoft.VisualBasic.DateInterval.Day, -1, DateAdd(Microsoft.VisualBasic.DateInterval.Month, 1, Date.Parse(Format(Now, "yyyy/MM"))))
            imdFrom.Text = General.DateUtil.paGetDateStringFromDate(Now, General.G_DATE_ENUM.yyyy_MM) & "/01"
            imdTo.Text = DateAdd(Microsoft.VisualBasic.DateInterval.Day, -1, DateAdd(Microsoft.VisualBasic.DateInterval.Month, 1, Date.Parse(Format(Now, "yyyy/MM"))))

        Catch ex As Exception
            Call General.paTrpMsg(Convert.ToString(Err.Number), W_SUBNAME)
        End Try
    End Sub

    '=====================================
    '休日マスタ情報 取得
    '=====================================
    Private Sub sGetHolidayM()
        Const W_SUBNAME As String = "frmNSC0000HA sGetHolidayM"

        Try
            Dim w_lngRecCnt As Integer
            Dim w_lngLoop As Integer
            Dim w_From As Integer
            Dim w_To As Integer
            Dim w_YYYY As Integer
            Dim w_mmdd As Integer

            '-------------------------
            '   休日・祝日情報 取得
            '-------------------------
            '初期化
            ReDim g_HolidayM(0)

            'ｶﾚﾝﾀﾞｰ表示月のFromTo取得
            w_From = AidGeneral.MinDate
            w_To = AidGeneral.MaxDate

            With General.g_objGetMaster
                .pHospitalCD = General.g_strHospitalCD
                .pHM_FromDate = w_From
                .pHM_ToDate = w_To
                If .mGetHolidayM = False Then

                Else
                    '件数取得
                    w_lngRecCnt = .fHM_DataCount
                    ReDim g_HolidayM(w_lngRecCnt)

                    For w_lngLoop = 1 To w_lngRecCnt
                        '索引
                        .mHM_DataIdx = w_lngLoop

                        '●年
                        w_YYYY = .fHM_YEARF
                        '●月日
                        w_mmdd = .fHM_MONTHDAY
                        '年月日
                        g_HolidayM(w_lngLoop).lngDate = Integer.Parse(General.paFormatZero(w_YYYY, 4) & General.paFormatZero(w_mmdd, 4))

                        '●名称
                        g_HolidayM(w_lngLoop).strName = .fHM_NAME
                        '区分
                        g_HolidayM(w_lngLoop).strHolKbn = .fHM_HOLIDAYBUNRUICD

                    Next w_lngLoop

                End If
            End With

        Catch ex As Exception
            Call General.paTrpMsg(Convert.ToString(Err.Number), W_SUBNAME)
        End Try
    End Sub

    '=========================================
    '勤務部署等のタブページの参照を設定
    '=========================================
    Private Sub subSetvstKinmuDept_TabPages()
        Const W_SUBNAME As String = "frmNSC0000HA subSetvstKinmuDept_TabPages"

        Try
            Dim w_intLoopCnt As Integer

            For w_intLoopCnt = 0 To UBound(m_objKinmuDept_page)

                m_objKinmuDept_page(w_intLoopCnt) = vstKinmuDept.TabPages.Item(w_intLoopCnt)

            Next

        Catch ex As Exception
            Call General.paTrpMsg(Convert.ToString(Err.Number), W_SUBNAME)
        End Try
    End Sub

    '=========================================
    '勤務部署等のタブページを再設定
    '=========================================
    Private Sub subAddvstKinmuDept()
        Const W_SUBNAME As String = "frmNSC0000HA subAddvstKinmuDept"

        Try
            Dim w_intLoopCnt As Integer

            For w_intLoopCnt = 0 To UBound(m_objKinmuDept_page)

                If vstKinmuDept.TabPages.Contains(m_objKinmuDept_page(w_intLoopCnt)) = False Then
                    vstKinmuDept.TabPages.Insert(w_intLoopCnt, m_objKinmuDept_page(w_intLoopCnt))
                End If
            Next

            tvwKinmuDept.Parent = vstKinmuDept.TabPages.Item(0)

        Catch ex As Exception
            Call General.paTrpMsg(Convert.ToString(Err.Number), W_SUBNAME)
        End Try
    End Sub

    Private Sub toolStrip_ItemClicked(ByVal eventSender As System.Object, ByVal eventArgs As System.Windows.Forms.ToolStripItemClickedEventArgs) Handles toolStrip.ItemClicked
        Const W_SUBNAME As String = "NSC0000HA toolStrip_ItemClicked"

        Try
            Select Case eventArgs.ClickedItem.Name
                Case "End"
                    Me.Close()

                    g_End_Flg = True

                Case "LogOff"
                    m_LogOff_Chk = True

                    Me.Close()

                    If m_LogOff_Chk = True Then

                        m_LogOff_Chk = False

                        m_strSelChildMenu = ""

                        m_strDispMenu = ""

                        General.g_RetrieveObj = Nothing
                        General.g_objSecurity = Nothing
                        General.g_objGetData = Nothing
                        General.g_objSelectDate = Nothing
                        General.g_objSelectStaff = Nothing
                        General.g_objGetMaster = Nothing
                        General.g_objIdoData = Nothing
                        General.g_objSelectDept = Nothing
                        General.g_objSyouninData = Nothing
                        General.g_objComCyokin = Nothing
                        General.g_objDutyGroup = Nothing

                        System.Windows.Forms.Application.DoEvents()

                        g_Logoff_Flg = True

                    End If

                Case "Print"
                    '印刷指示ﾒﾆｭｰ 表示
                    Call RunPrint()
            End Select

        Catch ex As Exception
            Call General.paTrpMsg(Convert.ToString(Err.Number), W_SUBNAME)
        End Try
    End Sub

    Private Sub frmNSC0000HA_FormClosing(ByVal eventSender As System.Object, ByVal eventArgs As System.Windows.Forms.FormClosingEventArgs) Handles Me.FormClosing
        Dim Cancel As Boolean = eventArgs.Cancel
        Dim UnloadMode As System.Windows.Forms.CloseReason = eventArgs.CloseReason

        Dim w_strMsg() As String
        Dim w_MsgResult As MsgBoxResult

        'リストビュー幅保存
        Call sSaveFieldWidth()

        If m_LogOff_Chk Then
            'ﾒｲﾝ画面UnLoad
            ReDim w_strMsg(3)
            w_strMsg(1) = "ログオフ"
            w_strMsg(2) = ""
            w_strMsg(3) = ""
            '&1を&2します。よろしいですか？&3
            w_MsgResult = General.paMsgDsp("NS0097", w_strMsg)

            '『はい』ならログオフ
            If w_MsgResult = MsgBoxResult.No Then
                m_LogOff_Chk = False
                eventArgs.Cancel = MsgBoxResult.Cancel
                Exit Sub
            End If
        Else
            If m_blnFormCloseFlg = True Then
                'ﾒｲﾝ画面UnLoad
                ReDim w_strMsg(1)
                w_strMsg(1) = "システム"
                '&1を終了してもよろしいですか？
                w_MsgResult = General.paMsgDsp("NS0159", w_strMsg)

                '『はい』なら画面終了
                If w_MsgResult = MsgBoxResult.No Then
                    eventArgs.Cancel = MsgBoxResult.Cancel
                    Exit Sub
                End If
            End If

            '共通情報ﾃﾞｰﾀ格納配列解放
            Erase g_Kyotuinf
            Erase g_HolidayM
            Erase g_KinmuM
            Erase g_MenuM

            'ｸﾗｽｵﾌﾞｼﾞｪｸﾄ解放
            g_ClsMain = Nothing

            'APStartFlg初期化
            Call General.paSaveSetting(General.G_SYSTEM_WIN7, General.G_STRMAINKEY1, "PSWDISPFLG", "0")

            'ﾃﾞｰﾀﾍﾞｰｽ 接続解除
            Call General.paDisConnect()

            '部品オブジェクト解放
            General.g_objSecurity = Nothing
            General.g_objGetData = Nothing
            General.g_objSelectDate = Nothing
            General.g_objGetMaster = Nothing
            General.g_objIdoData = Nothing
            General.g_objSelectDept = Nothing
            General.g_objSyouninData = Nothing
            General.g_objComCyokin = Nothing
            General.g_objDutyGroup = Nothing

            End
        End If

    End Sub

    Private Sub cmdSelMonth_Click(ByVal eventSender As System.Object, ByVal eventArgs As System.EventArgs) Handles cmdSelMonth.Click
        Const W_SUBNAME As String = "NSC0000HA cmdSelMonth_Click"

        Try
            '表示月選択画面表示
            Call ChangeInputMonth()

            'ｶﾚﾝﾀﾞｰｺﾝﾄﾛｰﾙにﾌｫｰｶｽを戻す
            PnlCalendar.Focus()

        Catch ex As Exception
            Call General.paTrpMsg(Convert.ToString(Err.Number), W_SUBNAME)
        End Try

    End Sub

    Private Sub ChangeInputMonth()
        Const W_SUBNAME As String = "NSC0000HA ChangeInputMonth"

        Try
            Dim w_Form As New frmNSC0000HM
            Dim w_SelMonth As String
            Dim w_Day As Integer
            Dim w_Date As Date

            '対象月選択画面表示
            w_Form.pSelDate = General.paGetDateStringFromDate(m_CalDate, General.G_DATE_ENUM.yyyyMM)

            'フォームロード
            w_Form.ShowDialog(Me)

            If w_Form.pEndState() Then
                w_SelMonth = w_Form.pSelectDate()
            Else
                w_Form = Nothing
                Exit Sub
            End If

            '解放
            w_Form = Nothing


            '選択月が一緒の場合は抜け出し
            If General.DateUtil.paGetDateStringFromDate(m_CalDate, General.G_DATE_ENUM.yyyyMM).Equals(w_SelMonth) Then
                Exit Sub
            End If
            If IsNumeric(Integer.Parse(Format(m_CalDate, "dd"))) = False Then
                w_Day = Integer.Parse(Format(Now, "dd"))
            Else
                If Integer.Parse(Format(m_CalDate, "dd")) <= 0 Then
                    w_Day = 1
                ElseIf Integer.Parse(Format(m_CalDate, "dd")) > 31 Then
                    w_Day = 31
                Else
                    w_Day = Integer.Parse(Format(m_CalDate, "dd"))
                End If
            End If
            Do
                If IsDate(General.paLeft(w_SelMonth, 4) & "/" & General.paRight(w_SelMonth, 2) & "/" & General.paFormatZero(w_Day, 2)) = True Then
                    Exit Do
                Else
                    w_Day = w_Day - 1
                    If w_Day <= 0 Then
                        w_Day = 1
                        w_SelMonth = General.DateUtil.paGetDateStringFromDate(Now, General.G_DATE_ENUM.yyyyMM)
                    End If
                End If
            Loop
            '選択日付をﾌﾟﾛﾊﾟﾃｨに書き込み
            m_CalDate = Date.Parse(General.paLeft(w_SelMonth, 4) & "/" & General.paRight(w_SelMonth, 2) & "/" & General.paFormatZero(w_Day, 2))

            w_Date = New Date(m_CalDate.Year, m_CalDate.Month, 1)
            '対象期間開始日
            m_DateFrom = w_Date
            AidGeneral.Calendar.MinDate = General.paGetDateIntegerFromDate(m_DateFrom)
            '対象期間終了日
            m_DateTo = DateAdd(Microsoft.VisualBasic.DateInterval.Day, -1, DateAdd(Microsoft.VisualBasic.DateInterval.Month, 1, w_Date))
            AidGeneral.Calendar.MinDate = General.paGetDateIntegerFromDate(m_DateTo)

            '対象期間日数
            m_lngPutDateNum = DateDiff(Microsoft.VisualBasic.DateInterval.Day, m_DateFrom, m_DateTo) + 1

            '日別超過勤務入力用日付
            m_DayOverSelectDate = m_CalDate
            m_DayOverSelectFrom = New Date(m_CalDate.Year, m_CalDate.Month, 1)
            m_DayOverSelectTo = DateAdd(Microsoft.VisualBasic.DateInterval.Day, -1, DateAdd(Microsoft.VisualBasic.DateInterval.Month, 1, m_DayOverSelectFrom))

            AidGeneral.SelectDate = General.paGetDateIntegerFromDate(m_CalDate)

            'カレンダー表示を更新する
            Call setCustomCalendar()
            Call sSetCalendar()

            cmdSelMonth.Text = StrConv(Convert.ToString(m_CalDate.Month), VbStrConv.Wide) & "月" & Space(1) & m_CalDate.Year

            Select Case g_MenuM(g_lngGroupIdx).ListBarMenu(g_lngListIdx).strResCD

                Case M_PERSONAL_RESCD
                    '------------
                    '■個人業務
                    '------------
                    Call sList_Personal()
                Case M_DEPT_RESCD, M_DAKOKU_RESCD
                    '---------------------
                    '■部署業務 or 出退勤
                    '---------------------
                    m_bolCarenderFlg = True
                    vseCover.Visible = True
                    vseCover.Left = albMenu.Left
                    vseCover.Width = Me.Width
                    vseCover.Top = 97
                    vseCover.Height = albMenu.Height
                    fraDataGet.Left = vseCover.Width / 3
                    fraDataGet.Top = vseCover.Height / 3
                    Call vseCover.BringToFront()
                    System.Windows.Forms.Application.DoEvents()
                    '選択している部署が無い場合は、処理しない
                    If m_lngDefDeptIdx = 0 Then
                        vseCover.Visible = False
                        Exit Sub
                    End If
                    If g_MenuM(g_lngGroupIdx).ListBarMenu(g_lngListIdx).strResCD = M_DEPT_RESCD Then
                        '●勤務部署ツリービュー 作成
                        Call sSetKinmuDeptTreeView()
                    End If
                    vseCover.Visible = False
                    m_bolCarenderFlg = False

                    Call tvwKinmuDept_NodeClick(tvwKinmuDept, New System.Windows.Forms.TreeViewEventArgs(tvwKinmuDept.Nodes.Find(M_NodeKey_DEPT & Convert.ToString(m_lngDefDeptIdx), True)(0)))
                Case M_DUTY_RESCD
                    '------------
                    '■日当直
                    '------------

                    '選択している部署が無い場合は、処理しない
                    If m_lngDefDeptIdx = 0 Then
                        Exit Sub
                    End If

                    Call sList_DutyInfo()

                Case M_OVERKINMU_RESCD
                    '------------
                    '■時間外
                    '------------
                    '日別時間外
                    If (M_STR_DAY).Equals(m_strOverKinmuDispType) Then

                        '選択している部署が無い場合は、処理しない
                        If m_lngDefDeptIdx = 0 Then
                            Exit Sub
                        End If


                        m_strAppliChange = M_DISP_DAYOVER
                        m_strSelChildMenu = M_APPRO_DAY_OVER

                        sList_DayOver()
                        '個人別時間外
                    Else
                        '修正前は職員一覧タブ→職員一覧タブ遷移時に、遷移後の職員情報を取得せず
                        '(勤務部署タブ→勤務部署タブは遷移後に取得されている)
                        '遷移前の職員情報が遷移後に使われていたため
                        '修正後は勤務部署タブ→勤務部署タブ遷移時のスイッチイベントを呼ぶことによって
                        '遷移後の職員情報を一度取得した後、職員情報タブのスイッチイベントを呼び表示処理をする
                        Dim visible_bk As Boolean = lblSearchData.Visible
                        lblSearchData.Visible = False
                        m_bolCarenderFlg = True
                        Call vstKinmuDept_Switch(0, 0, 0)
                        m_bolCarenderFlg = False
                        Call vstKinmuDept_Switch(0, 1, 0)
                        lblSearchData.Visible = visible_bk

                    End If
                Case M_ZAIIN_RESCD
                    '在院状況 の場合 勤務者一覧ﾘｽﾄ変更
                    Call tvwKinmuDept_NodeClick(tvwKinmuDept, New System.Windows.Forms.TreeViewEventArgs(tvwKinmuDept.Nodes.Find(M_NodeKey_DEPT & Convert.ToString(m_lngDefDeptIdx), True)(0)))

            End Select

        Catch ex As Exception
            Call General.paTrpMsg(Convert.ToString(Err.Number), W_SUBNAME)
        End Try
    End Sub

    Private Sub lvwDeptInfo_Click(ByVal eventSender As System.Object, ByVal eventArgs As System.EventArgs) Handles lvwDeptInfo.Click
        Try
            Dim w_PreErrorProc As String
            w_PreErrorProc = General.g_ErrorProc 'ﾌﾟﾛｼｰｼﾞｬ名の一時待避
            General.g_ErrorProc = "NSC0000HA lvwDeptInfo_Click"

            If lvwDeptInfo.Items.Count <= 0 Then
                General.g_ErrorProc = w_PreErrorProc '待避ﾌﾟﾛｼｰｼﾞｬ名を元に戻す
                Exit Sub
            End If

            '選択アイテムがない場合
            If lvwDeptInfo.SelectedItems.Count < 0 Then
                Exit Sub
            End If

            If g_MenuM(g_lngGroupIdx).ListBarMenu(g_lngListIdx).strResCD = M_STAFFIDO_RESCD Then

                If "1".Equals(m_DisplayMode) Then

                    If UBound(m_udtStaffData) > 0 Then
                        m_lngSelectListIndex = lvwDeptInfo.Items.Item(lvwDeptInfo.FocusedItem.Index).Tag '---2007/07/24 hara change

                    End If

                ElseIf "2".Equals(m_DisplayMode) Then

                End If

            End If

            If lvwDeptInfo.Items.Count > 0 Then
                If lvwDeptInfo.Items.Count >= lvwDeptInfo.FocusedItem.Index Then
                    lvwDeptInfo.Items(lvwDeptInfo.FocusedItem.Index).Selected = True
                End If
            End If

            m_lngSelectListIndex = lvwDeptInfo.Items.Item(lvwDeptInfo.FocusedItem.Index).Tag

            If UBound(m_udtStaffData) < m_lngSelectListIndex Then
                m_strSelectStaffMngID = ""
            Else
                m_strSelectStaffMngID = m_udtStaffData(m_lngSelectListIndex).strStaffMngID
            End If

            General.g_ErrorProc = w_PreErrorProc '待避ﾌﾟﾛｼｰｼﾞｬ名を元に戻す

        Catch ex As Exception
            Throw
        End Try
    End Sub

    Private Sub lvwDeptInfo_DoubleClick(ByVal eventSender As System.Object, ByVal eventArgs As System.EventArgs) Handles lvwDeptInfo.DoubleClick
        Try
            Dim w_PreErrorProc As String
            w_PreErrorProc = General.g_ErrorProc 'ﾌﾟﾛｼｰｼﾞｬ名の一時待避
            General.g_ErrorProc = "frmNSC0000HA lvwDeptInfo_DblClick"

            If lvwDeptInfo.CheckBoxes = False OrElse m_objMouseMovePoint.X > 17 Then

                lvwDeptInfo.Enabled = False

                If g_MenuM(g_lngGroupIdx).ListBarMenu(g_lngListIdx).strResCD = M_STAFFIDO_RESCD Then

                    If m_blnStaffKihonInfo = True Then
                        Call subKihon_Click()
                    End If

                ElseIf g_MenuM(g_lngGroupIdx).ListBarMenu(g_lngListIdx).strResCD = M_PERSONAL_RESCD Then
                    '実績状況が表示されている時
                    If m_strSelChildMenu = M_PER_JISSEKI_DSP Then
                        Call subMenuMainSetData(M_PER_JISSEKI_CHG)
                        '届出状況が表示されている時
                    ElseIf m_strSelChildMenu = M_PER_APPLI_DSP Then
                        Call subMenuMainSetData(M_PER_APPLI_CHG)
                    End If

                    '部署
                ElseIf g_MenuM(g_lngGroupIdx).ListBarMenu(g_lngListIdx).strResCD = M_DEPT_RESCD Then
                    '勤務状況が表示されている時
                    If m_strSelChildMenu = M_DEPT_KINMUINFO Then
                        Call subMenuMainSetData(M_DEPT_JISSEKI_CHG)
                    End If

                    '未承認
                ElseIf g_MenuM(g_lngGroupIdx).ListBarMenu(g_lngListIdx).strResCD = M_APPROVE_RESCD Then
                    '未承認or全表示が表示されている時

                    If m_strSelChildMenu = M_APPRO_DSP Or m_strSelChildMenu = M_APPRO_ALLDSP Then
                        Call subMenuMainSetData(M_APPRO_APPLI_CHG)
                    ElseIf m_strSelChildMenu = M_APPRO_DAYOVER Then
                        Call subMenuMainSetData(M_APPRO_DAYOVER_IN)
                    End If
                    '出退勤
                ElseIf g_MenuM(g_lngGroupIdx).ListBarMenu(g_lngListIdx).strResCD = M_DAKOKU_RESCD Then
                    '出退勤状況表示orエラー表示が表示されている時
                    If m_strSelChildMenu = M_DAKOKU_DSP Or m_strSelChildMenu = M_DAKOKU_ERROR_DSP Then
                        Call subMenuMainSetData(M_DAKOKU_JISSEKI_DSP)
                    End If
                    '日当直
                ElseIf g_MenuM(g_lngGroupIdx).ListBarMenu(g_lngListIdx).strResCD = M_DUTY_RESCD Then
                    'ダブルクリック対応なし
                    '在院照会
                ElseIf g_MenuM(g_lngGroupIdx).ListBarMenu(g_lngListIdx).strResCD = M_ZAIIN_RESCD Then
                    'ダブルクリック対応なし

                    '時間外
                ElseIf g_MenuM(g_lngGroupIdx).ListBarMenu(g_lngListIdx).strResCD = M_OVERKINMU_RESCD Then
                    '勤務状況が表示されている時
                    If m_strOverKinmuDispType = M_STR_DAY Then
                        Call subMenuMainSetData(M_APPRO_DAY_OVER_JISSEKI_CHG)
                    End If
                End If

                lvwDeptInfo.Enabled = True

            End If
            General.g_ErrorProc = w_PreErrorProc '待避ﾌﾟﾛｼｰｼﾞｬ名を元に戻す
        Catch ex As Exception
            Throw
        End Try
    End Sub

    Private Sub lvwDeptInfo_MouseUp(ByVal eventSender As System.Object, ByVal eventArgs As System.Windows.Forms.MouseEventArgs) Handles lvwDeptInfo.MouseUp
        Const W_SUBNAME As String = "NSC0000HA lvwDeptInfo_MouseUp"

        Try
            If fncPopUpMenu_MouseUp(M_LISTVIEW, lvwDeptInfo, eventArgs.Button, System.Windows.Forms.Control.ModifierKeys, eventArgs.X, eventArgs.Y) = False Then
                Exit Sub
            End If

        Catch ex As Exception
            Call General.paTrpMsg(Convert.ToString(Err.Number), W_SUBNAME)
        End Try
    End Sub

    Private Sub lvwDeptInfo_ColumnClick(ByVal eventSender As System.Object, ByVal eventArgs As System.Windows.Forms.ColumnClickEventArgs) Handles lvwDeptInfo.ColumnClick
        Dim ColumnHearder As System.Windows.Forms.ColumnHeader = lvwDeptInfo.Columns(eventArgs.Column)
        Const W_SUBNAME As String = "NSC0000HA lvwDeptInfo_ColumnClick"
        Try
            Static w_numSortOrder As Integer
            Static w_numSortKey As Integer
            Dim kbn As Integer
            With lvwDeptInfo
                '通常は文字列ソート
                kbn = 0
                If "表示NO".Equals(.Columns(eventArgs.Column).Text) Then
                    '表示NO時は数値ソート
                    kbn = 1
                End If
                '前回のSortKeyと違えば、昇順で並び替え
                If w_numSortKey <> (ColumnHearder.Index - 1) Then
                    w_numSortOrder = System.Windows.Forms.SortOrder.Descending
                End If

                If w_numSortOrder = System.Windows.Forms.SortOrder.Ascending Then
                    '降順で並び替え
                    w_numSortOrder = System.Windows.Forms.SortOrder.Descending
                    .ListViewItemSorter = New AidGeneral.ListViewItemComparer(eventArgs.Column, 1, kbn)
                    .ListViewItemSorter = Nothing
                Else
                    '昇順で並び替え
                    w_numSortOrder = System.Windows.Forms.SortOrder.Ascending
                    .ListViewItemSorter = New AidGeneral.ListViewItemComparer(eventArgs.Column, 0, kbn)
                    .ListViewItemSorter = Nothing
                End If

                w_numSortKey = ColumnHearder.Index - 1

            End With
        Catch ex As Exception
            Call General.paTrpMsg(Convert.ToString(Err.Number), W_SUBNAME)
        End Try
    End Sub

    Private Sub lvwDeptInfo_ItemSelectionChanged(ByVal eventSender As System.Object, ByVal eventArgs As System.Windows.Forms.ListViewItemSelectionChangedEventArgs) Handles lvwDeptInfo.ItemSelectionChanged

        With lvwDeptInfo
            If IsNothing(.FocusedItem) Then
                Exit Sub
            End If

            If IsNothing(.FocusedItem) = False And .SelectedItems.Count = 0 Then
                .Items.Item(.FocusedItem.Index).Focused = True
                .Items.Item(.FocusedItem.Index).Selected = True
                .Select()
                Exit Sub
            End If
        End With
    End Sub

    Private Sub cmdSelectTime_Click(ByVal senderArgs As System.Object, ByVal eventArgs As System.EventArgs) Handles cmdSelectTime.Click
        Const W_SUBNAME As String = "NSC0000HA cmdSelectTime_Click"

        Try
            '表示月選択画面表示
            Call ChangeInputTime()

        Catch ex As Exception
            Call General.paTrpMsg(Convert.ToString(Err), W_SUBNAME)
        End Try
    End Sub

    Private Sub imtSelectTime_DoubleClick(ByVal senderArgs As System.Object, ByVal eventArgs As System.EventArgs)
        Call cmdSelectTime_Click(senderArgs, eventArgs)
    End Sub

    Private Sub ChangeInputTime()
        Const W_SUBNAME As String = "NSC0000HA ChangeInputTime"

        Try
            Dim w_Form As frmNSC0000HE = New frmNSC0000HE
            Dim w_SelTime As String

            '対象月選択画面表示
            w_Form.pSelDate(General.paGetDateStringFromDate(m_CalDate, General.G_DATE_ENUM.yyyyMMdd)) = imtSelectTime.GetHourTime & imtSelectTime.GetMinTime

            'フォームロード
            w_Form.ShowDialog(Me)

            If w_Form.pEndState() = False Then
                w_Form = Nothing
                Exit Sub
            Else
                w_SelTime = w_Form.pSelTime()
            End If

            '解放
            w_Form = Nothing

            '選択時間が一緒の場合は抜け出し
            If (imtSelectTime.GetHourTime & imtSelectTime.GetMinTime).Equals(w_SelTime) Then
                Exit Sub
            End If

            imtSelectTime.Text = Format(Integer.Parse(w_SelTime), "00:00")
            lblTime.Text = imtSelectTime.Text

            Select Case g_MenuM(g_lngGroupIdx).ListBarMenu(g_lngListIdx).strResCD

                Case M_DAKOKU_RESCD
                    '------------
                    '■出退勤
                    '------------
                    Call sList_DeptInfo()
                Case M_ZAIIN_RESCD
                    '---------------------
                    '■在院
                    '---------------------
                    Call sList_ZaiinInfo()
            End Select

            lblSearchData.Text = Format(m_CalDate, "yyyy年MM月dd日") & "(" & Format$(m_CalDate, "ddd") & ")" & Space$(2) & Format(Integer.Parse(w_SelTime), "00:00")
            'lblSearchData.Font = New Font("ＭＳ ゴシック", 11, FontStyle.Bold)
            lblSearchData.ForeColor = Color.Blue

        Catch ex As Exception
            Call General.paTrpMsg(Convert.ToString(Err), W_SUBNAME)
        End Try
    End Sub

    Private Sub cmdKinmuti_Click(ByVal senderArgs As System.Object, ByVal eventArgs As System.EventArgs) Handles cmdKinmuti.Click
        Const W_SUBNAME As String = "NSC0000HA cmdKinmuti_Click"

        Try
            Dim w_tmpBusyoCD As String

            w_tmpBusyoCD = m_strSelBusyoCD

            With General.g_objSelectDept
                .pDP_TargetDeptCD = m_strSelBusyoCD
                .pDP_GetDeptFlg = "1"
                .pDP_AddKoumoku = "すべて"
                .pSecurityObj = General.g_objSecurity
                .pDP_ResourceCD = g_MenuM(g_lngGroupIdx).ListBarMenu(g_lngListIdx).strResCD
                .pDP_SecUseFlg = 1
                .pDP_AuthRangeKbn = 0

                'カレンダーダイアログを表示する
                Call .mShowDeptForm()

                '値が設定されている場合はその値を取得
                If .fDP_EndStatus = True Then
                    m_strSelBusyoCD = .fDP_DeptCD
                    m_strSelBusyoNM = .fDP_DeptName
                End If

            End With

            lblKinmuti.Text = m_strSelBusyoNM

            If w_tmpBusyoCD.Equals(m_strSelBusyoCD) = False Then
                If (m_strSelChildMenu).Equals(M_APPRO_DAYOVER) Then
                    Call sList_DayOver()
                Else
                    Call sList_ApproveInfo()
                End If
            End If

        Catch ex As Exception
            Call General.paTrpMsg(Convert.ToString(Err), W_SUBNAME)
        End Try
    End Sub

    ''' <summary>
    ''' 日当直ツリービュークリック処理
    ''' </summary>
    ''' <param name="eventSender"></param>
    ''' <param name="eventArgs"></param>
    ''' <remarks></remarks>
    Private Sub tvwDuty_NodeClick(ByVal eventSender As System.Object, ByVal eventArgs As System.Windows.Forms.TreeViewEventArgs) Handles tvwDuty.AfterSelect
        Dim Node As System.Windows.Forms.TreeNode = eventArgs.Node
        Const W_SUBNAME As String = "NSC0000HA tvwDuty_NodeClick"

        Try
            '選択されたノードINDEXの設定
            '親ノードと子ノードのINDEXは個別に存在するが、親ノードクリック時に『すべて』選択と同じ挙動だった為にそのまま代入している
            m_lngSelectDutyIdx = Node.Index

            If g_DutyMaster(m_lngSelectDutyIdx).strCD.Equals(m_strDispDutyGroupCD) = False Then
                '日当直
                Call sList_DutyInfo()
            End If

            m_strDispDutyGroupCD = g_DutyMaster(m_lngSelectDutyIdx).strCD

        Catch ex As Exception
            Call General.paTrpMsg(Convert.ToString(Err.Number), W_SUBNAME)
        End Try
    End Sub

    Private Sub cmdPersonalFrom_Click(ByVal sender As System.Object, ByVal e As System.EventArgs) Handles cmdPersonalFrom.Click
        Const W_SUBNAME As String = "frmNSC0000HA cmdPersonalFrom_Click"

        Try
            Dim w_strMsg() As String
            Dim w_lngDate As Integer

            w_lngDate = General.paGetDateIntegerFromDate(imdFrom.Value)

            With General.g_objSelectDate
                .LetMaxDate = General.G_DEFAULT_MAX_DATE '表示可能最大日付(yyyyMMdd)
                .LetMinDate = General.G_DEFAULT_MIN_DATE '表示可能最小日付(yyyyMMdd)
                If IsNothing(imdFrom.Value) = False Then
                    .letdefaultdate = General.paGetDateIntegerFromDate(imdFrom.Value) '初期表示日付(yyyyMMdd)
                Else
                    .letdefaultdate = 0
                End If

                'カレンダーダイアログを表示する
                Call .ShowDateForm()

                '値が設定されている場合はその値を取得
                If .GetEndStatus = True Then
                    w_lngDate = .GetSelectDate '値を取得(yyyyMMdd)
                End If
            End With

            '日付が変更されていない場合
            If imdFrom.Text.Equals(General.paGetDateStringFromInteger(w_lngDate)) Then
                Exit Sub
            End If

            '日付逆転チェック
            '開始年月日＞終了年月日
            If w_lngDate > General.paGetDateIntegerFromDate(imdTo.Value) Then
                '&1には&2より未来の日付は指定できません。
                'NS0092

                ReDim w_strMsg(2)
                w_strMsg(1) = "開始日"
                w_strMsg(2) = "終了日"

                Call General.paMsgDsp("NS0092", w_strMsg)

                Exit Sub

            End If

            imdFrom.Text = General.paGetDateStringFromInteger(w_lngDate) '値を取得(yyyyMMdd)

            '届出一覧
            Call sList_Personal()

        Catch ex As Exception
            Call General.paTrpMsg(Convert.ToString(Err.Number), W_SUBNAME)
        End Try
    End Sub

    Private Sub cmdPersonalTo_Click(ByVal sender As System.Object, ByVal e As System.EventArgs) Handles cmdPersonalTo.Click
        Const W_SUBNAME As String = "frmNSC0000HA cmdPersonalTo_Click"

        Try
            Dim w_strMsg() As String
            Dim w_lngDate As Integer

            w_lngDate = General.paGetDateIntegerFromDate(imdTo.Value)

            With General.g_objSelectDate
                .LetMaxDate = General.G_DEFAULT_MAX_DATE  '表示可能最大日付(yyyyMMdd)
                .LetMinDate = General.G_DEFAULT_MIN_DATE  '表示可能最小日付(yyyyMMdd)
                If IsNothing(imdTo.Value) = False Then
                    .letdefaultdate = General.paGetDateIntegerFromDate(imdTo.Value) '初期表示日付(yyyyMMdd)
                Else
                    .letdefaultdate = 0
                End If

                'カレンダーダイアログを表示する
                Call .ShowDateForm()

                '値が設定されている場合はその値を取得
                If .GetEndStatus = True Then
                    w_lngDate = .GetSelectDate '値を取得(yyyyMMdd)
                End If
            End With

            '日付が変更されていない場合
            If imdTo.Text.Equals(General.paGetDateStringFromInteger(w_lngDate)) Then
                Exit Sub
            End If

            '日付逆転チェック
            '開始年月日＞終了年月日
            If General.paGetDateIntegerFromDate(imdFrom.Value) > w_lngDate Then

                ReDim w_strMsg(2)
                w_strMsg(1) = "終了日"
                w_strMsg(2) = "開始日"

                Call General.paMsgDsp("NS0050", w_strMsg)

                Exit Sub

            End If

            imdTo.Text = General.paGetDateStringFromInteger(w_lngDate) '値を取得(yyyyMMdd)

            '届出一覧
            Call sList_Personal()

        Catch ex As Exception
            Call General.paTrpMsg(Convert.ToString(Err.Number), W_SUBNAME)
        End Try
    End Sub

    Private Sub cmdPersonalDataCalFrom_Click(ByVal sender As System.Object, ByVal e As System.EventArgs) Handles cmdPersonalDataCalFrom.Click
        Const W_SUBNAME As String = "frmNSC0000HA cmdPersonalDataCalFrom_Click"

        Try
            With General.g_objSelectDate
                .LetMaxDate = General.G_DEFAULT_MAX_DATE  '表示可能最大日付(yyyyMMdd)
                .LetMinDate = General.G_DEFAULT_MIN_DATE  '表示可能最小日付(yyyyMMdd)
                If IsNothing(imdSearchFrom.Value) = False Then
                    .letdefaultdate = General.paGetDateIntegerFromDate(imdSearchFrom.Value) '初期表示日付(yyyyMMdd)
                Else
                    .letdefaultdate = 0
                End If

                'カレンダーダイアログを表示する
                Call .ShowDateForm()

                '値が設定されている場合はその値を取得
                If .GetEndStatus = True Then
                    imdSearchFrom.Text = General.paGetDateStringFromInteger(.GetSelectDate) '値を取得(yyyyMMdd)
                End If
            End With

        Catch ex As Exception
            Call General.paTrpMsg(Convert.ToString(Err.Number), W_SUBNAME)
        End Try
    End Sub

    Private Sub cmdPersonalDataCalTo_Click(ByVal sender As System.Object, ByVal e As System.EventArgs) Handles cmdPersonalDataCalTo.Click
        Const W_SUBNAME As String = "frmNSC0000HA cmdPersonalDataCalTo_Click"

        Try
            With General.g_objSelectDate
                .LetMaxDate = General.G_DEFAULT_MAX_DATE  '表示可能最大日付(yyyyMMdd)
                .LetMinDate = General.G_DEFAULT_MIN_DATE  '表示可能最小日付(yyyyMMdd)
                If IsNothing(imdSearchTo.Value) = False Then
                    .letdefaultdate = General.paGetDateIntegerFromDate(imdSearchTo.Value) '初期表示日付(yyyyMMdd)
                Else
                    .letdefaultdate = 0
                End If

                'カレンダーダイアログを表示する
                Call .ShowDateForm()

                '値が設定されている場合はその値を取得
                If .GetEndStatus = True Then
                    imdSearchTo.Text = General.paGetDateStringFromInteger(.GetSelectDate) '値を取得(yyyyMMdd)
                End If
            End With

        Catch ex As Exception
            Call General.paTrpMsg(Convert.ToString(Err.Number), W_SUBNAME)
        End Try
    End Sub

    Private Sub cmdApproveInfoCalFrom_Click(ByVal sender As System.Object, ByVal e As System.EventArgs) Handles cmdApproveInfoCalFrom.Click
        Const W_SUBNAME As String = "frmNSC0000HA cmdApproveInfoCalFrom_Click"

        Try
            Dim w_strMsg() As String
            Dim w_lngDate As Integer

            w_lngDate = General.paGetDateIntegerFromDate(imdAppliFrom.Text)

            With General.g_objSelectDate
                .LetMaxDate = General.G_DEFAULT_MAX_DATE  '表示可能最大日付(yyyyMMdd)
                .LetMinDate = General.G_DEFAULT_MIN_DATE  '表示可能最小日付(yyyyMMdd)
                If IsNothing(imdAppliFrom.Text) = False Then
                    .letdefaultdate = General.paGetDateIntegerFromDate(imdAppliFrom.Text) '初期表示日付(yyyyMMdd)
                Else
                    .letdefaultdate = 0
                End If

                'カレンダーダイアログを表示する
                Call .ShowDateForm()

                '値が設定されている場合はその値を取得
                If .GetEndStatus = True Then
                    w_lngDate = .GetSelectDate '値を取得(yyyyMMdd)
                End If
            End With

            '日付が変更されていない場合
            If imdAppliFrom.Text.Equals(General.paGetDateStringFromInteger(w_lngDate)) Then
                Exit Sub
            End If

            '日付逆転チェック
            '開始年月日＞終了年月日
            If w_lngDate > General.paGetDateIntegerFromDate(imdAppliTo.Text) Then
                '&1には&2より未来の日付は指定できません。
                'NS0092

                ReDim w_strMsg(2)
                w_strMsg(1) = "開始日"
                w_strMsg(2) = "終了日"

                Call General.paMsgDsp("NS0092", w_strMsg)

                Exit Sub

            End If

            imdAppliFrom.Text = General.paGetDateStringFromInteger(w_lngDate) '値を取得(yyyyMMdd)

            '未承認画面再表示
            Call sList_ApproveInfo()

        Catch ex As Exception
            Call General.paTrpMsg(Convert.ToString(Err.Number), W_SUBNAME)
        End Try
    End Sub

    Private Sub cmdApproveInfoCalTo_Click(ByVal sender As System.Object, ByVal e As System.EventArgs) Handles cmdApproveInfoCalTo.Click
        Const W_SUBNAME As String = "frmNSC0000HA cmdApproveInfoCalTo_Click"

        Try
            Dim w_strMsg() As String
            Dim w_lngDate As Integer

            w_lngDate = General.paGetDateIntegerFromDate(imdAppliTo.Text)

            With General.g_objSelectDate
                .LetMaxDate = General.G_DEFAULT_MAX_DATE  '表示可能最大日付(yyyyMMdd)
                .LetMinDate = General.G_DEFAULT_MIN_DATE  '表示可能最小日付(yyyyMMdd)
                If IsNothing(imdAppliTo.Text) = False Then
                    .letdefaultdate = General.paGetDateIntegerFromDate(imdAppliTo.Text) '初期表示日付(yyyyMMdd)
                Else
                    .letdefaultdate = 0
                End If

                'カレンダーダイアログを表示する
                Call .ShowDateForm()

                '値が設定されている場合はその値を取得
                If .GetEndStatus = True Then
                    w_lngDate = .GetSelectDate '値を取得(yyyyMMdd)
                End If
            End With

            '日付が変更されていない場合
            If imdAppliTo.Text.Equals(General.paGetDateStringFromInteger(w_lngDate)) Then
                Exit Sub
            End If

            '日付逆転チェック
            '開始年月日＞終了年月日
            If General.paGetDateIntegerFromDate(imdAppliFrom.Text) > w_lngDate Then
                '&1には&2より過去の日付は指定できません。
                'NS0050

                ReDim w_strMsg(2)
                w_strMsg(1) = "終了日"
                w_strMsg(2) = "開始日"

                Call General.paMsgDsp("NS0050", w_strMsg)

                Exit Sub

            End If

            imdAppliTo.Text = General.paGetDateStringFromInteger(w_lngDate) '値を取得(yyyyMMdd)

            '未承認画面再表示
            Call sList_ApproveInfo()

        Catch ex As Exception
            Call General.paTrpMsg(Convert.ToString(Err.Number), W_SUBNAME)
        End Try
    End Sub

    '===============================================
    '勤務作成画面確認処理
    '===============================================
    Private Function fncCheckMakeKinmu() As Boolean
        Const W_SUBNAME As String = "NSC0000HA fncCheckMakeKinmu"

        Try
            Dim w_strMsg() As String
            Dim w_Form As frmNSC0000HD = New frmNSC0000HD
            Dim w_MsgRc As Integer
            Dim w_lngLoop2 As Integer

            Const MC_RESOURCE_PLAN As String = "NSK0000HA02"
            Const MC_RESOURCE_RESULT As String = "NSK0000HA03"

            '必須チェック
            '勤務部署選択ﾁｪｯｸ
            If String.IsNullOrEmpty(Trim(General.g_strSelKinmuDeptCD)) Then
                ReDim w_strMsg(1)
                w_strMsg(1) = "勤務部署"
                Call General.paMsgDsp("NS0002", w_strMsg)
                Exit Function
            End If
            '選択施設の検索
            For w_lngLoop2 = 1 To UBound(g_Kyotuinf)
                If (g_Kyotuinf(w_lngLoop2).ByoinCD).Equals(General.g_strHospitalCD) Then
                    Exit For
                End If
            Next w_lngLoop2

            'システム開始日 設定ﾁｪｯｸ
            If g_Kyotuinf(w_lngLoop2).Sysdate <= 0 Then
                'ﾒｯｾｰｼﾞの表示
                ReDim w_strMsg(1)
                w_strMsg(1) = "システム開始日"
                Call General.paMsgDsp("NS0032", w_strMsg)
                Exit Function
            End If


            '勤務 存在ﾁｪｯｸ
            If fncDeptKinmu() = False Then
                'ERRORの場合
                ReDim w_strMsg(1)
                w_strMsg(1) = "部署別勤務情報"
                Call General.paMsgDsp("NS0031", w_strMsg)
                Exit Function
            End If

            '対象月選択画面表示
            w_Form.pMode = m_strStartMode

            If w_Form.pLoadOK = True Then
                w_Form.ShowDialog(Me)

                If w_Form.pEndStatus() = False Then

                Else
                    '========================
                    '■新規作成の場合
                    '========================

                    m_lngPlanNo = w_Form.pPlanNo()

                    If (General.G_PGMSTARTFLG_NEWPLAN).Equals(m_strStartMode) Then
                        '新規作成時のアカウントは "K0021"
                        '締切日権限ﾁｪｯｸ
                        If AccountChk_Simekiri(MC_RESOURCE_PLAN) = False Then
                            If m_blnHopeFlg = True Then
                                If Get_KeikakuF(m_lngPlanNo, "3") = False Then
                                    '締切日が過ぎていて権限なし
                                    ReDim w_strMsg(1)
                                    w_strMsg(1) = "締切日を過ぎているため~n希望勤務を"

                                    Call General.paMsgDsp("NS0099", w_strMsg)
                                    Exit Function
                                End If
                            Else
                                If Get_KeikakuF(m_lngPlanNo, "0") = False Then
                                    '締切日が過ぎていて権限なし
                                    ReDim w_strMsg(1)
                                    w_strMsg(1) = "締切日を過ぎているため~n勤務を"

                                    Call General.paMsgDsp("NS0099", w_strMsg)
                                    Exit Function
                                End If
                            End If
                        End If

                        If m_blnHopeFlg = True Then
                            If SearchKakuteiData(m_lngPlanNo) = True Then

                                ReDim w_strMsg(2)
                                w_strMsg(1) = "勤務が確定されている期間"
                                w_strMsg(2) = "希望勤務"

                                Call General.paMsgDsp("NS0011", w_strMsg)
                                Exit Function
                            End If
                        End If
                        '---------------------------------------


                        '確定済みか否かを設定する
                        If SearchKakuteiData(m_lngPlanNo) = True Then
                            '確定済みの場合
                            'メッセージ表示
                            ReDim w_strMsg(0)
                            w_MsgRc = General.paMsgDsp("NS0140", w_strMsg)
                            If w_MsgRc = MsgBoxResult.No Then
                                Exit Function
                            End If
                        End If

                    ElseIf (General.G_PGMSTARTFLG_CHANGEJISSEKI).Equals(m_strStartMode) Then
                        '========================
                        '■勤務変更のとき
                        '========================
                        '確定済みか否かを設定する
                        If SearchKakuteiData(m_lngPlanNo) = False Then
                            '未確定の場合
                            'メッセージ表示
                            ReDim w_strMsg(0)
                            Call General.paMsgDsp("NS0141", w_strMsg)
                            Exit Function
                        End If
                    Else
                        '========================
                        '■計画変更のとき
                        '========================

                        If m_blnHopeFlg = True Then
                            If SearchKakuteiData(m_lngPlanNo) = True Then

                                ReDim w_strMsg(2)
                                w_strMsg(1) = "勤務が確定されている期間"
                                w_strMsg(2) = "希望勤務"

                                Call General.paMsgDsp("NS0011", w_strMsg)
                                Exit Function
                            End If
                        End If

                        '確定済みか否かを設定する
                        If SearchKakuteiData(m_lngPlanNo) = False Then
                            '未確定の場合
                            'メッセージ表示
                            ReDim w_strMsg(0)
                            Call General.paMsgDsp("NS0141", w_strMsg)
                            Exit Function
                        End If
                        '締切日権限ﾁｪｯｸ
                        If AccountChk_Simekiri(MC_RESOURCE_RESULT) = False Then
                            If m_blnHopeFlg = True Then
                                If Get_KeikakuF(m_lngPlanNo, "3") = False Then
                                    '締切日が過ぎていて権限なし
                                    ReDim w_strMsg(1)
                                    w_strMsg(1) = "締切日を過ぎているため~n希望勤務を"

                                    Call General.paMsgDsp("NS0099", w_strMsg)
                                    Exit Function
                                End If
                            Else
                                If Get_KeikakuF(m_lngPlanNo, "2") = False Then
                                    '締切日が過ぎていて権限なし
                                    ReDim w_strMsg(1)
                                    w_strMsg(1) = "締切日を過ぎているため~n勤務を"

                                    Call General.paMsgDsp("NS0099", w_strMsg)
                                    Exit Function
                                End If
                            End If
                        End If
                    End If

                    '正常終了
                    fncCheckMakeKinmu = True
                End If
            Else

            End If

            '解放
            w_Form = Nothing

        Catch ex As Exception
            Call General.paTrpMsg(Convert.ToString(Err.Number), W_SUBNAME)
        End Try
    End Function

    '===================================================================
    '　超勤データの有無チェック
    '===================================================================
    Private Function fncChkOverKinmuData(ByRef p_MsgCD As String) As Boolean
        Const W_SUBNAME As String = "NSC0000HA fncChkOverKinmuData"

        Try
            Dim w_Sql As String
            Dim w_Rs As ADODB.Recordset
            Dim w_Start_F As ADODB.Field
            Dim w_End_F As ADODB.Field
            Dim w_Index As Integer
            Dim w_lngStartDate As Integer '対象期間の開始年月日
            Dim w_lngToDate As Integer '対象期間の終了年月日
            Dim w_RecCnt As Integer 'レコード件数
            Dim w_lngLoop1 As Integer
            Dim w_lngLoop2 As Integer
            Dim w_lngLoop3 As Integer
            Dim w_lngTargetDate As Integer
            Dim w_lngIdoCnt As Integer
            Dim w_StaffData() As Staff_Type
            Dim w_StaffMngID As String
            Dim w_NewDataFlg As Boolean '新規取得職員フラグ
            Dim w_HaizokuFlg As Boolean '配属フラグ
            Dim w_blnSaikeiFlg As Boolean '20071011 iwasaki add

            '初期化
            fncChkOverKinmuData = False

            '計画制御Ｆから計画番号の期間を取得
            w_Sql = "SELECT PLANPERIODFROM, PLANPERIODTO FROM NS_PLANCONTROL_F "
            w_Sql = w_Sql & "WHERE HOSPITALCD = '" & General.g_strHospitalCD & "' "
            w_Sql = w_Sql & "AND PLANNO = " & m_lngPlanNo & " "
            w_Rs = General.paDBRecordSetOpen(w_Sql)

            If w_Rs.RecordCount <= 0 Then
                '計画制御が取得できない場合(ありえない)
                p_MsgCD = "NS0278"
                Exit Function
            Else
                With w_Rs
                    w_Start_F = .Fields("PLANPERIODFROM")
                    w_End_F = .Fields("PLANPERIODTO")

                    w_lngStartDate = Integer.Parse(General.paGetDbFieldVal(w_Start_F, 0))
                    w_lngToDate = Integer.Parse(General.paGetDbFieldVal(w_End_F, 0))
                End With
            End If

            w_Rs = Nothing

            '再掲部署かどうかを判定
            With General.g_objGetMaster
                .pHospitalCD = General.g_strHospitalCD
                .pKD_KinmuDeptCD = General.g_strSelKinmuDeptCD
                .pKD_KijunDate = w_lngToDate

                w_blnSaikeiFlg = False
                If .mGetKinmuDept = True Then
                    .mKD_KinmuDeptIdx = 1
                    If ("1").Equals(.fKD_SaikeiFlg) Then
                        w_blnSaikeiFlg = True
                    End If
                End If
            End With

            If w_blnSaikeiFlg = False Then
                '期間中に在職する職員を取得
                With General.g_objGetData
                    .p病院CD = General.g_strHospitalCD
                    .pソート順 = 0
                    .pチーム区分 = 0
                    .pシステム区分 = 0
                    .p日付区分 = 1 '日付区分
                    .p開始年月日 = w_lngStartDate '開始年月日
                    .p終了年月日 = w_lngToDate '終了年月日
                    .p勤務対象FLG = 1 '勤務対象FLG
                    .p職員取得FLG = 0 '職員対象フラグ
                    If w_blnSaikeiFlg = True Then
                        .p優先順位 = 9 '再掲部署CDを指定
                    Else
                        .p優先順位 = 0 '勤務部署CDを指定
                    End If

                    .p対象CD = General.g_strSelKinmuDeptCD '勤務部署CD

                    'ﾃﾞｰﾀ取得実行
                    If .mGetStaff = False Then
                        p_MsgCD = "NS0008"
                        'ﾃﾞｰﾀがないとき
                        Exit Function
                    Else
                        '初期化
                        ReDim w_StaffData(0)
                        w_StaffMngID = ""
                        w_NewDataFlg = True

                        'ﾃﾞｰﾀ件数取得
                        w_RecCnt = .f職員件数

                        'ﾃﾞｰﾀ件数分ﾙｰﾌﾟ
                        For w_lngLoop1 = 1 To w_RecCnt

                            'ｲﾝﾃﾞｯｸｽ引渡し
                            .p職員索引 = w_lngLoop1

                            w_StaffMngID = .f職員管理番号2

                            '新しい職員か？
                            For w_lngLoop2 = 1 To UBound(w_StaffData)
                                If (w_StaffMngID).Equals(w_StaffData(w_lngLoop2).strStaffMngID) Then
                                    w_NewDataFlg = False
                                End If
                            Next w_lngLoop2

                            If w_NewDataFlg = True Then
                                '新規の場合
                                '配列拡張
                                w_Index = UBound(w_StaffData) + 1
                                ReDim Preserve w_StaffData(w_Index)

                                w_StaffData(w_Index).strStaffMngID = w_StaffMngID

                                .p病院CD = General.g_strHospitalCD '施設CD
                                .p職員番号変換 = 0 'データ取得
                                .p職員区分 = 0 '職員管理番号で検索
                                .p職員番号 = w_StaffMngID '職員管理番号
                                .p日付区分 = 1 '期間
                                .p開始年月日 = w_lngStartDate
                                .p終了年月日 = w_lngToDate
                                .p履歴ソートFLG = 0 '昇順
                                .pシステム区分 = 1 '職員管理
                                '--データ検索
                                If .mStaffInit = True Then
                                    '採用履歴を取得
                                    w_lngIdoCnt = .f職員管理件数
                                    ReDim w_StaffData(w_Index).SaiyoHistory(w_lngIdoCnt)
                                    For w_lngLoop2 = 1 To w_lngIdoCnt
                                        .p職員管理索引 = w_lngLoop2
                                        w_StaffData(w_Index).SaiyoHistory(w_lngLoop2).lngStartDate = .f採用年月日1
                                        w_StaffData(w_Index).SaiyoHistory(w_lngLoop2).lngEndDate = .f転退年月日1
                                    Next w_lngLoop2

                                    If w_blnSaikeiFlg = False Then
                                        '勤務地異動歴を取得
                                        w_lngIdoCnt = .f勤務地異動件数
                                        ReDim w_StaffData(w_Index).IdoHistory(w_lngIdoCnt)
                                        For w_lngLoop2 = 1 To w_lngIdoCnt
                                            .p勤務地異動索引 = w_lngLoop2
                                            w_StaffData(w_Index).IdoHistory(w_lngLoop2).strCD = .f看護単位CD1
                                            w_StaffData(w_Index).IdoHistory(w_lngLoop2).lngStartDate = .f勤務地異動年月日
                                            w_StaffData(w_Index).IdoHistory(w_lngLoop2).lngEndDate = .f勤務地終了年月日
                                        Next w_lngLoop2
                                    Else
                                        '再掲異動歴を取得
                                        w_lngIdoCnt = .f再掲異動件数
                                        ReDim w_StaffData(w_Index).IdoHistory(w_lngIdoCnt)
                                        For w_lngLoop2 = 1 To w_lngIdoCnt
                                            .p再掲異動索引 = w_lngLoop2
                                            w_StaffData(w_Index).IdoHistory(w_lngLoop2).strCD = .f再掲CD
                                            w_StaffData(w_Index).IdoHistory(w_lngLoop2).lngStartDate = .f再掲異動年月日
                                            w_StaffData(w_Index).IdoHistory(w_lngLoop2).lngEndDate = .f再掲終了年月日
                                        Next w_lngLoop2
                                    End If
                                End If

                                '超勤データ取得
                                .p病院CD = General.g_strHospitalCD
                                .p承認区分 = 2 '0:調整F、1:明細F、2:両方
                                .p職員区分 = 0 '0:職員管理番号
                                .p職員番号 = w_StaffMngID '選択職員管理番号
                                .p日付区分 = 1 '1:期間
                                .p開始年月日 = w_lngStartDate '開始年月日
                                .p終了年月日 = w_lngToDate '終了年月日

                                If .mGetOverKinmu = True Then

                                    w_RecCnt = .f超勤件数
                                    For w_lngLoop2 = 1 To w_RecCnt

                                        .p超勤索引 = w_lngLoop2
                                        '超勤入り日
                                        w_lngTargetDate = .f年月日

                                        '採用期間内であるか
                                        w_HaizokuFlg = False
                                        For w_lngLoop3 = 1 To UBound(w_StaffData(w_Index).SaiyoHistory)
                                            If w_StaffData(w_Index).SaiyoHistory(w_lngLoop3).lngStartDate <= w_lngTargetDate AndAlso w_lngTargetDate <= w_StaffData(w_Index).SaiyoHistory(w_lngLoop3).lngEndDate Then

                                                'ﾌﾗｸﾞをTrue(在職期間内である)
                                                w_HaizokuFlg = True

                                                Exit For
                                            End If
                                        Next w_lngLoop3

                                        '勤務地に所属期間内であるか
                                        If w_HaizokuFlg = True Then
                                            w_HaizokuFlg = False
                                            For w_lngLoop3 = 1 To UBound(w_StaffData(w_Index).IdoHistory)
                                                If (w_StaffData(w_Index).IdoHistory(w_lngLoop3).strCD).Equals(General.g_strSelKinmuDeptCD) AndAlso w_StaffData(w_Index).IdoHistory(w_lngLoop3).lngStartDate <= w_lngTargetDate AndAlso w_lngTargetDate <= w_StaffData(w_Index).IdoHistory(w_lngLoop3).lngEndDate Then

                                                    'ﾌﾗｸﾞをTrue(在職期間内である)
                                                    w_HaizokuFlg = True

                                                    Exit For
                                                End If
                                            Next w_lngLoop3
                                        End If

                                        '配属期間中に超勤が存在した場合、作成画面を展開させない
                                        If w_HaizokuFlg = True Then
                                            p_MsgCD = "NS0278"
                                            Exit Function
                                        End If
                                    Next w_lngLoop2
                                End If
                            End If
                        Next w_lngLoop1
                    End If
                End With
            End If

            fncChkOverKinmuData = True

        Catch ex As Exception
            'ﾏｳｽﾎﾟｲﾝﾀを元に戻す
            Me.Cursor = System.Windows.Forms.Cursors.Default
            Call General.paTrpMsg(Convert.ToString(Err.Number), W_SUBNAME)
        End Try
    End Function

    '勤務部署　勤務情報 存在ﾁｪｯｸ ?
    Private Function fncDeptKinmu() As Boolean
        Const W_SUBNAME As String = "NSK0000A fncDeptKinmu"

        Try
            '初期化
            fncDeptKinmu = False

            'マスタ部品より選択部署の勤務情報を取得
            With General.g_objGetMaster
                .pHospitalCD = General.g_strHospitalCD '施設コード
                .pKN_GetKbn = "1" '勤務部署指定
                .pKN_KinmuDeptCD = General.g_strSelKinmuDeptCD '勤務部署コード

                If .mGetKinmuNameM = False Then
                    Exit Function
                Else
                    '勤務情報あり
                    fncDeptKinmu = True
                End If

            End With

        Catch ex As Exception
            Call General.paTrpMsg(Convert.ToString(Err.Number), W_SUBNAME)
        End Try
    End Function

    '締切日後の計画変更権限のﾁｪｯｸ
    Private Function AccountChk_Simekiri(ByVal pResourceCD As String) As Boolean
        Const W_SUBNAME As String = "NSC0000HA AccountChk_Simekiri"

        Try
            If General.g_objSecurity.mGetResource(pResourceCD) = True Then
                If String.IsNullOrEmpty(General.g_objSecurity.fR_UpdAuthRangeKbn) OrElse General.G_STRAUTHRANGENOTHING.Equals(General.g_objSecurity.fR_UpdAuthRangeKbn) Then
                    '参照不可
                    AccountChk_Simekiri = False
                Else
                    '参照･更新の場合
                    AccountChk_Simekiri = True
                End If
            Else
                '参照不可
                AccountChk_Simekiri = False
            End If

        Catch ex As Exception
            Call General.paTrpMsg(Convert.ToString(Err.Number), W_SUBNAME)
        End Try
    End Function

    '計画制御Ｆ締切日取得 p_Flg:締切日ﾁｪｯｸで呼び出されたとき"0",確定ﾃﾞｰﾀのﾒｯｾｰｼﾞ表示で呼び出されたとき"1"
    '                          ,ResultDueDateﾁｪｯｸで呼び出されたとき"2",HopeDueDateﾁｪｯｸで呼び出されたとき"3"
    Private Function Get_KeikakuF(ByVal p_PlanNo As Integer, ByVal p_Flg As String) As Boolean
        Const W_SUBNAME As String = "NSC0000HA Get_KeikakuF"

        Try
            Dim w_Sql As String
            Dim w_Simekiribi As Integer
            Dim w_PlanShime As Integer
            Dim w_SysDate As Integer
            Dim w_Rs As ADODB.Recordset

            Dim w_締切日_F As ADODB.Field
            Dim w_PlanDate_F As ADODB.Field

            'システム日付取得
            w_SysDate = General.paGetDateIntegerFromDate(Now)

            'SQL文字列 作成
            Select Case p_Flg
                Case "2"
                    w_Sql = "SELECT  RESULTDUEDATE AS 締切日 "
                Case "3"
                    w_Sql = "SELECT  HOPEDUEDATE AS 締切日, PLANDUEDATE "
                Case Else
                    w_Sql = "SELECT  PLANDUEDATE AS 締切日 "
            End Select
            w_Sql = w_Sql & "FROM NS_PLANCONTROL_F "
            w_Sql = w_Sql & "WHERE HOSPITALCD = '" & General.g_strHospitalCD & "' "
            w_Sql = w_Sql & "  AND PLANNO = " & p_PlanNo & " "
            w_Rs = General.paDBRecordSetOpen(w_Sql)

            'ﾃﾞｰﾀ存在ﾁｪｯｸ
            If w_Rs.RecordCount <= 0 Then
                'ﾃﾞｰﾀがない場合
                If "1".Equals(p_Flg) Then
                    Get_KeikakuF = False
                Else
                    Get_KeikakuF = True
                End If
            Else
                'ﾃﾞｰﾀがある場合
                w_締切日_F = w_Rs.Fields("締切日")

                w_Simekiribi = Integer.Parse(General.paGetDbFieldVal(w_締切日_F, 0))

                '希望の時
                If "3".Equals(p_Flg) Then
                    '計画の締切りを取得
                    w_PlanDate_F = w_Rs.Fields("PLANDUEDATE")

                    w_PlanShime = Integer.Parse(General.paGetDbFieldVal(w_PlanDate_F, 0))
                    If IsDate(Format(w_PlanShime, "0000/00/00")) = True Then
                        If w_PlanShime < w_Simekiribi Then
                            '希望締切りより計画締切りが早いとき
                            w_Simekiribi = w_PlanShime
                        End If
                    End If
                End If

                If IsDate(Format(w_Simekiribi, "0000/00/00")) = False Then
                    '日付以外のとき
                    If "1".Equals(p_Flg) OrElse "3".Equals(p_Flg) Then
                        Get_KeikakuF = False
                    Else
                        Get_KeikakuF = True
                    End If
                Else
                    If w_SysDate > w_Simekiribi Then
                        '締切日を過ぎているとき
                        Get_KeikakuF = False
                    Else
                        Get_KeikakuF = True
                    End If
                End If
            End If

            'ﾚｺｰﾄﾞｾｯﾄ 解放
            w_Rs.Close()

        Catch ex As Exception
            Call General.paTrpMsg(Convert.ToString(Err.Number), W_SUBNAME)
        End Try
    End Function

    '==============================================================
    '確定済みかを検索する
    '   戻り値：True（確定済），False（未確定）
    '==============================================================
    Private Function SearchKakuteiData(ByVal p_PlanNo As Integer) As Boolean
        Const W_SUBNAME As String = "NSC0000HA SearchKakuteiData"

        Try
            Dim w_Sql As String
            Dim w_Rs As ADODB.Recordset
            Dim w_Bool As Boolean

            w_Sql = "SELECT DECISIONDATE"
            w_Sql = w_Sql & " FROM NS_PLANDECISION_F"
            w_Sql = w_Sql & " WHERE PLANNO = " & Convert.ToString(p_PlanNo)
            w_Sql = w_Sql & " AND KINMUDEPTCD = '" & General.g_strSelKinmuDeptCD & "'"
            w_Sql = w_Sql & " AND HOSPITALCD = '" & General.g_strHospitalCD & "'"
            w_Sql = w_Sql & " "
            w_Rs = General.paDBRecordSetOpen(w_Sql)

            With w_Rs
                If .RecordCount <= 0 Then
                    'ﾃﾞｰﾀ無しの場合は未確定
                    w_Bool = False
                Else
                    'ﾃﾞｰﾀありの場合は未確定（1件のみ）
                    w_Bool = True
                End If
            End With
            w_Rs.Close()

            '戻り値設定
            SearchKakuteiData = w_Bool

        Catch ex As Exception
            Call General.paTrpMsg(Convert.ToString(Err.Number), W_SUBNAME)
        End Try
    End Function

    Public Sub subKensyu(ByRef p_Obj As Object, ByVal p_Type As Boolean)

        Const W_SUBNAME As String = "frmNSC0000HA subKensyu"

        Try
            '----------------------------------
            '●研修登録画面
            '----------------------------------
            'プロパティ設定
            p_Obj = New NsAid_NSS0010H.clsNSS0010H
            With p_Obj
                .LetHospitalCode = General.g_strHospitalCD '病院CD
                If (M_PERSONAL_RESCD).Equals(g_MenuM(g_lngGroupIdx).ListBarMenu(g_lngListIdx).strResCD) AndAlso m_blnKinmuDeptDspFlg = False Then
                    .LetUserData(General.g_strUserMngID) = ""
                Else
                    .LetUserData(m_strSelectStaffMngID) = ""
                End If

                .LetUserWardData(General.g_strSelKinmuDeptCD) = vbNullString '指定された職員看護単位情報
                .LetOpeUserData(General.g_strUserID) = General.g_strUserName '操作者情報
                .LetOpeUserWardData(General.g_strUserKinmuDeptCD) = General.g_strUserKinmuDeptNm '操作者の看護単位情報
                .LetInstallType = General.g_InstallType 'インストールタイプ
                .pSecurityObj = General.g_objSecurity 'セキュリティ部品

                '操作者の権限(個人画面から立ち上がる場合は権限は必ず個人になる)
                If p_Type = True Then
                    .LetUserPower = 2
                Else
                    .LetUserPower = 0
                End If

                .SetPartsObject = General.g_objGetData 'データ取得Object
                .SetDateObject = General.g_objSelectDate '日付表示Object

            End With

        Catch ex As Exception
            Call General.paTrpMsg(Convert.ToString(Err.Number), W_SUBNAME)
        End Try
    End Sub

    '時間外入力画面表示
    Private Sub CallOverKinmuDisp(ByVal p_lngStaffIndex As Integer)
        Const W_SUBNAME As String = "frmNSC0000HA CallOverKinmuDisp"

        Try
            Dim w_clsObj As Object
            Dim w_strMsg() As String
            Const WC_MONTHRESOURCE As String = "NSW0020HA6"
            Const WC_DAYRESOURCE As String = "NSW0020HA7"
            Dim w_lngDayLimit As Integer
            Dim w_lngNowdate As Integer
            Dim w_lngSelDate As Integer
            Dim w_strDateDeptCD As String
            Dim w_strDateDeptName As String
            Dim w_blnDateDeptFlg As Boolean

            '締切日の確認
            If GetShimekiri() = 1 Then
                '月の締切日を過ぎているとき→月締め後の操作権限があるか
                If General.g_objSecurity.mGetResource(WC_MONTHRESOURCE) = False Then
                    ReDim w_strMsg(2)
                    w_strMsg(1) = "締切日後に時間外"
                    w_strMsg(2) = "申請"

                    Call General.paMsgDsp("NS0169", w_strMsg)
                    Exit Sub
                Else
                    If String.IsNullOrEmpty(General.g_objSecurity.fR_UpdAuthRangeKbn) OrElse General.G_STRAUTHRANGENOTHING.Equals(General.g_objSecurity.fR_UpdAuthRangeKbn) Then

                        ReDim w_strMsg(2)
                        w_strMsg(1) = "締切日後に時間外"
                        w_strMsg(2) = "申請"

                        Call General.paMsgDsp("NS0169", w_strMsg)
                        Exit Sub
                    End If
                End If
            End If

            w_lngDayLimit = Integer.Parse(General.paGetItemValue(General.G_STRMAINKEY3, General.G_STRSUBKEY1, "OKTIMEDAYDEADLINE", "0", General.g_strHospitalCD))
            If w_lngDayLimit > 0 Then
                w_lngNowdate = General.paGetDateIntegerFromDate(Now)
                w_lngSelDate = General.paGetDateIntegerFromDate(m_DayOverSelectDate)
                w_lngSelDate = General.paGetDateIntegerFromDate(Format(DateAdd(Microsoft.VisualBasic.DateInterval.Day, w_lngDayLimit, General.paGetDateFromDateInteger(w_lngSelDate))))

                If w_lngSelDate < w_lngNowdate Then
                    '日締め日を過ぎているとき→月締め後の操作権限があるか
                    If General.g_objSecurity.mGetResource(WC_DAYRESOURCE) = False Then
                        ReDim w_strMsg(2)
                        w_strMsg(1) = "締切日後に時間外"
                        w_strMsg(2) = "申請"

                        Call General.paMsgDsp("NS0169", w_strMsg)
                        Exit Sub

                    Else
                        If String.IsNullOrEmpty(General.g_objSecurity.fR_UpdAuthRangeKbn) OrElse General.G_STRAUTHRANGENOTHING.Equals(General.g_objSecurity.fR_UpdAuthRangeKbn) Then
                            ReDim w_strMsg(2)
                            w_strMsg(1) = "締切日後に時間外"
                            w_strMsg(2) = "申請"

                            Call General.paMsgDsp("NS0169", w_strMsg)
                            Exit Sub
                        End If
                    End If
                End If
            End If

            '利用者と選択職員のセキュリティ
            If General.paCheckSelStaffAllAccount("NSW0020HA", Trim(m_udtStaffData(p_lngStaffIndex).strStaffMngID), General.g_strSelKinmuDeptCD) = False Then

                ReDim w_strMsg(2)
                w_strMsg(1) = "職員"
                w_strMsg(2) = "操作"
                '選択した&1を&2する権限がありません。
                Call General.paMsgDsp("NS0093", w_strMsg)
                Exit Sub

            End If

            w_blnDateDeptFlg = funcChangeDeptCD(m_udtStaffData(p_lngStaffIndex).strStaffMngID, General.paGetDateIntegerFromDate(m_DayOverSelectDate), w_strDateDeptCD, w_strDateDeptName)

            w_clsObj = New NsAid_NSW0020H.clsNSW0020H
            w_clsObj.pHospitalInfo(General.g_strHospitalCD) = General.g_strHospitalNm '施設情報
            w_clsObj.pKangoTaniInfo(w_strDateDeptCD) = w_strDateDeptName '選択勤務部署情報
            w_clsObj.pUserInfo(General.g_strUserID) = General.g_strUserName '利用者情報
            w_clsObj.pUserMngID = General.g_strUserMngID
            w_clsObj.pPersonalChk = True '個人or部署(個人:True、部署:False)
            w_clsObj.pGetDataObj = General.g_objGetData '職員取得部品
            w_clsObj.pGetMasterObj = General.g_objGetMaster 'マスタ取得部品
            w_clsObj.pSecurityObj = General.g_objSecurity 'セキュリティ部品
            w_clsObj.pSelectDateObj = General.g_objSelectDate 'カレンダー部品
            w_clsObj.pSyouninDataObj = General.g_objSyouninData '承認部品
            w_clsObj.pComCyokinObj = General.g_objComCyokin
            w_clsObj.pSelectData(m_udtStaffData(p_lngStaffIndex).strStaffMngID) = General.paGetDateIntegerFromDate(m_DayOverSelectDate, General.G_DATE_ENUM.yyyyMMdd) '対象者職員管理番号/日付

            w_clsObj.pProcessObj = Me
            '画面表示
            w_clsObj.mShowWindow()

            Call sList_DayOver()

        Catch ex As Exception
            Call General.paTrpMsg(Convert.ToString(Err.Number), W_SUBNAME)
        End Try
    End Sub

    Private Function GetShimekiri() As Integer
        Const W_SUBNAME As String = "frmNSC0000HA GetShimekiri"

        Try
            Dim w_Sql As String
            Dim w_AdoRs As ADODB.Recordset
            Dim w_lngShime As Integer
            Dim w_strRegRtn As String

            w_Sql = "SELECT DUEDATE"
            w_Sql = w_Sql & ", TARGETDATE"
            w_Sql = w_Sql & " FROM NS_OVERKINMULIMIT_F"
            w_Sql = w_Sql & " WHERE HOSPITALCD = '" & General.g_strHospitalCD & "'"
            w_Sql = w_Sql & " AND TARGETDATE = " & General.paGetDateStringFromDate(m_DayOverSelectDate, General.G_DATE_ENUM.yyyyMM)
            w_Sql = w_Sql & " ORDER BY TARGETDATE "
            w_AdoRs = General.paDBRecordSetOpen(w_Sql)

            With w_AdoRs
                w_lngShime = 0
                If .RecordCount > 0 Then
                    'ﾃﾞｰﾀありの場合（1件のみ）
                    .MoveFirst()
                    w_lngShime = .Fields("DUEDATE").Value
                End If
            End With

            w_AdoRs.Close()
            w_AdoRs = Nothing

            'ﾕｰｻﾞｰが締切り設定をしていない時
            If w_lngShime = 0 Then
                '項目設定から基準日を取得
                w_strRegRtn = General.paGetItemValue(General.G_STRMAINKEY3, "DISPMONTH", "DEFOKTIMELIMIT", "5", General.g_strHospitalCD)

                If IsNumeric(w_strRegRtn) = False Then
                    '数値として判断できない場合は締め切り日なし
                    w_lngShime = 99999999
                Else
                    w_lngShime = Integer.Parse(
                        General.DateUtil.paGetDateStringFromDate(DateAdd(Microsoft.VisualBasic.DateInterval.Month, 1, m_DayOverSelectDate), General.G_DATE_ENUM.yyyyMM) &
                        General.paFormatZero(Integer.Parse(w_strRegRtn), 2))
                End If
            End If

            '締切日を過ぎている時
            If w_lngShime < General.paGetDateIntegerFromDate(Now) Then
                GetShimekiri = 1
            Else
                GetShimekiri = 2
            End If

        Catch ex As Exception
            Call General.paTrpMsg(Convert.ToString(Err.Number), W_SUBNAME)
        End Try
    End Function

    Private Function GetShimekiri2(ByVal p_Date As Integer) As Integer
        Const W_SUBNAME As String = "NSW0020H GetShimekiri2"

        Try
            Dim w_Sql As String
            Dim w_AdoRs As ADODB.Recordset
            Dim w_lngShime As Integer
            Dim w_strRegRtn As String

            w_Sql = "SELECT DUEDATE"
            w_Sql = w_Sql & ", TARGETDATE"
            w_Sql = w_Sql & " FROM NS_OVERKINMULIMIT_F"
            w_Sql = w_Sql & " WHERE HOSPITALCD = '" & General.g_strHospitalCD & "'"
            w_Sql = w_Sql & " AND TARGETDATE = " & General.DateUtil.paGetDateStringFromInteger(p_Date, General.G_DATE_ENUM.yyyyMM)
            w_Sql = w_Sql & " ORDER BY TARGETDATE "
            w_AdoRs = General.paDBRecordSetOpen(w_Sql)

            With w_AdoRs
                w_lngShime = 0
                If .RecordCount > 0 Then
                    'ﾃﾞｰﾀありの場合（1件のみ）
                    .MoveFirst()
                    w_lngShime = .Fields("DUEDATE").Value
                End If
            End With

            w_AdoRs.Close()
            w_AdoRs = Nothing

            'ﾕｰｻﾞｰが締切り設定をしていない時
            If w_lngShime = 0 Then
                '項目設定から基準日を取得
                w_strRegRtn = General.paGetItemValue(General.G_STRMAINKEY3, "DISPMONTH", "DEFOKTIMELIMIT", "5", General.g_strHospitalCD)

                If IsNumeric(w_strRegRtn) = False Then
                    '数値として判断できない場合は締め切り日なし
                    w_lngShime = 99999999
                Else
                    w_lngShime = Integer.Parse(
                                    General.DateUtil.paGetDateStringFromDate(DateAdd(Microsoft.VisualBasic.DateInterval.Month, 1, General.DateUtil.paGetDateFromDateInteger(p_Date)), General.G_DATE_ENUM.yyyyMM) &
                                    General.paFormatZero(Integer.Parse(w_strRegRtn), 2))
                End If
            End If

            '締切日を過ぎている時
            If w_lngShime < General.paGetDateIntegerFromDate(Now) Then
                GetShimekiri2 = 1
            Else
                GetShimekiri2 = 2
            End If

        Catch ex As Exception
            Call General.paTrpMsg(Convert.ToString(Err.Number), W_SUBNAME)
        End Try
    End Function

    '====================================
    '承認情報を更新
    '====================================
    Private Sub sUpdApprove()
        Const W_SUBNAME As String = "NSC0000HA sUpdApprove"

        Try
            Dim w_lngLoop As Integer
            Dim w_numDate As Long
            Dim w_blnUPDFlg As Boolean
            Dim w_blnErrorFlg As Boolean
            Dim w_blnOKFlg As Boolean
            Dim w_lngErrorCnt As Integer
            Dim w_strMsg() As String
            Const WC_MONTHRESOURCE As String = "NSW0020HA6"
            Dim w_intOutCnt As Integer
            Dim w_blnOutFlg As Boolean
            Dim w_Int As Integer
            Dim w_tmpStaff() As String
            Dim w_Cnt As Integer
            Dim w_mngId As String
            Dim w_i As Integer
            Dim w_getMngIdFlg As Boolean
            Dim w_updFlg As Boolean
            Dim w_procDate As String
            Dim w_lngFrom As Integer
            Dim w_lngTo As Integer
            Dim w_tmpLngFrom As Integer
            Dim w_tmpLngTo As Integer
            Dim w_tmpLng As Integer
            Dim w_updOvRuikeFlg As String

            '★最初に勤務実績チェックや超勤入力可能勤務？もしくは時間年休登録可能勤務などを確認する
            '（入力画面と同じ処理）
            w_numDate = Long.Parse(Format(Now, "yyyyMMddHHmmss"))

            w_updOvRuikeFlg = General.paGetItemValue(General.G_STRMAINKEY3, General.G_STRSUBKEY13, "INSPECTIONUPDFLG", "0", General.g_strHospitalCD)
            ReDim w_tmpStaff(0)
            w_Cnt = 0
            w_mngId = ""
            w_updFlg = False
            '初期化
            w_lngFrom = Integer.Parse(General.paLeftB(imdAppliTo.Text.Replace("/", ""), 6))
            w_lngTo = Integer.Parse(General.paLeftB(imdAppliFrom.Text.Replace("/", ""), 6))

            w_blnErrorFlg = False
            w_lngErrorCnt = 0
            w_blnOKFlg = False
            w_intOutCnt = 0

            With General.g_objSyouninData

                For w_Int = 0 To lvwDeptInfo.Items.Count - 1
                    If lvwDeptInfo.Items.Item(w_Int).Checked = True Then
                        w_lngLoop = lvwDeptInfo.Items.Item(w_Int).Tag
                        If "2".Equals(m_udtApproveData(w_lngLoop).strScreenCtrlKbn) Then
                            w_blnOutFlg = False
                            If GetShimekiri2(m_udtApproveData(w_lngLoop).lngPeriodFromDate) = 1 Then
                                '月の締切日を過ぎているとき→月締め後の操作権限があるか
                                If General.g_objSecurity.mGetResource(WC_MONTHRESOURCE) = False Then
                                    w_blnOutFlg = True
                                    w_intOutCnt = w_intOutCnt + 1
                                Else
                                    If String.IsNullOrEmpty(General.g_objSecurity.fR_UpdAuthRangeKbn) OrElse "-".Equals(General.g_objSecurity.fR_UpdAuthRangeKbn) Then

                                        w_blnOutFlg = True
                                        w_intOutCnt = w_intOutCnt + 1
                                    End If
                                End If
                            End If
                        Else
                            w_blnOutFlg = False
                        End If

                        If w_blnOutFlg = False Then
                            If w_updOvRuikeFlg = "1" Then
                                '更新処理を行うとき
                                w_mngId = m_udtApproveData(w_lngLoop).strAppliStaffMngID
                                w_getMngIdFlg = True
                                '今までに取得した職員番号と比較
                                For w_i = 1 To UBound(w_tmpStaff)
                                    If w_mngId = w_tmpStaff(w_i) Then
                                        '既に格納した職員管理番号に該当するとき
                                        w_getMngIdFlg = False
                                        Exit For
                                    End If
                                Next w_i

                                If w_getMngIdFlg = True Then
                                    '1件も該当するデータがないとき、時間外届出累計更新対象者
                                    w_updFlg = True
                                    w_Cnt = UBound(w_tmpStaff) + 1
                                    ReDim Preserve w_tmpStaff(w_Cnt)
                                    w_tmpStaff(w_Cnt) = w_mngId

                                    '日付編集
                                    w_tmpLngFrom = Integer.Parse(General.paLeftB(Convert.ToString(m_udtApproveData(w_lngLoop).lngPeriodFromDate), 6))
                                    w_tmpLngTo = judgeOvKinmDate(m_udtApproveData(w_lngLoop).lngPeriodToDate)

                                    '開始日は小さい年月を格納する
                                    w_lngFrom = IIf(w_lngFrom < w_tmpLngFrom, w_lngFrom, w_tmpLngFrom)
                                    '終了日は大きい年月を格納する
                                    w_lngTo = IIf(w_lngTo < w_tmpLngTo, w_tmpLngTo, w_lngTo)
                                End If
                            End If

                            .pAppliCD = m_udtApproveData(w_lngLoop).strAppliCD '届出CD
                            .pAppliStaffMngID = m_udtApproveData(w_lngLoop).strAppliStaffMngID '申請者の職員管理番号
                            .pAppliDate = m_udtApproveData(w_lngLoop).lngAppliDate '申請日付
                            .pUniqueSeqNo = m_udtApproveData(w_lngLoop).strUNIQUESEQNO 'UNIQUESEQNO
                            .pDispMode = "2" '表示ﾓｰﾄﾞ
                            .pSyoriKbn = "2" '処理区分
                            .pApproveStaffMngID = General.g_strUserMngID '承認者職員管理番号
                            .mApproveComment = m_udtApproveData(w_lngLoop).strComment
                            .mApproveClassLevel = m_udtApproveData(w_lngLoop).lngApproveClassLvl
                            .mApproveStaffMngID = General.g_strUserMngID
                            .mLastUpdTimeDate = m_udtApproveData(w_lngLoop).dblLastUpdTimeDate
                            .mSyoriMode = "1" '1:承認 2:申請者に差戻 3:１つ前に差戻 4:保留

                            .pResourceCD = m_strDispMenu

                            '呼び出し側でコミット
                            Call General.paBeginTrans()

                            w_blnUPDFlg = .mApprove

                            '更新が異常の場合はロールバック
                            If w_blnUPDFlg = False Then
                                'ロールバック
                                Call General.paRollBack()
                                w_blnErrorFlg = True
                                w_lngErrorCnt = w_lngErrorCnt + 1
                            Else
                                '届出CDが「時間外」の場合は、超勤調整Fにデータを書き込み
                                If "2".Equals(m_udtApproveData(w_lngLoop).strScreenCtrlKbn) Then
                                    If fncSaveOverKinmuAdjust(m_udtApproveData(w_lngLoop).strAppliStaffMngID, m_udtApproveData(w_lngLoop).strUNIQUESEQNO, m_udtApproveData(w_lngLoop).lngApproveClassLvl, m_udtApproveData(w_lngLoop).lngPeriodFromDate) = False Then
                                        'ロールバック
                                        Call General.paRollBack()
                                        w_blnErrorFlg = True
                                        w_lngErrorCnt = w_lngErrorCnt + 1
                                    Else
                                        'コミット
                                        Call General.paCommit()
                                        w_blnOKFlg = True
                                    End If
                                Else
                                    '届出CDが「時間外」以外の場合は、年休Fにデータを書き込み
                                    If fncSaveNenkyuF(m_udtApproveData(w_lngLoop).strAppliStaffMngID, m_udtApproveData(w_lngLoop).strUNIQUESEQNO, m_udtApproveData(w_lngLoop).lngApproveClassLvl, m_udtApproveData(w_lngLoop).lngPeriodFromDate, m_udtApproveData(w_lngLoop).strAppliCD) = False Then
                                        'ロールバック
                                        Call General.paRollBack()
                                        w_blnErrorFlg = True
                                        w_lngErrorCnt = w_lngErrorCnt + 1
                                    Else
                                        'コミット
                                        Call General.paCommit()
                                        w_blnOKFlg = True
                                    End If

                                End If
                            End If

                        End If
                    End If
                Next w_Int
            End With

            '更新処理をする、且つ更新対象者
            If "1".Equals(w_updOvRuikeFlg) And w_updFlg = True Then
                '逆転チェック（初期値で開始日に範囲終了日を入れている為）
                If w_lngFrom > w_lngTo Then
                    w_tmpLng = w_lngFrom
                    w_lngFrom = w_lngTo
                    w_lngTo = w_tmpLng
                End If
                '期間生成
                w_procDate = w_lngFrom & ":" & w_lngTo
                '時間外届出累計を更新
                Call startApprvRuike(w_tmpStaff, w_procDate)
            End If

            '異常が発生した場合
            If w_blnErrorFlg = True Then
                ReDim w_strMsg(1)
                w_strMsg(1) = Convert.ToString(w_lngErrorCnt)
                Call General.paMsgDsp("NS0144", w_strMsg)
            End If

            If w_intOutCnt > 0 Then
                ReDim w_strMsg(0)
                Call General.paMsgDsp("NS0282", w_strMsg)
            End If

            '1件でも更新があれば再表示
            If w_blnOKFlg = True Then
                Call sList_ApproveInfo()

                General.g_objGetData.pUniqueSeqNo = "" 'UNIQUESEQNO
            End If

        Catch ex As Exception
            Call General.paTrpMsg(Convert.ToString(Err.Number), W_SUBNAME)
        End Try
    End Sub

    '時間外調整F更新処理
    Private Function fncSaveOverKinmuAdjust(ByVal p_strStaffMngID As String, ByVal p_strUNIQUESEQNO As String, ByVal p_lngApproveClassLvl As Integer, ByVal p_lngDate As Integer) As Boolean
        Const W_SUBNAME As String = "NSK0000A fncSaveOverKinmuAdjust"

        Try
            Dim w_lngLoop As Integer
            Dim w_lngRecCnt As Integer
            Dim w_Work() As OverKinmu_Type
            Dim w_strSql As String
            Dim w_numSysDate As Long
            Dim w_lngSeq As Integer
            Dim w_strLastApproveFlg As String
            Dim w_lngDate As Integer

            '初期化
            fncSaveOverKinmuAdjust = False
            ReDim w_Work(0)

            w_numSysDate = Long.Parse(Format(Now, "yyyyMMddHHmmss"))

            '一次承認者のみ
            If p_lngApproveClassLvl = 1 Then
                '時間外Fより最終更新年月日取得する
                With General.g_objGetData
                    .p病院CD = General.g_strHospitalCD
                    .p承認区分 = 1
                    .p職員区分 = 0 '職員管理番号指定
                    .p職員番号 = p_strStaffMngID
                    .p日付区分 = 0 '単一日
                    .p開始年月日 = p_lngDate
                    .pUniqueSeqNo = p_strUNIQUESEQNO

                    If .mGetOverKinmu = False Then

                    Else
                        w_lngRecCnt = .f超勤件数
                        ReDim w_Work(w_lngRecCnt)

                        For w_lngLoop = 1 To w_lngRecCnt
                            .p超勤索引 = w_lngLoop

                            '●年月日
                            w_Work(w_lngLoop).lngDate = .f年月日
                            '●時間外年月日
                            w_Work(w_lngLoop).lngOKDate = .f超勤年月日
                            '●勤務コード
                            w_Work(w_lngLoop).strKinmuCD = .f超勤勤務CD
                            '●分割フラグ
                            w_Work(w_lngLoop).strDivisionFlg = .f超勤分割FLG
                            '●時間外開始時間
                            w_Work(w_lngLoop).lngFromTime = .f超勤時間FROM
                            '●時間外終了時間
                            w_Work(w_lngLoop).lngToTime = .f超勤時間TO
                            '●時間外理由コード
                            w_Work(w_lngLoop).strReasonCD = .f超勤理由CD
                            '●時間外理由名称
                            w_Work(w_lngLoop).strReasonNm = .f超勤理由名称
                            '●時間外理由略称
                            w_Work(w_lngLoop).strReasonSNm = .f超勤理由略称
                            '●翌日フラグ
                            w_Work(w_lngLoop).strNextDayFlg = .f超勤翌日FLG
                            '●初回更新年月日
                            w_Work(w_lngLoop).dblFirstDate = .f時間外初回登録日時
                            '●最終更新年月日
                            w_Work(w_lngLoop).dblLastUpdDate = .f時間外最終更新日時
                            '●UNIQUESEQNO
                            w_Work(w_lngLoop).strUNIQUESEQNO = .f超勤UNIQUESEQNO
                            '●超勤取得区分
                            w_Work(w_lngLoop).lngGetKbn = .f超勤取得区分
                            '●超勤備考
                            w_Work(w_lngLoop).strReasonText = .f超勤備考
                        Next w_lngLoop
                    End If

                    .pUniqueSeqNo = ""

                End With

                '明細データがあるか
                If UBound(w_Work) > 0 Then
                    w_lngDate = w_Work(1).lngDate

                    '★とりあえず明細Fよりデータを取得して、調整Fに書き込み
                    Call General.paBeginTrans()

                    w_strSql = "DELETE FROM NS_OVERKINMUADJUST_F"
                    w_strSql = w_strSql & " WHERE HOSPITALCD = '" & General.g_strHospitalCD & "'"
                    w_strSql = w_strSql & " AND STAFFMNGID = '" & p_strStaffMngID & "'"
                    w_strSql = w_strSql & " AND DATEF = " & w_lngDate
                    Call General.paDBExecute(w_strSql)
                Else
                    w_lngDate = p_lngDate
                End If

                w_lngSeq = 1

                For w_lngLoop = 1 To UBound(w_Work)
                    w_strSql = "INSERT INTO  NS_OVERKINMUADJUST_F ( "
                    w_strSql = w_strSql & "HOSPITALCD, "
                    w_strSql = w_strSql & "STAFFMNGID, "
                    w_strSql = w_strSql & "DATEF, "
                    w_strSql = w_strSql & "SEQ, "
                    w_strSql = w_strSql & "OKTIMEDATE, "
                    w_strSql = w_strSql & "DIVISIONFLG, "
                    w_strSql = w_strSql & "OKTIMEFROM, "
                    w_strSql = w_strSql & "OKTIMETO, "
                    w_strSql = w_strSql & "OKTIMEREASONCD, "
                    w_strSql = w_strSql & "NEXTDAYFLG, "
                    w_strSql = w_strSql & "UNIQUESEQNO, "
                    w_strSql = w_strSql & "BIKOU, "
                    w_strSql = w_strSql & "REGISTFIRSTTIMEDATE, "
                    w_strSql = w_strSql & "LASTUPDTIMEDATE, "
                    w_strSql = w_strSql & "REGISTRANTID ) "
                    w_strSql = w_strSql & "VALUES( '"
                    w_strSql = w_strSql & General.g_strHospitalCD & "', '"
                    w_strSql = w_strSql & p_strStaffMngID & "', "
                    w_strSql = w_strSql & Convert.ToString(w_Work(w_lngLoop).lngDate) & ", "
                    w_strSql = w_strSql & Convert.ToString(w_lngSeq) & ", "
                    w_strSql = w_strSql & w_Work(w_lngLoop).lngOKDate & ", '"
                    w_strSql = w_strSql & w_Work(w_lngLoop).strDivisionFlg & "', "
                    w_strSql = w_strSql & w_Work(w_lngLoop).lngFromTime & ", "
                    w_strSql = w_strSql & w_Work(w_lngLoop).lngToTime & ", '"
                    w_strSql = w_strSql & w_Work(w_lngLoop).strReasonCD & "', '"
                    w_strSql = w_strSql & w_Work(w_lngLoop).strNextDayFlg & "','"
                    w_strSql = w_strSql & w_Work(w_lngLoop).strUNIQUESEQNO & "', "
                    w_strSql = w_strSql & "'" & w_Work(w_lngLoop).strReasonText & "', "
                    w_strSql = w_strSql & w_numSysDate & ", "
                    w_strSql = w_strSql & w_numSysDate & ", '"
                    w_strSql = w_strSql & General.g_strUserID & "' ) "

                    Call General.paDBExecute(w_strSql)

                    w_lngSeq = w_lngSeq + 1
                Next w_lngLoop

            End If

            '最終承認フラグ取得
            w_strLastApproveFlg = fncLastApproveFlg(p_strStaffMngID, p_lngDate, p_strUNIQUESEQNO, M_STRJIKANGAI)

            If "1".Equals(w_strLastApproveFlg) Then
                '最終承認者である時
                w_lngDate = p_lngDate

                Call General.paBeginTrans()

                '時間外Fの最終更新年月日を更新する
                w_strSql = "UPDATE NS_OVERKINMU_F SET "
                w_strSql = w_strSql & "UNIQUESEQNO      = '" & p_strUNIQUESEQNO & "', "
                w_strSql = w_strSql & "LASTAPPROVEFLG      = '" & w_strLastApproveFlg & "', "
                w_strSql = w_strSql & "LASTUPDTIMEDATE  =  " & w_numSysDate & ", "
                w_strSql = w_strSql & "REGISTRANTID     = '" & General.g_strUserID & "' "
                w_strSql = w_strSql & "WHERE HOSPITALCD = '" & General.g_strHospitalCD & "' "
                w_strSql = w_strSql & "AND   STAFFMNGID = '" & p_strStaffMngID & "' "
                w_strSql = w_strSql & "AND   DATEF      =  " & Convert.ToString(w_lngDate) & " "
                'SQL実行
                Call General.paDBExecute(w_strSql)

            End If

            '正常終了
            fncSaveOverKinmuAdjust = True

        Catch ex As Exception
            Call General.paTrpMsg(Convert.ToString(Err.Number), W_SUBNAME)
        End Try
    End Function

    '最終承認フラグ更新
    Private Function fncLastApproveFlg(ByVal p_strStaffMngID As String, ByVal p_lngSelectDate As Integer, ByVal p_strUNIQUESEQNO As String, ByVal p_strAppliCD As String) As String
        Try
            Dim w_PreErrorProc As String
            w_PreErrorProc = General.g_ErrorProc 'ﾌﾟﾛｼｰｼﾞｬ名の一時待避
            General.g_ErrorProc = "NSC0000HA fncLastApproveFlg"

            Dim w_lngIndex As Integer
            Dim w_lngLastApproveLevel As Integer '最終承認階層レベル
            Dim w_lngUserApproveClassLevel As Integer '利用者の承認階層レベル
            Dim w_lngDueFlg As Integer '締め処理済フラグ

            fncLastApproveFlg = ""

            '初期化
            w_lngLastApproveLevel = 0
            w_lngUserApproveClassLevel = 0
            w_lngDueFlg = 0

            With General.g_objSyouninData

                '共通プロパティ
                .pAppliCD = p_strAppliCD '届出コード
                .pAppliStaffMngID = p_strStaffMngID '申請者の職員管理番号
                .pAppliDate = p_lngSelectDate '申請年月日

                If .mGetAppliFlow(1) = False Then
                    Exit Function
                Else
                    w_lngLastApproveLevel = .fM_LastApproveClasslevel
                End If

                If .mGetFlowApproveStaff = False Then
                    Exit Function
                Else

                    For w_lngIndex = 1 To .fFA_ApproveCount
                        .mFA_Idx = w_lngIndex

                        If (General.g_strUserMngID).Equals(.fFA_ApproveStaffMngID) Then
                            w_lngUserApproveClassLevel = .fFA_ApproveClassLevel
                            Exit For
                        End If
                    Next w_lngIndex

                End If

                'UNIQUESEQNOがNULLでなければ届出F情報を取得
                If String.IsNullOrEmpty(p_strUNIQUESEQNO) = False Then
                    .pAppliCD = p_strAppliCD '届出コード
                    .pAppliStaffMngID = p_strStaffMngID '申請者の職員管理番号
                    .pAppliDate = p_lngSelectDate '申請年月日
                    .pUniqueSeqNo = p_strUNIQUESEQNO 'UNIQUESEQNO

                    If .mGetAppliApproveStaff = False Then
                        Exit Function
                    Else
                        w_lngDueFlg = .fAA_DueFlg
                    End If
                End If

            End With

            If w_lngLastApproveLevel = w_lngUserApproveClassLevel AndAlso w_lngDueFlg = 1 Then
                fncLastApproveFlg = "1"
            End If

            General.g_ErrorProc = w_PreErrorProc '待避ﾌﾟﾛｼｰｼﾞｬ名を元に戻す
        Catch ex As Exception
            Throw
        End Try
    End Function

    '年休F更新処理
    Private Function fncSaveNenkyuF(ByVal p_strStaffMngID As String, ByVal p_strUNIQUESEQNO As String, ByVal p_lngApproveClassLvl As Integer, ByVal p_lngDate As Integer, ByVal p_strAppliCD As String) As Boolean
        Const W_SUBNAME As String = "NSK0000A fncSaveNenkyuF"

        Try
            Dim w_strSql As String
            Dim w_numSysDate As Long
            Dim w_strLastApproveFlg As String
            Dim w_lngDate As Integer

            '初期化
            fncSaveNenkyuF = False

            w_numSysDate = Long.Parse(Format(Now, "yyyyMMddHHmmss"))

            '最終承認フラグ取得
            w_strLastApproveFlg = fncLastApproveFlg(p_strStaffMngID, p_lngDate, p_strUNIQUESEQNO, p_strAppliCD)

            If "1".Equals(w_strLastApproveFlg) Then
                '最終承認者である時

                w_lngDate = p_lngDate

                Call General.paBeginTrans()

                '時間外Fの最終更新年月日を更新する
                w_strSql = "UPDATE NS_NENKYU_F SET "
                w_strSql = w_strSql & "APPROVEFLG = '1', "
                w_strSql = w_strSql & "LASTUPDTIMEDATE  =  " & w_numSysDate & ", "
                w_strSql = w_strSql & "REGISTRANTID     = '" & General.g_strUserID & "' "
                w_strSql = w_strSql & "Where HOSPITALCD = '" & General.g_strHospitalCD & "' "
                w_strSql = w_strSql & "And   STAFFMNGID = '" & p_strStaffMngID & "' "
                w_strSql = w_strSql & "And   UNIQUESEQNO = '" & p_strUNIQUESEQNO & "' "
                'Sql実行
                Call General.paDBExecute(w_strSql)

            End If

            '正常終了
            fncSaveNenkyuF = True

        Catch ex As Exception
            Call General.paTrpMsg(Convert.ToString(Err.Number), W_SUBNAME)
        End Try
    End Function

    Private Function RunEnd() As Boolean
        Const W_SUBNAME As String = "frmNSC0000HA RunEnd"

        Try
            Dim w_KakuninStr As String
            Dim w_MsgResult As MsgBoxResult
            Dim w_strMsg() As String
            Dim w_blnKakutei As Boolean

            w_KakuninStr = ""

            w_blnKakutei = False
            '自身が確定できる職員がいる場合
            If UBound(m_udtApproveData) <> 0 Then
                w_blnKakutei = True
            End If

            '確定されていない人がいなければ抜ける
            If w_blnKakutei = False Then
                RunEnd = True
                Exit Function
            End If

            ReDim w_strMsg(1)
            w_strMsg(1) = Format(m_DayOverSelectDate, "yyyy年M月d日")
            w_MsgResult = General.paMsgDsp("NS0281", w_strMsg)

            Select Case w_MsgResult
                Case MsgBoxResult.Yes '｢はい｣
                    'ﾃﾞｰﾀを保存後終了
                    '半月・1ヶ月ﾁｪｯｸ
                    If TotalCheck() = False Then
                        RunEnd = False
                        Exit Function
                    End If

                    If w_blnKakutei = True Then
                        w_KakuninStr = "1"
                    End If
                Case MsgBoxResult.Cancel '｢ｷｬﾝｾﾙ｣
                    '終了中止
                    RunEnd = False
                    Exit Function

                Case Else '｢いいえ｣・その他
                    'そのまま終了

            End Select

            If String.IsNullOrEmpty(w_KakuninStr) = False Then
                '=== 確定済みﾃﾞｰﾀ作成 ===
                Call Update_State()
            End If

            RunEnd = True

        Catch ex As Exception
            Call General.paTrpMsg(Convert.ToString(Err.Number), W_SUBNAME)
        End Try
    End Function

    '1ヶ月・半月合計チェック(TotalCheck)
    Private Function TotalCheck() As Boolean
        Const W_SUBNAME As String = "frmNSC0000HA TotalCheck"

        Try
            Dim w_ChkTime_Half As String
            Dim w_ChkTime_Month As String
            Dim w_ChkIntTime As Integer
            Dim w_MsgText As String
            Dim w_Date As Date
            Dim w_i As Integer
            Dim w_BeforeChkFlg As Boolean
            Dim w_AfterChkFlg As Boolean
            Dim w_MonthChkFlg As Boolean
            Dim w_MonthTotal As Integer
            Dim w_strMsg() As String
            Dim w_HowToError As String
            Dim w_MsgResult As MsgBoxResult

            w_BeforeChkFlg = False
            w_AfterChkFlg = False
            w_MonthChkFlg = False
            TotalCheck = True

            m_Cyokin.EndDay = ""
            m_Cyokin.HalfChk = General.paGetItemValue(General.G_STRMAINKEY3, General.G_STRSUBKEY1, "OKTIMEHALFMIN", Convert.ToString(0), General.g_strHospitalCD)
            m_Cyokin.MonthChk = General.paGetItemValue(General.G_STRMAINKEY3, General.G_STRSUBKEY1, "OKTIMERUIKEIMIN", Convert.ToString(0), General.g_strHospitalCD)
            m_Cyokin.HalfErr = General.paGetItemValue(General.G_STRMAINKEY3, General.G_STRSUBKEY1, "OKTIMEHALFERR", Convert.ToString(0), General.g_strHospitalCD)
            m_Cyokin.MonthErr = General.paGetItemValue(General.G_STRMAINKEY3, General.G_STRSUBKEY1, "OKTIMERUIKEIERR", Convert.ToString(0), General.g_strHospitalCD)

            '**** 半月でのﾁｪｯｸ ****
            w_ChkTime_Half = m_Cyokin.HalfChk
            If IsNumeric(w_ChkTime_Half) = False Then
                '数値として判断できないのでﾁｪｯｸなし
                w_ChkTime_Half = "0"
            End If
            '**** 1ヶ月でのﾁｪｯｸ ****
            w_ChkTime_Month = m_Cyokin.MonthChk
            If IsNumeric(w_ChkTime_Month) = False Then
                '数値として判断できないのでﾁｪｯｸなし
                w_ChkTime_Month = "0"
            End If

            If "0".Equals(w_ChkTime_Half) = False OrElse "0".Equals(w_ChkTime_Month) = False Then
                'チェックあり

                '職員数だけLoop
                For w_i = 1 To UBound(m_udtOverKinmuTotal)

                    '*** 半月チェック ***
                    If "0".Equals(w_ChkTime_Half) = False Then
                        'ﾁｪｯｸありの場合
                        w_ChkIntTime = Integer.Parse(w_ChkTime_Half)
                        '前半の1日〜15日でﾁｪｯｸ
                        If m_udtOverKinmuTotal(w_i).lngBeforeHalf > w_ChkIntTime AndAlso w_BeforeChkFlg = False Then
                            'エラー
                            w_BeforeChkFlg = True
                        End If
                        '後半の16日〜末日でﾁｪｯｸ
                        If m_udtOverKinmuTotal(w_i).lngAfterHalf > w_ChkIntTime AndAlso w_AfterChkFlg = False Then
                            'エラー
                            w_AfterChkFlg = True
                        End If
                    End If

                    '*** 1ヶ月でのﾁｪｯｸ ***
                    If "0".Equals(w_ChkTime_Month) = False Then
                        'ﾁｪｯｸありの場合
                        w_ChkIntTime = Integer.Parse(w_ChkTime_Month)
                        w_MonthTotal = m_udtOverKinmuTotal(w_i).lngTotal
                        If w_MonthTotal > Integer.Parse(w_ChkIntTime) AndAlso w_MonthChkFlg = False Then
                            'ｴﾗｰ
                            w_MonthChkFlg = True
                        End If
                    End If

                Next w_i

                '**** 半月エラーの場合 ****
                w_HowToError = m_Cyokin.HalfErr
                If w_BeforeChkFlg = True Then
                    '半月でエラーがあった場合
                    w_Date = m_DayOverSelectFrom
                    w_MsgText = Format(w_Date, "d日") & "〜"
                    w_MsgText = w_MsgText & Format(Date.Parse(DateAdd(Microsoft.VisualBasic.DateInterval.Day, 14, w_Date)), "d日")
                    w_MsgText = w_MsgText & "の時間外勤務の累計時間"


                    If "1".Equals(w_HowToError) Then
                        '警告メッセージ
                        '*******ﾒｯｾｰｼﾞ***********************************
                        ReDim w_strMsg(1)
                        w_strMsg(1) = w_MsgText
                        w_MsgResult = General.paMsgDsp("NS0280", w_strMsg)
                        If w_MsgResult = MsgBoxResult.No Then '[いいえ] がクリックされた場合
                            TotalCheck = False
                        End If
                        '************************************************
                        Exit Function
                    Else
                        '入力不可
                        '*******ﾒｯｾｰｼﾞ***********************************
                        ReDim w_strMsg(1)
                        w_strMsg(1) = w_MsgText
                        w_MsgResult = General.paMsgDsp("NS0279", w_strMsg)
                        TotalCheck = False
                        '************************************************
                        Exit Function
                    End If


                End If
                If w_AfterChkFlg = True Then
                    w_Date = m_DayOverSelectFrom
                    w_MsgText = Format(Date.Parse(DateAdd(Microsoft.VisualBasic.DateInterval.Day, 15, w_Date)), "d日") & "〜"
                    w_MsgText = w_MsgText & Format(m_DayOverSelectTo, "d日")
                    w_MsgText = w_MsgText & "の時間外勤務の累計時間"
                    If "1".Equals(w_HowToError) Then
                        '警告メッセージ
                        '*******ﾒｯｾｰｼﾞ***********************************
                        ReDim w_strMsg(1)
                        w_strMsg(1) = w_MsgText
                        w_MsgResult = General.paMsgDsp("NS0280", w_strMsg)
                        If w_MsgResult = MsgBoxResult.No Then '[いいえ] がクリックされた場合
                            TotalCheck = False
                        End If
                        '************************************************
                        Exit Function
                    Else
                        '入力不可
                        '*******ﾒｯｾｰｼﾞ***********************************
                        ReDim w_strMsg(1)
                        w_strMsg(1) = w_MsgText
                        w_MsgResult = General.paMsgDsp("NS0279", w_strMsg)
                        TotalCheck = False
                        '************************************************
                        Exit Function
                    End If
                End If

                '**** 1ヶ月エラーの場合 ****
                w_HowToError = m_Cyokin.MonthErr
                If w_MonthChkFlg = True Then
                    w_MsgText = "一ヶ月"
                    w_MsgText = w_MsgText & "の時間外勤務の累計時間"
                    If "1".Equals(w_HowToError) Then
                        '警告メッセージ
                        '*******ﾒｯｾｰｼﾞ***********************************
                        ReDim w_strMsg(1)
                        w_strMsg(1) = w_MsgText
                        w_MsgResult = General.paMsgDsp("NS0280", w_strMsg)
                        If w_MsgResult = MsgBoxResult.No Then '[いいえ] がクリックされた場合
                            TotalCheck = False
                        End If
                        '************************************************
                        Exit Function
                    Else
                        '入力不可
                        '*******ﾒｯｾｰｼﾞ***********************************
                        ReDim w_strMsg(1)
                        w_strMsg(1) = w_MsgText
                        w_MsgResult = General.paMsgDsp("NS0279", w_strMsg)
                        TotalCheck = False
                        '************************************************
                        Exit Function
                    End If
                End If

            End If

            TotalCheck = True

        Catch ex As Exception
            Call General.paTrpMsg(Convert.ToString(Err.Number), W_SUBNAME)
        End Try
    End Function

    '超勤確定Ｆの更新
    Private Sub Update_State()
        Const W_SUBNAME As String = "frmNSC0000HA Update_State"

        Try
            Dim w_lngLoop As Integer
            'Dim w_dblDate As Double
            Dim w_blnUPDFlg As Boolean
            Dim w_blnErrorFlg As Boolean
            Dim w_blnOKFlg As Boolean
            Dim w_lngErrorCnt As Integer
            Dim w_strMsg() As String

            vseCover.Visible = True
            vseCover.Left = albMenu.Left
            vseCover.Width = Me.Width
            vseCover.Top = albMenu.Top
            vseCover.Height = albMenu.Height
            fraDataGet.Left = vseCover.Width / 3
            fraDataGet.Top = vseCover.Height / 3

            Call vseCover.BringToFront()

            'ﾏｳｽﾎﾟｲﾝﾀを砂時計に
            Me.Cursor = System.Windows.Forms.Cursors.WaitCursor

            '★最初に勤務実績チェックや超勤入力可能勤務？もしくは時間年休登録可能勤務などを確認する
            '（入力画面と同じ処理）

            w_blnErrorFlg = False
            w_lngErrorCnt = 0
            w_blnOKFlg = False

            With General.g_objSyouninData

                For w_lngLoop = 1 To UBound(m_udtApproveData)

                    .pAppliCD = m_udtApproveData(w_lngLoop).strAppliCD '届出CD
                    .pAppliStaffMngID = m_udtApproveData(w_lngLoop).strAppliStaffMngID '申請者の職員管理番号
                    .pAppliDate = m_udtApproveData(w_lngLoop).lngAppliDate '申請日付
                    .pUniqueSeqNo = m_udtApproveData(w_lngLoop).strUNIQUESEQNO 'UNIQUESEQNO
                    .pDispMode = "2" '表示ﾓｰﾄﾞ
                    .pSyoriKbn = "2" '処理区分
                    .pApproveStaffMngID = General.g_strUserMngID '承認者職員管理番号
                    .mApproveComment = m_udtApproveData(w_lngLoop).strComment
                    .mApproveClassLevel = m_udtApproveData(w_lngLoop).lngApproveClassLvl
                    .mApproveStaffMngID = General.g_strUserMngID
                    .mLastUpdTimeDate = m_udtApproveData(w_lngLoop).dblLastUpdTimeDate
                    .mSyoriMode = "1" '1:承認 2:申請者に差戻 3:１つ前に差戻 4:保留

                    '呼び出し側でコミット
                    Call General.paBeginTrans()

                    w_blnUPDFlg = .mApprove

                    '更新が異常の場合はロールバック()
                    If w_blnUPDFlg = False Then
                        'ロールバック
                        Call General.paRollBack()
                        w_blnErrorFlg = True
                        w_lngErrorCnt = w_lngErrorCnt + 1
                    Else
                        '届出CDが「時間外」の場合は、超勤調整Fにデータを書き込み
                        If "2".Equals(m_udtApproveData(w_lngLoop).strScreenCtrlKbn) Then
                            If fncSaveOverKinmuAdjust(m_udtApproveData(w_lngLoop).strAppliStaffMngID, m_udtApproveData(w_lngLoop).strUNIQUESEQNO, m_udtApproveData(w_lngLoop).lngApproveClassLvl, m_udtApproveData(w_lngLoop).lngPeriodFromDate) = False Then
                                'ロールバック
                                Call General.paRollBack()
                                w_blnErrorFlg = True
                                w_lngErrorCnt = w_lngErrorCnt + 1
                            Else
                                'コミット
                                Call General.paCommit()
                                w_blnOKFlg = True
                            End If
                        Else
                            'コミット
                            Call General.paCommit()
                            w_blnOKFlg = True
                        End If
                    End If

                Next w_lngLoop
            End With

            vseCover.Visible = False

            'ﾒｲﾝﾌｫｰﾑ ﾏｳｽﾎﾟｲﾝﾀ "既定値"に変更
            Me.Cursor = System.Windows.Forms.Cursors.Default

            '異常が発生した場合
            If w_blnErrorFlg = True Then
                ReDim w_strMsg(1)
                w_strMsg(1) = Convert.ToString(w_lngErrorCnt)
                Call General.paMsgDsp("NS0144", w_strMsg)
            End If

        Catch ex As Exception
            Me.Cursor = System.Windows.Forms.Cursors.Default
            Call General.paTrpMsg(Convert.ToString(Err.Number), W_SUBNAME)
        End Try
    End Sub

    Private Sub subKihon_Click()
        Try
            Dim w_PreErrorProc As String
            w_PreErrorProc = General.g_ErrorProc 'ﾌﾟﾛｼｰｼﾞｬ名の一時待避
            General.g_ErrorProc = "frmNSC0000HA subKihon_Click"

            Dim w_clsObj As Object
            Dim w_strStaffName As String
            Dim w_numNowDate As Integer
            Dim w_lngDeptLoop As Integer
            Dim w_lngDeptCnt As Integer
            Dim w_lngHaichiLoop As Integer
            Dim w_lngHaichiCnt As Integer
            Dim w_lngNoConfLoop As Integer
            Dim w_lngNoConfCnt As Integer
            Dim w_lngNoConfEmpLoop As Integer
            Dim w_lngNoConfEmpCnt As Integer
            Dim w_blnNoConfFlg As Boolean
            Dim w_strCheckID As String
            Dim w_strMsg() As String

            Const w_ResCD As String = "SC0040HA"

            w_clsObj = New NsAid_NSC0040H.clsNSC0040H
            If (M_DISP_HAICHI).Equals(m_strBusyoHaichi) Then
                If String.IsNullOrEmpty(m_strSelHaichiStaffMngID) Then
                    ReDim w_strMsg(1)
                    w_strMsg(1) = "職員"

                    Call General.paMsgDsp("NS0002", w_strMsg)

                    Exit Sub
                End If
            Else
                If lvwDeptInfo.Items.Count <= 0 Then
                    General.g_ErrorProc = w_PreErrorProc '待避ﾌﾟﾛｼｰｼﾞｬ名を元に戻す
                    Exit Sub
                End If

                '1件以上データが存在する場合にデータが選択されてない場合は1件目を取得
                If IsNothing(lvwDeptInfo.FocusedItem) = False Then
                    m_lngSelectListIndex = lvwDeptInfo.Items.Item(lvwDeptInfo.FocusedItem.Index).Tag
                Else
                    m_lngSelectListIndex = lvwDeptInfo.Items.Item(0).Tag
                End If

                m_strSelectStaffMngID = Trim(m_udtStaffData(m_lngSelectListIndex).strStaffMngID)
                m_strSelectStaffID = Trim(m_udtStaffData(m_lngSelectListIndex).strStaffID)
            End If

            w_clsObj.pHospitalCD = General.g_strHospitalCD '施設情報
            w_clsObj.pUserInfo(General.g_strUserID) = General.g_strUserName '利用者情報

            '選択職員の基本情報参照権限のチェック
            With General.g_objSecurity
                If .mGetSecuResource(w_ResCD) = False Then
                    'アカウントが存在しない
                    ReDim w_strMsg(2)
                    w_strMsg(1) = "職員"
                    w_strMsg(2) = "参照"
                    '選択した&1を&2する権限がありません。
                    Call General.paMsgDsp("NS0093", w_strMsg)

                    Exit Sub
                Else

                    If (M_DISP_HAICHI).Equals(m_strBusyoHaichi) Then
                        w_strCheckID = m_strSelHaichiStaffMngID
                    Else
                        w_strCheckID = m_strSelectStaffMngID
                    End If

                    If .mCheckAuthRangeKbn(General.g_objSecurity.fSR_RefAuthRangeKbn, Trim(w_strCheckID), General.g_strSelKinmuDeptCD) = False Then
                        '選択された職員の捜査権限が取得されない場合
                        ReDim w_strMsg(2)
                        w_strMsg(1) = "職員"
                        w_strMsg(2) = "参照"
                        Call General.paMsgDsp("NS0093", w_strMsg)

                        Exit Sub
                    End If
                End If
            End With

            If (M_DISP_HAICHI).Equals(m_strBusyoHaichi) Then
                '配置表だったら
                w_clsObj.pSelStaffMngID = m_strSelHaichiStaffMngID '選択職員管理番号
                m_strSelHaichiStaffID = ""
                w_lngDeptCnt = UBound(m_udtHaichiStaff)

                For w_lngDeptLoop = 1 To w_lngDeptCnt
                    w_lngHaichiCnt = UBound(m_udtHaichiStaff(w_lngDeptLoop).Staff)

                    For w_lngHaichiLoop = 1 To w_lngHaichiCnt
                        If (m_strSelHaichiStaffMngID).Equals(m_udtHaichiStaff(w_lngDeptLoop).Staff(w_lngHaichiLoop).strStaffMngID) Then
                            m_strSelHaichiStaffID = m_udtHaichiStaff(w_lngDeptLoop).Staff(w_lngHaichiLoop).strStaffID
                            Exit For
                        End If
                    Next w_lngHaichiLoop
                    If String.IsNullOrEmpty(m_strSelHaichiStaffID) = False Then
                        Exit For
                    End If
                Next w_lngDeptLoop

                w_clsObj.pSelStaffNo = m_strSelHaichiStaffID '選択職員番号
                w_clsObj.pSelStaffKinmuDeptCD = m_strSelHaichiKinmuDeptCD '選択職員勤務部署コード
            Else
                'それ以外だったら
                w_clsObj.pSelStaffMngID = m_strSelectStaffMngID '選択職員管理番号
                w_clsObj.pSelStaffNo = m_strSelectStaffID '選択職員番号
                w_clsObj.pSelStaffKinmuDeptCD = General.g_strSelKinmuDeptCD '選択職員勤務部署コード
            End If

            w_clsObj.pInstallType = General.g_InstallType 'インストールタイプ

            If tvwKinmuDept.Visible = True Then
                If (M_strSearchCD).Equals(tvwKinmuDept.SelectedNode.Name) Then
                    w_clsObj.pKijunDate = g_SearchDate
                ElseIf (M_strNoConfCD).Equals(tvwKinmuDept.SelectedNode.Name) Then
                    w_blnNoConfFlg = False
                    w_lngNoConfCnt = UBound(m_udtStaffData)

                    '当日時点を初期設定
                    w_clsObj.pKijunDate = General.paGetDateIntegerFromDate(Now)

                    For w_lngNoConfLoop = 1 To w_lngNoConfCnt
                        If m_udtStaffData(w_lngNoConfLoop).strStaffMngID = m_strSelectStaffMngID Then
                            w_lngNoConfEmpCnt = UBound(m_udtStaffData(w_lngNoConfLoop).SaiyoHistory)
                            For w_lngNoConfEmpLoop = 1 To w_lngNoConfEmpCnt

                                If General.paGetDateIntegerFromDate(Now) < m_udtStaffData(w_lngNoConfLoop).SaiyoHistory(w_lngNoConfEmpLoop).lngStartDate Then

                                    w_clsObj.pKijunDate = m_udtStaffData(w_lngNoConfLoop).SaiyoHistory(w_lngNoConfEmpLoop).lngStartDate

                                    w_blnNoConfFlg = True

                                End If

                                If w_blnNoConfFlg = True Then
                                    Exit For
                                End If
                            Next w_lngNoConfEmpLoop
                        End If
                        If w_blnNoConfFlg = True Then
                            Exit For
                        End If
                    Next w_lngNoConfLoop
                Else
                    w_clsObj.pKijunDate = General.paGetDateIntegerFromDate(Now)
                End If
            Else
                w_clsObj.pKijunDate = General.paGetDateIntegerFromDate(Now)
            End If
            w_clsObj.pGetDataObj = General.g_objGetData '職員取得部品
            w_clsObj.pSecurityObj = General.g_objSecurity 'セキュリティ部品
            w_clsObj.pSelectDateObj = General.g_objSelectDate 'カレンダー部品
            w_clsObj.pGetMasterObj = General.g_objGetMaster
            w_clsObj.pSelectStaffObj = General.g_objSelectStaff
            w_clsObj.pIdoDataObj = General.g_objIdoData
            w_clsObj.pSelectDeptObj = General.g_objSelectDept
            w_clsObj.pSyouninDataObj = General.g_objSyouninData
            w_clsObj.pComCyokinObj = General.g_objComCyokin
            w_clsObj.pDutyGroupObj = General.g_objDutyGroup
            w_clsObj.pProcessObj = Me
            w_clsObj.mShowWindow()

            If (M_DISP_HAICHI).Equals(m_strBusyoHaichi) Then

                Call subObjectVisibleFalse()

                Call sList_HaichiInfo()

            Else
                w_numNowDate = General.paGetDateIntegerFromDate(Now)
                With General.g_objGetData
                    '/* 部品検索 */
                    '--プロパティ設定
                    .p病院CD = General.g_strHospitalCD '施設CD
                    .p職員番号変換 = 0 'データ取得
                    .p職員区分 = 0 '職員管理番号で検索
                    .p職員番号 = m_strSelectStaffMngID '職員管理番号
                    .p日付区分 = 0 '単日
                    .p開始年月日 = w_numNowDate
                    .p終了年月日 = 0
                    .p履歴ソートFLG = 0 '昇順
                    .pシステム区分 = 1 '職員管理
                    '--データ検索
                    If .mStaffInit = True Then
                        w_strStaffName = .f氏名1
                        lblSearchData.Text = m_strSelectStaffID & Space(2) & w_strStaffName
                        'lblSearchData.Font = FontChangeBold(lblSearchData.Font, True)
                        lblSearchData.ForeColor = System.Drawing.Color.Blue
                        Call tvwKinmuDept_NodeClick(tvwKinmuDept, New System.Windows.Forms.TreeViewEventArgs(tvwKinmuDept.Nodes.Find(m_strRefreshList, True)(0)))
                    End If
                End With
            End If

            General.g_ErrorProc = w_PreErrorProc '待避ﾌﾟﾛｼｰｼﾞｬ名を元に戻す

        Catch ex As Exception
            Throw
        End Try
    End Sub

    Private Sub subNewStaff_Click()
        Try
            Dim w_PreErrorProc As String
            w_PreErrorProc = General.g_ErrorProc 'ﾌﾟﾛｼｰｼﾞｬ名の一時待避
            General.g_ErrorProc = "frmNSC0000HA subNewStaff_Click"

            Dim w_clsObj As Object

            w_clsObj = New NsAid_NSC0030H.clsNSC0030H

            With w_clsObj
                .pInstallType = General.g_InstallType 'インストールタイプ
                .pHospitalInfo(General.g_strHospitalCD) = General.g_strHospitalNm '施設情報
                .pUserInfo(General.g_strUserID) = General.g_strUserName '利用者情報
                .pSelectDateObj = General.g_objSelectDate 'カレンダー部品
            End With
            w_clsObj.pProcessObj = Me
            w_clsObj.mShowWindow()

            If m_strBusyoHaichi = M_DISP_HAICHI Then

                Call subObjectVisibleFalse()

                Call sList_HaichiInfo()
            Else
                '選択されているノードのリフレッシュ
                If String.IsNullOrEmpty(m_strRefreshList) = False Then
                    Call tvwKinmuDept_NodeClick(tvwKinmuDept, New System.Windows.Forms.TreeViewEventArgs(tvwKinmuDept.Nodes.Find(m_strRefreshList, True)(0)))
                End If
            End If

            General.g_ErrorProc = w_PreErrorProc '待避ﾌﾟﾛｼｰｼﾞｬ名を元に戻す

        Catch ex As Exception
            Throw
        End Try
    End Sub

    Public Sub subImport_Click()
        Dim w_objImport As Object
        Const W_SUBNAME As String = "frmNSC0000HA subImport_Click"
        Try
            w_objImport = New NsAid_NSC0060H.clsNSC0060H

            With w_objImport
                '--- パラメータセット
                .pInstallType = General.g_InstallType
                .pHospitalInfo(General.g_strHospitalCD) = ""
                .pUserInfo(General.g_strUserID) = General.g_strUserName
                .pAccessModule = "NSC0000H"
                .mShowForm()
            End With

            If m_strBusyoHaichi = M_DISP_HAICHI Then

                Call subObjectVisibleFalse()

                Call sList_HaichiInfo()

            Else
                '選択されているノードのリフレッシュ
                If String.IsNullOrEmpty(m_strRefreshList) = False Then
                    Call tvwKinmuDept_NodeClick(tvwKinmuDept, New System.Windows.Forms.TreeViewEventArgs(tvwKinmuDept.Nodes.Find(m_strRefreshList, True)(0)))
                End If
            End If

        Catch ex As Exception
            Call General.paTrpMsg(Convert.ToString(Err.Number), W_SUBNAME)
        End Try
    End Sub

    '検索 表示
    Public Sub subSearch_Click()
        Const W_SUBNAME As String = "frmNSC0000HA subSearch_Click"

        Try
            If General.g_RetrieveObj Is Nothing Then
                '検索画面DLLｵﾌﾞｼﾞｪｸﾄが生成されていない場合
                General.g_RetrieveObj = New NsAid_NSC0050H.clsNSC0050H
                General.g_RetrieveObj.pInstallType = General.g_InstallType
                General.g_RetrieveObj.pMainObj = Me
                General.g_RetrieveObj.pHospitalCD = General.g_strHospitalCD
                General.g_RetrieveObj.pBuhin = General.g_objGetData
                General.g_RetrieveObj.pZenSearchD = g_SearchDate '前回検索結果の基準日を引き渡す
                General.g_RetrieveObj.pUserInfo(General.g_strUserID) = General.g_strUserName
                General.g_RetrieveObj.pSelectDateObj = General.g_objSelectDate '
                General.g_RetrieveObj.pSecurityObj = General.g_objSecurity

                '検索画面に引き渡すリソースを、職員画面⇒検索画面に変更
                General.g_RetrieveObj.pResourceCD = M_STAFFIDO_SEARCH
            End If

            Call General.g_RetrieveObj.mShowWindow()

            '配置表の検索はないので、分岐なし
            Call SearchSelected()

            m_blnSearchFlg = True

        Catch ex As Exception
            Call General.paTrpMsg(Convert.ToString(Err.Number), W_SUBNAME)
        End Try
    End Sub

    '検索 表示
    Public Sub subFileOutPut_Click()
        Const W_SUBNAME As String = "frmNSC0000HA subFileOutPut_Click"

        Try
            Dim w_strSql As String
            Dim w_strSqlValue As String
            Dim w_i As Integer
            Dim w_obj As Object


            '*** ﾌｧｲﾙ出力対象者をNSﾌｧｲﾙ出力Fに書き込む ***

            'ﾄﾗﾝｻﾞｸｼｮﾝ開始
            Call General.paBeginTrans()

            '現在のﾃﾞｰﾀを削除
            w_strSql = "DELETE FROM NS_OUTPUTFILE_F "
            w_strSql = w_strSql & " WHERE USERID   = '" & General.g_strUserID & "'"
            w_strSql = w_strSql & " AND HOSPITALCD = '" & General.g_strHospitalCD & "'"
            Call General.paDBExecute(w_strSql)

            '新しいﾃﾞｰﾀを書き込み
            w_strSql = "INSERT INTO NS_OUTPUTFILE_F ( "
            w_strSql = w_strSql & "HOSPITALCD, STAFFMNGID, SEQ, STAFFNAME, USERID ) "

            For w_i = 1 To UBound(m_udtStaffData)

                If String.IsNullOrEmpty(Trim(m_udtStaffData(w_i).strStaffMngID)) = False Then
                    w_strSqlValue = "VALUES ( '" & General.g_strHospitalCD & "', "
                    w_strSqlValue = w_strSqlValue & "'" & m_udtStaffData(w_i).strStaffMngID & "', "
                    w_strSqlValue = w_strSqlValue & "1, "
                    w_strSqlValue = w_strSqlValue & "'" & m_udtStaffData(w_i).strName & "', "
                    w_strSqlValue = w_strSqlValue & "'" & General.g_strUserID & "' ) "
                    'SQL実行
                    Call General.paDBExecute(w_strSql & w_strSqlValue)
                End If

            Next w_i

            'ｺﾐｯﾄ
            Call General.paCommit()

            '*** ファイル出力画面表示(DLL呼び出し) ***
            w_obj = New NsAid_NSC0070H.clsNSC0070H

            'ﾌﾟﾛﾊﾟﾃｨ設定
            w_obj.pInstallType = General.g_InstallType
            w_obj.pHospitalCD = General.g_strHospitalCD
            w_obj.pUserInfo(General.g_strUserID) = General.g_strUserKinmuDeptCD
            w_obj.PSEARCHD = g_SearchDate '検索結果の基準日を引き渡す

            w_obj.pProcessObj = Me
            '画面呼び出し
            Call w_obj.mShowWindow()

            'DLLｵﾌﾞｼﾞｪｸﾄ解放
            w_obj = Nothing

        Catch ex As Exception
            Call General.paTrpMsg(Convert.ToString(Err.Number), W_SUBNAME)
        End Try
    End Sub

    Private Sub ShowIkkatsu(ByVal p_Type As String)
        Try
            Dim w_objIkkatsu As Object

            w_objIkkatsu = New NsAid_NSS0020H.clsNSS0020H
            '画面インスタンス作成
            With w_objIkkatsu
                .LetHospitalCode = General.g_strHospitalCD '病院CD
                .LetIkkatsuType = p_Type
                .LetOpeUserData(g_ClsMain.UserNo) = g_ClsMain.UserNm '操作者情報
                .SetDateObject = General.g_objSelectDate '日付表示Object
                .SetPartsObject = General.g_objGetData 'データ取得Object

                'モジュール実行
                Call .StartIkkatsuInput()
            End With

            w_objIkkatsu = Nothing

        Catch ex As Exception
            Throw
        End Try
    End Sub

    '検索 表示
    Public Sub subIinkaiNittei_Click()
        Const W_SUBNAME As String = "frmNSC0000HA subIinkaiNittei_Click"

        Try
            Dim w_strSecurityUpd As String
            Dim w_strSecurityRef As String = String.Empty
            Dim w_strKbn As String
            Dim w_strMsg() As String
            Dim w_objIinkai As Object
            Dim w_blnSecurityUpd As Boolean
            Dim w_blnSecurityRef As Boolean

            '更新.参照権限
            With General.g_objSecurity
                '権限範囲区分を取得する
                If .mGetResource(M_STAFFIDO_IINKAINITTEI) = False Then
                    w_blnSecurityUpd = False
                    w_blnSecurityRef = False
                Else
                    w_strSecurityUpd = .fR_UpdAuthRangeKbn
                    w_strSecurityRef = .fR_RefAuthRangeKbn
                End If
            End With

            If String.IsNullOrEmpty(w_strSecurityRef) OrElse General.G_STRAUTHRANGENOTHING.Equals(w_strSecurityRef) Then

                ReDim w_strMsg(1)
                w_strMsg(1) = "参照"
                Call General.paMsgDsp("NS0046", w_strMsg)
                Exit Sub
            End If

            '更新権限があるか(1.あり2.なし)
            If String.IsNullOrEmpty(w_strSecurityRef) OrElse "-".Equals(w_strSecurityRef) Then
                w_strKbn = Convert.ToString(2)
            Else
                w_strKbn = Convert.ToString(1)
            End If

            w_objIinkai = New NsAid_NSS0030H.clsNSS0030H
            '画面インスタンス作成
            With w_objIinkai
                .pHospitalInfo = General.g_strHospitalCD '病院CD
                .pUserInfo(General.g_strUserID) = General.g_strUserName '操作者情報
                .pSelectDateObj = General.g_objSelectDate '日付表示Object
                .pGetDataObj = General.g_objGetData 'データ取得Object
                .pSecurityObj = General.g_objSecurity
                .pSecurityKbn = w_strKbn
                .pInstallType = General.g_InstallType

                .pProcessObj = Me
                'モジュール実行
                Call .mShowWindow()
            End With

            w_objIinkai = Nothing

        Catch ex As Exception
            Call General.paTrpMsg(Convert.ToString(Err.Number), W_SUBNAME)
        End Try
    End Sub

    '==================================
    '勤務部署職員 取得
    '==================================
    Private Sub sGetHaichiStaff()
        Const W_SUBNAME As String = "NSC0000HA sGetHaichiStaff"

        Try
            Dim w_Rs As ADODB.Recordset
            Dim w_CD_F As ADODB.Field
            Dim w_Name_F As ADODB.Field

            Dim w_lngLoop As Integer
            Dim w_lngCnt As Integer
            Dim w_lngStaffLoop As Integer
            Dim w_lngMasterLoop As Integer
            Dim w_lngMasterCnt As Integer
            Dim w_lngPostNameLoop As Integer
            Dim w_lngPostNameCnt As Integer
            Dim w_lngPostCDLoop As Integer
            Dim w_lngPostCDCnt As Integer
            Dim w_lngDate As Integer
            Dim w_strWork As String
            Dim w_varWork As Object
            Dim w_lngWork As Integer
            Dim w_varWork2 As Object
            Dim w_lngWork2 As Integer
            Dim w_varWork3 As Object
            Dim w_lngWork3 As Integer
            Dim w_strSql As String

            Dim w_KinmuDeptData() As HeaderData_Type
            Dim w_lngDeptCnt As Integer
            Dim w_lngDateGet As Integer
            Dim w_lngRecCnt As Integer
            Dim w_strStaffMngID As String
            Dim w_strStaffID_bk As String '退避用
            Dim w_StaffCount As Integer
            Dim w_lngFrom As Integer
            Dim w_lngTo As Integer

            w_lngDate = General.paGetDateIntegerFromDate(Today)

            ReDim m_udtHaichiStaff(0)

            ReDim m_strDispPost(0)

            w_strWork = ""

            '部長;Y01,副部;Y02,主幹;Y03,師長;Y04,師補;Y05,主任;Y06
            w_strWork = General.paGetItemValue(General.G_STRMAINKEY4, "HAICHI", "DISPPOST", "", General.g_strHospitalCD)

            '部長;Y01,副部;Y02,主幹;Y03,師長;Y04,師補;Y05,主任;Y06
            w_varWork = General.paSplit(w_strWork, ",")
            For w_lngWork = 0 To UBound(w_varWork)
                '看護師
                'S01,S02,S03
                w_varWork2 = General.paSplit(w_varWork(w_lngWork), ";")
                For w_lngWork2 = 0 To UBound(w_varWork2)
                    If w_lngWork2 = 0 Then
                        ReDim Preserve m_strDispPost(UBound(m_strDispPost) + 1)
                        m_strDispPost(w_lngWork + 1).strName = w_varWork2(w_lngWork2)
                    Else
                        w_varWork3 = General.paSplit(w_varWork2(w_lngWork2), "+")
                        For w_lngWork3 = 0 To UBound(w_varWork3)
                            ReDim Preserve m_strDispPost(UBound(m_strDispPost)).strCD(w_lngWork3 + 1)
                            m_strDispPost(UBound(m_strDispPost)).strCD(w_lngWork3 + 1) = w_varWork3(w_lngWork3)

                        Next w_lngWork3
                    End If

                Next w_lngWork2
            Next w_lngWork

            ReDim m_udtEmpM(0)
            'ＮＳ汎用Ｍよりﾃﾞｰﾀ取得
            w_strSql = "SELECT * FROM NS_HANYOU_M "
            w_strSql = w_strSql & "WHERE HOSPITALCD = '" & General.g_strHospitalCD & "' "
            w_strSql = w_strSql & "AND MASTERID = 'C001' "
            w_strSql = w_strSql & "ORDER BY DISPNO "

            w_Rs = General.paDBRecordSetOpen(w_strSql)

            With w_Rs

                If .RecordCount <= 0 Then
                    w_lngCnt = 0

                Else
                    .MoveLast()
                    w_lngCnt = .RecordCount
                    .MoveFirst()
                    ReDim m_udtEmpM(w_lngCnt)

                    w_CD_F = .Fields.Item("MASTERCD")
                    w_Name_F = .Fields.Item("NAME")

                    For w_lngLoop = 1 To w_lngCnt

                        m_udtEmpM(w_lngLoop).strCD = General.paGetDbFieldVal(w_CD_F, "")
                        m_udtEmpM(w_lngLoop).strName = General.paGetDbFieldVal(w_Name_F, "")
                        m_udtEmpM(w_lngLoop).lngCnt = 0

                        .MoveNext()
                    Next w_lngLoop
                    .Close()

                End If
            End With

            w_Rs = Nothing

            ReDim m_udtJobM(0)
            With General.g_objGetMaster
                .pHospitalCD = General.g_strHospitalCD
                .pJM_CD = ""
                .pJM_KijunDate = General.paGetDateIntegerFromDate(Now)

                If .mGetJobM = False Then
                Else
                    w_lngCnt = .fJM_DataCount
                    ReDim m_udtJobM(w_lngCnt)

                    For w_lngLoop = 1 To w_lngCnt
                        .mJM_DataIdx = w_lngLoop
                        m_udtJobM(w_lngLoop).strCD = .fJM_JobCD 'CD
                        m_udtJobM(w_lngLoop).strName = .fJM_Name '名称
                        m_udtJobM(w_lngLoop).lngCnt = 0

                    Next w_lngLoop
                End If
            End With

            ReDim w_KinmuDeptData(0)
            With General.g_objGetMaster
                .pHospitalCD = General.g_strHospitalCD
                .pKD_KinmuDeptCD = ""
                .pKD_KijunDate = General.paGetDateIntegerFromDate(Now)

                If .mGetKinmuDept = False Then
                Else
                    w_lngCnt = .fKD_KinmuDeptCount
                    ReDim w_KinmuDeptData(w_lngCnt)

                    For w_lngLoop = 1 To w_lngCnt
                        .mKD_KinmuDeptIdx = w_lngLoop

                        ReDim w_KinmuDeptData(w_lngLoop).strCD(0)

                        w_KinmuDeptData(w_lngLoop).strCD(0) = .fKD_KinmuDeptCD 'CD
                        w_KinmuDeptData(w_lngLoop).strName = .fKD_KinmuDeptName '名称

                    Next w_lngLoop
                End If
            End With

            '表示対象役職コード
            w_lngPostNameCnt = UBound(m_strDispPost)

            w_lngDeptCnt = 0

            w_lngCnt = UBound(w_KinmuDeptData)

            For w_lngLoop = 1 To w_lngCnt

                '基準日
                '職員管理の場合は、カレンダー日付は使用しない
                If (M_STAFFIDO_RESCD).Equals(g_MenuM(g_lngGroupIdx).ListBarMenu(g_lngListIdx).strResCD) Then
                    w_lngDateGet = General.paGetDateIntegerFromDate(Today)
                Else
                    w_lngDateGet = General.paGetDateIntegerFromDate(m_CalDate)
                End If
                w_lngFrom = General.paGetDateIntegerFromDate(m_DateFrom)
                w_lngTo = General.paGetDateIntegerFromDate(m_DateTo)

                '==================================
                '職員情報 取得
                '==================================
                With General.g_objGetData
                    .p病院CD = General.g_strHospitalCD

                    '職員取得FLG
                    If (M_strNoConfCD).Equals(w_KinmuDeptData(w_lngLoop).strCD(0)) AndAlso (M_strRetireCD).Equals(w_KinmuDeptData(w_lngLoop).strCD(0)) Then

                    Else
                        .p職員取得FLG = 0

                        w_lngDeptCnt = UBound(m_udtHaichiStaff) + 1

                        ReDim Preserve m_udtHaichiStaff(w_lngDeptCnt)
                        ReDim Preserve m_udtHaichiStaff(w_lngDeptCnt).Staff(0)

                        m_udtHaichiStaff(w_lngDeptCnt).strKinmuDeptCD = w_KinmuDeptData(w_lngLoop).strCD(0)
                        m_udtHaichiStaff(w_lngDeptCnt).strKinmuDeptName = w_KinmuDeptData(w_lngLoop).strName
                        m_udtHaichiStaff(w_lngDeptCnt).lngSum1 = 0
                        m_udtHaichiStaff(w_lngDeptCnt).lngSum2 = 0

                        .pソート順 = 0 'ソート順
                        If (M_DEPT_OVERTIME).Equals(m_strSelChildMenu) Then
                            .p日付区分 = 1 '期間
                            .p開始年月日 = w_lngFrom '開始年月日
                            .p終了年月日 = w_lngTo '終了年月日
                        Else
                            .p日付区分 = 0 '単一日
                            .p開始年月日 = w_lngDateGet '開始年月日
                            .p終了年月日 = 0
                        End If
                        .p勤務対象FLG = 0 '全員
                        If "1".Equals(g_strSelSaikeiFlg) Then
                            .p優先順位 = 9 '勤務部署CD優先
                        Else
                            .p優先順位 = 0 '勤務部署CD優先
                        End If

                        .p対象CD = w_KinmuDeptData(w_lngLoop).strCD(0) '勤務部署CD
                        .pチーム区分 = 0 '考慮しない
                        .pシステム区分 = 0 '職員歴必要

                        If .mGetStaff = False Then

                        Else
                            '●職員件数
                            w_lngRecCnt = .f職員件数
                            For w_lngStaffLoop = 1 To w_lngRecCnt
                                '索引
                                .p職員索引 = w_lngStaffLoop

                                w_strStaffMngID = .f職員管理番号2

                                If w_strStaffMngID.Equals(w_strStaffID_bk) = False Then
                                    w_StaffCount = w_StaffCount + 1 '対象職員数カウント
                                    '●勤務地異動歴
                                    ReDim Preserve m_udtHaichiStaff(w_lngDeptCnt).Staff(w_StaffCount)

                                End If

                                '●職員管理番号
                                m_udtHaichiStaff(w_lngDeptCnt).Staff(w_StaffCount).strStaffMngID = w_strStaffMngID
                                '●職員番号
                                m_udtHaichiStaff(w_lngDeptCnt).Staff(w_StaffCount).strStaffID = .f職員番号2
                                '●氏名
                                m_udtHaichiStaff(w_lngDeptCnt).Staff(w_StaffCount).strStaffName = .f氏名2
                                '●表示順
                                m_udtHaichiStaff(w_lngDeptCnt).Staff(w_StaffCount).strDispNo = 0
                                '●採用条件コード
                                If .f採用年月日2 <= w_lngDate AndAlso w_lngDate <= .f転退年月日2 Then
                                    m_udtHaichiStaff(w_lngDeptCnt).Staff(w_StaffCount).strEmpCD = .f採用条件CD2
                                End If

                                m_udtHaichiStaff(w_lngDeptCnt).Staff(w_StaffCount).strKinmuDeptCD = .f在職看護単位CD
                                m_udtHaichiStaff(w_lngDeptCnt).Staff(w_StaffCount).strKinmuDeptName = .f在職看護単位名称
                                m_udtHaichiStaff(w_lngDeptCnt).Staff(w_StaffCount).strWardDeptCD = .f配属部署CD2
                                m_udtHaichiStaff(w_lngDeptCnt).Staff(w_StaffCount).strWardDeptName = .f配属部署名称2
                                m_udtHaichiStaff(w_lngDeptCnt).Staff(w_StaffCount).strJobCD = .f職種CD2
                                m_udtHaichiStaff(w_lngDeptCnt).Staff(w_StaffCount).strJobName = .f職種名称2
                                m_udtHaichiStaff(w_lngDeptCnt).Staff(w_StaffCount).strPostCD = .f役職CD2
                                m_udtHaichiStaff(w_lngDeptCnt).Staff(w_StaffCount).strPostName = .f役職名称2
                                m_udtHaichiStaff(w_lngDeptCnt).Staff(w_StaffCount).strDispPostName = Space(6)

                                '名称に役職追加
                                For w_lngPostNameLoop = 1 To w_lngPostNameCnt
                                    w_lngPostCDCnt = UBound(m_strDispPost(w_lngPostNameLoop).strCD)

                                    For w_lngPostCDLoop = 1 To w_lngPostCDCnt

                                        If (m_udtHaichiStaff(w_lngDeptCnt).Staff(w_StaffCount).strPostCD).Equals(m_strDispPost(w_lngPostNameLoop).strCD(w_lngPostCDLoop)) Then

                                            m_udtHaichiStaff(w_lngLoop).Staff(w_StaffCount).strDispPostName = General.paLeft(m_strDispPost(w_lngPostNameLoop).strName & Space(10), 8)

                                        End If
                                    Next w_lngPostCDLoop
                                Next w_lngPostNameLoop

                                '採用カウントアップ
                                w_lngMasterCnt = UBound(m_udtEmpM)

                                For w_lngMasterLoop = 1 To w_lngMasterCnt
                                    If (m_udtEmpM(w_lngMasterLoop).strCD).Equals(m_udtHaichiStaff(w_lngDeptCnt).Staff(w_StaffCount).strEmpCD) Then
                                        m_udtEmpM(w_lngMasterLoop).lngCnt = m_udtEmpM(w_lngMasterLoop).lngCnt + 1
                                        Exit For
                                    End If
                                Next w_lngMasterLoop

                                '職種カウントアップ
                                w_lngMasterCnt = UBound(m_udtJobM)

                                For w_lngMasterLoop = 1 To w_lngMasterCnt
                                    If (m_udtJobM(w_lngMasterLoop).strCD).Equals(m_udtHaichiStaff(w_lngDeptCnt).Staff(w_StaffCount).strJobCD) Then
                                        m_udtJobM(w_lngMasterLoop).lngCnt = m_udtJobM(w_lngMasterLoop).lngCnt + 1
                                        Exit For
                                    End If
                                Next w_lngMasterLoop

                                '職員管理番号 退避
                                w_strStaffID_bk = w_strStaffMngID
                            Next w_lngStaffLoop

                        End If

                    End If

                End With

            Next w_lngLoop

        Catch ex As Exception
            Call General.paTrpMsg(Convert.ToString(Err.Number), W_SUBNAME)
        End Try
    End Sub

    '====================================
    'スプレッド設定[個人業務-実績照会]
    '====================================
    Private Sub sSetSpreadSheetHaichi()
        Const W_SUBNAME As String = "NSC0000HA sSetSpreadSheetHaichi"

        Try
            Dim w_lngLoop As Integer
            Dim w_lngCnt As Integer
            Dim w_lngStaffLoop As Integer
            Dim w_lngStaffCnt As Integer

            Dim w_strWork As String
            Dim w_varWork As Object
            Dim w_lngWork As Integer
            Dim w_varWork2 As Object
            Dim w_lngWork2 As Integer
            Dim w_varWork3 As Object
            Dim w_lngWork3 As Integer

            Dim w_lngRowIndex As Integer
            Dim w_lngDispLoop As Integer
            Dim w_lngDispCnt As Integer

            Dim w_lngSumMaster As Integer

            Dim w_lngMaxStaffCnt As Integer
            Dim w_lngMaxStaffCnt_bk As Integer

            Dim w_lngSetRow1 As Integer
            Dim w_lngSetRow2 As Integer
            Dim w_lngSetCol As Integer

            Dim w_strDispName As String

            Dim w_strTEXT As String

            w_lngCnt = UBound(m_udtHaichiStaff)

            ReDim m_strKangoshiCD(0)
            ReDim m_strJosyuCD(0)

            w_lngMaxStaffCnt = 0
            w_lngMaxStaffCnt_bk = 0

            w_lngSetRow1 = Integer.Parse(General.paGetItemValue(General.G_STRMAINKEY4, "HAICHI", "SETROWDISP1", Convert.ToString(M_MAX_HAICHIROW1), General.g_strHospitalCD)) + 1
            w_lngSetRow2 = Integer.Parse(General.paGetItemValue(General.G_STRMAINKEY4, "HAICHI", "SETROWDISP2", Convert.ToString(M_MAX_HAICHIROW2), General.g_strHospitalCD))
            w_lngSetCol = Integer.Parse(General.paGetItemValue(General.G_STRMAINKEY4, "HAICHI", "SETCOLDISP", Convert.ToString(M_MAX_HAICHICOL), General.g_strHospitalCD)) + 1

            w_strWork = ""

            '看護師;S01,S02,S03
            w_strWork = General.paGetItemValue(General.G_STRMAINKEY4, "HAICHI", "SUMDISP1", "", General.g_strHospitalCD)

            '看護師;S01,S02,S03
            w_varWork = General.paSplit(w_strWork, ",")
            For w_lngWork = 0 To UBound(w_varWork)
                '看護師
                'S01,S02,S03
                w_varWork2 = General.paSplit(w_varWork(w_lngWork), ";")
                For w_lngWork2 = 0 To UBound(w_varWork2)
                    If w_lngWork2 = 0 Then
                        ReDim Preserve m_strKangoshiCD(UBound(m_strKangoshiCD) + 1)
                        m_strKangoshiCD(w_lngWork2 + 1).strName = w_varWork2(w_lngWork2)
                        imtName1.Text = Convert.ToString(w_varWork2(w_lngWork2))
                    Else
                        w_varWork3 = General.paSplit(w_varWork2(w_lngWork2), "+")
                        For w_lngWork3 = 0 To UBound(w_varWork3)
                            ReDim Preserve m_strKangoshiCD(UBound(m_strKangoshiCD)).strCD(w_lngWork3 + 1)
                            m_strKangoshiCD(UBound(m_strKangoshiCD)).strCD(w_lngWork3 + 1) = w_varWork3(w_lngWork3)

                        Next w_lngWork3
                    End If

                Next w_lngWork2
            Next w_lngWork

            w_strWork = ""

            '看護助手;S04,S05,
            w_strWork = General.paGetItemValue(General.G_STRMAINKEY4, "HAICHI", "SUMDISP2", "", General.g_strHospitalCD)

            '看護助手;S04,S05,
            w_varWork = General.paSplit(w_strWork, ",")
            For w_lngWork = 0 To UBound(w_varWork)
                '看護助手
                'S04,S05
                w_varWork2 = General.paSplit(w_varWork(w_lngWork), ";")
                For w_lngWork2 = 0 To UBound(w_varWork2)
                    If w_lngWork2 = 0 Then
                        ReDim Preserve m_strJosyuCD(UBound(m_strJosyuCD) + 1)
                        m_strJosyuCD(w_lngWork2 + 1).strName = w_varWork2(w_lngWork2)
                        imtName2.Text = Convert.ToString(w_varWork2(w_lngWork2))
                    Else
                        w_varWork3 = General.paSplit(w_varWork2(w_lngWork2), "+")
                        For w_lngWork3 = 0 To UBound(w_varWork3)
                            ReDim Preserve m_strJosyuCD(UBound(m_strJosyuCD)).strCD(w_lngWork3 + 1)
                            m_strJosyuCD(UBound(m_strJosyuCD)).strCD(w_lngWork3 + 1) = w_varWork3(w_lngWork3)

                        Next w_lngWork3
                    End If

                Next w_lngWork2
            Next w_lngWork

            sprKangoshiData.EditModeReplace = True
            sprKangoshiData.Cursor = Cursors.Default

            With sprKangoshiData_Sheet1

                w_lngMaxStaffCnt_bk = w_lngSetRow1

                'スプレッド初期化
                .ClearRange(-1, -1, -1, -1, False)

                '列ヘッダー非表示
                .ColumnHeaderVisible = False
                '行ヘッダー非表示
                .RowHeaderVisible = False
                'スクロールバー非表示
                sprKangoshiData.HorizontalScrollBarPolicy = FarPoint.Win.Spread.ScrollBarPolicy.Never
                sprKangoshiData.VerticalScrollBarPolicy = FarPoint.Win.Spread.ScrollBarPolicy.Never

                '罫線の非表示
                Dim w_GridStyle As New FarPoint.Win.Spread.GridLine(FarPoint.Win.Spread.GridLineType.None)
                .HorizontalGridLine = w_GridStyle
                .VerticalGridLine = w_GridStyle

                '見せる最大行数
                '.VisibleRows = w_lngSetRow1

                '最大列数
                .ColumnCount = w_lngCnt + 1 ' w_lngCnt
                '見せる列数
                If w_lngCnt + 1 < w_lngSetCol Then
                    '.VisibleCols = w_lngCnt + 1
                Else
                    '.VisibleCols = w_lngSetCol
                End If

                .FrozenColumnCount = 1
                .FrozenRowCount = 1

                '行の高さ
                .SetRowHeight(-1, M_HAICHI_ROWHEIGHT)
                '列幅
                .SetColumnWidth(-1, M_HAICHI_COLWIDTH)
                .SetColumnWidth(1, 9)
                'セル囲いを消す
                '.EditModePermanent = True

                Dim w_style As New FarPoint.Win.Spread.StyleInfo
                Dim txtCellType As New FarPoint.Win.Spread.CellType.TextCellType
                txtCellType.WordWrap = False

                w_style.CellType = txtCellType
                w_style.HorizontalAlignment = FarPoint.Win.Spread.CellHorizontalAlignment.Left
                w_style.VerticalAlignment = FarPoint.Win.Spread.CellVerticalAlignment.Top

                '.TypeTextShadow = False
                '.TypeTextShadowIn = False
                '.TypeTextPrefix = False

                .Models.Style.SetDirectInfo(-1, -1, w_style)

                '１行目の背景色
                .Cells(M_KINMU_HEADER_ROW, -1, M_KINMU_HEADER_ROW, -1).BackColor = System.Drawing.SystemColors.Control

                '罫線の表示
                Dim w_lBorder As New FarPoint.Win.LineBorder(Color.Gray, 1, False, False, False, True)
                w_style.Border = w_lBorder
                .Cells(M_KINMU_HEADER_ROW, -1, M_KINMU_HEADER_ROW, -1).Border = w_lBorder

                '.BlockMode = True
                '.CellBorderType = SS_BORDER_TYPE_BOTTOM
                '.CellBorderStyle = SS_BORDER_STYLE_SOLID
                '.Action = SS_ACTION_SET_CELL_BORDER
                '.BlockMode = False

                w_style.CellType = txtCellType
                w_style.HorizontalAlignment = FarPoint.Win.Spread.CellHorizontalAlignment.Center
                .Models.Style.SetDirectInfo(M_KINMU_HEADER_ROW, -1, w_style)

                '.BlockMode = True
                '.CellType = SS_CELL_TYPE_STATIC_TEXT
                '.TypeHAlign = FPSpread.TypeHAlignConstants.TypeHAlignCenter
                '.BlockMode = False

                '１行目の背景色
                .Cells(-1, M_DATA_COL, -1, M_DATA_COL).BackColor = System.Drawing.SystemColors.Control

                '罫線を表示
                Dim w_lBorder2 As New FarPoint.Win.LineBorder(Color.Gray, 1, True, False, True, False)
                .Cells(-1, M_DATA_COL, -1, M_DATA_COL).Border = w_lBorder2

                '.BlockMode = True
                '.CellBorderType = SS_BORDER_TYPE_LEFT Or SS_BORDER_TYPE_RIGHT
                '.CellBorderStyle = SS_BORDER_STYLE_SOLID
                '.Action = SS_ACTION_SET_CELL_BORDER
                '.BlockMode = False

                .SetText(1, 1, "部署")

                w_lngDispCnt = UBound(m_strKangoshiCD(1).strCD)

                'データ挿入
                For w_lngLoop = 1 To w_lngCnt

                    w_strTEXT = m_udtHaichiStaff(w_lngLoop).strKinmuDeptName
                    '部署名称が18ﾊﾞｲﾄを超える場合、ﾌｫﾝﾄｻｲｽﾞを小さくする(9.75⇒9)
                    If General.paLenB(w_strTEXT) > 18 Then
                        '.Font.Size = 9
                    End If

                    .SetText(1, w_lngLoop + 1, m_udtHaichiStaff(w_lngLoop).strKinmuDeptName)

                    w_lngRowIndex = 1

                    w_lngMaxStaffCnt = 0

                    '職員データ
                    w_lngStaffCnt = UBound(m_udtHaichiStaff(w_lngLoop).Staff)
                    For w_lngStaffLoop = 1 To w_lngStaffCnt

                        '対象職員のみ
                        For w_lngDispLoop = 1 To w_lngDispCnt

                            If m_udtHaichiStaff(w_lngLoop).Staff(w_lngStaffLoop).strJobCD = m_strKangoshiCD(1).strCD(w_lngDispLoop) Then

                                w_lngRowIndex = w_lngRowIndex + 1

                                '役職名 + 職員氏名
                                w_strDispName = m_udtHaichiStaff(w_lngLoop).Staff(w_lngStaffLoop).strDispPostName & m_udtHaichiStaff(w_lngLoop).Staff(w_lngStaffLoop).strStaffName

                                '役職 + 職員氏名 + スペース + 職員番号(隠し項目)
                                w_strDispName = w_strDispName & Space(50) & m_udtHaichiStaff(w_lngLoop).Staff(w_lngStaffLoop).strStaffMngID

                                .SetText(1, w_lngRowIndex, w_strDispName)

                                w_lngMaxStaffCnt = w_lngMaxStaffCnt + 1

                                Exit For
                            End If

                        Next w_lngDispLoop

                    Next w_lngStaffLoop

                    m_udtHaichiStaff(w_lngLoop).lngSum1 = w_lngMaxStaffCnt

                    If w_lngMaxStaffCnt < w_lngMaxStaffCnt_bk Then
                        w_lngMaxStaffCnt_bk = w_lngMaxStaffCnt_bk
                    Else
                        w_lngMaxStaffCnt_bk = w_lngMaxStaffCnt
                    End If

                Next w_lngLoop

                .RowCount = w_lngMaxStaffCnt_bk + 1
                'AutoSizeは無いのでサイズの計算ロジックを実装するしかない
                '.AutoSize = True
                '.ReDraw = True

            End With

            w_lngMaxStaffCnt = 0
            w_lngMaxStaffCnt_bk = 0

            sprJosyuData.EditModeReplace = True
            sprJosyuData.Cursor = Cursors.Default

            With sprJosyuData_Sheet1

                w_lngMaxStaffCnt_bk = w_lngSetRow2

                '.ReDraw = False

                'スプレッド初期化
                .ClearRange(-1, -1, -1, -1, False)

                '列ヘッダー非表示
                .ColumnHeaderVisible = False
                '行ヘッダー非表示
                .RowHeaderVisible = False
                'スクロールバー非表示
                sprJosyuData.HorizontalScrollBarPolicy = FarPoint.Win.Spread.ScrollBarPolicy.Never
                sprJosyuData.VerticalScrollBarPolicy = FarPoint.Win.Spread.ScrollBarPolicy.Never

                '罫線の非表示
                Dim w_GridStyle As New FarPoint.Win.Spread.GridLine(FarPoint.Win.Spread.GridLineType.None)
                .HorizontalGridLine = w_GridStyle
                .VerticalGridLine = w_GridStyle

                '見せる最大行数
                '.VisibleRows = w_lngSetRow2
                '最大列数
                .ColumnCount = w_lngCnt + 1
                '見せる列数
                If w_lngCnt + 1 < w_lngSetCol Then
                    '.VisibleCols = w_lngCnt + 1
                Else
                    '.VisibleCols = w_lngSetCol
                End If

                .FrozenColumnCount = 1

                '行の高さ
                .SetRowHeight(-1, M_HAICHI_ROWHEIGHT)
                '列幅
                .SetColumnWidth(-1, M_HAICHI_COLWIDTH)
                .SetColumnWidth(1, 9)

                'セル囲いを消す
                '.EditModePermanent = True

                '１列目の背景色
                .Cells(-1, M_DATA_COL, -1, M_DATA_COL).BackColor = System.Drawing.SystemColors.Control

                '罫線を表示
                Dim w_style As New FarPoint.Win.Spread.StyleInfo
                Dim w_lBorder As New FarPoint.Win.LineBorder(Color.Gray, 1, True, False, True, False)
                w_style.Border = w_lBorder
                .Cells(-1, -1).Border = w_lBorder

                '.Row = -1
                '.Col = -1
                '.BlockMode = True
                '.CellBorderType = SS_BORDER_TYPE_LEFT Or SS_BORDER_TYPE_RIGHT
                '.CellBorderStyle = SS_BORDER_STYLE_SOLID
                '.Action = FPSpread.ActionConstants.ActionSetCellBorder
                '.BlockMode = False

                Dim txtCellType As New FarPoint.Win.Spread.CellType.TextCellType
                txtCellType.WordWrap = False

                w_style.CellType = txtCellType
                .Models.Style.SetDirectInfo(-1, -1, w_style)

                '.Row = -1
                '.Col = -1
                '.CellType = SS_CELL_TYPE_STATIC_TEXT
                '.TypeTextWordWrap = False

                w_lngDispCnt = UBound(m_strJosyuCD(1).strCD)

                'データ挿入
                For w_lngLoop = 1 To w_lngCnt


                    w_lngRowIndex = 0

                    w_lngMaxStaffCnt = 0

                    '職員データ
                    w_lngStaffCnt = UBound(m_udtHaichiStaff(w_lngLoop).Staff)
                    For w_lngStaffLoop = 1 To w_lngStaffCnt

                        '対象職員のみ
                        For w_lngDispLoop = 1 To w_lngDispCnt

                            If m_udtHaichiStaff(w_lngLoop).Staff(w_lngStaffLoop).strJobCD = m_strJosyuCD(1).strCD(w_lngDispLoop) Then

                                w_lngRowIndex = w_lngRowIndex + 1


                                '役職名 + 職員氏名
                                w_strDispName = m_udtHaichiStaff(w_lngLoop).Staff(w_lngStaffLoop).strDispPostName & m_udtHaichiStaff(w_lngLoop).Staff(w_lngStaffLoop).strStaffName

                                '役職 + 職員氏名 + スペース + 職員番号(隠し項目)
                                w_strDispName = w_strDispName & Space(50) & m_udtHaichiStaff(w_lngLoop).Staff(w_lngStaffLoop).strStaffMngID

                                .SetText(w_lngRowIndex, w_lngLoop + 1, w_strDispName)

                                w_lngMaxStaffCnt = w_lngMaxStaffCnt + 1

                                Exit For
                            End If

                        Next w_lngDispLoop

                    Next w_lngStaffLoop

                    m_udtHaichiStaff(w_lngLoop).lngSum2 = w_lngMaxStaffCnt

                    If w_lngMaxStaffCnt < w_lngMaxStaffCnt_bk Then
                        w_lngMaxStaffCnt_bk = w_lngMaxStaffCnt_bk
                    Else
                        w_lngMaxStaffCnt_bk = w_lngMaxStaffCnt
                    End If

                Next w_lngLoop

                .RowCount = w_lngMaxStaffCnt_bk
                'AutoSizeは無いのでサイズの計算ロジックを実装するしかない
                '.AutoSize = True

                '.ReDraw = True

            End With

            sprSum1.EditModeReplace = True
            sprSum1.Cursor = Cursors.Default

            With sprSum1_Sheet1

                '.ReDraw = False

                'スプレッド初期化
                .ClearRange(-1, -1, -1, -1, False)

                '列ヘッダー非表示
                .ColumnHeaderVisible = False
                '行ヘッダー非表示
                .RowHeaderVisible = False
                'スクロールバー非表示
                sprSum1.HorizontalScrollBarPolicy = FarPoint.Win.Spread.ScrollBarPolicy.Never
                sprSum1.VerticalScrollBarPolicy = FarPoint.Win.Spread.ScrollBarPolicy.Never

                '見せる最大行数
                .RowCount = 1
                '.VisibleRows = 1
                '最大列数
                .ColumnCount = w_lngCnt + 1
                '見せる列数
                If w_lngCnt + 1 < w_lngSetCol Then
                    '.VisibleCols = w_lngCnt + 1
                Else
                    '.VisibleCols = w_lngSetCol
                End If

                .FrozenColumnCount = 1
                .FrozenRowCount = 1

                Dim w_style As New FarPoint.Win.Spread.StyleInfo
                Dim txtCellType As New FarPoint.Win.Spread.CellType.TextCellType
                txtCellType.WordWrap = False

                w_style.CellType = txtCellType
                w_style.HorizontalAlignment = FarPoint.Win.Spread.CellHorizontalAlignment.Left
                w_style.VerticalAlignment = FarPoint.Win.Spread.CellVerticalAlignment.Top

                '.TypeTextShadow = False
                '.TypeTextShadowIn = False
                '.TypeTextWordWrap = False
                '.TypeTextPrefix = False
                .Models.Style.SetDirectInfo(-1, -1, w_style)

                '行の高さ
                .SetRowHeight(-1, M_HAICHI_ROWHEIGHT)
                '列幅
                .SetColumnWidth(-1, M_HAICHI_COLWIDTH)
                .SetColumnWidth(1, 9)

                'セル囲いを消す
                '.EditModePermanent = True

                '１行目の背景色
                .Cells(-1, 1, -1, 1).BackColor = System.Drawing.SystemColors.Control

                '罫線を表示
                Dim w_lBorder As New FarPoint.Win.LineBorder(Color.Gray, 1, True, False, True, False)
                w_style.Border = w_lBorder
                .Cells(-1, M_DATA_COL, -1, M_DATA_COL).Border = w_lBorder

                '.Row = -1
                '.Col = -1
                '.BlockMode = True
                '.CellBorderType = SS_BORDER_TYPE_OUTLINE
                '.CellBorderStyle = SS_BORDER_STYLE_SOLID
                '.Action = FPSpread.ActionConstants.ActionSetCellBorder
                '.BlockMode = False


                w_style.CellType = txtCellType
                w_style.HorizontalAlignment = FarPoint.Win.Spread.CellHorizontalAlignment.Center
                .Models.Style.SetDirectInfo(0, -1, w_style)

                '.BlockMode = True
                '.CellType = SS_CELL_TYPE_STATIC_TEXT
                '.TypeHAlign = FPSpread.TypeHAlignConstants.TypeHAlignCenter
                '.BlockMode = False

                '.AutoSize = True

                .SetText(1, 1, "小計")

                'データ挿入
                For w_lngLoop = 1 To w_lngCnt

                    '職員データ
                    w_lngStaffCnt = m_udtHaichiStaff(w_lngLoop).lngSum1

                    .SetText(1, w_lngLoop + 1, StrConv(Convert.ToString(w_lngStaffCnt), VbStrConv.Wide) & "名")

                Next w_lngLoop

                '.ReDraw = True

            End With

            sprSum2.EditModeReplace = True
            sprSum2.Cursor = Cursors.Default

            With sprSum2_Sheet1

                '.ReDraw = False

                'スプレッド初期化
                .ClearRange(-1, -1, -1, -1, False)

                '列ヘッダー非表示
                .ColumnHeaderVisible = False
                '行ヘッダー非表示
                .RowHeaderVisible = False
                'スクロールバー非表示
                sprSum2.HorizontalScrollBarPolicy = FarPoint.Win.Spread.ScrollBarPolicy.Never
                sprSum2.VerticalScrollBarPolicy = FarPoint.Win.Spread.ScrollBarPolicy.Never

                '見せる最大行数
                .RowCount = 2
                '.VisibleRows = 2
                '最大列数
                .ColumnCount = w_lngCnt + 1
                '見せる列数
                If w_lngCnt + 1 < w_lngSetCol Then
                    '.VisibleCols = w_lngCnt + 1
                Else
                    '.VisibleCols = w_lngSetCol
                End If

                .FrozenColumnCount = 1
                .FrozenRowCount = 2

                Dim w_style As New FarPoint.Win.Spread.StyleInfo
                Dim txtCellType As New FarPoint.Win.Spread.CellType.TextCellType
                txtCellType.WordWrap = False

                w_style.CellType = txtCellType
                w_style.HorizontalAlignment = FarPoint.Win.Spread.CellHorizontalAlignment.Left
                w_style.VerticalAlignment = FarPoint.Win.Spread.CellVerticalAlignment.Top

                '.TypeTextShadow = False
                '.TypeTextShadowIn = False
                '.TypeTextPrefix = False

                .Models.Style.SetDirectInfo(-1, -1, w_style)

                '行の高さ
                .SetRowHeight(-1, M_HAICHI_ROWHEIGHT)
                '列幅
                .SetColumnWidth(-1, M_HAICHI_COLWIDTH)
                .SetColumnWidth(1, 9)

                'セル囲いを消す
                '.EditModePermanent = True

                '１行目の背景色
                .Cells(-1, 1, -1, 1).BackColor = System.Drawing.SystemColors.Control

                '罫線を表示
                Dim w_lBorder As New FarPoint.Win.LineBorder(Color.Gray, 1, True, True, True, True)
                w_style.Border = w_lBorder
                .Cells(-1, -1).Border = w_lBorder

                w_style.HorizontalAlignment = FarPoint.Win.Spread.CellHorizontalAlignment.Center
                .Models.Style.SetDirectInfo(0, -1, w_style)

                '.AutoSize = True

                .SetText(1, 1, "小計")

                .SetText(2, 1, "合計")

                'データ挿入
                For w_lngLoop = 1 To w_lngCnt

                    '職員データ
                    w_lngStaffCnt = m_udtHaichiStaff(w_lngLoop).lngSum2

                    .SetText(1, w_lngLoop + 1, StrConv(Convert.ToString(w_lngStaffCnt), VbStrConv.Wide) & "名")

                    '職員データ
                    w_lngStaffCnt = m_udtHaichiStaff(w_lngLoop).lngSum1 + m_udtHaichiStaff(w_lngLoop).lngSum2

                    .SetText(2, w_lngLoop + 1, StrConv(Convert.ToString(w_lngStaffCnt), VbStrConv.Wide) & "名")

                Next w_lngLoop

                '.ReDraw = True

            End With

            sprSaiyoList.EditModeReplace = True
            sprSaiyoList.Cursor = Cursors.Default

            With sprSaiyoList_Sheet1

                '.ReDraw = False

                'スプレッド初期化
                .ClearRange(-1, -1, -1, -1, False)

                '列ヘッダー非表示
                .ColumnHeaderVisible = False
                '行ヘッダー非表示
                .RowHeaderVisible = False
                'スクロールバー非表示
                sprSum2.HorizontalScrollBarPolicy = FarPoint.Win.Spread.ScrollBarPolicy.Never
                sprSum2.VerticalScrollBarPolicy = FarPoint.Win.Spread.ScrollBarPolicy.Never

                '最大行数
                .RowCount = 12
                '最大列数
                .ColumnCount = 2
                '見せる列数
                '.VisibleCols = 12

                .FrozenColumnCount = 2
                .FrozenRowCount = 12

                Dim w_style As New FarPoint.Win.Spread.StyleInfo
                Dim txtCellType As New FarPoint.Win.Spread.CellType.TextCellType
                txtCellType.WordWrap = False

                w_style.CellType = txtCellType
                w_style.HorizontalAlignment = FarPoint.Win.Spread.CellHorizontalAlignment.Left
                w_style.VerticalAlignment = FarPoint.Win.Spread.CellVerticalAlignment.Top

                '.TypeTextShadow = False
                '.TypeTextShadowIn = False
                '.TypeTextPrefix = False

                .Models.Style.SetDirectInfo(-1, -1, w_style)

                '行の高さ
                .SetRowHeight(-1, M_HAICHI_ROWHEIGHT)
                '列幅
                .SetColumnWidth(1, 13)
                .SetColumnWidth(2, 6)

                'セル囲いを消す
                '.EditModePermanent = True

                '１列目の背景色
                .Cells(-1, 1, -1, 1).BackColor = System.Drawing.SystemColors.Control

                w_style.HorizontalAlignment = FarPoint.Win.Spread.CellHorizontalAlignment.Center
                .Models.Style.SetDirectInfo(0, -1, w_style)

                w_style.HorizontalAlignment = FarPoint.Win.Spread.CellHorizontalAlignment.Center
                .Models.Style.SetDirectInfo(-1, 2, w_style)

                '罫線を表示
                Dim w_lBorder As New FarPoint.Win.LineBorder(Color.Gray, 1, True, True, True, True)
                w_style.Border = w_lBorder
                .Cells(-1, -1).Border = w_lBorder

                .SetText(1, 1, "採用条件")

                .SetText(1, 2, "人数")

                w_lngCnt = UBound(m_udtEmpM)

                w_lngSumMaster = 0

                For w_lngLoop = 1 To w_lngCnt

                    .SetText(w_lngLoop + 1, 1, m_udtEmpM(w_lngLoop).strName)

                    .SetText(w_lngLoop + 1, 2, m_udtEmpM(w_lngLoop).lngCnt & "名")

                    w_lngSumMaster = w_lngSumMaster + m_udtEmpM(w_lngLoop).lngCnt

                Next w_lngLoop

                .SetText(12, 1, "合計")

                .SetText(12, 2, w_lngSumMaster & "名")

                '.ReDraw = True
            End With

            sprSaiyoList.EditModeReplace = True
            sprSaiyoList.Cursor = Cursors.Default

            With sprJobList_Sheet1

                '.ReDraw = False

                'スプレッド初期化
                .ClearRange(-1, -1, -1, -1, False)

                '列ヘッダー非表示
                .ColumnHeaderVisible = False
                '行ヘッダー非表示
                .RowHeaderVisible = False
                'スクロールバー非表示
                sprSum2.HorizontalScrollBarPolicy = FarPoint.Win.Spread.ScrollBarPolicy.Never
                sprSum2.VerticalScrollBarPolicy = FarPoint.Win.Spread.ScrollBarPolicy.Never

                '最大行数
                .RowCount = 12
                '最大列数
                .ColumnCount = 2
                '見せる列数
                '.VisibleCols = 2

                .FrozenColumnCount = 2
                .FrozenRowCount = 12

                Dim w_style As New FarPoint.Win.Spread.StyleInfo
                Dim txtCellType As New FarPoint.Win.Spread.CellType.TextCellType
                txtCellType.WordWrap = False

                w_style.CellType = txtCellType
                w_style.HorizontalAlignment = FarPoint.Win.Spread.CellHorizontalAlignment.Left
                w_style.VerticalAlignment = FarPoint.Win.Spread.CellVerticalAlignment.Top

                '.TypeTextShadow = False
                '.TypeTextShadowIn = False
                '.TypeTextPrefix = False

                .Models.Style.SetDirectInfo(-1, -1, w_style)

                '行の高さ
                .SetRowHeight(-1, M_HAICHI_ROWHEIGHT)
                '列幅
                .SetColumnWidth(1, 13)
                .SetColumnWidth(2, 6)

                'セル囲いを消す
                '.EditModePermanent = True

                '１列目の背景色
                .Cells(-1, 1, -1, 1).BackColor = System.Drawing.SystemColors.Control

                w_style.HorizontalAlignment = FarPoint.Win.Spread.CellHorizontalAlignment.Center
                .Models.Style.SetDirectInfo(0, -1, w_style)

                w_style.HorizontalAlignment = FarPoint.Win.Spread.CellHorizontalAlignment.Center
                .Models.Style.SetDirectInfo(-1, 3, w_style)

                '罫線を表示
                Dim w_lBorder As New FarPoint.Win.LineBorder(Color.Gray, 1, True, True, True, True)
                w_style.Border = w_lBorder
                .Cells(-1, -1).Border = w_lBorder

                .SetText(1, 1, "職種")

                .SetText(1, 2, "人数")

                w_lngCnt = UBound(m_udtJobM)

                w_lngSumMaster = 0

                For w_lngLoop = 1 To w_lngCnt

                    .SetText(w_lngLoop + 1, 1, m_udtJobM(w_lngLoop).strName)

                    .SetText(w_lngLoop + 1, 2, m_udtJobM(w_lngLoop).lngCnt & "名")

                    w_lngSumMaster = w_lngSumMaster + m_udtJobM(w_lngLoop).lngCnt

                Next w_lngLoop

                .SetText(12, 1, "合計")

                .SetText(12, 2, w_lngSumMaster & "名")

                '.ReDraw = True

            End With

            'sprSum1.Move(sprKangoshiData.Left, sprKangoshiData.Top + sprKangoshiData.Height)

            'sprJosyuData.Move(sprSum1.Left, sprSum1.Top + sprSum1.Height)

            'sprSum2.Move(sprJosyuData.Left, sprJosyuData.Top + sprJosyuData.Height)

            'sprSaiyoList.Move(sprKangoshiData.Left + sprKangoshiData.Width + 100, sprKangoshiData.Top, 2300, 3600)

            'sprJobList.Move(sprKangoshiData.Left + sprKangoshiData.Width + 100, sprKangoshiData.Top + sprSaiyoList.Height + 100, 2300, 3600)

            'imtName1.Move(sprKangoshiData.Left + 50, sprKangoshiData.Top + (sprKangoshiData.Height - 300) / 2)
            imtName1.BackColor = System.Drawing.SystemColors.Control

            'imtName2.Move(sprJosyuData.Left + 50, sprJosyuData.Top + (sprJosyuData.Height - 300) / 2)
            imtName2.BackColor = System.Drawing.SystemColors.Control

        Catch ex As Exception
            Call General.paTrpMsg(Convert.ToString(Err.Number), W_SUBNAME)
        End Try
    End Sub

    Private Sub sprJosyuData_Click(ByVal Col As Integer, ByVal Row As Integer)
        Dim sprJosyuData As Object
        Dim sprKangoshiData As Object
        Const W_SUBNAME As String = "NSC0000HA sprJosyuData_Click"

        Try
            '１列目はヘッダなので選択不可
            If Col = 1 Then
                Exit Sub
            End If

            With sprKangoshiData

                .ReDraw = False

                .Col = 2
                .Col2 = .MaxCols
                .Row = 2
                .Row2 = .MaxRows

                .BlockMode = True
                .ForeColor = System.Drawing.ColorTranslator.ToOle(System.Drawing.Color.Black)
                .BackColor = System.Drawing.ColorTranslator.ToOle(System.Drawing.Color.White)
                .BlockMode = False

                .ReDraw = True

            End With

            With sprJosyuData

                .ReDraw = False

                .Col = 2
                .Col2 = .MaxCols
                .Row = 1
                .Row2 = .MaxRows

                .BlockMode = True
                .ForeColor = System.Drawing.ColorTranslator.ToOle(System.Drawing.Color.Black)
                .BackColor = System.Drawing.ColorTranslator.ToOle(System.Drawing.Color.White)
                .BlockMode = False

                .Col = Col
                .Col2 = Col
                .Row = Row
                .Row2 = Row

                If String.IsNullOrEmpty(Trim(.Text)) Then

                    m_strSelHaichiKinmuDeptCD = ""
                    m_strSelHaichiStaffMngID = ""
                    Exit Sub
                End If

                .Col = Col
                .Col2 = Col
                .Row = Row
                .Row2 = Row

                .BlockMode = True
                .ForeColor = System.Drawing.ColorTranslator.ToOle(System.Drawing.Color.Black)
                .BackColor = System.Drawing.ColorTranslator.ToOle(System.Drawing.Color.Cyan)
                .BlockMode = False

                m_strSelHaichiStaffMngID = Trim(General.paRightB(.Text, 40))

                m_strSelHaichiKinmuDeptCD = Trim(m_udtHaichiStaff(Col + 1).strKinmuDeptCD)

                .ReDraw = True

            End With

        Catch ex As Exception
            Call General.paTrpMsg(Convert.ToString(Err.Number), W_SUBNAME)
        End Try
    End Sub

    Private Sub sprJosyuData_DblClick(ByVal Col As Integer, ByVal Row As Integer)
        Try
            Dim w_PreErrorProc As String
            w_PreErrorProc = General.g_ErrorProc 'ﾌﾟﾛｼｰｼﾞｬ名の一時待避
            General.g_ErrorProc = "NSC0000HA sprJosyuData_DblClick"

            '１列目はヘッダなので不可
            If Col = 1 Then
                Exit Sub
            End If

            If String.IsNullOrEmpty(m_strSelHaichiStaffMngID) AndAlso String.IsNullOrEmpty(m_strSelHaichiKinmuDeptCD) Then
                Exit Sub
            End If

            If m_blnStaffKihonInfo = True Then
                Call subKihon_Click()
            End If

            General.g_ErrorProc = w_PreErrorProc '待避ﾌﾟﾛｼｰｼﾞｬ名を元に戻す

        Catch ex As Exception
            Throw
        End Try
    End Sub

    Private Sub sprKangoshiData_Click(ByVal Col As Integer, ByVal Row As Integer)
        Dim sprKangoshiData As Object
        Dim sprJosyuData As Object
        Const W_SUBNAME As String = "NSC0000HA sprKangoshiData_Click"

        Try
            '1行目と１列目はヘッダなので選択不可
            If Col = 1 OrElse Row = 1 Then
                Exit Sub
            End If

            With sprJosyuData

                .ReDraw = False

                .Col = 2
                .Col2 = .MaxCols
                .Row = 1
                .Row2 = .MaxRows

                .BlockMode = True
                .ForeColor = System.Drawing.ColorTranslator.ToOle(System.Drawing.Color.Black)
                .BackColor = System.Drawing.ColorTranslator.ToOle(System.Drawing.Color.White)
                .BlockMode = False

                .ReDraw = True

            End With

            With sprKangoshiData

                .ReDraw = False

                .Col = 2
                .Col2 = .MaxCols
                .Row = 2
                .Row2 = .MaxRows

                .BlockMode = True
                .ForeColor = System.Drawing.ColorTranslator.ToOle(System.Drawing.Color.Black)
                .BackColor = System.Drawing.ColorTranslator.ToOle(System.Drawing.Color.White)
                .BlockMode = False

                .Col = Col
                .Col2 = Col
                .Row = Row
                .Row2 = Row

                If String.IsNullOrEmpty(Trim(.Text)) Then

                    m_strSelHaichiKinmuDeptCD = ""
                    m_strSelHaichiStaffMngID = ""
                    Exit Sub
                End If

                .Col = Col
                .Col2 = Col
                .Row = Row
                .Row2 = Row

                .BlockMode = True
                .ForeColor = System.Drawing.ColorTranslator.ToOle(System.Drawing.Color.Black)
                .BackColor = System.Drawing.ColorTranslator.ToOle(System.Drawing.Color.Cyan)
                .BlockMode = False

                m_strSelHaichiStaffMngID = Trim(General.paRightB(.Text, 40))

                m_strSelHaichiKinmuDeptCD = Trim(m_udtHaichiStaff(Col - 1).strKinmuDeptCD) 'Trim(m_udtHaichiStaff(Col + 1).strKinmuDeptCD)

                .ReDraw = True

            End With

        Catch ex As Exception
            Call General.paTrpMsg(Convert.ToString(Err.Number), W_SUBNAME)
        End Try
    End Sub

    Private Sub sprKangoshiData_DblClick(ByVal Col As Integer, ByVal Row As Integer)
        Try
            Dim w_PreErrorProc As String
            w_PreErrorProc = General.g_ErrorProc 'ﾌﾟﾛｼｰｼﾞｬ名の一時待避
            General.g_ErrorProc = "NSC0000HA sprKangoshiData_DblClick"

            '1行目と１列目はヘッダなので不可
            If Col = 1 OrElse Row = 1 Then
                Exit Sub
            End If

            If String.IsNullOrEmpty(m_strSelHaichiStaffMngID) AndAlso String.IsNullOrEmpty(m_strSelHaichiKinmuDeptCD) Then
                Exit Sub
            End If

            If m_blnStaffKihonInfo = True Then
                Call subKihon_Click()
            End If

            General.g_ErrorProc = w_PreErrorProc '待避ﾌﾟﾛｼｰｼﾞｬ名を元に戻す

        Catch ex As Exception
            Throw
        End Try
    End Sub


    Public Sub SearchSelected()
        Const W_SUBNAME As String = "frmNSC0000HA SearchSelected"

        Try

            If (IsNothing(tvwKinmuDept.SelectedNode) AndAlso tvwKinmuDept.Nodes.Find(M_strSearchCD, True).Length > 0) _
                OrElse (tvwKinmuDept.SelectedNode.Text <> tvwKinmuDept.Nodes.Find(M_strSearchCD, True)(0).Text) Then
                'ツリービューの選択が無く、ツリービューにNode検索結果が存在する 
                'または　ツリービューの選択がNode検索結果以外
                tvwKinmuDept.SelectedNode = tvwKinmuDept.Nodes.Find(M_strSearchCD, True)(0)
                tvwKinmuDept.Nodes.Find(M_strSearchCD, True)(0).Checked = True
            Else
                Call tvwKinmuDept_NodeClick(tvwKinmuDept, New System.Windows.Forms.TreeViewEventArgs(tvwKinmuDept.Nodes.Find(M_strSearchCD, True)(0)))
                tvwKinmuDept.Nodes.Find(M_strSearchCD, True)(0).Checked = True
            End If

        Catch ex As Exception
            Call General.paTrpMsg(Convert.ToString(Err.Number), W_SUBNAME)
        End Try
    End Sub

    '検索画面より検索結果の基準日取得
    Public WriteOnly Property pSearchDate() As Integer
        Set(ByVal Value As Integer)
            g_SearchDate = Value
        End Set
    End Property

    '画面 終了状態ﾌﾗｸﾞ 取得
    Public ReadOnly Property pEndStatus() As Object
        Get
            pEndStatus = m_EndStatus
        End Get
    End Property

    '====================================
    '日別時間外の承認情報を更新
    '====================================
    Private Function sUpdApproveDayOver() As Boolean
        Const W_functionNAME As String = "NSC0000HA sUpdApproveDayOver"

        Try
            Dim w_lngLoop As Integer
            Dim w_blnUPDFlg As Boolean
            Dim w_blnErrorFlg As Boolean
            Dim w_blnOKFlg As Boolean
            Dim w_lngErrorCnt As Integer
            Dim w_strMsg() As String
            Const WC_MONTHRESOURCE As String = "NSW0020HA6"
            Dim w_intOutCnt As Integer
            Dim w_blnOutFlg As Boolean
            Dim w_blnLockMsgFlg As Boolean 'ロックがかかっていて承認できないメッセージを表示したか否か
            Dim w_Int As Integer
            Dim w_tmpStaff() As String
            Dim w_Cnt As String
            Dim w_mngId As String
            Dim w_i As Integer
            Dim w_getMngIdFlg As Boolean
            Dim w_updFlg As Boolean
            Dim w_procDate As String
            Dim w_lngFrom As Integer
            Dim w_lngTo As Integer
            Dim w_tmpLngFrom As Integer
            Dim w_tmpLngTo As Integer
            Dim w_updOvRuikeFlg As String

            '★最初に勤務実績チェックや超勤入力可能勤務？もしくは時間年休登録可能勤務などを確認する
            '（入力画面と同じ処理）

            sUpdApproveDayOver = False

            w_updOvRuikeFlg = General.paGetItemValue(General.G_STRMAINKEY3, General.G_STRSUBKEY13, "INSPECTIONUPDFLG", "0", General.g_strHospitalCD)
            ReDim w_tmpStaff(0)
            w_Cnt = Convert.ToString(0)
            w_mngId = ""
            w_updFlg = False


            w_blnErrorFlg = False
            w_lngErrorCnt = 0
            w_blnOKFlg = False
            w_intOutCnt = 0

            With General.g_objSyouninData

                w_blnLockMsgFlg = False

                For w_Int = 0 To lvwDeptInfo.Items.Count - 1
                    w_blnOutFlg = False
                    If lvwDeptInfo.Items.Item(w_Int).Checked = True Then
                        w_lngLoop = lvwDeptInfo.Items.Item(w_Int).Tag
                        If m_udtDayOverKinmu(w_lngLoop).IconStatus = M_OK_APPROVE Then
                            w_blnOutFlg = False
                            If GetShimekiri2(General.paGetDateIntegerFromDate(m_DayOverSelectDate)) = 1 Then
                                '月の締切日を過ぎているとき→月締め後の操作権限があるか
                                If General.g_objSecurity.mGetResource(WC_MONTHRESOURCE) = False Then
                                    w_blnOutFlg = True
                                    w_intOutCnt = w_intOutCnt + 1
                                Else
                                    If String.IsNullOrEmpty(General.g_objSecurity.fR_UpdAuthRangeKbn) OrElse General.G_STRAUTHRANGENOTHING.Equals(General.g_objSecurity.fR_UpdAuthRangeKbn) Then

                                        w_blnOutFlg = True
                                        w_intOutCnt = w_intOutCnt + 1
                                    End If
                                End If
                            End If

                            If m_blnOverKinmuLockFlg = True Then

                                If General.g_objSecurity.mGetResource(M_APPRO_DAY_OVER_LOCK) = False Then

                                    If w_blnLockMsgFlg = False Then
                                        ReDim w_strMsg(0)
                                        Call General.paMsgDsp("NS0283", w_strMsg)

                                        w_blnOutFlg = True
                                        w_blnLockMsgFlg = True
                                    End If

                                Else
                                    If String.IsNullOrEmpty(General.g_objSecurity.fR_UpdAuthRangeKbn) OrElse General.G_STRAUTHRANGENOTHING.Equals(General.g_objSecurity.fR_UpdAuthRangeKbn) Then

                                        If w_blnLockMsgFlg = False Then
                                            ReDim w_strMsg(0)
                                            Call General.paMsgDsp("NS0283", w_strMsg)

                                            w_blnOutFlg = True
                                            w_blnLockMsgFlg = True
                                        End If

                                    Else

                                        If General.g_objSecurity.mCheckAuthRangeKbn(General.g_objSecurity.fR_UpdAuthRangeKbn, m_udtStaffData(w_lngLoop).strStaffMngID, General.g_strSelKinmuDeptCD) = True Then

                                        Else

                                            If w_blnLockMsgFlg = False Then
                                                ReDim w_strMsg(0)
                                                Call General.paMsgDsp("NS0283", w_strMsg)

                                                w_blnOutFlg = True
                                                w_blnLockMsgFlg = True
                                            End If

                                        End If

                                    End If
                                End If

                            End If

                        Else
                            w_blnOutFlg = True
                        End If

                        If w_blnOutFlg = False Then

                            If w_updOvRuikeFlg = "1" Then
                                '更新処理を行うとき
                                w_mngId = m_udtStaffData(w_lngLoop).strStaffMngID
                                w_getMngIdFlg = True
                                '今までに取得した職員番号と比較
                                For w_i = 1 To UBound(w_tmpStaff)
                                    If w_mngId = w_tmpStaff(w_i) Then
                                        '既に格納した職員管理番号に該当するとき
                                        w_getMngIdFlg = False
                                        Exit For
                                    End If
                                Next w_i

                                If w_getMngIdFlg = True Then
                                    '1件も該当するデータがないとき、時間外届出累計更新対象者
                                    w_updFlg = True
                                    w_Cnt = Convert.ToString(UBound(w_tmpStaff) + 1)
                                    ReDim Preserve w_tmpStaff(w_Cnt)
                                    w_tmpStaff(Integer.Parse(w_Cnt)) = w_mngId
                                End If
                            End If

                            .pAppliCD = M_STRJIKANGAI '届出CD
                            .pAppliStaffMngID = m_udtStaffData(w_lngLoop).strStaffMngID '申請者の職員管理番号
                            .pAppliDate = General.paGetDateIntegerFromDate(m_DayOverSelectDate) '申請日付
                            .pUniqueSeqNo = m_udtDayOverKinmu(w_lngLoop).UNIQUESEQNO 'UNIQUESEQNO
                            .pDispMode = "2" '表示ﾓｰﾄﾞ
                            .pSyoriKbn = "2" '処理区分
                            .pApproveStaffMngID = General.g_strUserMngID '承認者職員管理番号
                            .mApproveComment = ""
                            .mApproveClassLevel = m_udtDayOverKinmu(w_lngLoop).ApproveLevel
                            .mApproveStaffMngID = General.g_strUserMngID
                            .mLastUpdTimeDate = m_udtDayOverKinmu(w_lngLoop).LastUpdDate
                            .mSyoriMode = "1" '1:承認 2:申請者に差戻 3:１つ前に差戻 4:保留

                            .pResourceCD = m_strDispMenu

                            '呼び出し側でコミット
                            Call General.paBeginTrans()

                            w_blnUPDFlg = .mApprove

                            '更新が異常の場合はロールバック()
                            If w_blnUPDFlg = False Then
                                'ロールバック
                                Call General.paRollBack()
                                w_blnErrorFlg = True
                                w_lngErrorCnt = w_lngErrorCnt + 1
                            Else

                                If fncSaveOverKinmuAdjust(m_udtDayOverKinmu(w_lngLoop).AppliStaffMngID, m_udtDayOverKinmu(w_lngLoop).UNIQUESEQNO, m_udtDayOverKinmu(w_lngLoop).ApproveLevel, m_udtDayOverKinmu(w_lngLoop).AppliDate) = False Then
                                    'ロールバック
                                    Call General.paRollBack()
                                    w_blnErrorFlg = True
                                    w_lngErrorCnt = w_lngErrorCnt + 1
                                Else
                                    'コミット
                                    Call General.paCommit()
                                    w_blnOKFlg = True
                                End If
                            End If

                        End If
                    End If
                Next w_Int
            End With

            If w_updOvRuikeFlg = "1" And w_updFlg = True Then
                '更新対象者なら時間外届出累計を更新
                w_procDate = General.paGetDateIntegerFromDate(m_CalDate, General.G_DATE_ENUM.yyyyMM)
                w_procDate = w_procDate & ":" & judgeOvKinmDate(General.paGetDateIntegerFromDate(m_CalDate))
                Call startApprvRuike(w_tmpStaff, w_procDate)
            End If

            '異常が発生した場合
            If w_blnErrorFlg = True Then
                ReDim w_strMsg(1)
                w_strMsg(1) = Convert.ToString(w_lngErrorCnt)
                Call General.paMsgDsp("NS0144", w_strMsg)
            End If

            If w_intOutCnt > 0 Then
                ReDim w_strMsg(0)
                Call General.paMsgDsp("NS0282", w_strMsg)
            End If

            '1件でも更新があれば再表示
            If w_blnOKFlg = True Then
                General.g_objGetData.pUniqueSeqNo = "" 'UNIQUESEQNO
            End If

            sUpdApproveDayOver = w_blnOKFlg

        Catch ex As Exception
            Call General.paTrpMsg(Convert.ToString(Err.Number), W_functionNAME)
        End Try
    End Function

    Private Sub subPersonal_Click()
        Try
            Dim w_PreErrorProc As String
            w_PreErrorProc = General.g_ErrorProc 'ﾌﾟﾛｼｰｼﾞｬ名の一時待避
            General.g_ErrorProc = "frmNSC0000HA subPersonal_Click"

            If lvwDeptInfo.Items.Count = 0 Then
                General.g_ErrorProc = w_PreErrorProc '待避ﾌﾟﾛｼｰｼﾞｬ名を元に戻す
                Exit Sub
            End If

            If IIf(IsDBNull(m_lngSelectListIndex), 0, m_lngSelectListIndex) = 0 Then
                m_lngSelectListIndex = 1
            ElseIf m_lngSelectListIndex > UBound(m_udtStaffData) Then
                m_lngSelectListIndex = 1
            End If

            If UBound(m_udtStaffData) <= 0 Then
                Exit Sub
            End If

            m_strSelectStaffMngID = Trim(m_udtStaffData(m_lngSelectListIndex).strStaffMngID)
            m_strSelectStaffID = Trim(m_udtStaffData(m_lngSelectListIndex).strStaffID)

            '個人画面用セキュリティ部品
            If fncCheckPersonalSecurity(m_strSelectStaffMngID) = False Then
                Exit Sub
            End If

            tvwPersonal.Visible = True
            tvwPersonal.Enabled = True

            m_strSelectStaffID = Trim(lvwDeptInfo.Items.Item(m_lngSelectListIndex).SubItems(1).Text)

            lblSearchData.Text = m_strSelectStaffID & Space(2) & m_udtStaffData(m_lngSelectListIndex).strName
            'lblSearchData.Font = FontChangeBold(lblSearchData.Font, True)
            lblSearchData.ForeColor = System.Drawing.Color.Blue

            m_DisplayMode = "2"

            Call SetTreeListView()


            '個人画面表示
            Call subDisplayPersonalData()

            General.g_ErrorProc = w_PreErrorProc '待避ﾌﾟﾛｼｰｼﾞｬ名を元に戻す

        Catch ex As Exception
            Throw
        End Try
    End Sub

    '個人ツリー作成前のセキュリティチェック
    Private Function fncCheckPersonalSecurity(ByVal p_strSelectStaffMngID As String) As Boolean
        Try
            Dim w_PreErrorProc As String
            w_PreErrorProc = General.g_ErrorProc 'ﾌﾟﾛｼｰｼﾞｬ名の一時待避
            General.g_ErrorProc = "frmNSC0000HA fncCheckPersonalSecurity"

            Dim w_lngPackageCnt As Integer
            Dim w_lngLoop As Integer
            Dim w_lngIndex As Integer

            Dim w_strMsg() As String

            fncCheckPersonalSecurity = False

            '初期化
            ReDim g_UserPackage(0)

            'セキュリティ部品　５−８
            '必要権限範囲取得
            'mGetNeedAuthRangeKbn(p_選択された職員の職員番号)
            m_strAuthRangeKbn = ""
            If General.g_objSecurity.mGetNeedAuthRangeKbn(p_strSelectStaffMngID, General.paGetDateIntegerFromDate(Today)) = True Then
                m_strAuthRangeKbn = General.g_objSecurity.fNeedAuthRangeKbn

            Else
                '選択された職員の捜査権限が取得されない場合
                ReDim w_strMsg(2)
                w_strMsg(1) = "職員"
                w_strMsg(2) = "操作"
                Call General.paMsgDsp("NS0093", w_strMsg)

                Exit Function

            End If

            'セキュリティ部品　５−２
            'パッケージ別一括権限取得
            'mGetAllResourcePackage(p_画面ID, p_権限範囲区分)
            If General.g_objSecurity.mGetAllResourcePackage(g_strNSC2000HA, m_strAuthRangeKbn) = True Then

                w_lngPackageCnt = General.g_objSecurity.fARP_Count

                For w_lngLoop = 1 To w_lngPackageCnt

                    General.g_objSecurity.mARP_Idx = w_lngLoop

                    If "3".Equals(General.g_objSecurity.fARP_ObjectKbn) Then

                        w_lngIndex = UBound(g_UserPackage) + 1

                        ReDim Preserve g_UserPackage(w_lngIndex)

                        g_UserPackage(w_lngIndex).strPackageCD = General.g_objSecurity.fARP_PackageCD 'パッケージコード
                        g_UserPackage(w_lngIndex).strPackageName = General.g_objSecurity.fARP_PackageName 'パッケージ名称
                        g_UserPackage(w_lngIndex).strResourceCD = General.g_objSecurity.fARP_ResourceCD 'リソースコード
                        g_UserPackage(w_lngIndex).strTitle = General.g_objSecurity.fARP_Title 'タイトル
                        g_UserPackage(w_lngIndex).strObjectName = General.g_objSecurity.fARP_ObjectNm 'オブジェクト名
                        g_UserPackage(w_lngIndex).strObjectKbn = General.g_objSecurity.fARP_ObjectKbn 'オブジェクト区分
                        g_UserPackage(w_lngIndex).strSecuResourceCD = General.g_objSecurity.fARP_SecuResourceCD 'セキュリティリソースコード
                        g_UserPackage(w_lngIndex).strMasterKbn = General.g_objSecurity.fARP_MasterKbn 'マスタ区分
                        g_UserPackage(w_lngIndex).strMasterID = General.g_objSecurity.fARP_MasterID 'マスタID
                        g_UserPackage(w_lngIndex).strUpdAuthRangeKbn = General.g_objSecurity.fARP_UpdAuthRangeKbn '更新権限範囲区分
                        g_UserPackage(w_lngIndex).strRefAuthRangeKbn = General.g_objSecurity.fARP_RefAuthRangeKbn '参照権限範囲区分

                    End If

                Next w_lngLoop
            Else

                '選択された職員の捜査権限はあるが、操作できる項目がない場合
                ReDim w_strMsg(2)
                w_strMsg(1) = "職員"
                w_strMsg(2) = "操作"
                Call General.paMsgDsp("NS0093", w_strMsg)

                Exit Function
            End If

            fncCheckPersonalSecurity = True

            General.g_ErrorProc = w_PreErrorProc '待避ﾌﾟﾛｼｰｼﾞｬ名を元に戻す

        Catch ex As Exception
            Throw
        End Try
    End Function

    Private Sub SetTreeListView()
        Const W_SUBNAME As String = "NSC0000HA SetTreeListView"

        Try
            vseCover.Visible = True
            vseCover.Left = albMenu.Left
            vseCover.Width = Me.Width
            vseCover.Top = albMenu.Top
            vseCover.Height = albMenu.Height
            fraDataGet.Left = vseCover.Width / 3
            fraDataGet.Top = vseCover.Height / 3
            Call vseCover.BringToFront()
            System.Windows.Forms.Application.DoEvents()

            'ﾏｳｽﾎﾟｲﾝﾀを砂時計に
            Me.Cursor = System.Windows.Forms.Cursors.WaitCursor

            'With sptMain
            '    'Splitterの高さを取得
            '    w_splHeight = .Height

            '    'Splitterの初期化(Paneをひとつにまとめる)
            '    For w_Int = .Panes.count - 1 To 1 Step -1
            '        If Not (.Panes(w_Int).Control Is Nothing) Then
            '            w_Control = .Panes(w_Int).Control
            '            w_Control.Visible = False
            '            w_Control = Nothing
            '            .Panes(w_Int).Control = Nothing
            '        End If
            '        .Panes.Remove(.Panes(w_Int).Name)
            '    Next w_Int
            '    '=========================================================================================

            '    lvwMain.Visible = False '個人業務-リストビュー
            '    vsePersonal.Visible = False '個人業務-ツールバー（個人業務用Elastic）
            '    imdFrom.Visible = False
            '    imdTo.Visible = False
            '    cmdPersonalFrom.Visible = False
            '    cmdPersonalTo.Visible = False

            '    cmbStatus.Visible = False
            '    Label2.Visible = False
            '    Label3.Visible = False
            '    sprKinmuCnt.Visible = False
            '    sprMatrix.Visible = False
            '    sprTanka.Visible = False
            '    vsePersonalHol.Visible = False '個人業務-休暇情報のElastic
            '    lvwDeptInfo.Visible = False '部署業務-リストビュー（勤務部署用Elastic）
            '    vseDeptInfo.Visible = False '部署業務-ツールバー
            '    vstKinmuDept.Visible = False '部署情報タブ
            '    vseApproveInfo.Visible = False '未承認ツールバー（未承認用Elastic）
            '    vseDutyInfo.Visible = False '日当直ツールバー（日当直用Elastic）
            '    vseDakokuInfo.Visible = False '出退勤ツールバー（出退勤用Elastic）
            '    vseZaiin.Visible = False '在院照会（在院照会用Elastic）
            '    vseHaichi.Visible = False '配置表（配置表用Elastic）

            '    tvwPersonal.Visible = False
            '    tvwPersonal.Enabled = False

            '    vseInformation.Visible = False
            '    lvwInformation.Visible = False
            '    vsePersonal.Visible = False
            '    vseCalendar.Visible = False

            '    If m_DisplayMode = "1" Then

            '        .Panes(0).Name = M_PANENAME0

            '        'カレンダー用Paneを追加
            '        .Panes.Add(M_PANENAME0, SSSplitter.Constants_SplitType.ssBottomOfSplit, M_PANENAME2)
            '        'リストビューPaneを追加
            '        .Panes.Add(M_PANENAME2, SSSplitter.Constants_SplitType.ssRightOfSplit, M_PANENAME5)

            '        .Panes.Add(M_PANENAME2, SSSplitter.Constants_SplitType.ssBottomOfSplit, M_PANENAME3)
            '        '部署選択用Paneを追加
            '        .Panes.Add(M_PANENAME3, SSSplitter.Constants_SplitType.ssBottomOfSplit, M_PANENAME4)

            '        .Panes(M_PANENAME0).MinHeight = 0
            '        .Panes(M_PANENAME0).Height = 0
            '        .Panes(M_PANENAME2).MinHeight = 0
            '        .Panes(M_PANENAME2).Height = 0
            '        .Panes(M_PANENAME3).MinHeight = 0
            '        .Panes(M_PANENAME3).Height = 0
            '        .Panes(M_PANENAME4).MinWidth = M_LISTWIDTH
            '        .Panes(M_PANENAME4).Width = M_LISTWIDTH

            '        .Panes(M_PANENAME2).Control = vseCalendar
            '        .Panes(M_PANENAME3).Control = vsePersonal
            '        .Panes(M_PANENAME4).Control = vstKinmuDept.CurrTab
            '        .Panes(M_PANENAME5).Control = lvwDeptInfo.Text

            '        tvwKinmuDept.Visible = True
            '        tvwKinmuDept.Enabled = True
            '        lvwDeptStaff.Visible = True
            '        lvwDeptStaff.Enabled = True
            '        tvwPersonal.Visible = False
            '        tvwPersonal.Enabled = False

            '        lvwDeptInfo.Visible = True
            '        lvwDeptInfo.Enabled = True
            '        lvwMain.Visible = False
            '        lvwMain.Enabled = False

            '        vstKinmuDept.Visible = True
            '        vstKinmuDept.Enabled = True

            '    ElseIf m_DisplayMode = "2" Then

            '        .Panes(0).Name = M_PANENAME0

            '        'カレンダー用Paneを追加
            '        .Panes.Add(M_PANENAME0, SSSplitter.Constants_SplitType.ssBottomOfSplit, M_PANENAME2)
            '        'リストビューPaneを追加
            '        .Panes.Add(M_PANENAME2, SSSplitter.Constants_SplitType.ssRightOfSplit, M_PANENAME5)

            '        .Panes.Add(M_PANENAME2, SSSplitter.Constants_SplitType.ssBottomOfSplit, M_PANENAME3)
            '        '部署選択用Paneを追加
            '        .Panes.Add(M_PANENAME3, SSSplitter.Constants_SplitType.ssBottomOfSplit, M_PANENAME4)

            '        .Panes(M_PANENAME0).MinHeight = 0
            '        .Panes(M_PANENAME0).Height = 0
            '        .Panes(M_PANENAME2).MinHeight = 0
            '        .Panes(M_PANENAME2).Height = 0
            '        .Panes(M_PANENAME3).MinHeight = 0
            '        .Panes(M_PANENAME3).Height = 0
            '        .Panes(M_PANENAME4).MinWidth = M_PERSONALWIDTH
            '        .Panes(M_PANENAME4).Width = M_PERSONALWIDTH

            '        .Panes(M_PANENAME2).Control = vseCalendar
            '        .Panes(M_PANENAME3).Control = vsePersonal
            '        .Panes(M_PANENAME4).Control = tvwPersonal
            '        .Panes(M_PANENAME5).Control = lvwMain.Text

            '        lvwDeptInfo.Visible = False
            '        lvwDeptInfo.Enabled = False
            '        lvwMain.Visible = True
            '        lvwMain.Enabled = True

            '        tvwKinmuDept.Visible = False
            '        tvwKinmuDept.Enabled = False
            '        lvwDeptStaff.Visible = False
            '        lvwDeptStaff.Enabled = False
            '        tvwPersonal.Visible = True
            '        tvwPersonal.Enabled = True
            '        vstKinmuDept.Visible = False
            '        vstKinmuDept.Enabled = False
            '    End If

            'End With

            'w_Control = Nothing

            ''ﾏｳｽﾎﾟｲﾝﾀを元に戻す
            'Me.Cursor = System.Windows.Forms.Cursors.Default

            'vseCover.Visible = False

            ''ステータスバー編集
            'barStatus.Items.Item(1).Text = ""
            'barStatus.Refresh()

        Catch ex As Exception
            Me.Cursor = System.Windows.Forms.Cursors.Default
            Call General.paTrpMsg(Convert.ToString(Err.Number), W_SUBNAME)
        End Try
    End Sub

    Private Sub subDisplayPersonalData()
        Try
            Dim w_PreErrorProc As String
            w_PreErrorProc = General.g_ErrorProc 'ﾌﾟﾛｼｰｼﾞｬ名の一時待避
            General.g_ErrorProc = "frmNSC0000HA subDisplayPersonalData"

            Dim w_Node As System.Windows.Forms.TreeNode
            Dim w_Idx As Integer

            Dim w_strResCD As String
            Dim w_strMainNodeName As String

            w_strMainNodeName = ""
            w_strResCD = ""

            With tvwPersonal

                'Pictureｺﾝﾄﾛｰﾙの設定
                .ImageList = imlSmallIcon

                'TreeViewのｸﾘｱｰ
                .Nodes.Clear()

                '部署分類区分表示
                For w_Idx = 1 To UBound(g_UserPackage)

                    If g_UserPackage(w_Idx).strPackageName.Equals(w_strMainNodeName) = False Then
                        w_Node = .Nodes.Add(g_UserPackage(w_Idx).strPackageCD, g_UserPackage(w_Idx).strPackageName, "GREEN")
                        w_Node.Expand()
                        w_strMainNodeName = g_UserPackage(w_Idx).strPackageName
                        If String.IsNullOrEmpty(w_strResCD) Then
                            w_strResCD = g_UserPackage(w_Idx).strResourceCD
                        End If
                    End If

                    'Node追加
                    w_Node = .Nodes.Find(g_UserPackage(w_Idx).strPackageCD, True)(0).Nodes.Add(g_UserPackage(w_Idx).strResourceCD, g_UserPackage(w_Idx).strTitle, "BLUE")

                    '初期状態はすべてOpenに
                    w_Node.Expand()

                Next w_Idx

                If String.IsNullOrEmpty(w_strResCD) = False Then
                    m_Node = w_strResCD
                    .Nodes.Item(m_Node).Checked = True
                    .SelectedNode = .Nodes.Item(m_Node)
                    Call tvwPersonal_NodeClick(tvwPersonal, New System.Windows.Forms.TreeNodeMouseClickEventArgs(.Nodes.Item(m_Node), System.Windows.Forms.MouseButtons.None, 0, 0, 0))
                End If

            End With

            General.g_ErrorProc = w_PreErrorProc '待避ﾌﾟﾛｼｰｼﾞｬ名を元に戻す

        Catch ex As Exception
            Throw
        End Try
    End Sub

    Private Sub tvwPersonal_NodeClick(ByVal eventSender As System.Object, ByVal eventArgs As System.Windows.Forms.TreeNodeMouseClickEventArgs) Handles tvwPersonal.NodeMouseClick
        Dim Node As System.Windows.Forms.TreeNode = eventArgs.Node
        Dim lblKikan As Object
        Dim cboKikan As Object
        Dim lblKinmuBusyo As Object
        Dim cboKinmuBusyo As Object

        Try
            Dim w_PreErrorProc As String
            w_PreErrorProc = General.g_ErrorProc 'ﾌﾟﾛｼｰｼﾞｬ名の一時待避
            General.g_ErrorProc = "frmNSC0000HA tvwPersonal_NodeClick"

            Dim w_lngCnt As Integer
            Dim w_lngLoop As Integer
            Dim w_List As System.Windows.Forms.ListViewItem
            Dim w_column As System.Windows.Forms.ColumnHeader

            Dim w_lngDate As Integer
            Dim w_strUpdRangeKbn As String
            Dim w_strWork As String

            Dim w_blnADD As Boolean
            Dim w_blnUPD As Boolean
            Dim w_blnDEL As Boolean

            Dim w_strAccessEvent As String
            Dim w_blnResult As Boolean

            Dim w_blnFLG As Boolean

            Const W_strSTUDY As String = "NSC2000HA24" '研修申込

            Const W_strALL As String = "0"

            '研修用定数
            '0:申込
            Const W_strMousikomiCD As String = "0"
            Const W_strMousikomiDISP As String = "申込"
            '1:受講登録
            Const W_strTourokuCD As String = "1"
            Const W_strTourokuDISP As String = "受講登録"
            '2:受講完了
            Const W_strKanryouCD As String = "2"
            Const W_strKanryouDISP As String = "受講完了"


            cboKinmuBusyo.Visible = False
            cboKinmuBusyo.Enabled = False
            lblKinmuBusyo.Visible = False
            cboKikan.Visible = False
            cboKikan.Enabled = False
            lblKikan.Visible = False

            'リストビューの幅を設定
            If String.IsNullOrEmpty(m_strNodeKey) = False Then
                Call sSaveFieldWidth()
            End If

            '確保
            m_strNodeKey = Node.Name

            w_lngDate = General.paGetDateIntegerFromDate(Today)

            m_strSelectResCD = IIf(IsDBNull(Node.Name), "", Trim(Node.Name))

            w_blnUPD = True

            w_lngCnt = 0

            'データ入力変更用子画面のIDを取得
            m_strObjectName = ""
            For w_lngLoop = 1 To UBound(g_UserPackage)
                If g_UserPackage(w_lngLoop).strResourceCD = m_strSelectResCD Then
                    m_strObjectName = g_UserPackage(w_lngLoop).strObjectName
                    w_strUpdRangeKbn = g_UserPackage(w_lngLoop).strUpdAuthRangeKbn
                    Exit For
                End If
            Next w_lngLoop

            ReDim m_dblLastUpdTime(0)

            General.g_objIdoData.pHospitalCD = General.g_strHospitalCD '施設コード
            General.g_objIdoData.pStaffMngID = m_strSelectStaffMngID '職員管理番号
            General.g_objIdoData.pDateFlg = 2 '日付区分(全件)
            General.g_objIdoData.pDateFrom = w_lngDate '開始年月日
            General.g_objIdoData.pDateTo = 0 '終了年月日
            General.g_objIdoData.pSortFlg = 1 'ソート順(降順)

            ReDim m_lngSEQ(0)
            ReDim m_strSEQ(0)
            ReDim m_lngNendo(0)
            ReDim m_strPlanFlg(0)
            ReDim m_lngFromDate(0)
            ReDim m_lngToDate(0)
            ReDim m_lngDate(0)

            'アクセスログ参照の場合
            w_strAccessEvent = General.G_ACCESS_SEE
            If g_intAccessLogFlg = 1 Then
                w_blnResult = General.paSaveAccessLog(General.g_strUserID, General.g_strUserName, m_strSelectStaffMngID, m_strSelectStaffID, m_udtStaffData(m_lngSelectListIndex).strName, m_strSelectResCD, w_strAccessEvent, General.g_strHospitalCD)
            End If

            With lvwMain
                .Columns.Clear()
                .Items.Clear()
                '選択されたノードのキーが採用情報だった場合(セキュリティコードが"NSC2000HA01"だった場合)
                If m_strSelectResCD = G_strSaiyoRes Then

                    w_blnADD = False
                    w_blnUPD = True

                    'ｱｲｺﾝの整列方法
                    .Alignment = System.Windows.Forms.ListViewAlignment.Top
                    'ﾘｽﾄﾋﾞｭｰﾀｲﾌﾟ設定
                    .View = System.Windows.Forms.View.Details
                    .LabelEdit = False
                    'ｶﾗﾑﾍｯﾀﾞｰの追加

                    w_column = .Columns.Add("EmpCD", "採用コード", Integer.Parse(General.paTwipsTopixels(1000)), System.Windows.Forms.HorizontalAlignment.Left, "")
                    w_column = .Columns.Add("EmpName", "採用条件", Integer.Parse(General.paTwipsTopixels(1800)), System.Windows.Forms.HorizontalAlignment.Left, "")
                    w_column = .Columns.Add("EmpDate", "採用年月日", Integer.Parse(General.paTwipsTopixels(1500)), System.Windows.Forms.HorizontalAlignment.Left, "")
                    w_column = .Columns.Add("RetireCD", "転退コード", Integer.Parse(General.paTwipsTopixels(1000)), System.Windows.Forms.HorizontalAlignment.Left, "")
                    w_column = .Columns.Add("RetireName", "転退理由", Integer.Parse(General.paTwipsTopixels(1800)), System.Windows.Forms.HorizontalAlignment.Left, "")
                    w_column = .Columns.Add("RetireDate", "転退年月日", Integer.Parse(General.paTwipsTopixels(1500)), System.Windows.Forms.HorizontalAlignment.Left, "")

                    '採用情報の取得
                    If General.g_objIdoData.mGetSaiyoIdo() = True Then
                        w_lngCnt = General.g_objIdoData.fSI_SaiyoCount

                        ReDim m_dblLastUpdTime(w_lngCnt)
                        For w_lngLoop = 1 To w_lngCnt

                            General.g_objIdoData.mSI_SaiyoIdx = w_lngLoop

                            m_dblLastUpdTime(w_lngLoop) = General.g_objIdoData.fSI_UpdTime '最終更新日時

                            '画面の表示
                            w_List = .Items.Add(M_strSelectID & General.paFormatZero(w_lngLoop, 5), Trim(General.g_objIdoData.fSI_EmpCD), "")

                            If w_List.SubItems.Count > 1 Then
                                w_List.SubItems(1).Text = Trim(General.g_objIdoData.fSI_EmpName)
                            Else
                                w_List.SubItems.Insert(1, New System.Windows.Forms.ListViewItem.ListViewSubItem(Nothing, Trim(General.g_objIdoData.fSI_EmpName)))
                            End If

                            If w_List.SubItems.Count > 2 Then
                                w_List.SubItems(2).Text = General.DateUtil.paGetDateStringFromInteger(General.g_objIdoData.fSI_EmpDate)
                            Else
                                w_List.SubItems.Insert(2, New System.Windows.Forms.ListViewItem.ListViewSubItem(Nothing, General.DateUtil.paGetDateStringFromInteger(General.g_objIdoData.fSI_EmpDate)))
                            End If

                            If w_List.SubItems.Count > 3 Then
                                w_List.SubItems(3).Text = Trim(General.g_objIdoData.fSI_RetireCD)
                            Else
                                w_List.SubItems.Insert(3, New System.Windows.Forms.ListViewItem.ListViewSubItem(Nothing, Trim(General.g_objIdoData.fSI_RetireCD)))
                            End If

                            If w_List.SubItems.Count > 4 Then
                                w_List.SubItems(4).Text = Trim(General.g_objIdoData.fSI_RetireName)
                            Else
                                w_List.SubItems.Insert(4, New System.Windows.Forms.ListViewItem.ListViewSubItem(Nothing, Trim(General.g_objIdoData.fSI_RetireName)))
                            End If

                            If w_List.SubItems.Count > 5 Then
                                w_List.SubItems(5).Text = IIf(IIf(IsDBNull(General.g_objIdoData.fSI_RetireDate), 99999999, General.g_objIdoData.fSI_RetireDate) = 99999999, "", General.DateUtil.paGetDateStringFromInteger(General.g_objIdoData.fSI_RetireDate))
                            Else
                                w_List.SubItems.Insert(5, New System.Windows.Forms.ListViewItem.ListViewSubItem(Nothing, IIf(IIf(IsDBNull(General.g_objIdoData.fSI_RetireDate), 99999999, General.g_objIdoData.fSI_RetireDate) = 99999999, "", General.DateUtil.paGetDateStringFromInteger(General.g_objIdoData.fSI_RetireDate))))
                            End If
                            w_List.Tag = Convert.ToString(w_lngLoop)
                        Next w_lngLoop

                    End If

                    '選択されたノードのキーが勤務部署情報だった場合(セキュリティコードが"NSC2000HA02"だった場合)
                ElseIf m_strSelectResCD = G_strKinmuDeptRes Then

                    w_blnADD = True
                    w_blnUPD = False

                    'ｱｲｺﾝの整列方法
                    .Alignment = System.Windows.Forms.ListViewAlignment.Top
                    'ﾘｽﾄﾋﾞｭｰﾀｲﾌﾟ設定
                    .View = System.Windows.Forms.View.Details
                    .LabelEdit = False
                    'ｶﾗﾑﾍｯﾀﾞｰの追加
                    w_column = .Columns.Add("KinmuDeptCD", "勤務部署コード", Integer.Parse(General.paTwipsTopixels(2000)), System.Windows.Forms.HorizontalAlignment.Left, "")
                    w_column = .Columns.Add("KinmuDeptName", "勤務部署名", Integer.Parse(General.paTwipsTopixels(3000)), System.Windows.Forms.HorizontalAlignment.Left, "")
                    w_column = .Columns.Add("DateFrom", "開始年月日", Integer.Parse(General.paTwipsTopixels(1500)), System.Windows.Forms.HorizontalAlignment.Left, "")
                    w_column = .Columns.Add("DateTo", "終了年月日", Integer.Parse(General.paTwipsTopixels(1500)), System.Windows.Forms.HorizontalAlignment.Left, "")

                    '勤務部署情報の取得
                    If General.g_objIdoData.mGetKinmuDeptIdo() = True Then

                        w_lngCnt = General.g_objIdoData.fKI_KinmuDeptCount

                        ReDim m_dblLastUpdTime(w_lngCnt)

                        For w_lngLoop = 1 To w_lngCnt

                            General.g_objIdoData.mKI_KinmuDeptIdx = w_lngLoop

                            m_dblLastUpdTime(w_lngLoop) = General.g_objIdoData.fKI_UpdTime '最終更新日時

                            '画面の表示
                            w_List = .Items.Add(M_strSelectID & General.paFormatZero(w_lngLoop, 5), Trim(General.g_objIdoData.fKI_CD), "")
                            If w_List.SubItems.Count > 1 Then
                                w_List.SubItems(1).Text = Trim(General.g_objIdoData.fKI_Name)
                            Else
                                w_List.SubItems.Insert(1, New System.Windows.Forms.ListViewItem.ListViewSubItem(Nothing, Trim(General.g_objIdoData.fKI_Name)))
                            End If

                            If w_List.SubItems.Count > 2 Then
                                w_List.SubItems(2).Text = General.DateUtil.paGetDateStringFromInteger(General.g_objIdoData.fKI_DateFrom)
                            Else
                                w_List.SubItems.Insert(2, New System.Windows.Forms.ListViewItem.ListViewSubItem(Nothing, General.DateUtil.paGetDateStringFromInteger(General.g_objIdoData.fKI_DateFrom)))
                            End If

                            If w_List.SubItems.Count > 3 Then
                                w_List.SubItems(3).Text = IIf(IIf(IsDBNull(General.g_objIdoData.fKI_DateTo), 99999999, General.g_objIdoData.fKI_DateTo) = 99999999, "", General.DateUtil.paGetDateStringFromInteger(General.g_objIdoData.fKI_DateTo))
                            Else
                                w_List.SubItems.Insert(3, New System.Windows.Forms.ListViewItem.ListViewSubItem(Nothing, IIf(IIf(IsDBNull(General.g_objIdoData.fKI_DateTo), 99999999, General.g_objIdoData.fKI_DateTo) = 99999999, "", General.DateUtil.paGetDateStringFromInteger(General.g_objIdoData.fKI_DateTo))))
                            End If
                            w_List.Tag = Convert.ToString(w_lngLoop)
                        Next w_lngLoop

                    End If

                    '選択されたノードのキーが配属部署情報だった場合(セキュリティコードが"NSC2000HA03"だった場合)
                ElseIf m_strSelectResCD = G_strWardDeptRes Then

                    w_blnADD = True
                    w_blnUPD = False

                    'ｱｲｺﾝの整列方法
                    .Alignment = System.Windows.Forms.ListViewAlignment.Top
                    'ﾘｽﾄﾋﾞｭｰﾀｲﾌﾟ設定
                    .View = System.Windows.Forms.View.Details
                    .LabelEdit = False
                    'ｶﾗﾑﾍｯﾀﾞｰの追加
                    w_column = .Columns.Add("WardDeptCD", "配属部署コード", Integer.Parse(General.paTwipsTopixels(2000)), System.Windows.Forms.HorizontalAlignment.Left, "")
                    w_column = .Columns.Add("WardDeptName", "配属部署名", Integer.Parse(General.paTwipsTopixels(3000)), System.Windows.Forms.HorizontalAlignment.Left, "")
                    w_column = .Columns.Add("DateFrom", "開始年月日", Integer.Parse(General.paTwipsTopixels(1500)), System.Windows.Forms.HorizontalAlignment.Left, "")
                    w_column = .Columns.Add("DateTo", "終了年月日", Integer.Parse(General.paTwipsTopixels(1500)), System.Windows.Forms.HorizontalAlignment.Left, "")

                    '配属部署情報の取得
                    If General.g_objIdoData.mGetWardDeptIdo() = True Then

                        w_lngCnt = General.g_objIdoData.fWI_WardDeptCount

                        ReDim m_dblLastUpdTime(w_lngCnt)

                        For w_lngLoop = 1 To w_lngCnt

                            General.g_objIdoData.mWI_WardDeptIdx = w_lngLoop

                            m_dblLastUpdTime(w_lngLoop) = General.g_objIdoData.fWI_UpdTime '最終更新日時

                            '画面の表示
                            w_List = .Items.Add(M_strSelectID & General.paFormatZero(w_lngLoop, 5), Trim(General.g_objIdoData.fWI_CD), "")

                            If w_List.SubItems.Count > 1 Then
                                w_List.SubItems(1).Text = Trim(General.g_objIdoData.fWI_Name)
                            Else
                                w_List.SubItems.Insert(1, New System.Windows.Forms.ListViewItem.ListViewSubItem(Nothing, Trim(General.g_objIdoData.fWI_Name)))
                            End If

                            If w_List.SubItems.Count > 2 Then
                                w_List.SubItems(2).Text = General.DateUtil.paGetDateStringFromInteger(General.g_objIdoData.fWI_DateFrom)
                            Else
                                w_List.SubItems.Insert(2, New System.Windows.Forms.ListViewItem.ListViewSubItem(Nothing, General.DateUtil.paGetDateStringFromInteger(General.g_objIdoData.fWI_DateFrom)))
                            End If

                            If w_List.SubItems.Count > 3 Then
                                w_List.SubItems(3).Text = IIf(IIf(IsDBNull(General.g_objIdoData.fWI_DateTo), 99999999, General.g_objIdoData.fWI_DateTo) = 99999999, "", General.DateUtil.paGetDateStringFromInteger(General.g_objIdoData.fWI_DateTo))
                            Else
                                w_List.SubItems.Insert(3, New System.Windows.Forms.ListViewItem.ListViewSubItem(Nothing, IIf(IIf(IsDBNull(General.g_objIdoData.fWI_DateTo), 99999999, General.g_objIdoData.fWI_DateTo) = 99999999, "", General.DateUtil.paGetDateStringFromInteger(General.g_objIdoData.fWI_DateTo))))
                            End If
                            w_List.Tag = Convert.ToString(w_lngLoop)
                        Next w_lngLoop

                    End If

                    '選択されたノードのキーが役職情報だった場合(セキュリティコードが"NSC2000HA04"だった場合)
                ElseIf m_strSelectResCD = G_strPostRes Then

                    w_blnADD = True
                    w_blnUPD = False

                    'ｱｲｺﾝの整列方法
                    .Alignment = System.Windows.Forms.ListViewAlignment.Top
                    'ﾘｽﾄﾋﾞｭｰﾀｲﾌﾟ設定
                    .View = System.Windows.Forms.View.Details
                    .LabelEdit = False
                    'ｶﾗﾑﾍｯﾀﾞｰの追加
                    w_column = .Columns.Add("PostCD", "役職コード", Integer.Parse(General.paTwipsTopixels(2000)), System.Windows.Forms.HorizontalAlignment.Left, "")
                    w_column = .Columns.Add("PostName", "役職名", Integer.Parse(General.paTwipsTopixels(3000)), System.Windows.Forms.HorizontalAlignment.Left, "")
                    w_column = .Columns.Add("DateFrom", "開始年月日", Integer.Parse(General.paTwipsTopixels(1500)), System.Windows.Forms.HorizontalAlignment.Left, "")
                    w_column = .Columns.Add("DateTo", "終了年月日", Integer.Parse(General.paTwipsTopixels(1500)), System.Windows.Forms.HorizontalAlignment.Left, "")

                    '役職情報の取得
                    If General.g_objIdoData.mGetPostIdo() = True Then

                        w_lngCnt = General.g_objIdoData.fPI_PostCount

                        ReDim m_dblLastUpdTime(w_lngCnt)

                        For w_lngLoop = 1 To w_lngCnt

                            General.g_objIdoData.mPI_PostIdx = w_lngLoop

                            m_dblLastUpdTime(w_lngLoop) = General.g_objIdoData.fPI_UpdTime '最終更新日時

                            '画面の表示
                            w_List = .Items.Add(M_strSelectID & General.paFormatZero(w_lngLoop, 5), Trim(General.g_objIdoData.fPI_CD), "")
                            If w_List.SubItems.Count > 1 Then
                                w_List.SubItems(1).Text = Trim(General.g_objIdoData.fPI_Name)
                            Else
                                w_List.SubItems.Insert(1, New System.Windows.Forms.ListViewItem.ListViewSubItem(Nothing, Trim(General.g_objIdoData.fPI_Name)))
                            End If

                            If w_List.SubItems.Count > 2 Then
                                w_List.SubItems(2).Text = General.DateUtil.paGetDateStringFromInteger(General.g_objIdoData.fPI_DateFrom)
                            Else
                                w_List.SubItems.Insert(2, New System.Windows.Forms.ListViewItem.ListViewSubItem(Nothing, General.DateUtil.paGetDateStringFromInteger(General.g_objIdoData.fPI_DateFrom)))
                            End If

                            If w_List.SubItems.Count > 3 Then
                                w_List.SubItems(3).Text = IIf(IIf(IsDBNull(General.g_objIdoData.fPI_DateTo), 99999999, General.g_objIdoData.fPI_DateTo) = 99999999, "", General.DateUtil.paGetDateStringFromInteger(General.g_objIdoData.fPI_DateTo))
                            Else
                                w_List.SubItems.Insert(3, New System.Windows.Forms.ListViewItem.ListViewSubItem(Nothing, IIf(IIf(IsDBNull(General.g_objIdoData.fPI_DateTo), 99999999, General.g_objIdoData.fPI_DateTo) = 99999999, "", General.DateUtil.paGetDateStringFromInteger(General.g_objIdoData.fPI_DateTo))))
                            End If
                            w_List.Tag = Convert.ToString(w_lngLoop)
                        Next w_lngLoop

                    End If

                    '選択されたノードのキーが職種情報だった場合(セキュリティコードが"NSC2000HA05"だった場合)
                ElseIf m_strSelectResCD = G_strJobRes Then

                    w_blnADD = True
                    w_blnUPD = False

                    'ｱｲｺﾝの整列方法
                    .Alignment = System.Windows.Forms.ListViewAlignment.Top
                    'ﾘｽﾄﾋﾞｭｰﾀｲﾌﾟ設定
                    .View = System.Windows.Forms.View.Details
                    .LabelEdit = False
                    'ｶﾗﾑﾍｯﾀﾞｰの追加
                    w_column = .Columns.Add("JobCD", "職種コード", Integer.Parse(General.paTwipsTopixels(2000)), System.Windows.Forms.HorizontalAlignment.Left, "")
                    w_column = .Columns.Add("JobName", "職種名", Integer.Parse(General.paTwipsTopixels(3000)), System.Windows.Forms.HorizontalAlignment.Left, "")
                    w_column = .Columns.Add("DateFrom", "開始年月日", Integer.Parse(General.paTwipsTopixels(1500)), System.Windows.Forms.HorizontalAlignment.Left, "")
                    w_column = .Columns.Add("DateTo", "終了年月日", Integer.Parse(General.paTwipsTopixels(1500)), System.Windows.Forms.HorizontalAlignment.Left, "")

                    '職種情報の取得
                    If General.g_objIdoData.mGetJobIdo() = True Then

                        w_lngCnt = General.g_objIdoData.fJI_JobCount

                        ReDim m_dblLastUpdTime(w_lngCnt)

                        For w_lngLoop = 1 To w_lngCnt

                            General.g_objIdoData.mJI_JobIdx = w_lngLoop

                            m_dblLastUpdTime(w_lngLoop) = General.g_objIdoData.fJI_UpdTime '最終更新日時

                            '画面の表示
                            w_List = .Items.Add(M_strSelectID & General.paFormatZero(w_lngLoop, 5), Trim(General.g_objIdoData.fJI_CD), "")

                            If w_List.SubItems.Count > 1 Then
                                w_List.SubItems(1).Text = Trim(General.g_objIdoData.fJI_Name)
                            Else
                                w_List.SubItems.Insert(1, New System.Windows.Forms.ListViewItem.ListViewSubItem(Nothing, Trim(General.g_objIdoData.fJI_Name)))
                            End If

                            If w_List.SubItems.Count > 2 Then
                                w_List.SubItems(2).Text = General.DateUtil.paGetDateStringFromInteger(General.g_objIdoData.fJI_DateFrom)
                            Else
                                w_List.SubItems.Insert(2, New System.Windows.Forms.ListViewItem.ListViewSubItem(Nothing, General.DateUtil.paGetDateStringFromInteger(General.g_objIdoData.fJI_DateFrom)))
                            End If

                            If w_List.SubItems.Count > 3 Then
                                w_List.SubItems(3).Text = IIf(IIf(IsDBNull(General.g_objIdoData.fJI_DateTo), 99999999, General.g_objIdoData.fJI_DateTo) = 99999999, "", General.DateUtil.paGetDateStringFromInteger(General.g_objIdoData.fJI_DateTo))
                            Else
                                w_List.SubItems.Insert(3, New System.Windows.Forms.ListViewItem.ListViewSubItem(Nothing, IIf(IIf(IsDBNull(General.g_objIdoData.fJI_DateTo), 99999999, General.g_objIdoData.fJI_DateTo) = 99999999, "", General.DateUtil.paGetDateStringFromInteger(General.g_objIdoData.fJI_DateTo))))
                            End If
                            w_List.Tag = Convert.ToString(w_lngLoop)
                        Next w_lngLoop

                    End If

                    '選択されたノードのキーが兼務情報だった場合(セキュリティコードが"NSC2000HA06"だった場合)
                ElseIf m_strSelectResCD = G_strKenmuRes Then

                    w_blnADD = True
                    w_blnUPD = True

                    'ｱｲｺﾝの整列方法
                    .Alignment = System.Windows.Forms.ListViewAlignment.Top
                    'ﾘｽﾄﾋﾞｭｰﾀｲﾌﾟ設定
                    .View = System.Windows.Forms.View.Details
                    .LabelEdit = False
                    'ｶﾗﾑﾍｯﾀﾞｰの追加
                    w_column = .Columns.Add("DateFrom", "開始年月日", Integer.Parse(General.paTwipsTopixels(1500)), System.Windows.Forms.HorizontalAlignment.Left, "")
                    w_column = .Columns.Add("DateTo", "終了年月日", Integer.Parse(General.paTwipsTopixels(1500)), System.Windows.Forms.HorizontalAlignment.Left, "")
                    w_column = .Columns.Add("WardDeptCD", "配属部署コード", Integer.Parse(General.paTwipsTopixels(1300)), System.Windows.Forms.HorizontalAlignment.Left, "")
                    w_column = .Columns.Add("WardDeptName", "配属部署名", Integer.Parse(General.paTwipsTopixels(2000)), System.Windows.Forms.HorizontalAlignment.Left, "")
                    w_column = .Columns.Add("KinmuDeptCD", "勤務部署コード", Integer.Parse(General.paTwipsTopixels(1300)), System.Windows.Forms.HorizontalAlignment.Left, "")
                    w_column = .Columns.Add("KinmuDeptName", "勤務部署名", Integer.Parse(General.paTwipsTopixels(2000)), System.Windows.Forms.HorizontalAlignment.Left, "")
                    w_column = .Columns.Add("PostCD", "役職コード", Integer.Parse(General.paTwipsTopixels(1300)), System.Windows.Forms.HorizontalAlignment.Left, "")
                    w_column = .Columns.Add("PostName", "役職名", Integer.Parse(General.paTwipsTopixels(2000)), System.Windows.Forms.HorizontalAlignment.Left, "")

                    '兼務情報の取得
                    If General.g_objIdoData.mGetKenmuIdo() = True Then

                        w_lngCnt = General.g_objIdoData.fKE_KenmuCount

                        ReDim m_dblLastUpdTime(w_lngCnt)
                        ReDim m_lngSEQ(w_lngCnt)

                        For w_lngLoop = 1 To w_lngCnt

                            General.g_objIdoData.mKE_KenmuIdx = w_lngLoop

                            m_dblLastUpdTime(w_lngLoop) = General.g_objIdoData.fKE_UpdTime '最終更新日時
                            m_lngSEQ(w_lngLoop) = General.g_objIdoData.fKE_SEQ 'SEQ

                            '画面の表示
                            w_List = .Items.Add(M_strSelectID & General.paFormatZero(w_lngLoop, 5), General.paGetDateStringFromInteger(General.g_objIdoData.fKE_DateFrom), "")
                            If General.g_objIdoData.fKE_DateTo > 0 AndAlso General.g_objIdoData.fKE_DateTo <> 99999999 Then
                                If w_List.SubItems.Count > 1 Then
                                    w_List.SubItems(1).Text = General.paGetDateStringFromInteger(General.g_objIdoData.fKE_DateTo)
                                Else
                                    w_List.SubItems.Insert(1, New System.Windows.Forms.ListViewItem.ListViewSubItem(Nothing, General.paGetDateStringFromInteger(General.g_objIdoData.fKE_DateTo)))
                                End If
                            Else
                                If w_List.SubItems.Count > 1 Then
                                    w_List.SubItems(1).Text = ""
                                Else
                                    w_List.SubItems.Insert(1, New System.Windows.Forms.ListViewItem.ListViewSubItem(Nothing, ""))
                                End If
                            End If

                            If w_List.SubItems.Count > 2 Then
                                w_List.SubItems(2).Text = Trim(General.g_objIdoData.fKE_WardDeptCD)
                            Else
                                w_List.SubItems.Insert(2, New System.Windows.Forms.ListViewItem.ListViewSubItem(Nothing, Trim(General.g_objIdoData.fKE_WardDeptCD)))
                            End If

                            If w_List.SubItems.Count > 3 Then
                                w_List.SubItems(3).Text = Trim(General.g_objIdoData.fKE_WardDeptName)
                            Else
                                w_List.SubItems.Insert(3, New System.Windows.Forms.ListViewItem.ListViewSubItem(Nothing, Trim(General.g_objIdoData.fKE_WardDeptName)))
                            End If

                            If w_List.SubItems.Count > 4 Then
                                w_List.SubItems(4).Text = Trim(General.g_objIdoData.fKE_KinmuDeptCD)
                            Else
                                w_List.SubItems.Insert(4, New System.Windows.Forms.ListViewItem.ListViewSubItem(Nothing, Trim(General.g_objIdoData.fKE_KinmuDeptCD)))
                            End If

                            If w_List.SubItems.Count > 5 Then
                                w_List.SubItems(5).Text = Trim(General.g_objIdoData.fKE_KinmuDeptName)
                            Else
                                w_List.SubItems.Insert(5, New System.Windows.Forms.ListViewItem.ListViewSubItem(Nothing, Trim(General.g_objIdoData.fKE_KinmuDeptName)))
                            End If

                            If w_List.SubItems.Count > 6 Then
                                w_List.SubItems(6).Text = Trim(General.g_objIdoData.fKE_PostCD)
                            Else
                                w_List.SubItems.Insert(6, New System.Windows.Forms.ListViewItem.ListViewSubItem(Nothing, Trim(General.g_objIdoData.fKE_PostCD)))
                            End If

                            If w_List.SubItems.Count > 7 Then
                                w_List.SubItems(7).Text = Trim(General.g_objIdoData.fKE_PostName)
                            Else
                                w_List.SubItems.Insert(7, New System.Windows.Forms.ListViewItem.ListViewSubItem(Nothing, Trim(General.g_objIdoData.fKE_PostName)))
                            End If
                            w_List.Tag = Convert.ToString(w_lngLoop)
                        Next w_lngLoop

                    End If

                    '選択されたノードのキーが免許情報だった場合(セキュリティコードが"NSC2000HA07"だった場合)
                ElseIf m_strSelectResCD = G_strMenkyoRes Then

                    w_blnADD = True
                    w_blnUPD = True

                    'ｱｲｺﾝの整列方法
                    .Alignment = System.Windows.Forms.ListViewAlignment.Top
                    'ﾘｽﾄﾋﾞｭｰﾀｲﾌﾟ設定
                    .View = System.Windows.Forms.View.Details
                    .LabelEdit = False
                    'ｶﾗﾑﾍｯﾀﾞｰの追加
                    w_column = .Columns.Add("CD", "免許区分", Integer.Parse(General.paTwipsTopixels(1300)), System.Windows.Forms.HorizontalAlignment.Left, "")
                    w_column = .Columns.Add("Name", "免許名", Integer.Parse(General.paTwipsTopixels(2000)), System.Windows.Forms.HorizontalAlignment.Left, "")
                    w_column = .Columns.Add("No", "免許番号", Integer.Parse(General.paTwipsTopixels(1300)), System.Windows.Forms.HorizontalAlignment.Left, "")
                    w_column = .Columns.Add("Date", "取得年月日", Integer.Parse(General.paTwipsTopixels(2000)), System.Windows.Forms.HorizontalAlignment.Left, "")
                    w_column = .Columns.Add("Bikou", "備考", Integer.Parse(General.paTwipsTopixels(1300)), System.Windows.Forms.HorizontalAlignment.Left, "")

                    '兼務情報の取得
                    If General.g_objIdoData.mGetMenkyoInfo() = True Then

                        w_lngCnt = General.g_objIdoData.fLI_MenkyoCount

                        ReDim m_dblLastUpdTime(w_lngCnt)

                        For w_lngLoop = 1 To w_lngCnt

                            General.g_objIdoData.mLI_MenkyoIdx = w_lngLoop

                            m_dblLastUpdTime(w_lngLoop) = General.g_objIdoData.fLI_UpdTime '最終更新日時

                            '画面の表示
                            w_List = .Items.Add(M_strSelectID & General.paFormatZero(w_lngLoop, 5), Trim(General.g_objIdoData.fLI_MenkyoCD), "")
                            If w_List.SubItems.Count > 1 Then
                                w_List.SubItems(1).Text = Trim(General.g_objIdoData.fLI_MenkyoName)
                            Else
                                w_List.SubItems.Insert(1, New System.Windows.Forms.ListViewItem.ListViewSubItem(Nothing, Trim(General.g_objIdoData.fLI_MenkyoName)))
                            End If

                            If w_List.SubItems.Count > 2 Then
                                w_List.SubItems(2).Text = Trim(General.g_objIdoData.fLI_MenkyoNo)
                            Else
                                w_List.SubItems.Insert(2, New System.Windows.Forms.ListViewItem.ListViewSubItem(Nothing, Trim(General.g_objIdoData.fLI_MenkyoNo)))
                            End If

                            If w_List.SubItems.Count > 3 Then
                                w_List.SubItems(3).Text = General.DateUtil.paGetDateStringFromInteger(General.g_objIdoData.fLI_GetDate)
                            Else
                                w_List.SubItems.Insert(3, New System.Windows.Forms.ListViewItem.ListViewSubItem(Nothing, General.DateUtil.paGetDateStringFromInteger(General.g_objIdoData.fLI_GetDate)))
                            End If

                            If w_List.SubItems.Count > 4 Then
                                w_List.SubItems(4).Text = Trim(General.g_objIdoData.fLI_Bikou)
                            Else
                                w_List.SubItems.Insert(4, New System.Windows.Forms.ListViewItem.ListViewSubItem(Nothing, Trim(General.g_objIdoData.fLI_Bikou)))
                            End If
                            w_List.Tag = Convert.ToString(w_lngLoop)
                        Next w_lngLoop

                    End If

                    '選択されたノードのキーが資格情報だった場合(セキュリティコードが"NSC2000HA08"だった場合)
                ElseIf m_strSelectResCD = G_strShikakuRes Then

                    w_blnADD = True
                    w_blnUPD = True

                    'ｱｲｺﾝの整列方法
                    .Alignment = System.Windows.Forms.ListViewAlignment.Top
                    'ﾘｽﾄﾋﾞｭｰﾀｲﾌﾟ設定
                    .View = System.Windows.Forms.View.Details
                    .LabelEdit = False
                    'ｶﾗﾑﾍｯﾀﾞｰの追加
                    w_column = .Columns.Add("CD", "資格コード", Integer.Parse(General.paTwipsTopixels(1300)), System.Windows.Forms.HorizontalAlignment.Left, "")
                    w_column = .Columns.Add("Name", "資格名", Integer.Parse(General.paTwipsTopixels(2000)), System.Windows.Forms.HorizontalAlignment.Left, "")
                    w_column = .Columns.Add("GetDate", "取得年月日", Integer.Parse(General.paTwipsTopixels(1500)), System.Windows.Forms.HorizontalAlignment.Left, "")
                    w_column = .Columns.Add("DateFrom", "開始年月日", Integer.Parse(General.paTwipsTopixels(1500)), System.Windows.Forms.HorizontalAlignment.Left, "")
                    w_column = .Columns.Add("DateTo", "終了年月日", Integer.Parse(General.paTwipsTopixels(1500)), System.Windows.Forms.HorizontalAlignment.Left, "")
                    w_column = .Columns.Add("Bikou", "備考", Integer.Parse(General.paTwipsTopixels(1300)), System.Windows.Forms.HorizontalAlignment.Left, "")

                    '兼務情報の取得
                    If General.g_objIdoData.mGetShikakuInfo() = True Then

                        w_lngCnt = General.g_objIdoData.fSH_ShikakuCount

                        ReDim m_dblLastUpdTime(w_lngCnt)

                        For w_lngLoop = 1 To w_lngCnt

                            General.g_objIdoData.mSH_ShikakuIdx = w_lngLoop

                            m_dblLastUpdTime(w_lngLoop) = General.g_objIdoData.fSH_UpdTime '最終更新日時

                            '画面の表示
                            w_List = .Items.Add(M_strSelectID & General.paFormatZero(w_lngLoop, 5), Trim(General.g_objIdoData.fSH_ShikakuCD), "")

                            If w_List.SubItems.Count > 1 Then
                                w_List.SubItems(1).Text = Trim(General.g_objIdoData.fSH_ShikakuName)
                            Else
                                w_List.SubItems.Insert(1, New System.Windows.Forms.ListViewItem.ListViewSubItem(Nothing, Trim(General.g_objIdoData.fSH_ShikakuName)))
                            End If

                            If w_List.SubItems.Count > 2 Then
                                w_List.SubItems(2).Text = General.DateUtil.paGetDateStringFromInteger(General.g_objIdoData.fSH_GetDate)
                            Else
                                w_List.SubItems.Insert(2, New System.Windows.Forms.ListViewItem.ListViewSubItem(Nothing, General.DateUtil.paGetDateStringFromInteger(General.g_objIdoData.fSH_GetDate)))
                            End If

                            If w_List.SubItems.Count > 3 Then
                                w_List.SubItems(3).Text = General.DateUtil.paGetDateStringFromInteger(General.g_objIdoData.fSH_DateFrom)
                            Else
                                w_List.SubItems.Insert(3, New System.Windows.Forms.ListViewItem.ListViewSubItem(Nothing, General.DateUtil.paGetDateStringFromInteger(General.g_objIdoData.fSH_DateFrom)))
                            End If

                            If w_List.SubItems.Count > 4 Then
                                w_List.SubItems(4).Text = IIf(IIf(IsDBNull(General.g_objIdoData.fSH_DateTo), 0, General.g_objIdoData.fSH_DateTo) = 0, "", General.DateUtil.paGetDateStringFromInteger(General.g_objIdoData.fSH_DateTo))
                            Else
                                w_List.SubItems.Insert(4, New System.Windows.Forms.ListViewItem.ListViewSubItem(Nothing, IIf(IIf(IsDBNull(General.g_objIdoData.fSH_DateTo), 0, General.g_objIdoData.fSH_DateTo) = 0, "", General.DateUtil.paGetDateStringFromInteger(General.g_objIdoData.fSH_DateTo))))
                            End If

                            If w_List.SubItems.Count > 5 Then
                                w_List.SubItems(5).Text = Trim(General.g_objIdoData.fSH_Bikou)
                            Else
                                w_List.SubItems.Insert(5, New System.Windows.Forms.ListViewItem.ListViewSubItem(Nothing, Trim(General.g_objIdoData.fSH_Bikou)))
                            End If
                            w_List.Tag = Convert.ToString(w_lngLoop)
                        Next w_lngLoop

                    End If

                    '選択されたノードのキーが委員情報だった場合(セキュリティコードが"NSC2000HA09"だった場合)
                ElseIf m_strSelectResCD = G_strIinRes Then

                    w_blnADD = True
                    w_blnUPD = True

                    'ｱｲｺﾝの整列方法
                    .Alignment = System.Windows.Forms.ListViewAlignment.Top
                    'ﾘｽﾄﾋﾞｭｰﾀｲﾌﾟ設定
                    .View = System.Windows.Forms.View.Details
                    .LabelEdit = False
                    'ｶﾗﾑﾍｯﾀﾞｰの追加
                    w_column = .Columns.Add("CD", "委員コード", Integer.Parse(General.paTwipsTopixels(1300)), System.Windows.Forms.HorizontalAlignment.Left, "")
                    w_column = .Columns.Add("Name", "委員名", Integer.Parse(General.paTwipsTopixels(2000)), System.Windows.Forms.HorizontalAlignment.Left, "")
                    w_column = .Columns.Add("DateFrom", "開始年月日", Integer.Parse(General.paTwipsTopixels(1500)), System.Windows.Forms.HorizontalAlignment.Left, "")
                    w_column = .Columns.Add("DateTo", "終了年月日", Integer.Parse(General.paTwipsTopixels(1500)), System.Windows.Forms.HorizontalAlignment.Left, "")
                    w_column = .Columns.Add("Bikou", "備考", Integer.Parse(General.paTwipsTopixels(1300)), System.Windows.Forms.HorizontalAlignment.Left, "")

                    '兼務情報の取得
                    If General.g_objIdoData.mGetIinInfo() = True Then

                        w_lngCnt = General.g_objIdoData.fII_IinCount

                        ReDim m_dblLastUpdTime(w_lngCnt)

                        For w_lngLoop = 1 To w_lngCnt

                            General.g_objIdoData.mII_IinIdx = w_lngLoop

                            m_dblLastUpdTime(w_lngLoop) = General.g_objIdoData.fII_UpdTime '最終更新日時

                            '画面の表示
                            w_List = .Items.Add(M_strSelectID & General.paFormatZero(w_lngLoop, 5), Trim(General.g_objIdoData.fII_IinCD), "")

                            If w_List.SubItems.Count > 1 Then
                                w_List.SubItems(1).Text = Trim(General.g_objIdoData.fII_IinName)
                            Else
                                w_List.SubItems.Insert(1, New System.Windows.Forms.ListViewItem.ListViewSubItem(Nothing, Trim(General.g_objIdoData.fII_IinName)))
                            End If

                            If w_List.SubItems.Count > 2 Then
                                w_List.SubItems(2).Text = General.DateUtil.paGetDateStringFromInteger(General.g_objIdoData.fII_DateFrom)
                            Else
                                w_List.SubItems.Insert(2, New System.Windows.Forms.ListViewItem.ListViewSubItem(Nothing, General.DateUtil.paGetDateStringFromInteger(General.g_objIdoData.fII_DateFrom)))
                            End If

                            If w_List.SubItems.Count > 3 Then
                                w_List.SubItems(3).Text = IIf(IIf(IsNothing(General.g_objIdoData.fII_DateTo), 0, General.g_objIdoData.fII_DateTo) = 0, "", General.DateUtil.paGetDateStringFromInteger(General.g_objIdoData.fII_DateTo))
                            Else
                                w_List.SubItems.Insert(3, New System.Windows.Forms.ListViewItem.ListViewSubItem(Nothing, IIf(IIf(IsNothing(General.g_objIdoData.fII_DateTo), 0, General.g_objIdoData.fII_DateTo) = 0, "", General.DateUtil.paGetDateStringFromInteger(General.g_objIdoData.fII_DateTo))))
                            End If

                            If w_List.SubItems.Count > 4 Then
                                w_List.SubItems(4).Text = Trim(General.g_objIdoData.fII_Bikou)
                            Else
                                w_List.SubItems.Insert(4, New System.Windows.Forms.ListViewItem.ListViewSubItem(Nothing, Trim(General.g_objIdoData.fII_Bikou)))
                            End If
                            w_List.Tag = Convert.ToString(w_lngLoop)
                        Next w_lngLoop

                    End If

                    '選択されたノードのキーが職歴情報だった場合(セキュリティコードが"NSC2000HA10"だった場合)
                ElseIf m_strSelectResCD = G_strSyokurekiRes Then

                    w_blnADD = True
                    w_blnUPD = True

                    'ｱｲｺﾝの整列方法
                    .Alignment = System.Windows.Forms.ListViewAlignment.Top
                    'ﾘｽﾄﾋﾞｭｰﾀｲﾌﾟ設定
                    .View = System.Windows.Forms.View.Details
                    .LabelEdit = False
                    'ｶﾗﾑﾍｯﾀﾞｰの追加
                    w_column = .Columns.Add("CD", "勤務地コード", Integer.Parse(General.paTwipsTopixels(1300)), System.Windows.Forms.HorizontalAlignment.Left, "")
                    w_column = .Columns.Add("Name", "勤務地名", Integer.Parse(General.paTwipsTopixels(2000)), System.Windows.Forms.HorizontalAlignment.Left, "")
                    w_column = .Columns.Add("DateFrom", "開始年月日", Integer.Parse(General.paTwipsTopixels(1500)), System.Windows.Forms.HorizontalAlignment.Left, "")
                    w_column = .Columns.Add("DateTo", "終了年月日", Integer.Parse(General.paTwipsTopixels(1500)), System.Windows.Forms.HorizontalAlignment.Left, "")
                    w_column = .Columns.Add("Kikan", "勤務機関", Integer.Parse(General.paTwipsTopixels(2000)), System.Windows.Forms.HorizontalAlignment.Left, "")
                    w_column = .Columns.Add("Bikou", "備考", Integer.Parse(General.paTwipsTopixels(2000)), System.Windows.Forms.HorizontalAlignment.Left, "")

                    '兼務情報の取得
                    If General.g_objIdoData.mGetSyokurekiInfo() = True Then

                        w_lngCnt = General.g_objIdoData.fJC_SyokurekiCount

                        ReDim m_dblLastUpdTime(w_lngCnt)

                        For w_lngLoop = 1 To w_lngCnt

                            General.g_objIdoData.mJC_SyokurekiIdx = w_lngLoop

                            m_dblLastUpdTime(w_lngLoop) = General.g_objIdoData.fJC_UpdTime '最終更新日時

                            '画面の表示
                            w_List = .Items.Add(M_strSelectID & General.paFormatZero(w_lngLoop, 5), Trim(General.g_objIdoData.fJC_KinmuchiCD), "")

                            If w_List.SubItems.Count > 1 Then
                                w_List.SubItems(1).Text = Trim(General.g_objIdoData.fJC_KinmuchiName)
                            Else
                                w_List.SubItems.Insert(1, New System.Windows.Forms.ListViewItem.ListViewSubItem(Nothing, Trim(General.g_objIdoData.fJC_KinmuchiName)))
                            End If

                            If w_List.SubItems.Count > 2 Then
                                w_List.SubItems(2).Text = General.DateUtil.paGetDateStringFromInteger(General.g_objIdoData.fJC_DateFrom)
                            Else
                                w_List.SubItems.Insert(2, New System.Windows.Forms.ListViewItem.ListViewSubItem(Nothing, General.DateUtil.paGetDateStringFromInteger(General.g_objIdoData.fJC_DateFrom)))
                            End If

                            If w_List.SubItems.Count > 3 Then
                                w_List.SubItems(3).Text = IIf(IIf(IsNothing(General.g_objIdoData.fJC_DateTo), 0, General.g_objIdoData.fJC_DateTo) = 0, "", General.DateUtil.paGetDateStringFromInteger(General.g_objIdoData.fJC_DateTo))
                            Else
                                w_List.SubItems.Insert(3, New System.Windows.Forms.ListViewItem.ListViewSubItem(Nothing, IIf(IIf(IsNothing(General.g_objIdoData.fJC_DateTo), 0, General.g_objIdoData.fJC_DateTo) = 0, "", General.DateUtil.paGetDateStringFromInteger(General.g_objIdoData.fJC_DateTo))))
                            End If

                            If w_List.SubItems.Count > 4 Then
                                w_List.SubItems(4).Text = Trim(General.g_objIdoData.fJC_KinmuKikan)
                            Else
                                w_List.SubItems.Insert(4, New System.Windows.Forms.ListViewItem.ListViewSubItem(Nothing, Trim(General.g_objIdoData.fJC_KinmuKikan)))
                            End If

                            If w_List.SubItems.Count > 5 Then
                                w_List.SubItems(5).Text = Trim(General.g_objIdoData.fJC_Bikou)
                            Else
                                w_List.SubItems.Insert(5, New System.Windows.Forms.ListViewItem.ListViewSubItem(Nothing, Trim(General.g_objIdoData.fJC_Bikou)))
                            End If
                            w_List.Tag = Convert.ToString(w_lngLoop)
                        Next w_lngLoop

                    End If

                    '選択されたノードのキーが一般学歴情報だった場合(セキュリティコードが"NSC2000HA11"だった場合)
                ElseIf m_strSelectResCD = G_strIppanGakurekiRes Then

                    w_blnADD = True
                    w_blnUPD = True

                    'ｱｲｺﾝの整列方法
                    .Alignment = System.Windows.Forms.ListViewAlignment.Top
                    'ﾘｽﾄﾋﾞｭｰﾀｲﾌﾟ設定
                    .View = System.Windows.Forms.View.Details
                    .LabelEdit = False
                    'ｶﾗﾑﾍｯﾀﾞｰの追加
                    w_column = .Columns.Add("Kbn", "区分", Integer.Parse(General.paTwipsTopixels(2000)), System.Windows.Forms.HorizontalAlignment.Left, "")
                    w_column = .Columns.Add("Name", "区分名", Integer.Parse(General.paTwipsTopixels(2000)), System.Windows.Forms.HorizontalAlignment.Left, "")
                    w_column = .Columns.Add("ChiikiCD", "地域コード", Integer.Parse(General.paTwipsTopixels(1500)), System.Windows.Forms.HorizontalAlignment.Left, "")
                    w_column = .Columns.Add("ChiikiName", "地域名", Integer.Parse(General.paTwipsTopixels(1500)), System.Windows.Forms.HorizontalAlignment.Left, "")
                    w_column = .Columns.Add("LastKbn", "最終更新区分", Integer.Parse(General.paTwipsTopixels(1500)), System.Windows.Forms.HorizontalAlignment.Left, "")
                    w_column = .Columns.Add("Date", "卒業年月日", Integer.Parse(General.paTwipsTopixels(2000)), System.Windows.Forms.HorizontalAlignment.Left, "")
                    w_column = .Columns.Add("SchoolCD", "学校コード", Integer.Parse(General.paTwipsTopixels(2000)), System.Windows.Forms.HorizontalAlignment.Left, "")
                    w_column = .Columns.Add("SchoolName", "学校名", Integer.Parse(General.paTwipsTopixels(2000)), System.Windows.Forms.HorizontalAlignment.Left, "")
                    w_column = .Columns.Add("Bikou", "修了過程", Integer.Parse(General.paTwipsTopixels(2000)), System.Windows.Forms.HorizontalAlignment.Left, "")

                    '兼務情報の取得
                    If General.g_objIdoData.mGetIppanGakurekiInfo() = True Then

                        w_lngCnt = General.g_objIdoData.fGS_IppanGakurekiCount

                        ReDim m_dblLastUpdTime(w_lngCnt)

                        For w_lngLoop = 1 To w_lngCnt

                            General.g_objIdoData.mGS_IppanGakurekiIdx = w_lngLoop

                            m_dblLastUpdTime(w_lngLoop) = General.g_objIdoData.fGS_UpdTime '最終更新日時

                            '画面の表示
                            w_List = .Items.Add(M_strSelectID & General.paFormatZero(w_lngLoop, 5), Trim(General.g_objIdoData.fGS_Kbn), "")

                            If w_List.SubItems.Count > 1 Then
                                w_List.SubItems(1).Text = Trim(General.g_objIdoData.fGS_KbnName)
                            Else
                                w_List.SubItems.Insert(1, New System.Windows.Forms.ListViewItem.ListViewSubItem(Nothing, Trim(General.g_objIdoData.fGS_KbnName)))
                            End If

                            If w_List.SubItems.Count > 2 Then
                                w_List.SubItems(2).Text = Trim(General.g_objIdoData.fGS_ChiikiCD)
                            Else
                                w_List.SubItems.Insert(2, New System.Windows.Forms.ListViewItem.ListViewSubItem(Nothing, Trim(General.g_objIdoData.fGS_ChiikiCD)))
                            End If

                            If w_List.SubItems.Count > 3 Then
                                w_List.SubItems(3).Text = Trim(General.g_objIdoData.fGS_ChiikiName)
                            Else
                                w_List.SubItems.Insert(3, New System.Windows.Forms.ListViewItem.ListViewSubItem(Nothing, Trim(General.g_objIdoData.fGS_ChiikiName)))
                            End If

                            If "1".Equals(Trim(General.g_objIdoData.fGS_LastKbn)) Then
                                w_strWork = "最終"
                            Else
                                w_strWork = ""
                            End If

                            If w_List.SubItems.Count > 4 Then
                                w_List.SubItems(4).Text = w_strWork
                            Else
                                w_List.SubItems.Insert(4, New System.Windows.Forms.ListViewItem.ListViewSubItem(Nothing, w_strWork))
                            End If

                            If w_List.SubItems.Count > 5 Then
                                w_List.SubItems(5).Text = General.paGetDateStringFromInteger(General.g_objIdoData.fGS_LastDate)
                            Else
                                w_List.SubItems.Insert(5, New System.Windows.Forms.ListViewItem.ListViewSubItem(Nothing, General.paGetDateStringFromInteger(General.g_objIdoData.fGS_LastDate)))
                            End If

                            If w_List.SubItems.Count > 6 Then
                                w_List.SubItems(6).Text = Trim(General.g_objIdoData.fGS_SchoolCD)
                            Else
                                w_List.SubItems.Insert(6, New System.Windows.Forms.ListViewItem.ListViewSubItem(Nothing, Trim(General.g_objIdoData.fGS_SchoolCD)))
                            End If

                            If w_List.SubItems.Count > 7 Then
                                w_List.SubItems(7).Text = Trim(General.g_objIdoData.fGS_SchoolName)
                            Else
                                w_List.SubItems.Insert(7, New System.Windows.Forms.ListViewItem.ListViewSubItem(Nothing, Trim(General.g_objIdoData.fGS_SchoolName)))
                            End If

                            If w_List.SubItems.Count > 8 Then
                                w_List.SubItems(8).Text = Trim(General.g_objIdoData.fGS_Bikou)
                            Else
                                w_List.SubItems.Insert(8, New System.Windows.Forms.ListViewItem.ListViewSubItem(Nothing, Trim(General.g_objIdoData.fGS_Bikou)))
                            End If
                            w_List.Tag = Convert.ToString(w_lngLoop)
                        Next w_lngLoop

                    End If

                    '選択されたノードのキーが専門学歴情報だった場合(セキュリティコードが"NSC2000HA12"だった場合)
                ElseIf m_strSelectResCD = G_strSenmonGakurekiRes Then

                    w_blnADD = True
                    w_blnUPD = True

                    'ｱｲｺﾝの整列方法
                    .Alignment = System.Windows.Forms.ListViewAlignment.Top
                    'ﾘｽﾄﾋﾞｭｰﾀｲﾌﾟ設定
                    .View = System.Windows.Forms.View.Details
                    .LabelEdit = False
                    'ｶﾗﾑﾍｯﾀﾞｰの追加
                    w_column = .Columns.Add("Kbn", "区分", Integer.Parse(General.paTwipsTopixels(2000)), System.Windows.Forms.HorizontalAlignment.Left, "")
                    w_column = .Columns.Add("Name", "区分名", Integer.Parse(General.paTwipsTopixels(2000)), System.Windows.Forms.HorizontalAlignment.Left, "")
                    w_column = .Columns.Add("ChiikiCD", "地域コード", Integer.Parse(General.paTwipsTopixels(1500)), System.Windows.Forms.HorizontalAlignment.Left, "")
                    w_column = .Columns.Add("ChiikiName", "地域名", Integer.Parse(General.paTwipsTopixels(1500)), System.Windows.Forms.HorizontalAlignment.Left, "")
                    w_column = .Columns.Add("LastKbn", "最終更新区分", Integer.Parse(General.paTwipsTopixels(1500)), System.Windows.Forms.HorizontalAlignment.Left, "")
                    w_column = .Columns.Add("Date", "卒業年月日", Integer.Parse(General.paTwipsTopixels(2000)), System.Windows.Forms.HorizontalAlignment.Left, "")
                    w_column = .Columns.Add("SchoolCD", "学校コード", Integer.Parse(General.paTwipsTopixels(2000)), System.Windows.Forms.HorizontalAlignment.Left, "")
                    w_column = .Columns.Add("SchoolName", "学校名", Integer.Parse(General.paTwipsTopixels(2000)), System.Windows.Forms.HorizontalAlignment.Left, "")
                    w_column = .Columns.Add("Bikou", "修了過程", Integer.Parse(General.paTwipsTopixels(2000)), System.Windows.Forms.HorizontalAlignment.Left, "")

                    '兼務情報の取得
                    If General.g_objIdoData.mGetSenmonGakurekiInfo() = True Then

                        w_lngCnt = General.g_objIdoData.fSS_SenmonGakurekiCount

                        ReDim m_dblLastUpdTime(w_lngCnt)

                        For w_lngLoop = 1 To w_lngCnt

                            General.g_objIdoData.mSS_SenmonGakurekiIdx = w_lngLoop

                            m_dblLastUpdTime(w_lngLoop) = General.g_objIdoData.fSS_UpdTime '最終更新日時

                            '画面の表示
                            w_List = .Items.Add(M_strSelectID & General.paFormatZero(w_lngLoop, 5), Trim(General.g_objIdoData.fSS_Kbn), "")

                            If w_List.SubItems.Count > 1 Then
                                w_List.SubItems(1).Text = Trim(General.g_objIdoData.fSS_KbnName)
                            Else
                                w_List.SubItems.Insert(1, New System.Windows.Forms.ListViewItem.ListViewSubItem(Nothing, Trim(General.g_objIdoData.fSS_KbnName)))
                            End If

                            If w_List.SubItems.Count > 2 Then
                                w_List.SubItems(2).Text = Trim(General.g_objIdoData.fSS_ChiikiCD)
                            Else
                                w_List.SubItems.Insert(2, New System.Windows.Forms.ListViewItem.ListViewSubItem(Nothing, Trim(General.g_objIdoData.fSS_ChiikiCD)))
                            End If

                            If w_List.SubItems.Count > 3 Then
                                w_List.SubItems(3).Text = Trim(General.g_objIdoData.fSS_ChiikiName)
                            Else
                                w_List.SubItems.Insert(3, New System.Windows.Forms.ListViewItem.ListViewSubItem(Nothing, Trim(General.g_objIdoData.fSS_ChiikiName)))
                            End If

                            If "1".Equals(Trim(General.g_objIdoData.fSS_LastKbn)) Then
                                w_strWork = "最終"
                            Else
                                w_strWork = ""
                            End If

                            If w_List.SubItems.Count > 4 Then
                                w_List.SubItems(4).Text = w_strWork
                            Else
                                w_List.SubItems.Insert(4, New System.Windows.Forms.ListViewItem.ListViewSubItem(Nothing, w_strWork))
                            End If

                            If w_List.SubItems.Count > 5 Then
                                w_List.SubItems(5).Text = General.paGetDateStringFromInteger(General.g_objIdoData.fSS_LastDate)
                            Else
                                w_List.SubItems.Insert(5, New System.Windows.Forms.ListViewItem.ListViewSubItem(Nothing, General.paGetDateStringFromInteger(General.g_objIdoData.fSS_LastDate)))
                            End If

                            If w_List.SubItems.Count > 6 Then
                                w_List.SubItems(6).Text = Trim(General.g_objIdoData.fSS_SchoolCD)
                            Else
                                w_List.SubItems.Insert(6, New System.Windows.Forms.ListViewItem.ListViewSubItem(Nothing, Trim(General.g_objIdoData.fSS_SchoolCD)))
                            End If

                            If w_List.SubItems.Count > 7 Then
                                w_List.SubItems(7).Text = Trim(General.g_objIdoData.fSS_SchoolName)
                            Else
                                w_List.SubItems.Insert(7, New System.Windows.Forms.ListViewItem.ListViewSubItem(Nothing, Trim(General.g_objIdoData.fSS_SchoolName)))
                            End If

                            If w_List.SubItems.Count > 8 Then
                                w_List.SubItems(8).Text = Trim(General.g_objIdoData.fSS_Bikou)
                            Else
                                w_List.SubItems.Insert(8, New System.Windows.Forms.ListViewItem.ListViewSubItem(Nothing, Trim(General.g_objIdoData.fSS_Bikou)))
                            End If
                            w_List.Tag = Convert.ToString(w_lngLoop)
                        Next w_lngLoop

                    End If

                    '選択されたノードのキーが長休情報だった場合(セキュリティコードが"NSC2000HA13"だった場合)
                ElseIf m_strSelectResCD = G_strChoukyuRes Then

                    w_blnADD = True
                    w_blnUPD = True

                    'ｱｲｺﾝの整列方法
                    .Alignment = System.Windows.Forms.ListViewAlignment.Top
                    'ﾘｽﾄﾋﾞｭｰﾀｲﾌﾟ設定
                    .View = System.Windows.Forms.View.Details
                    .LabelEdit = False
                    'ｶﾗﾑﾍｯﾀﾞｰの追加
                    w_column = .Columns.Add("Code", "長休コード", Integer.Parse(General.paTwipsTopixels(2000)), System.Windows.Forms.HorizontalAlignment.Left, "")
                    w_column = .Columns.Add("Name", "長休理由", Integer.Parse(General.paTwipsTopixels(2000)), System.Windows.Forms.HorizontalAlignment.Left, "")
                    w_column = .Columns.Add("DateFrom", "開始年月日", Integer.Parse(General.paTwipsTopixels(1500)), System.Windows.Forms.HorizontalAlignment.Left, "")
                    w_column = .Columns.Add("DateTo", "終了年月日", Integer.Parse(General.paTwipsTopixels(1500)), System.Windows.Forms.HorizontalAlignment.Left, "")
                    w_column = .Columns.Add("Bikou", "備考", Integer.Parse(General.paTwipsTopixels(2000)), System.Windows.Forms.HorizontalAlignment.Left, "")

                    '兼務情報の取得
                    If General.g_objIdoData.mGetChoukyuInfo() = True Then

                        w_lngCnt = General.g_objIdoData.fLL_ChoukyuCount

                        ReDim m_dblLastUpdTime(w_lngCnt)

                        For w_lngLoop = 1 To w_lngCnt

                            General.g_objIdoData.mLL_ChoukyuIdx = w_lngLoop

                            m_dblLastUpdTime(w_lngLoop) = General.g_objIdoData.fLL_UpdTime '最終更新日時

                            '画面の表示
                            w_List = .Items.Add(M_strSelectID & General.paFormatZero(w_lngLoop, 5), Trim(General.g_objIdoData.fLL_CD), "")

                            If w_List.SubItems.Count > 1 Then
                                w_List.SubItems(1).Text = Trim(General.g_objIdoData.fLL_Name)
                            Else
                                w_List.SubItems.Insert(1, New System.Windows.Forms.ListViewItem.ListViewSubItem(Nothing, Trim(General.g_objIdoData.fLL_Name)))
                            End If

                            If w_List.SubItems.Count > 2 Then
                                w_List.SubItems(2).Text = General.paGetDateStringFromInteger(General.g_objIdoData.fLL_DateFrom)
                            Else
                                w_List.SubItems.Insert(2, New System.Windows.Forms.ListViewItem.ListViewSubItem(Nothing, General.paGetDateStringFromInteger(General.g_objIdoData.fLL_DateFrom)))
                            End If

                            If w_List.SubItems.Count > 3 Then
                                w_List.SubItems(3).Text = IIf(IIf(IsNothing(General.g_objIdoData.fLL_DateTo), 0, General.g_objIdoData.fLL_DateTo) = 0, "", General.paGetDateStringFromInteger(General.g_objIdoData.fLL_DateTo))
                            Else
                                w_List.SubItems.Insert(3, New System.Windows.Forms.ListViewItem.ListViewSubItem(Nothing, IIf(IIf(IsNothing(General.g_objIdoData.fLL_DateTo), 0, General.g_objIdoData.fLL_DateTo) = 0, "", General.paGetDateStringFromInteger(General.g_objIdoData.fLL_DateTo))))
                            End If

                            If w_List.SubItems.Count > 4 Then
                                w_List.SubItems(4).Text = Trim(General.g_objIdoData.fLL_Bikou)
                            Else
                                w_List.SubItems.Insert(4, New System.Windows.Forms.ListViewItem.ListViewSubItem(Nothing, Trim(General.g_objIdoData.fLL_Bikou)))
                            End If
                            w_List.Tag = Convert.ToString(w_lngLoop)
                        Next w_lngLoop

                    End If

                    '選択されたノードのキーが産休情報だった場合(セキュリティコードが"NSC2000HA14"だった場合)
                ElseIf m_strSelectResCD = G_strSankyuRes Then

                    w_blnADD = True
                    w_blnUPD = True

                    'ｱｲｺﾝの整列方法
                    .Alignment = System.Windows.Forms.ListViewAlignment.Top
                    'ﾘｽﾄﾋﾞｭｰﾀｲﾌﾟ設定
                    .View = System.Windows.Forms.View.Details
                    .LabelEdit = False
                    'ｶﾗﾑﾍｯﾀﾞｰの追加
                    w_column = .Columns.Add("PlanDate", "出産予定日", Integer.Parse(General.paTwipsTopixels(1500)), System.Windows.Forms.HorizontalAlignment.Left, "")
                    w_column = .Columns.Add("TwinFlg", "双胎区分", Integer.Parse(General.paTwipsTopixels(1000)), System.Windows.Forms.HorizontalAlignment.Left, "")
                    w_column = .Columns.Add("PlanYamenFrom", "予定夜免From", Integer.Parse(General.paTwipsTopixels(1500)), System.Windows.Forms.HorizontalAlignment.Left, "")
                    w_column = .Columns.Add("PlanYamenTo", "予定夜免To", Integer.Parse(General.paTwipsTopixels(1500)), System.Windows.Forms.HorizontalAlignment.Left, "")
                    w_column = .Columns.Add("PlanSanzenFrom", "予定産前From", Integer.Parse(General.paTwipsTopixels(1500)), System.Windows.Forms.HorizontalAlignment.Left, "")
                    w_column = .Columns.Add("PlanSanzenTo", "予定産前To", Integer.Parse(General.paTwipsTopixels(1500)), System.Windows.Forms.HorizontalAlignment.Left, "")
                    w_column = .Columns.Add("PlanSangoFrom", "予定産後From", Integer.Parse(General.paTwipsTopixels(1500)), System.Windows.Forms.HorizontalAlignment.Left, "")
                    w_column = .Columns.Add("PlanSangoTo", "予定産後To", Integer.Parse(General.paTwipsTopixels(1500)), System.Windows.Forms.HorizontalAlignment.Left, "")
                    w_column = .Columns.Add("PlanIkujiFrom", "予定育児From", Integer.Parse(General.paTwipsTopixels(1500)), System.Windows.Forms.HorizontalAlignment.Left, "")
                    w_column = .Columns.Add("PlanIkujiTo", "予定育児To", Integer.Parse(General.paTwipsTopixels(1500)), System.Windows.Forms.HorizontalAlignment.Left, "")
                    w_column = .Columns.Add("BirthDate", "出産日", Integer.Parse(General.paTwipsTopixels(1500)), System.Windows.Forms.HorizontalAlignment.Left, "")
                    w_column = .Columns.Add("FixedYamenFrom", "確定夜免From", Integer.Parse(General.paTwipsTopixels(1500)), System.Windows.Forms.HorizontalAlignment.Left, "")
                    w_column = .Columns.Add("FixedYamenTo", "確定夜免To", Integer.Parse(General.paTwipsTopixels(1500)), System.Windows.Forms.HorizontalAlignment.Left, "")
                    w_column = .Columns.Add("FixedSanzenFrom", "確定産前From", Integer.Parse(General.paTwipsTopixels(1500)), System.Windows.Forms.HorizontalAlignment.Left, "")
                    w_column = .Columns.Add("FixedSanzenTo", "確定産前To", Integer.Parse(General.paTwipsTopixels(1500)), System.Windows.Forms.HorizontalAlignment.Left, "")
                    w_column = .Columns.Add("FixedSangoFrom", "確定産後From", Integer.Parse(General.paTwipsTopixels(1500)), System.Windows.Forms.HorizontalAlignment.Left, "")
                    w_column = .Columns.Add("FixedSangoTo", "確定産後To", Integer.Parse(General.paTwipsTopixels(1500)), System.Windows.Forms.HorizontalAlignment.Left, "")
                    w_column = .Columns.Add("FixedIkujiFrom", "確定育児From", Integer.Parse(General.paTwipsTopixels(1500)), System.Windows.Forms.HorizontalAlignment.Left, "")
                    w_column = .Columns.Add("FixedIkujiTo", "確定育児To", Integer.Parse(General.paTwipsTopixels(1500)), System.Windows.Forms.HorizontalAlignment.Left, "")

                    '兼務情報の取得
                    If General.g_objIdoData.mGetSankyuInfo() = True Then

                        w_lngCnt = General.g_objIdoData.fSK_SankyuCount

                        ReDim m_dblLastUpdTime(w_lngCnt)
                        ReDim m_lngSEQ(w_lngCnt)

                        For w_lngLoop = 1 To w_lngCnt

                            General.g_objIdoData.mSK_SankyuIdx = w_lngLoop

                            m_dblLastUpdTime(w_lngLoop) = General.g_objIdoData.fSK_UpdTime '最終更新日時

                            m_lngSEQ(w_lngLoop) = General.g_objIdoData.fSK_SEQ

                            '画面の表示
                            w_List = .Items.Add(M_strSelectID & General.paFormatZero(w_lngLoop, 5), IIf(IIf(IsNothing(General.g_objIdoData.fSK_PlanDate), 0, General.g_objIdoData.fSK_PlanDate) = 0, "", Format(General.g_objIdoData.fSK_PlanDate)), "")

                            If "1".Equals(Trim(General.g_objIdoData.fSK_TwinFlg)) Then
                                w_strWork = "単胎"
                            ElseIf "2".Equals(Trim(General.g_objIdoData.fSK_TwinFlg)) Then
                                w_strWork = "双胎"
                            End If

                            If w_List.SubItems.Count > 1 Then
                                w_List.SubItems(1).Text = w_strWork
                            Else
                                w_List.SubItems.Insert(1, New System.Windows.Forms.ListViewItem.ListViewSubItem(Nothing, w_strWork))
                            End If

                            If w_List.SubItems.Count > 2 Then
                                w_List.SubItems(2).Text = IIf(IIf(IsNothing(General.g_objIdoData.fSK_PlanSanzenYamenFrom), 0, General.g_objIdoData.fSK_PlanSanzenYamenFrom) = 0, "", General.paGetDateStringFromInteger(General.g_objIdoData.fSK_PlanSanzenYamenFrom))
                            Else
                                w_List.SubItems.Insert(2, New System.Windows.Forms.ListViewItem.ListViewSubItem(Nothing, IIf(IIf(IsNothing(General.g_objIdoData.fSK_PlanSanzenYamenFrom), 0, General.g_objIdoData.fSK_PlanSanzenYamenFrom) = 0, "", General.paGetDateStringFromInteger(General.g_objIdoData.fSK_PlanSanzenYamenFrom))))
                            End If

                            If w_List.SubItems.Count > 3 Then
                                w_List.SubItems(3).Text = IIf(IIf(IsNothing(General.g_objIdoData.fSK_PlanSanzenYamenTo), 0, General.g_objIdoData.fSK_PlanSanzenYamenTo) = 0, "", General.paGetDateStringFromInteger(General.g_objIdoData.fSK_PlanSanzenYamenTo))
                            Else
                                w_List.SubItems.Insert(3, New System.Windows.Forms.ListViewItem.ListViewSubItem(Nothing, IIf(IIf(IsNothing(General.g_objIdoData.fSK_PlanSanzenYamenTo), 0, General.g_objIdoData.fSK_PlanSanzenYamenTo) = 0, "", General.paGetDateStringFromInteger(General.g_objIdoData.fSK_PlanSanzenYamenTo))))
                            End If

                            If w_List.SubItems.Count > 4 Then
                                w_List.SubItems(4).Text = IIf(IIf(IsDBNull(General.g_objIdoData.fSK_PlanSanzenHolFrom), 0, General.g_objIdoData.fSK_PlanSanzenHolFrom) = 0, "", General.paGetDateStringFromInteger(General.g_objIdoData.fSK_PlanSanzenHolFrom))
                            Else
                                w_List.SubItems.Insert(4, New System.Windows.Forms.ListViewItem.ListViewSubItem(Nothing, IIf(IIf(IsDBNull(General.g_objIdoData.fSK_PlanSanzenHolFrom), 0, General.g_objIdoData.fSK_PlanSanzenHolFrom) = 0, "", General.paGetDateStringFromInteger(General.g_objIdoData.fSK_PlanSanzenHolFrom))))
                            End If

                            If w_List.SubItems.Count > 5 Then
                                w_List.SubItems(5).Text = IIf(IIf(IsDBNull(General.g_objIdoData.fSK_PlanSanzenHolTo), 0, General.g_objIdoData.fSK_PlanSanzenHolTo) = 0, "", General.paGetDateStringFromInteger(General.g_objIdoData.fSK_PlanSanzenHolTo))
                            Else
                                w_List.SubItems.Insert(5, New System.Windows.Forms.ListViewItem.ListViewSubItem(Nothing, IIf(IIf(IsDBNull(General.g_objIdoData.fSK_PlanSanzenHolTo), 0, General.g_objIdoData.fSK_PlanSanzenHolTo) = 0, "", General.paGetDateStringFromInteger(General.g_objIdoData.fSK_PlanSanzenHolTo))))
                            End If

                            If w_List.SubItems.Count > 6 Then
                                w_List.SubItems(6).Text = IIf(IIf(IsDBNull(General.g_objIdoData.fSK_PlanSangoHolFrom), 0, General.g_objIdoData.fSK_PlanSangoHolFrom) = 0, "", General.paGetDateStringFromInteger(General.g_objIdoData.fSK_PlanSangoHolFrom))
                            Else
                                w_List.SubItems.Insert(6, New System.Windows.Forms.ListViewItem.ListViewSubItem(Nothing, IIf(IIf(IsDBNull(General.g_objIdoData.fSK_PlanSangoHolFrom), 0, General.g_objIdoData.fSK_PlanSangoHolFrom) = 0, "", General.paGetDateStringFromInteger(General.g_objIdoData.fSK_PlanSangoHolFrom))))
                            End If

                            If w_List.SubItems.Count > 7 Then
                                w_List.SubItems(7).Text = IIf(IIf(IsDBNull(General.g_objIdoData.fSK_PlanSangoHolTo), 0, General.g_objIdoData.fSK_PlanSangoHolTo) = 0, "", General.paGetDateStringFromInteger(General.g_objIdoData.fSK_PlanSangoHolTo))
                            Else
                                w_List.SubItems.Insert(7, New System.Windows.Forms.ListViewItem.ListViewSubItem(Nothing, IIf(IIf(IsDBNull(General.g_objIdoData.fSK_PlanSangoHolTo), 0, General.g_objIdoData.fSK_PlanSangoHolTo) = 0, "", General.paGetDateStringFromInteger(General.g_objIdoData.fSK_PlanSangoHolTo))))
                            End If

                            If w_List.SubItems.Count > 8 Then
                                w_List.SubItems(8).Text = IIf(IIf(IsDBNull(General.g_objIdoData.fSK_PlanIkujiHolFrom), 0, General.g_objIdoData.fSK_PlanIkujiHolFrom) = 0, "", General.paGetDateStringFromInteger(General.g_objIdoData.fSK_PlanIkujiHolFrom))
                            Else
                                w_List.SubItems.Insert(8, New System.Windows.Forms.ListViewItem.ListViewSubItem(Nothing, IIf(IIf(IsDBNull(General.g_objIdoData.fSK_PlanIkujiHolFrom), 0, General.g_objIdoData.fSK_PlanIkujiHolFrom) = 0, "", General.paGetDateStringFromInteger(General.g_objIdoData.fSK_PlanIkujiHolFrom))))
                            End If

                            If w_List.SubItems.Count > 9 Then
                                w_List.SubItems(9).Text = IIf(IIf(IsDBNull(General.g_objIdoData.fSK_PlanIkujiHolTo), 0, General.g_objIdoData.fSK_PlanIkujiHolTo) = 0, "", General.paGetDateStringFromInteger(General.g_objIdoData.fSK_PlanIkujiHolTo))
                            Else
                                w_List.SubItems.Insert(9, New System.Windows.Forms.ListViewItem.ListViewSubItem(Nothing, IIf(IIf(IsDBNull(General.g_objIdoData.fSK_PlanIkujiHolTo), 0, General.g_objIdoData.fSK_PlanIkujiHolTo) = 0, "", General.paGetDateStringFromInteger(General.g_objIdoData.fSK_PlanIkujiHolTo))))
                            End If

                            If w_List.SubItems.Count > 10 Then
                                w_List.SubItems(10).Text = IIf(IIf(IsDBNull(General.g_objIdoData.fSK_BirthDate), 0, General.g_objIdoData.fSK_BirthDate) = 0, "", General.paGetDateStringFromInteger(General.g_objIdoData.fSK_BirthDate))
                            Else
                                w_List.SubItems.Insert(10, New System.Windows.Forms.ListViewItem.ListViewSubItem(Nothing, IIf(IIf(IsDBNull(General.g_objIdoData.fSK_BirthDate), 0, General.g_objIdoData.fSK_BirthDate) = 0, "", General.paGetDateStringFromInteger(General.g_objIdoData.fSK_BirthDate))))
                            End If

                            If w_List.SubItems.Count > 11 Then
                                w_List.SubItems(11).Text = IIf(IIf(IsDBNull(General.g_objIdoData.fSK_FixedSanzenYamenFrom), 0, General.g_objIdoData.fSK_FixedSanzenYamenFrom) = 0, "", General.paGetDateStringFromInteger(General.g_objIdoData.fSK_FixedSanzenYamenFrom))
                            Else
                                w_List.SubItems.Insert(11, New System.Windows.Forms.ListViewItem.ListViewSubItem(Nothing, IIf(IIf(IsDBNull(General.g_objIdoData.fSK_FixedSanzenYamenFrom), 0, General.g_objIdoData.fSK_FixedSanzenYamenFrom) = 0, "", General.paGetDateStringFromInteger(General.g_objIdoData.fSK_FixedSanzenYamenFrom))))
                            End If

                            If w_List.SubItems.Count > 12 Then
                                w_List.SubItems(12).Text = IIf(IIf(IsDBNull(General.g_objIdoData.fSK_FixedSanzenYamenTo), 0, General.g_objIdoData.fSK_FixedSanzenYamenTo) = 0, "", General.paGetDateStringFromInteger(General.g_objIdoData.fSK_FixedSanzenYamenTo))
                            Else
                                w_List.SubItems.Insert(12, New System.Windows.Forms.ListViewItem.ListViewSubItem(Nothing, IIf(IIf(IsDBNull(General.g_objIdoData.fSK_FixedSanzenYamenTo), 0, General.g_objIdoData.fSK_FixedSanzenYamenTo) = 0, "", General.paGetDateStringFromInteger(General.g_objIdoData.fSK_FixedSanzenYamenTo))))
                            End If

                            If w_List.SubItems.Count > 13 Then
                                w_List.SubItems(13).Text = IIf(IIf(IsDBNull(General.g_objIdoData.fSK_FixedSanzenHolFrom), 0, General.g_objIdoData.fSK_FixedSanzenHolFrom) = 0, "", General.paGetDateStringFromInteger(General.g_objIdoData.fSK_FixedSanzenHolFrom))
                            Else
                                w_List.SubItems.Insert(13, New System.Windows.Forms.ListViewItem.ListViewSubItem(Nothing, IIf(IIf(IsDBNull(General.g_objIdoData.fSK_FixedSanzenHolFrom), 0, General.g_objIdoData.fSK_FixedSanzenHolFrom) = 0, "", General.paGetDateStringFromInteger(General.g_objIdoData.fSK_FixedSanzenHolFrom))))
                            End If

                            If w_List.SubItems.Count > 14 Then
                                w_List.SubItems(14).Text = IIf(IIf(IsDBNull(General.g_objIdoData.fSK_FixedSanzenHolTo), 0, General.g_objIdoData.fSK_FixedSanzenHolTo) = 0, "", General.paGetDateStringFromInteger(General.g_objIdoData.fSK_FixedSanzenHolTo))
                            Else
                                w_List.SubItems.Insert(14, New System.Windows.Forms.ListViewItem.ListViewSubItem(Nothing, IIf(IIf(IsDBNull(General.g_objIdoData.fSK_FixedSanzenHolTo), 0, General.g_objIdoData.fSK_FixedSanzenHolTo) = 0, "", General.paGetDateStringFromInteger(General.g_objIdoData.fSK_FixedSanzenHolTo))))
                            End If

                            If w_List.SubItems.Count > 15 Then
                                w_List.SubItems(15).Text = IIf(IIf(IsDBNull(General.g_objIdoData.fSK_FixedSangoHolFrom), 0, General.g_objIdoData.fSK_FixedSangoHolFrom) = 0, "", General.paGetDateStringFromInteger(General.g_objIdoData.fSK_FixedSangoHolFrom))
                            Else
                                w_List.SubItems.Insert(15, New System.Windows.Forms.ListViewItem.ListViewSubItem(Nothing, IIf(IIf(IsDBNull(General.g_objIdoData.fSK_FixedSangoHolFrom), 0, General.g_objIdoData.fSK_FixedSangoHolFrom) = 0, "", General.paGetDateStringFromInteger(General.g_objIdoData.fSK_FixedSangoHolFrom))))
                            End If

                            If w_List.SubItems.Count > 16 Then
                                w_List.SubItems(16).Text = IIf(IIf(IsDBNull(General.g_objIdoData.fSK_FixedSangoHolTo), 0, General.g_objIdoData.fSK_FixedSangoHolTo) = 0, "", General.paGetDateStringFromInteger(General.g_objIdoData.fSK_FixedSangoHolTo))
                            Else
                                w_List.SubItems.Insert(16, New System.Windows.Forms.ListViewItem.ListViewSubItem(Nothing, IIf(IIf(IsDBNull(General.g_objIdoData.fSK_FixedSangoHolTo), 0, General.g_objIdoData.fSK_FixedSangoHolTo) = 0, "", General.paGetDateStringFromInteger(General.g_objIdoData.fSK_FixedSangoHolTo))))
                            End If

                            If w_List.SubItems.Count > 17 Then
                                w_List.SubItems(17).Text = IIf(IIf(IsDBNull(General.g_objIdoData.fSK_FixedIkujiHolFrom), 0, General.g_objIdoData.fSK_FixedIkujiHolFrom) = 0, "", General.paGetDateStringFromInteger(General.g_objIdoData.fSK_FixedIkujiHolFrom))
                            Else
                                w_List.SubItems.Insert(17, New System.Windows.Forms.ListViewItem.ListViewSubItem(Nothing, IIf(IIf(IsDBNull(General.g_objIdoData.fSK_FixedIkujiHolFrom), 0, General.g_objIdoData.fSK_FixedIkujiHolFrom) = 0, "", General.paGetDateStringFromInteger(General.g_objIdoData.fSK_FixedIkujiHolFrom))))
                            End If

                            If w_List.SubItems.Count > 18 Then
                                w_List.SubItems(18).Text = IIf(IIf(IsDBNull(General.g_objIdoData.fSK_FixedIkujiHolTo), 0, General.g_objIdoData.fSK_FixedIkujiHolTo) = 0, "", General.paGetDateStringFromInteger(General.g_objIdoData.fSK_FixedIkujiHolTo))
                            Else
                                w_List.SubItems.Insert(18, New System.Windows.Forms.ListViewItem.ListViewSubItem(Nothing, IIf(IIf(IsDBNull(General.g_objIdoData.fSK_FixedIkujiHolTo), 0, General.g_objIdoData.fSK_FixedIkujiHolTo) = 0, "", General.paGetDateStringFromInteger(General.g_objIdoData.fSK_FixedIkujiHolTo))))
                            End If
                            w_List.Tag = Convert.ToString(w_lngLoop)
                        Next w_lngLoop

                    End If

                    '選択されたノードのキーが協会情報だった場合(セキュリティコードが"NSC2000HA15"だった場合)
                ElseIf m_strSelectResCD = G_strKyoukaiRes Then

                    w_blnADD = True
                    w_blnUPD = True

                    'ｱｲｺﾝの整列方法
                    .Alignment = System.Windows.Forms.ListViewAlignment.Top
                    'ﾘｽﾄﾋﾞｭｰﾀｲﾌﾟ設定
                    .View = System.Windows.Forms.View.Details
                    .LabelEdit = False
                    'ｶﾗﾑﾍｯﾀﾞｰの追加
                    w_column = .Columns.Add("PlanDate", "協会コード", Integer.Parse(General.paTwipsTopixels(1500)), System.Windows.Forms.HorizontalAlignment.Left, "")
                    w_column = .Columns.Add("PlanYamenFrom", "協会名", Integer.Parse(General.paTwipsTopixels(1500)), System.Windows.Forms.HorizontalAlignment.Left, "")
                    w_column = .Columns.Add("PlanYamenTo", "協会番号", Integer.Parse(General.paTwipsTopixels(1500)), System.Windows.Forms.HorizontalAlignment.Left, "")
                    w_column = .Columns.Add("PlanSanzenFrom", "入会日", Integer.Parse(General.paTwipsTopixels(1500)), System.Windows.Forms.HorizontalAlignment.Left, "")

                    '情報の取得
                    If General.g_objIdoData.mGetKyoukaiInfo() = True Then

                        w_lngCnt = General.g_objIdoData.fSO_KyoukaiCount

                        ReDim m_dblLastUpdTime(w_lngCnt)

                        For w_lngLoop = 1 To w_lngCnt

                            General.g_objIdoData.mSO_KyoukaiIdx = w_lngLoop

                            m_dblLastUpdTime(w_lngLoop) = General.g_objIdoData.fSO_UpdTime '最終更新日時

                            '画面の表示
                            w_List = .Items.Add(M_strSelectID & General.paFormatZero(w_lngLoop, 5), Trim(General.g_objIdoData.fSO_CD), "")

                            If w_List.SubItems.Count > 1 Then
                                w_List.SubItems(1).Text = Trim(General.g_objIdoData.fSO_Name)
                            Else
                                w_List.SubItems.Insert(1, New System.Windows.Forms.ListViewItem.ListViewSubItem(Nothing, Trim(General.g_objIdoData.fSO_Name)))
                            End If

                            If w_List.SubItems.Count > 2 Then
                                w_List.SubItems(2).Text = Trim(General.g_objIdoData.fSO_No)
                            Else
                                w_List.SubItems.Insert(2, New System.Windows.Forms.ListViewItem.ListViewSubItem(Nothing, Trim(General.g_objIdoData.fSO_No)))
                            End If

                            If w_List.SubItems.Count > 3 Then
                                w_List.SubItems(3).Text = General.paGetDateStringFromInteger(General.g_objIdoData.fSO_Date)
                            Else
                                w_List.SubItems.Insert(3, New System.Windows.Forms.ListViewItem.ListViewSubItem(Nothing, General.DateUtil.paGetDateStringFromInteger(General.g_objIdoData.fSO_Date)))
                            End If
                            w_List.Tag = Convert.ToString(w_lngLoop)
                        Next w_lngLoop

                    End If

                    '選択されたノードのキーが家族情報だった場合(セキュリティコードが"NSC2000HA16"だった場合)
                ElseIf m_strSelectResCD = G_strKazokuRes Then

                    w_blnADD = True
                    w_blnUPD = True

                    'ｱｲｺﾝの整列方法
                    .Alignment = System.Windows.Forms.ListViewAlignment.Top
                    'ﾘｽﾄﾋﾞｭｰﾀｲﾌﾟ設定
                    .View = System.Windows.Forms.View.Details
                    .LabelEdit = False
                    'ｶﾗﾑﾍｯﾀﾞｰの追加
                    w_column = .Columns.Add("Name", "氏名", Integer.Parse(General.paTwipsTopixels(1500)), System.Windows.Forms.HorizontalAlignment.Left, "")
                    w_column = .Columns.Add("Date", "生年月日", Integer.Parse(General.paTwipsTopixels(1500)), System.Windows.Forms.HorizontalAlignment.Left, "")
                    w_column = .Columns.Add("TsudukiCD", "続柄コード", Integer.Parse(General.paTwipsTopixels(1500)), System.Windows.Forms.HorizontalAlignment.Left, "")
                    w_column = .Columns.Add("TsudukiName", "続柄名称", Integer.Parse(General.paTwipsTopixels(1500)), System.Windows.Forms.HorizontalAlignment.Left, "")
                    w_column = .Columns.Add("DoukyoKbn", "同居区分", Integer.Parse(General.paTwipsTopixels(1500)), System.Windows.Forms.HorizontalAlignment.Left, "")
                    w_column = .Columns.Add("FuyouKbn", "扶養区分", Integer.Parse(General.paTwipsTopixels(1500)), System.Windows.Forms.HorizontalAlignment.Left, "")
                    w_column = .Columns.Add("SeizonKbn", "生存区分", Integer.Parse(General.paTwipsTopixels(1500)), System.Windows.Forms.HorizontalAlignment.Left, "")

                    '情報の取得
                    If General.g_objIdoData.mGetKazokuInfo() = True Then
                        w_lngCnt = General.g_objIdoData.fKY_KazokuCount

                        ReDim m_dblLastUpdTime(w_lngCnt)
                        ReDim m_lngSEQ(w_lngCnt)

                        For w_lngLoop = 1 To w_lngCnt

                            General.g_objIdoData.mKY_KazokuIdx = w_lngLoop

                            m_dblLastUpdTime(w_lngLoop) = General.g_objIdoData.fKY_UpdTime '最終更新日時

                            m_lngSEQ(w_lngLoop) = General.g_objIdoData.fKY_SEQ

                            '画面の表示
                            w_List = .Items.Add(M_strSelectID & General.paFormatZero(w_lngLoop, 5), Trim(General.g_objIdoData.fKY_Name), "")

                            If w_List.SubItems.Count > 1 Then
                                w_List.SubItems(1).Text = IIf(General.g_objIdoData.fKY_BirthDay = 0, "", General.DateUtil.paGetDateStringFromInteger(General.g_objIdoData.fKY_BirthDay))
                            Else
                                w_List.SubItems.Insert(1, New System.Windows.Forms.ListViewItem.ListViewSubItem(Nothing, IIf(General.g_objIdoData.fKY_BirthDay = 0, "", General.DateUtil.paGetDateStringFromInteger(General.g_objIdoData.fKY_BirthDay))))
                            End If

                            If w_List.SubItems.Count > 2 Then
                                w_List.SubItems(2).Text = Trim(General.g_objIdoData.fKY_TsudukiCD)
                            Else
                                w_List.SubItems.Insert(2, New System.Windows.Forms.ListViewItem.ListViewSubItem(Nothing, Trim(General.g_objIdoData.fKY_TsudukiCD)))
                            End If

                            If w_List.SubItems.Count > 3 Then
                                w_List.SubItems(3).Text = Trim(General.g_objIdoData.fKY_TsudukiName)
                            Else
                                w_List.SubItems.Insert(3, New System.Windows.Forms.ListViewItem.ListViewSubItem(Nothing, Trim(General.g_objIdoData.fKY_TsudukiName)))
                            End If
                            '"1"（同居），"2"（別居）

                            If "1".Equals(Trim(General.g_objIdoData.fKY_DoukyoKbn)) Then
                                w_strWork = "同居"
                            ElseIf "2".Equals(Trim(General.g_objIdoData.fKY_DoukyoKbn)) Then
                                w_strWork = "別居"
                            End If

                            If w_List.SubItems.Count > 4 Then
                                w_List.SubItems(4).Text = w_strWork
                            Else
                                w_List.SubItems.Insert(4, New System.Windows.Forms.ListViewItem.ListViewSubItem(Nothing, w_strWork))
                            End If
                            '"1"（扶養者），"2"（非扶養者）， "3"（被扶養者）

                            If "1".Equals(Trim(General.g_objIdoData.fKY_FuyouKbn)) Then
                                w_strWork = "扶養者"
                            ElseIf "2".Equals(Trim(General.g_objIdoData.fKY_FuyouKbn)) Then
                                w_strWork = "非扶養者"
                            ElseIf "3".Equals(Trim(General.g_objIdoData.fKY_FuyouKbn)) Then
                                w_strWork = "被扶養者"
                            End If

                            If w_List.SubItems.Count > 5 Then
                                w_List.SubItems(5).Text = w_strWork
                            Else
                                w_List.SubItems.Insert(5, New System.Windows.Forms.ListViewItem.ListViewSubItem(Nothing, w_strWork))
                            End If
                            '"1"（生存），"2"（△）
                            If "1".Equals(Trim(General.g_objIdoData.fKY_SeizonKbn)) Then
                                w_strWork = "生存"
                            ElseIf "2".Equals(Trim(General.g_objIdoData.fKY_SeizonKbn)) Then
                                w_strWork = ""
                            End If

                            If w_List.SubItems.Count > 6 Then
                                w_List.SubItems(6).Text = w_strWork
                            Else
                                w_List.SubItems.Insert(6, New System.Windows.Forms.ListViewItem.ListViewSubItem(Nothing, w_strWork))
                            End If
                            w_strWork = ""

                            w_List.Tag = Convert.ToString(w_lngLoop)
                        Next w_lngLoop

                    End If
                    '選択されたノードのキーが研修情報だった場合(セキュリティコードが"NSC2000HA17"だった場合)
                ElseIf m_strSelectResCD = G_strStudyRes Then

                    w_blnADD = True
                    w_blnUPD = True

                    'ｱｲｺﾝの整列方法
                    .Alignment = System.Windows.Forms.ListViewAlignment.Top
                    'ﾘｽﾄﾋﾞｭｰﾀｲﾌﾟ設定
                    .View = System.Windows.Forms.View.Details
                    .LabelEdit = False
                    'ｶﾗﾑﾍｯﾀﾞｰの追加
                    w_column = .Columns.Add("Date", "日程", Integer.Parse(General.paTwipsTopixels(1500)), System.Windows.Forms.HorizontalAlignment.Left, "")
                    w_column = .Columns.Add("CourseCD", "コースコード", Integer.Parse(General.paTwipsTopixels(1500)), System.Windows.Forms.HorizontalAlignment.Left, "") 'コースコード
                    w_column = .Columns.Add("CourseName", "コース名称", Integer.Parse(General.paTwipsTopixels(1500)), System.Windows.Forms.HorizontalAlignment.Left, "") 'コース名称
                    w_column = .Columns.Add("DivisionCD", "区分コード", Integer.Parse(General.paTwipsTopixels(1500)), System.Windows.Forms.HorizontalAlignment.Left, "") '区分コード
                    w_column = .Columns.Add("DivisionName", "区分名称", Integer.Parse(General.paTwipsTopixels(1500)), System.Windows.Forms.HorizontalAlignment.Left, "") '区分名称
                    w_column = .Columns.Add("KindCD", "種類コード", Integer.Parse(General.paTwipsTopixels(1500)), System.Windows.Forms.HorizontalAlignment.Left, "") '種類コード
                    w_column = .Columns.Add("KindName", "種類名称", Integer.Parse(General.paTwipsTopixels(1500)), System.Windows.Forms.HorizontalAlignment.Left, "") '種類名称
                    w_column = .Columns.Add("SponsorCD", "主催コード", Integer.Parse(General.paTwipsTopixels(1500)), System.Windows.Forms.HorizontalAlignment.Left, "") '主催コード
                    w_column = .Columns.Add("SponsorName", "主催名称", Integer.Parse(General.paTwipsTopixels(1500)), System.Windows.Forms.HorizontalAlignment.Left, "") '主催名称
                    w_column = .Columns.Add("JoinCD", "参加形態コード", Integer.Parse(General.paTwipsTopixels(1500)), System.Windows.Forms.HorizontalAlignment.Left, "") '参加形態コード
                    w_column = .Columns.Add("JoinName", "参加形態名称", Integer.Parse(General.paTwipsTopixels(1500)), System.Windows.Forms.HorizontalAlignment.Left, "") '参加形態名称
                    w_column = .Columns.Add("CostCD", "費用コード", Integer.Parse(General.paTwipsTopixels(1500)), System.Windows.Forms.HorizontalAlignment.Left, "") '費用コード
                    w_column = .Columns.Add("CostName", "費用名称", Integer.Parse(General.paTwipsTopixels(1500)), System.Windows.Forms.HorizontalAlignment.Left, "") '費用名称
                    w_column = .Columns.Add("State", "状態", Integer.Parse(General.paTwipsTopixels(1500)), System.Windows.Forms.HorizontalAlignment.Left, "") '状態

                    '情報の取得
                    If General.g_objIdoData.mGetStudyInfo() = True Then

                        w_lngCnt = General.g_objIdoData.fSD_StudyCount

                        ReDim m_dblLastUpdTime(w_lngCnt)
                        ReDim m_strSEQ(w_lngCnt)
                        ReDim m_lngNendo(w_lngCnt)
                        ReDim m_strPlanFlg(w_lngCnt)

                        For w_lngLoop = 1 To w_lngCnt

                            General.g_objIdoData.mSD_StudyIdx = w_lngLoop

                            '画面の表示
                            w_List = .Items.Add(M_strSelectID & General.paFormatZero(w_lngLoop, 5), Trim(General.g_objIdoData.fSD_Date), "")

                            If w_List.SubItems.Count > 1 Then
                                w_List.SubItems(1).Text = Trim(General.g_objIdoData.fSD_CourseCD)
                            Else
                                w_List.SubItems.Insert(1, New System.Windows.Forms.ListViewItem.ListViewSubItem(Nothing, Trim(General.g_objIdoData.fSD_CourseCD)))
                            End If 'コースコード

                            If w_List.SubItems.Count > 2 Then
                                w_List.SubItems(2).Text = Trim(General.g_objIdoData.fSD_CourseName)
                            Else
                                w_List.SubItems.Insert(2, New System.Windows.Forms.ListViewItem.ListViewSubItem(Nothing, Trim(General.g_objIdoData.fSD_CourseName)))
                            End If 'コース名称

                            If w_List.SubItems.Count > 3 Then
                                w_List.SubItems(3).Text = Trim(General.g_objIdoData.fSD_KbnCD)
                            Else
                                w_List.SubItems.Insert(3, New System.Windows.Forms.ListViewItem.ListViewSubItem(Nothing, Trim(General.g_objIdoData.fSD_KbnCD)))
                            End If '区分コード

                            If w_List.SubItems.Count > 4 Then
                                w_List.SubItems(4).Text = Trim(General.g_objIdoData.fSD_KbnName)
                            Else
                                w_List.SubItems.Insert(4, New System.Windows.Forms.ListViewItem.ListViewSubItem(Nothing, Trim(General.g_objIdoData.fSD_KbnName)))
                            End If '区分名称

                            If w_List.SubItems.Count > 5 Then
                                w_List.SubItems(5).Text = Trim(General.g_objIdoData.fSD_SyuruiCD)
                            Else
                                w_List.SubItems.Insert(5, New System.Windows.Forms.ListViewItem.ListViewSubItem(Nothing, Trim(General.g_objIdoData.fSD_SyuruiCD)))
                            End If '種類コード

                            If w_List.SubItems.Count > 6 Then
                                w_List.SubItems(6).Text = Trim(General.g_objIdoData.fSD_SyuruiName)
                            Else
                                w_List.SubItems.Insert(6, New System.Windows.Forms.ListViewItem.ListViewSubItem(Nothing, Trim(General.g_objIdoData.fSD_SyuruiName)))
                            End If '種類名称

                            If w_List.SubItems.Count > 7 Then
                                w_List.SubItems(7).Text = Trim(General.g_objIdoData.fSD_SyusaiCD)
                            Else
                                w_List.SubItems.Insert(7, New System.Windows.Forms.ListViewItem.ListViewSubItem(Nothing, Trim(General.g_objIdoData.fSD_SyusaiCD)))
                            End If '主催コード

                            If w_List.SubItems.Count > 8 Then
                                w_List.SubItems(8).Text = Trim(General.g_objIdoData.fSD_SyusaiName)
                            Else
                                w_List.SubItems.Insert(8, New System.Windows.Forms.ListViewItem.ListViewSubItem(Nothing, Trim(General.g_objIdoData.fSD_SyusaiName)))
                            End If '主催名称

                            If w_List.SubItems.Count > 9 Then
                                w_List.SubItems(9).Text = Trim(General.g_objIdoData.fSD_SankaCD)
                            Else
                                w_List.SubItems.Insert(9, New System.Windows.Forms.ListViewItem.ListViewSubItem(Nothing, Trim(General.g_objIdoData.fSD_SankaCD)))
                            End If '参加形態コード

                            If w_List.SubItems.Count > 10 Then
                                w_List.SubItems(10).Text = Trim(General.g_objIdoData.fSD_SankaName)
                            Else
                                w_List.SubItems.Insert(10, New System.Windows.Forms.ListViewItem.ListViewSubItem(Nothing, Trim(General.g_objIdoData.fSD_SankaName)))
                            End If '参加形態名称

                            If w_List.SubItems.Count > 11 Then
                                w_List.SubItems(11).Text = Trim(General.g_objIdoData.fSD_CostCD)
                            Else
                                w_List.SubItems.Insert(11, New System.Windows.Forms.ListViewItem.ListViewSubItem(Nothing, Trim(General.g_objIdoData.fSD_CostCD)))
                            End If '費用コード

                            If w_List.SubItems.Count > 12 Then
                                w_List.SubItems(12).Text = Trim(General.g_objIdoData.fSD_CostName)
                            Else
                                w_List.SubItems.Insert(12, New System.Windows.Forms.ListViewItem.ListViewSubItem(Nothing, Trim(General.g_objIdoData.fSD_CostName)))
                            End If '費用名称

                            '0:申込,1:受講登録,2:受講完了
                            If (W_strMousikomiCD).Equals(Trim(General.g_objIdoData.fSD_ApplyStatus)) Then
                                If w_List.SubItems.Count > 13 Then
                                    w_List.SubItems(13).Text = W_strMousikomiDISP
                                Else
                                    w_List.SubItems.Insert(13, New System.Windows.Forms.ListViewItem.ListViewSubItem(Nothing, W_strMousikomiDISP))
                                End If '申込
                            ElseIf (W_strTourokuCD).Equals(Trim(General.g_objIdoData.fSD_ApplyStatus)) Then
                                If w_List.SubItems.Count > 13 Then
                                    w_List.SubItems(13).Text = W_strTourokuDISP
                                Else
                                    w_List.SubItems.Insert(13, New System.Windows.Forms.ListViewItem.ListViewSubItem(Nothing, W_strTourokuDISP))
                                End If '受講登録
                            ElseIf (W_strKanryouCD).Equals(Trim(General.g_objIdoData.fSD_ApplyStatus)) Then
                                If w_List.SubItems.Count > 13 Then
                                    w_List.SubItems(13).Text = W_strKanryouDISP
                                Else
                                    w_List.SubItems.Insert(13, New System.Windows.Forms.ListViewItem.ListViewSubItem(Nothing, W_strKanryouDISP))
                                End If '受講完了
                            End If

                            m_strSEQ(w_lngLoop) = Trim(General.g_objIdoData.fSD_SEQ) 'SEQ
                            m_lngNendo(w_lngLoop) = Integer.Parse(Trim(General.g_objIdoData.fSD_YYYY)) '年度
                            m_strPlanFlg(w_lngLoop) = Trim(General.g_objIdoData.fSD_PlaningFLG) '
                            w_List.Tag = Convert.ToString(w_lngLoop)
                        Next w_lngLoop

                    End If

                    '選択されたノードのキーが自己評価情報だった場合(セキュリティコードが"NSC2000HA18"だった場合)
                ElseIf (G_strMyLadderRes).Equals(m_strSelectResCD) Then

                    w_blnADD = True
                    w_blnUPD = True

                    '情報の取得
                    'ラダーのみ、別ファンクション化
                    '　⇒　いずれ部品化する(今はほぼ、沖縄より流用)
                    Call fncGetSetMyLader()


                    '選択されたノードのキーが他評価情報だった場合(セキュリティコードが"NSC2000HA19"だった場合)
                ElseIf (G_strOtherLadderRes).Equals(m_strSelectResCD) Then

                    w_blnADD = True
                    w_blnUPD = True

                    '情報の取得
                    'ラダーのみ、別ファンクション化
                    '　⇒　いずれ部品化する(今はほぼ、沖縄より流用)
                    Call fncGetSetOtherLader()


                    cboKinmuBusyo.Visible = True
                    cboKinmuBusyo.Enabled = True
                    lblKinmuBusyo.Visible = True
                    cboKikan.Visible = True
                    cboKikan.Enabled = True
                    lblKikan.Visible = True
                Else

                    w_blnADD = False
                    w_blnUPD = False
                    w_blnDEL = False

                    'ｱｲｺﾝの整列方法
                    .Alignment = System.Windows.Forms.ListViewAlignment.Top
                    'ﾘｽﾄﾋﾞｭｰﾀｲﾌﾟ設定
                    .View = System.Windows.Forms.View.Details
                    .LabelEdit = False
                    'ｶﾗﾑﾍｯﾀﾞｰの追加
                    w_column = .Columns.Add("Non", "", Integer.Parse(General.paTwipsTopixels(3000)), System.Windows.Forms.HorizontalAlignment.Left, "")

                End If

            End With

            'リストビューの幅を取得
            If String.IsNullOrEmpty(m_strNodeKey) = False Then
                Call General.paSetFieldWidth(lvwDeptInfo, General.G_STRMAINKEY1 & "\" & G_PROJECTID, m_strSelChildMenu, False)
                Call General.paSetFieldWidth(lvwMain, General.G_STRMAINKEY1 & "\" & G_PROJECTID, m_strSelChildMenu, False)
            End If

            'リストにデータが存在しない場合は変更・削除ボタン使用不可
            If lvwMain.Items.Count = 0 Then
                w_blnUPD = False
                w_blnDEL = False
            Else
                If (G_strSaiyoRes).Equals(m_strSelectResCD) Then
                    If w_lngCnt <= 1 Then
                        w_blnDEL = False
                    Else
                        w_blnDEL = True
                    End If
                Else
                    w_blnDEL = True
                End If
            End If

            'セキュリティ部品呼び出し
            Dim tbrMenu As Object
            If General.g_objSecurity.mCheckAuthRangeKbn2(w_strUpdRangeKbn, m_strAuthRangeKbn) = True Then
                tbrMenu.Items.Item(G_ToolBar_DataAdd).Visible = w_blnADD
                tbrMenu.Items.Item(G_ToolBar_DataAdd).Enabled = w_blnADD

                tbrMenu.Items.Item(G_ToolBar_DataUpd).Visible = w_blnUPD
                tbrMenu.Items.Item(G_ToolBar_DataUpd).Enabled = w_blnUPD

                tbrMenu.Items.Item(G_ToolBar_DataDel).Visible = w_blnDEL
                tbrMenu.Items.Item(G_ToolBar_DataDel).Enabled = w_blnDEL
            Else
                tbrMenu.Items.Item(G_ToolBar_DataAdd).Visible = False
                tbrMenu.Items.Item(G_ToolBar_DataAdd).Enabled = False

                tbrMenu.Items.Item(G_ToolBar_DataUpd).Visible = False
                tbrMenu.Items.Item(G_ToolBar_DataUpd).Enabled = False

                tbrMenu.Items.Item(G_ToolBar_DataDel).Visible = False
                tbrMenu.Items.Item(G_ToolBar_DataDel).Enabled = False
            End If

            If (G_strStudyRes).Equals(m_strSelectResCD) Then
                tbrMenu.Items.Item(G_ToolBar_Study).Enabled = True
                tbrMenu.Items.Item(G_ToolBar_Study).Visible = True

                tbrMenu.Items.Item(G_ToolBar_DataUpd).Visible = False
                tbrMenu.Items.Item(G_ToolBar_DataUpd).Enabled = False

            Else
                tbrMenu.Items.Item(G_ToolBar_Study).Enabled = False
                tbrMenu.Items.Item(G_ToolBar_Study).Visible = False
            End If

            If (G_strOtherLadderRes).Equals(m_strSelectResCD) Then
                tbrMenu.Items.Item(G_ToolBar_DataAdd).Enabled = False
                tbrMenu.Items.Item(G_ToolBar_DataAdd).Visible = False

                tbrMenu.Items.Item(G_ToolBar_DataDel).Visible = False
                tbrMenu.Items.Item(G_ToolBar_DataDel).Enabled = False

            End If

            '研修申込
            If tbrMenu.Items.Item(G_ToolBar_Study).Visible = True Then
                'リソース分
                w_lngCnt = UBound(m_MenuButton)
                For w_lngLoop = 1 To w_lngCnt
                    'リソースが同じ
                    If (W_strSTUDY).Equals(m_MenuButton(w_lngLoop).ResourceCD) Then
                        '権限ありorなし
                        If (W_strALL).Equals(m_MenuButton(w_lngLoop).strRefAuthRangeKbn) Then
                            w_blnFLG = True
                        Else
                            w_blnFLG = False
                        End If
                        Exit For
                    End If
                Next w_lngLoop
                '権限ありorなし
                If w_blnFLG = True Then
                    tbrMenu.Items.Item(G_ToolBar_Study).Enabled = True
                    tbrMenu.Items.Item(G_ToolBar_Study).Visible = True
                Else
                    tbrMenu.Items.Item(G_ToolBar_Study).Enabled = False
                    tbrMenu.Items.Item(G_ToolBar_Study).Visible = False
                End If
            End If

            '参照権限しかない場合は、追加・変更・削除ボタンを使用不可に
            m_blnDataUpdCheckFlg = General.g_objSecurity.mCheckAuthRangeKbn(w_strUpdRangeKbn, Trim(m_udtStaffData(m_lngSelectListIndex).strStaffMngID), General.g_strSelKinmuDeptCD)
            If m_blnDataUpdCheckFlg = False Then

                tbrMenu.Items.Item(G_ToolBar_DataAdd).Enabled = False
                tbrMenu.Items.Item(G_ToolBar_DataAdd).Visible = False
                tbrMenu.Items.Item(G_ToolBar_DataUpd).Enabled = False
                tbrMenu.Items.Item(G_ToolBar_DataUpd).Visible = False
                tbrMenu.Items.Item(G_ToolBar_DataDel).Enabled = False
                tbrMenu.Items.Item(G_ToolBar_DataDel).Visible = False

            End If

            '選択されたノード
            m_Node = m_strNodeKey

            Call lvwMain_Click(lvwMain, New System.EventArgs())

            General.g_ErrorProc = w_PreErrorProc '待避ﾌﾟﾛｼｰｼﾞｬ名を元に戻す

        Catch ex As Exception
            Throw
        End Try
    End Sub

    '自己評価設定
    Public Function fncGetSetMyLader() As Boolean
        Const W_SUBNAME As String = "frmNSC0000HA fncGetSetMyLader"

        Try
            Dim w_column As System.Windows.Forms.ColumnHeader

            fncGetSetMyLader = False

            With lvwMain

                'ｱｲｺﾝの整列方法
                .Alignment = System.Windows.Forms.ListViewAlignment.Top
                'ﾘｽﾄﾋﾞｭｰﾀｲﾌﾟ設定
                .View = System.Windows.Forms.View.Details
                .LabelEdit = False
                'ｶﾗﾑﾍｯﾀﾞｰの追加
                w_column = .Columns.Add("Kikan", "評価期間", Integer.Parse(General.paTwipsTopixels(1500)), System.Windows.Forms.HorizontalAlignment.Left, "") '評価期間
                w_column = .Columns.Add("Date", "評価日", Integer.Parse(General.paTwipsTopixels(1500)), System.Windows.Forms.HorizontalAlignment.Left, "") '評価日
                w_column = .Columns.Add("Level", "評価レベル", Integer.Parse(General.paTwipsTopixels(1500)), System.Windows.Forms.HorizontalAlignment.Left, "") '評価レベル
                w_column = .Columns.Add("Hyouka1", "第１評価者", Integer.Parse(General.paTwipsTopixels(1500)), System.Windows.Forms.HorizontalAlignment.Left, "") '第１評価者
                w_column = .Columns.Add("Hyouka2", "第２評価者", Integer.Parse(General.paTwipsTopixels(1500)), System.Windows.Forms.HorizontalAlignment.Left, "") '第２評価者
                w_column = .Columns.Add("Hyouka3", "第３評価者", Integer.Parse(General.paTwipsTopixels(1500)), System.Windows.Forms.HorizontalAlignment.Left, "") '第３評価者
                w_column = .Columns.Add("Decision", "確定区分", Integer.Parse(General.paTwipsTopixels(1500)), System.Windows.Forms.HorizontalAlignment.Left, "") '確定区分


                '職員氏名取得
                Call GetStaffName()

                '看護単位M取得
                Call GetKangoM()

                '期間取得
                Call GetKikan()

                '自己評価ﾃﾞｰﾀ取得
                Call GetJikoHyouka()

                '自己評価(ﾃﾞﾌｫﾙﾄ)の表示
                Call DispItemsMyLadder()

            End With

            fncGetSetMyLader = True

        Catch ex As Exception
            Call General.paTrpMsg(Convert.ToString(Err.Number), W_SUBNAME)
        End Try
    End Function

    Private Sub GetStaffName()
        Const W_SUBNAME As String = "Nssl001 GetStaffName"

        Try
            Dim w_Int As Integer
            Dim w_Sql As String
            Dim w_Count As Integer

            'DAOｵﾌﾞｼﾞｪｸﾄ
            Dim w_Rs As ADODB.Recordset

            '評価者氏名///////////////////////////////////////////////////////////////////////
            w_Sql = ""
            w_Sql = "SELECT STAFFMNGID, STAFFNAME"
            w_Sql = w_Sql & " FROM NS_STAFFBASISINFO_F "
            w_Sql = w_Sql & "WHERE HOSPITALCD = '" & General.g_strHospitalCD & "' "

            'ﾚｺｰﾄﾞｾｯﾄｵﾌﾞｼﾞｪｸﾄ生成
            w_Rs = General.paDBRecordSetOpen(w_Sql)
            '配列の再確保
            ReDim Preserve m_StaffData(0)

            '資格情報Ｆにﾃﾞｰﾀが存在するか ?
            If w_Rs.RecordCount <= 0 Then
                'ﾃﾞｰﾀが存在しない場合

            Else
                'ﾏｽﾀにﾃﾞｰﾀがある場合

                '*** With ｽﾃｰﾄﾒﾝﾄ開始 ***
                With w_Rs

                    '--- ﾚｺｰﾄﾞ件数取得 ---
                    .MoveLast()
                    w_Count = .RecordCount
                    .MoveFirst()

                    ReDim m_StaffData(w_Count)

                    '取得ﾃﾞｰﾀ件数 繰り返し
                    For w_Int = 1 To w_Count
                        m_StaffData(w_Int).ID = General.paGetDbFieldVal(.Fields("STAFFMNGID"), "")
                        m_StaffData(w_Int).Name_Renamed = General.paGetDbFieldVal(.Fields("STAFFNAME"), "")
                        .MoveNext()
                    Next w_Int

                End With
            End If
            'ｵﾌﾞｼﾞｪｸﾄの解放
            w_Rs.Close()

        Catch ex As Exception
            Call General.paTrpMsg(Convert.ToString(Err.Number), W_SUBNAME)
        End Try
    End Sub

    '自己評価設定
    Public Function fncGetSetOtherLader() As Boolean
        Dim cboKikan As Object
        Dim cboKinmuBusyo As Object

        Const W_SUBNAME As String = "frmNSC0000HA fncGetSetOtherLader"

        Try
            Dim w_column As System.Windows.Forms.ColumnHeader

            Dim w_Cnt As Integer

            fncGetSetOtherLader = False

            With lvwMain

                'ｱｲｺﾝの整列方法
                .Alignment = System.Windows.Forms.ListViewAlignment.Top
                'ﾘｽﾄﾋﾞｭｰﾀｲﾌﾟ設定
                .View = System.Windows.Forms.View.Details
                .LabelEdit = False
                'ｶﾗﾑﾍｯﾀﾞｰの追加
                w_column = .Columns.Add("Kikan", "評価期間", Integer.Parse(General.paTwipsTopixels(1500)), System.Windows.Forms.HorizontalAlignment.Left, "") '評価期間
                w_column = .Columns.Add("Name", "氏名", Integer.Parse(General.paTwipsTopixels(1500)), System.Windows.Forms.HorizontalAlignment.Left, "") '氏名
                w_column = .Columns.Add("Level", "評価レベル", Integer.Parse(General.paTwipsTopixels(1500)), System.Windows.Forms.HorizontalAlignment.Left, "") '評価レベル
                w_column = .Columns.Add("Date", "評価日", Integer.Parse(General.paTwipsTopixels(1500)), System.Windows.Forms.HorizontalAlignment.Left, "") '評価日
                w_column = .Columns.Add("Progress", "進捗", Integer.Parse(General.paTwipsTopixels(1500)), System.Windows.Forms.HorizontalAlignment.Left, "") '進捗


                '職員氏名取得
                Call GetStaffName()

                '看護単位M取得
                Call GetKangoM()

                '期間取得
                Call GetKikan()

                '自己評価ﾃﾞｰﾀ取得
                Call GetJikoHyouka()

                '他評価ﾃﾞｰﾀ取得
                Call GetTaHyouka()

                '他評価(ﾃﾞﾌｫﾙﾄ)の表示
                Call DispItemsOtherLadder()

                'このインスタンスは何に対しセットしている？
                '部署コンボボックス設定----------------------------------
                cboKinmuBusyo.Clear()
                For w_Cnt = 0 To UBound(m_KangoM)
                    cboKinmuBusyo.AddItem(m_KangoM(w_Cnt).BusyoNM)
                Next w_Cnt
                cboKinmuBusyo.ListIndex = 0

                '期間コンボボックス設定
                cboKikan.Clear()
                For w_Cnt = 0 To UBound(m_Kikan)
                    cboKikan.AddItem(m_Kikan(w_Cnt).Kikan)
                Next w_Cnt
                cboKikan.ListIndex = 0

            End With

            fncGetSetOtherLader = True

        Catch ex As Exception
            Call General.paTrpMsg(Convert.ToString(Err.Number), W_SUBNAME)
        End Try
    End Function

    Private Sub lvwMain_Click(ByVal eventSender As System.Object, ByVal eventArgs As System.EventArgs) Handles lvwMain.Click

        Dim tbrMenu As Object
        Try
            Dim w_PreErrorProc As String
            w_PreErrorProc = General.g_ErrorProc 'ﾌﾟﾛｼｰｼﾞｬ名の一時待避
            General.g_ErrorProc = "frmNSC0000HA lvwMain_Click"

            Dim w_lngLoop As Integer
            Dim w_lngLoopSub As Integer
            Dim w_lngMaxDate As Integer
            Dim w_lngSelectDate As Integer

            w_lngMaxDate = 0
            w_lngSelectDate = 0

            If g_MenuM(g_lngGroupIdx).ListBarMenu(g_lngListIdx).strResCD = M_STAFFIDO_RESCD Then

                '共通の情報は最新日付のデータしか削除できない
                If (G_strSaiyoRes).Equals(m_strSelectResCD) OrElse (G_strKinmuDeptRes).Equals(m_strSelectResCD) OrElse (G_strWardDeptRes).Equals(m_strSelectResCD) OrElse (G_strPostRes).Equals(m_strSelectResCD) OrElse (G_strJobRes).Equals(m_strSelectResCD) Then
                    'リスト内の日付の最大を取得する
                    For w_lngLoop = 1 To lvwDeptInfo.Items.Count

                        For w_lngLoopSub = 1 To lvwDeptInfo.Items.Item(w_lngLoop).SubItems.Count
                            If IsDate(lvwDeptInfo.Items.Item(w_lngLoop).SubItems.Item(w_lngLoopSub).Text) = True Then
                                w_lngSelectDate = General.paGetDateIntegerFromDate(lvwDeptInfo.Items.Item(w_lngLoop).SubItems.Item(w_lngLoopSub).Text)

                                If w_lngMaxDate < w_lngSelectDate Then
                                    w_lngMaxDate = w_lngSelectDate
                                End If
                                Exit For
                            End If
                        Next w_lngLoopSub

                    Next w_lngLoop

                    For w_lngLoop = 1 To lvwDeptInfo.Items.Count

                        If lvwDeptInfo.Items.Item(w_lngLoop).Selected = True Then
                            For w_lngLoopSub = 1 To lvwDeptInfo.Items.Item(w_lngLoop).SubItems.Count
                                If IsDate(lvwDeptInfo.Items.Item(w_lngLoop).SubItems.Item(w_lngLoopSub).Text) = True Then
                                    '最大日付以外が選択されている場合
                                    '削除ボタンを使用不可にする
                                    w_lngSelectDate = General.paGetDateIntegerFromDate(lvwDeptInfo.Items.Item(w_lngLoop).SubItems.Item(w_lngLoopSub).Text)
                                    If w_lngMaxDate = w_lngSelectDate Then
                                        tbrMenu.Items.Item(G_ToolBar_DataDel).Enabled = True
                                    Else
                                        tbrMenu.Items.Item(G_ToolBar_DataDel).Enabled = False
                                    End If
                                End If
                            Next w_lngLoopSub
                        End If
                    Next w_lngLoop

                End If

            End If

            If (M_DEPT_RESCD).Equals(g_MenuM(g_lngGroupIdx).ListBarMenu(g_lngListIdx).strResCD) OrElse (M_OVERKINMU_RESCD).Equals(g_MenuM(g_lngGroupIdx).ListBarMenu(g_lngListIdx).strResCD) Then
                If lvwMain.Items.Count > 0 Then
                    If IsNothing(lvwMain.FocusedItem) Then
                        Exit Sub
                    End If
                    If UBound(m_udtKinmuData) > lvwMain.FocusedItem.Index Then
                        If m_udtKinmuData(lvwMain.FocusedItem.Index + 1).lngDate <> 0 Then
                            m_CalDate = General.paGetDateFromDateInteger(m_udtKinmuData(lvwMain.FocusedItem.Index + 1).lngDate)
                        Else
                            Exit Sub
                        End If
                        m_CalDate = General.paGetDateFromDateInteger(m_udtKinmuData(lvwMain.FocusedItem.Index + 1).lngDate)
                        m_DayOverSelectDate = m_CalDate
                        m_DayOverSelectFrom = New Date(m_CalDate.Year, m_CalDate.Month, 1)
                        m_DayOverSelectTo = DateAdd(Microsoft.VisualBasic.DateInterval.Day, -1, DateAdd(Microsoft.VisualBasic.DateInterval.Month, 1, m_DayOverSelectFrom))
                    End If
                End If
            End If

            General.g_ErrorProc = w_PreErrorProc '待避ﾌﾟﾛｼｰｼﾞｬ名を元に戻す

        Catch ex As Exception
            Throw
        End Try
    End Sub

    Private Sub GetKikan()
        Const W_SUBNAME As String = "Nssl001 GetKikan"

        Try
            Dim w_Int As Integer
            Dim w_Sql As String
            Dim w_Count As Integer

            'DAOｵﾌﾞｼﾞｪｸﾄ
            Dim w_Rs As ADODB.Recordset

            'NS評価シートMより期間を取得する
            w_Sql = ""
            w_Sql = "SELECT DISTINCT FROMDATE, TODATE"
            w_Sql = w_Sql & " FROM NS_VALUATIONSHEET_M "
            w_Sql = w_Sql & "WHERE HOSPITALCD = '" & General.g_strHospitalCD & "' "

            'ﾚｺｰﾄﾞｾｯﾄｵﾌﾞｼﾞｪｸﾄ生成
            w_Rs = General.paDBRecordSetOpen(w_Sql)
            '配列の再確保
            ReDim Preserve m_Kikan(0)

            'ﾃﾞｰﾀが存在するか ?
            If w_Rs.RecordCount <= 0 Then
                'ﾃﾞｰﾀが存在しない場合
                ReDim m_Kikan(w_Count)

                m_Kikan(0).Kikan = "すべて"
                m_Kikan(0).Fromdate = 0
                m_Kikan(0).Todate = 99999999

            Else
                'ﾏｽﾀにﾃﾞｰﾀがある場合

                '*** With ｽﾃｰﾄﾒﾝﾄ開始 ***
                With w_Rs

                    '--- ﾚｺｰﾄﾞ件数取得 ---
                    .MoveLast()
                    w_Count = .RecordCount
                    .MoveFirst()

                    ReDim m_Kikan(w_Count)

                    m_Kikan(0).Kikan = "すべて"
                    m_Kikan(0).Fromdate = 0
                    m_Kikan(0).Todate = 99999999

                    '取得ﾃﾞｰﾀ件数 繰り返し
                    For w_Int = 1 To w_Count
                        m_Kikan(w_Int).Fromdate = General.paGetDbFieldVal(.Fields("FROMDATE"), 0)
                        m_Kikan(w_Int).Todate = General.paGetDbFieldVal(.Fields("TODATE"), 0)
                        m_Kikan(w_Int).Kikan = General.paGetDateStringFromInteger(m_Kikan(w_Int).Fromdate) & "〜" & General.paGetDateStringFromInteger(m_Kikan(w_Int).Todate)

                        .MoveNext()
                    Next w_Int

                End With
            End If
            'ｵﾌﾞｼﾞｪｸﾄの解放
            w_Rs.Close()

        Catch ex As Exception
            Call General.paTrpMsg(Convert.ToString(Err.Number), W_SUBNAME)
        End Try
    End Sub

    Private Sub GetJikoHyouka()
        Const W_SUBNAME As String = "Nssl001 GetJikoHyouka"

        Try
            Dim w_Int As Integer
            Dim w_Sql As String
            Dim w_Count As Integer
            Dim w_Cnt1 As Integer
            Dim w_Cnt2 As Integer
            Dim w_TargetTable As String
            Dim w_StaffLoop As Integer

            'DAOｵﾌﾞｼﾞｪｸﾄ
            Dim w_Rs As ADODB.Recordset

            w_TargetTable = "NS_VALUATIONHIS_F"

            'Select文 編集
            w_Sql = "SELECT FROMDATE, TODATE, DATEF, LEVELCD, LV1STAFFMNGID, LV2STAFFMNGID,LV3STAFFMNGID, DECISIONKBN, REGISTFIRSTTIMEDATE, "
            w_Sql = w_Sql & "LASTUPDTIMEDATE, REGISTRANTID FROM " & w_TargetTable & " "
            w_Sql = w_Sql & "WHERE HOSPITALCD = '" & General.g_strHospitalCD & "' "
            w_Sql = w_Sql & "AND STAFFMNGID = '" & m_strSelectStaffMngID & "' "

            'ﾚｺｰﾄﾞｾｯﾄｵﾌﾞｼﾞｪｸﾄ生成
            w_Rs = General.paDBRecordSetOpen(w_Sql)

            '配列の再確保
            ReDim Preserve m_JikoHyouka(0)
            ReDim Preserve m_lngFromDate(0)
            ReDim Preserve m_lngToDate(0)
            ReDim Preserve m_lngDate(0)

            '資格情報Ｆにﾃﾞｰﾀが存在するか ?
            If w_Rs.RecordCount <= 0 Then
                'ﾃﾞｰﾀが存在しない場合

            Else
                'ﾏｽﾀにﾃﾞｰﾀがある場合

                '*** With ｽﾃｰﾄﾒﾝﾄ開始 ***
                With w_Rs

                    '--- ﾚｺｰﾄﾞ件数取得 ---
                    .MoveLast()
                    w_Count = .RecordCount
                    .MoveFirst()

                    '取得ﾃﾞｰﾀ件数 繰り返し
                    For w_Int = 1 To w_Count
                        '配列再確保
                        ReDim Preserve m_JikoHyouka(UBound(m_JikoHyouka) + 1)
                        ReDim Preserve m_lngFromDate(UBound(m_lngFromDate) + 1)
                        ReDim Preserve m_lngToDate(UBound(m_lngToDate) + 1)
                        ReDim Preserve m_lngDate(UBound(m_lngDate) + 1)
                        ReDim Preserve m_dblLastUpdTime(UBound(m_dblLastUpdTime) + 1)
                        '配列に格納(固定値)
                        m_JikoHyouka(w_Int).ByoinCD = General.g_strHospitalCD
                        m_JikoHyouka(w_Int).SyokuinNo = m_strSelectStaffMngID
                        m_JikoHyouka(w_Int).NewFlg = M_FlgOld '既存
                        m_JikoHyouka(w_Int).ProcFlg = M_FlgNon '無処理
                        '配列に格納(取得値)
                        m_JikoHyouka(w_Int).Fromdate = Integer.Parse(General.paGetDbFieldVal(.Fields("FROMDATE"), 0))
                        m_JikoHyouka(w_Int).Todate = Integer.Parse(General.paGetDbFieldVal(.Fields("TODATE"), 0))
                        '--期間
                        m_JikoHyouka(w_Int).HyoukaKikan = General.paGetDateStringFromInteger(m_JikoHyouka(w_Int).Fromdate) & "〜" & General.paGetDateStringFromInteger(m_JikoHyouka(w_Int).Todate)

                        m_JikoHyouka(w_Int).JikoHyoukaDate = Integer.Parse(General.paGetDbFieldVal(.Fields("DATEF"), 0))
                        m_JikoHyouka(w_Int).HyoukaLvCD = General.paGetDbFieldVal(.Fields("LEVELCD"), "")
                        m_JikoHyouka(w_Int).Lv1StaffMngID = General.paGetDbFieldVal(.Fields("LV1STAFFMNGID"), "")
                        m_JikoHyouka(w_Int).Lv2StaffMngID = General.paGetDbFieldVal(.Fields("LV2STAFFMNGID"), "")
                        m_JikoHyouka(w_Int).Lv3StaffMngID = General.paGetDbFieldVal(.Fields("LV3STAFFMNGID"), "")
                        '職員氏名の取得
                        For w_StaffLoop = 1 To UBound(m_StaffData)
                            If (m_JikoHyouka(w_Int).Lv1StaffMngID).Equals(m_StaffData(w_StaffLoop).ID) Then
                                m_JikoHyouka(w_Int).Lv1StaffName = m_StaffData(w_StaffLoop).Name_Renamed
                            End If
                            If (m_JikoHyouka(w_Int).Lv2StaffMngID).Equals(m_StaffData(w_StaffLoop).ID) Then
                                m_JikoHyouka(w_Int).Lv2StaffName = m_StaffData(w_StaffLoop).Name_Renamed
                            End If
                            If (m_JikoHyouka(w_Int).Lv3StaffMngID).Equals(m_StaffData(w_StaffLoop).ID) Then
                                m_JikoHyouka(w_Int).Lv3StaffName = m_StaffData(w_StaffLoop).Name_Renamed
                            End If
                        Next w_StaffLoop

                        m_JikoHyouka(w_Int).KakuteiKbn = General.paGetDbFieldVal(.Fields("DECISIONKBN"), "")
                        m_JikoHyouka(w_Int).Fdate = Integer.Parse(General.paGetDbFieldVal(.Fields("REGISTFIRSTTIMEDATE"), 0))
                        m_JikoHyouka(w_Int).Ldate = Integer.Parse(General.paGetDbFieldVal(.Fields("LASTUPDTIMEDATE"), 0))
                        m_JikoHyouka(w_Int).UserID = General.paGetDbFieldVal(.Fields("REGISTRANTID"), "")

                        m_lngFromDate(w_Int) = m_JikoHyouka(w_Int).Fromdate
                        m_lngToDate(w_Int) = m_JikoHyouka(w_Int).Todate
                        m_lngDate(w_Int) = m_JikoHyouka(w_Int).JikoHyoukaDate

                        '次ﾚｺｰﾄﾞに
                        .MoveNext()
                    Next w_Int

                    '*** Withｽﾃｰﾄﾒﾝﾄ終了 ***
                End With
            End If

            'ｵﾌﾞｼﾞｪｸﾄの解放
            w_Rs.Close()

            '評価日取得
            w_Sql = "SELECT DISTINCT FROMDATE, TODATE, DATEF, LEVELCD, VALUATIONKBN, VALUATIONDATE "
            w_Sql = w_Sql & " FROM NS_VALUATIONDETAIL_F "
            w_Sql = w_Sql & "WHERE HOSPITALCD = '" & General.g_strHospitalCD & "' "
            w_Sql = w_Sql & "AND STAFFMNGID = '" & m_strSelectStaffMngID & "' "

            'ﾚｺｰﾄﾞｾｯﾄｵﾌﾞｼﾞｪｸﾄ生成
            w_Rs = General.paDBRecordSetOpen(w_Sql)
            '資格情報Ｆにﾃﾞｰﾀが存在するか ?
            If w_Rs.RecordCount <= 0 Then
                'ﾃﾞｰﾀが存在しない場合

            Else
                'ﾏｽﾀにﾃﾞｰﾀがある場合

                '*** With ｽﾃｰﾄﾒﾝﾄ開始 ***
                With w_Rs

                    '--- ﾚｺｰﾄﾞ件数取得 ---
                    .MoveLast()
                    w_Count = .RecordCount
                    .MoveFirst()

                    '取得ﾃﾞｰﾀ件数 繰り返し
                    For w_Int = 1 To w_Count

                        For w_Cnt1 = 1 To UBound(m_JikoHyouka)
                            If m_JikoHyouka(w_Cnt1).Fromdate = Integer.Parse(General.paGetDbFieldVal(.Fields("FROMDATE"), 0)) Then
                                If m_JikoHyouka(w_Cnt1).Todate = Integer.Parse(General.paGetDbFieldVal(.Fields("FROMDATE"), 0)) Then
                                    If m_JikoHyouka(w_Cnt1).JikoHyoukaDate = Integer.Parse(General.paGetDbFieldVal(.Fields("DATEF"), 0)) Then
                                        If m_JikoHyouka(w_Cnt1).HyoukaLvCD = General.paGetDbFieldVal(.Fields("LEVELCD"), "") Then
                                            Select Case General.paGetDbFieldVal(.Fields("VALUATIONKBN"), "")
                                                Case "0"
                                                    m_JikoHyouka(w_Cnt1).PointAddDate = Integer.Parse(General.paGetDbFieldVal(.Fields("VALUATIONDATE"), 0))
                                                Case "1"
                                                    m_JikoHyouka(w_Cnt1).Lv1StaffDate = Integer.Parse(General.paGetDbFieldVal(.Fields("VALUATIONDATE"), 0))
                                                Case "2"
                                                    m_JikoHyouka(w_Cnt1).Lv2StaffDate = Integer.Parse(General.paGetDbFieldVal(.Fields("VALUATIONDATE"), 0))
                                                Case "3"
                                                    m_JikoHyouka(w_Cnt1).Lv3StaffDate = Integer.Parse(General.paGetDbFieldVal(.Fields("VALUATIONDATE"), 0))
                                            End Select

                                            Exit For
                                        End If
                                    End If
                                End If
                            End If
                        Next w_Cnt1

                        '次ﾚｺｰﾄﾞに
                        .MoveNext()
                    Next w_Int

                    '*** Withｽﾃｰﾄﾒﾝﾄ終了 ***
                End With
            End If

            'ｵﾌﾞｼﾞｪｸﾄの解放
            w_Rs.Close()

            '汎用Ｍよりレベル名称取得
            'Select文 編集
            w_Sql = "SELECT NAME, MASTERCD FROM NS_HANYOU_M "
            w_Sql = w_Sql & "WHERE HOSPITALCD = '" & General.g_strHospitalCD & "' "
            w_Sql = w_Sql & "AND MASTERID = '" & "E001" & "' "

            'ﾚｺｰﾄﾞｾｯﾄｵﾌﾞｼﾞｪｸﾄ生成
            w_Rs = General.paDBRecordSetOpen(w_Sql)

            '配列の再確保
            ReDim Preserve m_Level(0)

            '汎用Ｍにﾃﾞｰﾀが存在するか ?
            If w_Rs.RecordCount <= 0 Then
                'ﾃﾞｰﾀが存在しない場合

            Else
                'ﾏｽﾀにﾃﾞｰﾀがある場合

                '*** With ｽﾃｰﾄﾒﾝﾄ開始 ***
                With w_Rs

                    '--- ﾚｺｰﾄﾞ件数取得 ---
                    .MoveLast()
                    w_Count = .RecordCount
                    .MoveFirst()

                    '取得ﾃﾞｰﾀ件数 繰り返し
                    For w_Int = 1 To w_Count
                        '配列再確保
                        ReDim Preserve m_Level(UBound(m_Level) + 1)
                        '配列格納
                        m_Level(w_Int).LvCD = General.paGetDbFieldVal(.Fields("MASTERCD"), "")
                        m_Level(w_Int).Name_Renamed = General.paGetDbFieldVal(.Fields("NAME"), "")
                        '次ﾚｺｰﾄﾞに
                        .MoveNext()
                    Next w_Int

                    '*** Withｽﾃｰﾄﾒﾝﾄ終了 ***
                End With
                If UBound(m_JikoHyouka) > 0 Then

                    '配列に対応する名称格納
                    '取得ﾃﾞｰﾀ数分ﾙｰﾌﾟ
                    For w_Cnt1 = 1 To UBound(m_JikoHyouka)
                        For w_Cnt2 = 1 To UBound(m_Level)
                            If m_JikoHyouka(w_Cnt1).HyoukaLvCD = m_Level(w_Cnt2).LvCD Then
                                m_JikoHyouka(w_Cnt1).HyoukaLvNM = m_Level(w_Cnt2).Name_Renamed
                                Exit For
                            End If
                        Next w_Cnt2
                        If w_Cnt2 = (UBound(m_Level) + 1) Then
                            m_JikoHyouka(w_Cnt1).HyoukaLvNM = ""
                        End If
                    Next w_Cnt1

                End If

                'ｵﾌﾞｼﾞｪｸﾄの解放
                w_Rs.Close()

            End If

        Catch ex As Exception
            Call General.paTrpMsg(Convert.ToString(Err.Number), W_SUBNAME)
        End Try
    End Sub

    Private Sub DispItemsMyLadder()
        Const W_SUBNAME As String = "Nssl001 DispItemsMyLadder"

        Try
            Dim clmX As System.Windows.Forms.ColumnHeader
            Dim itmX As System.Windows.Forms.ListViewItem
            Dim w_Cnt As Integer
            Dim w_Idx As Integer


            '自己評価Tab
            lvwMain.Columns.Clear()
            lvwMain.Items.Clear()
            'ｱｲｺﾝの整列方法
            lvwMain.Alignment = System.Windows.Forms.ListViewAlignment.Top
            'ﾘｽﾄﾋﾞｭｰﾀｲﾌﾟ設定
            lvwMain.View = System.Windows.Forms.View.Details
            'ﾘｽﾄﾋﾞｭｰのItemｸﾘｱｰ
            lvwMain.Columns.Clear()
            lvwMain.Items.Clear()
            lvwMain.Refresh()

            'ラベル編集不可
            lvwMain.LabelEdit = False

            'ｱｲｺﾝの整列方法
            lvwMain.Alignment = System.Windows.Forms.ListViewAlignment.Top
            'ﾘｽﾄﾋﾞｭｰﾀｲﾌﾟ設定
            lvwMain.View = System.Windows.Forms.View.Details
            lvwMain.LabelEdit = False
            'ｶﾗﾑﾍｯﾀﾞｰの追加
            clmX = lvwMain.Columns.Add("Kikan", "評価期間", Integer.Parse(General.paTwipsTopixels(1500)), System.Windows.Forms.HorizontalAlignment.Left, "") '評価期間
            clmX = lvwMain.Columns.Add("Date", "評価日", Integer.Parse(General.paTwipsTopixels(1500)), System.Windows.Forms.HorizontalAlignment.Left, "") '評価日
            clmX = lvwMain.Columns.Add("Level", "評価レベル", Integer.Parse(General.paTwipsTopixels(1500)), System.Windows.Forms.HorizontalAlignment.Left, "") '評価レベル
            clmX = lvwMain.Columns.Add("Hyouka1", "第１評価者", Integer.Parse(General.paTwipsTopixels(1500)), System.Windows.Forms.HorizontalAlignment.Left, "") '第１評価者
            clmX = lvwMain.Columns.Add("Hyouka2", "第２評価者", Integer.Parse(General.paTwipsTopixels(1500)), System.Windows.Forms.HorizontalAlignment.Left, "") '第２評価者
            clmX = lvwMain.Columns.Add("Hyouka3", "第３評価者", Integer.Parse(General.paTwipsTopixels(1500)), System.Windows.Forms.HorizontalAlignment.Left, "") '第３評価者
            clmX = lvwMain.Columns.Add("Decision", "確定区分", Integer.Parse(General.paTwipsTopixels(1500)), System.Windows.Forms.HorizontalAlignment.Left, "") '確定区分

            '配列のｿｰﾄ
            Call SortArrayMyLadder()

            '表示時のﾘｽﾄｲﾝﾃﾞｯｸｽ変数 初期化
            w_Idx = 1

            '取得ﾃﾞｰﾀ数分ﾙｰﾌﾟ
            For w_Cnt = 1 To UBound(m_JikoHyouka)
                If m_JikoHyouka(w_Cnt).ProcFlg <> M_FlgDelete Then
                    '削除ﾃﾞｰﾀでない場合表示
                    '表示時のﾘｽﾄｲﾝﾃﾞｯｸｽｾｯﾄ
                    m_JikoHyouka(w_Cnt).DispIndex = w_Idx
                    w_Idx = w_Idx + 1

                    itmX = lvwMain.Items.Add(m_JikoHyouka(w_Cnt).HyoukaKikan)
                    If itmX.SubItems.Count > 1 Then
                        itmX.SubItems(1).Text = General.paGetDateStringFromInteger(m_JikoHyouka(w_Cnt).JikoHyoukaDate)
                    Else
                        itmX.SubItems.Insert(1, New System.Windows.Forms.ListViewItem.ListViewSubItem(Nothing, General.paGetDateStringFromInteger(m_JikoHyouka(w_Cnt).JikoHyoukaDate)))
                    End If

                    If itmX.SubItems.Count > 2 Then
                        itmX.SubItems(2).Text = m_JikoHyouka(w_Cnt).HyoukaLvNM
                    Else
                        itmX.SubItems.Insert(2, New System.Windows.Forms.ListViewItem.ListViewSubItem(Nothing, m_JikoHyouka(w_Cnt).HyoukaLvNM))
                    End If

                    If itmX.SubItems.Count > 3 Then
                        itmX.SubItems(3).Text = m_JikoHyouka(w_Cnt).Lv1StaffName
                    Else
                        itmX.SubItems.Insert(3, New System.Windows.Forms.ListViewItem.ListViewSubItem(Nothing, m_JikoHyouka(w_Cnt).Lv1StaffName))
                    End If

                    If itmX.SubItems.Count > 4 Then
                        itmX.SubItems(4).Text = m_JikoHyouka(w_Cnt).Lv2StaffName
                    Else
                        itmX.SubItems.Insert(4, New System.Windows.Forms.ListViewItem.ListViewSubItem(Nothing, m_JikoHyouka(w_Cnt).Lv2StaffName))
                    End If

                    If itmX.SubItems.Count > 5 Then
                        itmX.SubItems(5).Text = m_JikoHyouka(w_Cnt).Lv3StaffName
                    Else
                        itmX.SubItems.Insert(5, New System.Windows.Forms.ListViewItem.ListViewSubItem(Nothing, m_JikoHyouka(w_Cnt).Lv3StaffName))
                    End If

                    If itmX.SubItems.Count > 6 Then
                        itmX.SubItems(6).Text = IIf(m_JikoHyouka(w_Cnt).KakuteiKbn = "1", "確定", "")
                    Else
                        itmX.SubItems.Insert(6, New System.Windows.Forms.ListViewItem.ListViewSubItem(Nothing, IIf(m_JikoHyouka(w_Cnt).KakuteiKbn = "1", "確定", "")))
                    End If
                Else
                    '削除ﾃﾞｰﾀの場合
                    m_JikoHyouka(w_Cnt).DispIndex = 0
                End If
            Next w_Cnt

            Call General.paSetFieldWidth(lvwMain, General.G_STRMAINKEY1 & "\" & G_PROJECTID, m_strNodeKey, False)

            If lvwMain.Items.Count >= 1 Then
                lvwMain.FocusedItem = lvwMain.Items.Item(1)
                lvwMain.Items.Item(1).Selected = True
            End If

        Catch ex As Exception
            Call General.paTrpMsg(Convert.ToString(Err.Number), W_SUBNAME)
        End Try
    End Sub

    Private Sub GetTaHyouka()
        Dim cboKikan As Object
        Dim cboKinmuBusyo As Object
        Const W_SUBNAME As String = "Nssl001 GetTaHyouka"

        Try
            Dim w_Int As Integer
            Dim w_Sql As String
            Dim w_Count As Integer
            Dim w_Cnt1 As Integer
            Dim w_Cnt2 As Integer
            Dim w_TargetTable As String
            Dim w_dblDate As Double
            Dim w_HyoukaData() As Hyouka_Type
            Dim w_JikoHyoukaFlg As Boolean
            Dim w_1stHyoukaFlg As Boolean
            Dim w_2ndHyoukaFlg As Boolean
            Dim w_3rdHyoukaFlg As Boolean
            Dim w_StaffLoop As Integer
            Dim w_Tahyouka() As TaHyouka_Type
            Dim w_strTargetBusyoCD As String
            Dim w_lngTargetFrom As Integer
            Dim w_lngTargetTo As Integer

            'DAOｵﾌﾞｼﾞｪｸﾄ
            Dim w_Rs As ADODB.Recordset

            w_TargetTable = "NS_VALUATIONHIS_F"

            'SELECT文 編集
            w_Sql = "SELECT STAFFMNGID, FROMDATE, TODATE, DATEF, LEVELCD, LV1STAFFMNGID, LV2STAFFMNGID,LV3STAFFMNGID, DECISIONKBN, REGISTFIRSTTIMEDATE, "
            w_Sql = w_Sql & "LASTUPDTIMEDATE, REGISTRANTID FROM " & w_TargetTable & " "
            w_Sql = w_Sql & "WHERE HOSPITALCD = '" & General.g_strHospitalCD & "' "
            w_Sql = w_Sql & "AND ( LV1STAFFMNGID = '" & m_strSelectStaffMngID & "' "
            w_Sql = w_Sql & "OR  LV2STAFFMNGID = '" & m_strSelectStaffMngID & "' "
            w_Sql = w_Sql & "OR  LV3STAFFMNGID = '" & m_strSelectStaffMngID & "') "

            'ﾚｺｰﾄﾞｾｯﾄｵﾌﾞｼﾞｪｸﾄ生成
            w_Rs = General.paDBRecordSetOpen(w_Sql)

            '配列の再確保
            ReDim Preserve w_Tahyouka(0)

            '資格情報Ｆにﾃﾞｰﾀが存在するか ?
            If w_Rs.RecordCount <= 0 Then
                'ﾃﾞｰﾀが存在しない場合

            Else
                'ﾏｽﾀにﾃﾞｰﾀがある場合

                '*** WITH ｽﾃｰﾄﾒﾝﾄ開始 ***
                With w_Rs

                    '--- ﾚｺｰﾄﾞ件数取得 ---
                    .MoveLast()
                    w_Count = .RecordCount
                    .MoveFirst()

                    '取得ﾃﾞｰﾀ件数 繰り返し
                    For w_Int = 1 To w_Count
                        '配列再確保
                        ReDim Preserve w_Tahyouka(UBound(w_Tahyouka) + 1)
                        '配列に格納(固定値)
                        w_Tahyouka(w_Int).ByoinCD = General.g_strHospitalCD
                        w_Tahyouka(w_Int).SyokuinNo = m_strSelectStaffMngID
                        w_Tahyouka(w_Int).NewFlg = M_FlgOld '既存
                        w_Tahyouka(w_Int).ProcFlg = M_FlgNon '無処理
                        '配列に格納(取得値)
                        w_Tahyouka(w_Int).Fromdate = General.paGetDbFieldVal(.Fields("Fromdate"), 0)
                        w_Tahyouka(w_Int).Todate = General.paGetDbFieldVal(.Fields("Todate"), 0)
                        '--期間
                        w_Tahyouka(w_Int).HyoukaKikan = General.DateUtil.paGetDateStringFromInteger(w_Tahyouka(w_Int).Fromdate) & "〜" &
                                                        General.DateUtil.paGetDateStringFromInteger(w_Tahyouka(w_Int).Todate)

                        w_Tahyouka(w_Int).TaisyouStaffMngID = General.paGetDbFieldVal(.Fields("STAFFMNGID"), "")
                        w_Tahyouka(w_Int).JikoHyoukaDate = General.paGetDbFieldVal(.Fields("DateF"), 0)
                        w_Tahyouka(w_Int).HyoukaLvCD = General.paGetDbFieldVal(.Fields("LEVELCD"), "")
                        w_Tahyouka(w_Int).Lv1StaffMngID = General.paGetDbFieldVal(.Fields("Lv1StaffMngID"), "")
                        w_Tahyouka(w_Int).Lv2StaffMngID = General.paGetDbFieldVal(.Fields("Lv2StaffMngID"), "")
                        w_Tahyouka(w_Int).Lv3StaffMngID = General.paGetDbFieldVal(.Fields("Lv3StaffMngID"), "")
                        '職員氏名の取得
                        For w_StaffLoop = 1 To UBound(m_StaffData)
                            If (w_Tahyouka(w_Int).TaisyouStaffMngID).Equals(m_StaffData(w_StaffLoop).ID) Then
                                w_Tahyouka(w_Int).TaisyouStaffName = m_StaffData(w_StaffLoop).Name_Renamed
                            End If
                            If (w_Tahyouka(w_Int).Lv1StaffMngID).Equals(m_StaffData(w_StaffLoop).ID) Then
                                w_Tahyouka(w_Int).Lv1StaffName = m_StaffData(w_StaffLoop).Name_Renamed
                            End If
                            If (w_Tahyouka(w_Int).Lv2StaffMngID).Equals(m_StaffData(w_StaffLoop).ID) Then
                                w_Tahyouka(w_Int).Lv2StaffName = m_StaffData(w_StaffLoop).Name_Renamed
                            End If
                            If (w_Tahyouka(w_Int).Lv3StaffMngID).Equals(m_StaffData(w_StaffLoop).ID) Then
                                w_Tahyouka(w_Int).Lv3StaffName = m_StaffData(w_StaffLoop).Name_Renamed
                            End If
                        Next w_StaffLoop

                        '評価区分
                        If (m_strSelectStaffMngID).Equals(w_Tahyouka(w_Int).Lv1StaffMngID) Then
                            '第１評価者
                            w_Tahyouka(w_Int).HyoukaKbn = Convert.ToString(1)
                        ElseIf (m_strSelectStaffMngID).Equals(w_Tahyouka(w_Int).Lv2StaffMngID) Then
                            '第２評価者
                            w_Tahyouka(w_Int).HyoukaKbn = Convert.ToString(2)
                        ElseIf (m_strSelectStaffMngID).Equals(w_Tahyouka(w_Int).Lv3StaffMngID) Then
                            '第３評価者
                            w_Tahyouka(w_Int).HyoukaKbn = Convert.ToString(3)
                        End If

                        w_Tahyouka(w_Int).KakuteiKbn = General.paGetDbFieldVal(.Fields("DECISIONKBN"), "")

                        w_Tahyouka(w_Int).Fdate = Long.Parse(General.paGetDbFieldVal(.Fields("REGISTFIRSTTIMEDATE"), 0))
                        w_Tahyouka(w_Int).Ldate = Long.Parse(General.paGetDbFieldVal(.Fields("LASTUPDTIMEDATE"), 0))
                        w_Tahyouka(w_Int).UserID = General.paGetDbFieldVal(.Fields("REGISTRANTID"), "")
                        '次ﾚｺｰﾄﾞに
                        .MoveNext()
                    Next w_Int

                    '*** WITHｽﾃｰﾄﾒﾝﾄ終了 ***
                End With
            End If

            'ｵﾌﾞｼﾞｪｸﾄの解放
            w_Rs.Close()

            '配列に対応する名称格納
            '取得ﾃﾞｰﾀ数分ﾙｰﾌﾟ
            For w_Cnt1 = 1 To UBound(w_Tahyouka)
                For w_Cnt2 = 1 To UBound(m_Level)
                    If w_Tahyouka(w_Cnt1).HyoukaLvCD = m_Level(w_Cnt2).LvCD Then
                        w_Tahyouka(w_Cnt1).HyoukaLvNM = m_Level(w_Cnt2).Name_Renamed
                        Exit For
                    End If
                Next w_Cnt2
                If w_Cnt2 = (UBound(m_Level) + 1) Then
                    w_Tahyouka(w_Cnt1).HyoukaLvNM = ""
                End If
            Next w_Cnt1

            w_dblDate = General.paGetDateIntegerFromDate(Now)

            For w_Cnt1 = 1 To UBound(w_Tahyouka)
                ReDim w_HyoukaData(0)

                '進捗状況
                w_Sql = ""
                w_Sql = "SELECT VALUATIONKBN, VALUATIONDATE "
                w_Sql = w_Sql & "FROM NS_VALUATIONDETAIL_F "
                w_Sql = w_Sql & " WHERE HOSPITALCD = '" & General.g_strHospitalCD & "' "
                w_Sql = w_Sql & " AND STAFFMNGID= '" & w_Tahyouka(w_Cnt1).TaisyouStaffMngID & "' "
                w_Sql = w_Sql & " AND FROMDATE = " & w_Tahyouka(w_Cnt1).Fromdate
                w_Sql = w_Sql & " AND TODATE = " & w_Tahyouka(w_Cnt1).Todate
                w_Sql = w_Sql & " AND DATEF = " & w_Tahyouka(w_Cnt1).JikoHyoukaDate
                w_Sql = w_Sql & " ORDER BY VALUATIONKBN "

                'ﾚｺｰﾄﾞｾｯﾄｵﾌﾞｼﾞｪｸﾄ生成
                w_Rs = General.paDBRecordSetOpen(w_Sql)

                If w_Rs.RecordCount <= 0 Then
                    'ﾃﾞｰﾀが存在しない場合--誰も評価していないので「待」
                    w_Tahyouka(w_Cnt1).Sintyoku = "待"

                Else
                    '*** WITH ｽﾃｰﾄﾒﾝﾄ開始 ***
                    With w_Rs

                        '--- ﾚｺｰﾄﾞ件数取得 ---
                        .MoveLast()
                        w_Count = .RecordCount
                        .MoveFirst()

                        ReDim w_HyoukaData(w_Count)

                        '取得ﾃﾞｰﾀ件数 繰り返し
                        For w_Int = 1 To w_Count
                            w_HyoukaData(w_Int).Kbn = General.paGetDbFieldVal(.Fields("VALUATIONKBN"), "")
                            w_HyoukaData(w_Int).Date_Renamed = Integer.Parse(General.paGetDbFieldVal(.Fields("VALUATIONDATE"), 0))
                            .MoveNext()
                        Next w_Int

                        Select Case w_Tahyouka(w_Cnt1).HyoukaKbn

                            Case Convert.ToString(1) '第１評価者
                                w_JikoHyoukaFlg = False
                                w_1stHyoukaFlg = False
                                w_2ndHyoukaFlg = False
                                w_3rdHyoukaFlg = False

                                For w_Int = 1 To UBound(w_HyoukaData)
                                    If ("0").Equals((w_HyoukaData(w_Int).Kbn)) AndAlso w_HyoukaData(w_Int).Date_Renamed > 0 Then
                                        w_JikoHyoukaFlg = True
                                        w_Tahyouka(w_Cnt1).PointAddDate = w_HyoukaData(w_Int).Date_Renamed
                                    End If

                                    If ("1").Equals((w_HyoukaData(w_Int).Kbn)) AndAlso w_HyoukaData(w_Int).Date_Renamed > 0 Then
                                        w_1stHyoukaFlg = True
                                        w_Tahyouka(w_Cnt1).Lv1StaffDate = w_HyoukaData(w_Int).Date_Renamed
                                    End If

                                    If ("2").Equals((w_HyoukaData(w_Int).Kbn)) AndAlso w_HyoukaData(w_Int).Date_Renamed > 0 Then
                                        w_2ndHyoukaFlg = True
                                        w_Tahyouka(w_Cnt1).Lv2StaffDate = w_HyoukaData(w_Int).Date_Renamed
                                    End If

                                    If ("3").Equals((w_HyoukaData(w_Int).Kbn)) AndAlso w_HyoukaData(w_Int).Date_Renamed > 0 Then
                                        w_3rdHyoukaFlg = True
                                        w_Tahyouka(w_Cnt1).Lv3StaffDate = w_HyoukaData(w_Int).Date_Renamed
                                    End If
                                Next w_Int

                                '自己評価が終了していて、自分が終了していない⇒「未」
                                If w_JikoHyoukaFlg = True AndAlso w_1stHyoukaFlg = False Then
                                    w_Tahyouka(w_Cnt1).Sintyoku = "未"
                                End If

                                '自己評価が完了していない⇒「待」
                                If w_JikoHyoukaFlg = False Then
                                    w_Tahyouka(w_Cnt1).Sintyoku = "待"
                                End If

                                '自分が終了している⇒「済」
                                If w_JikoHyoukaFlg = True AndAlso w_1stHyoukaFlg = True Then
                                    w_Tahyouka(w_Cnt1).Sintyoku = "済"
                                End If

                            Case Convert.ToString(2) '第２評価者
                                w_JikoHyoukaFlg = False
                                w_1stHyoukaFlg = False
                                w_2ndHyoukaFlg = False
                                w_3rdHyoukaFlg = False

                                For w_Int = 1 To UBound(w_HyoukaData)
                                    If ("0").Equals((w_HyoukaData(w_Int).Kbn)) AndAlso w_HyoukaData(w_Int).Date_Renamed > 0 Then
                                        w_JikoHyoukaFlg = True
                                        w_Tahyouka(w_Cnt1).PointAddDate = w_HyoukaData(w_Int).Date_Renamed
                                    End If

                                    If ("1").Equals((w_HyoukaData(w_Int).Kbn)) AndAlso w_HyoukaData(w_Int).Date_Renamed > 0 Then
                                        w_1stHyoukaFlg = True
                                        w_Tahyouka(w_Cnt1).Lv1StaffDate = w_HyoukaData(w_Int).Date_Renamed
                                    End If

                                    If ("2").Equals((w_HyoukaData(w_Int).Kbn)) AndAlso w_HyoukaData(w_Int).Date_Renamed > 0 Then
                                        w_2ndHyoukaFlg = True
                                        w_Tahyouka(w_Cnt1).Lv2StaffDate = w_HyoukaData(w_Int).Date_Renamed
                                    End If

                                    If ("3").Equals((w_HyoukaData(w_Int).Kbn)) AndAlso w_HyoukaData(w_Int).Date_Renamed > 0 Then
                                        w_3rdHyoukaFlg = True
                                        w_Tahyouka(w_Cnt1).Lv3StaffDate = w_HyoukaData(w_Int).Date_Renamed
                                    End If
                                Next w_Int

                                '第１評価が終了していて、自分が終了していない⇒「未」
                                If w_1stHyoukaFlg = True AndAlso w_2ndHyoukaFlg = False Then
                                    w_Tahyouka(w_Cnt1).Sintyoku = "未"
                                End If

                                '第１評価が完了していない⇒「待」
                                If w_1stHyoukaFlg = False Then
                                    w_Tahyouka(w_Cnt1).Sintyoku = "待"
                                End If

                                '自分が終了している⇒「済」
                                If w_1stHyoukaFlg = True AndAlso w_2ndHyoukaFlg = True Then
                                    w_Tahyouka(w_Cnt1).Sintyoku = "済"
                                End If
                            Case Convert.ToString(3) '第３評価者
                                w_JikoHyoukaFlg = False
                                w_1stHyoukaFlg = False
                                w_2ndHyoukaFlg = False
                                w_3rdHyoukaFlg = False

                                For w_Int = 1 To UBound(w_HyoukaData)
                                    If ("0").Equals(w_HyoukaData(w_Int).Kbn) AndAlso w_HyoukaData(w_Int).Date_Renamed > 0 Then
                                        w_JikoHyoukaFlg = True
                                        w_Tahyouka(w_Cnt1).PointAddDate = w_HyoukaData(w_Int).Date_Renamed
                                    End If

                                    If ("1").Equals(w_HyoukaData(w_Int).Kbn) AndAlso w_HyoukaData(w_Int).Date_Renamed > 0 Then
                                        w_1stHyoukaFlg = True
                                        w_Tahyouka(w_Cnt1).Lv1StaffDate = w_HyoukaData(w_Int).Date_Renamed
                                    End If

                                    If ("2").Equals(w_HyoukaData(w_Int).Kbn) AndAlso w_HyoukaData(w_Int).Date_Renamed > 0 Then
                                        w_2ndHyoukaFlg = True
                                        w_Tahyouka(w_Cnt1).Lv2StaffDate = w_HyoukaData(w_Int).Date_Renamed
                                    End If

                                    If ("3").Equals(w_HyoukaData(w_Int).Kbn) AndAlso w_HyoukaData(w_Int).Date_Renamed > 0 Then
                                        w_3rdHyoukaFlg = True
                                        w_Tahyouka(w_Cnt1).Lv3StaffDate = w_HyoukaData(w_Int).Date_Renamed
                                    End If
                                Next w_Int

                                '第２評価が終了していて、自分が終了していない⇒「未」
                                If w_2ndHyoukaFlg = True AndAlso w_3rdHyoukaFlg = False Then
                                    w_Tahyouka(w_Cnt1).Sintyoku = "未"
                                End If

                                '第２評価が完了していない⇒「待」
                                If w_2ndHyoukaFlg = False Then
                                    w_Tahyouka(w_Cnt1).Sintyoku = "待"
                                End If

                                '自分が終了している⇒「済」
                                If w_2ndHyoukaFlg = True AndAlso w_3rdHyoukaFlg = True Then
                                    w_Tahyouka(w_Cnt1).Sintyoku = "済"
                                End If

                        End Select

                    End With
                End If

                '評価対象職員の勤務部署
                w_Sql = ""
                w_Sql = "SELECT KINMUDEPTCD "
                w_Sql = w_Sql & " FROM NS_KINMUIDOINFO_F "
                w_Sql = w_Sql & "WHERE HOSPITALCD = '" & General.g_strHospitalCD & "' "
                w_Sql = w_Sql & "AND STAFFMNGID= '" & w_Tahyouka(w_Cnt1).TaisyouStaffMngID & "' "
                w_Sql = w_Sql & "AND IDODATE <= " & w_dblDate
                w_Sql = w_Sql & "AND ENDDATE >= " & w_dblDate

                'ﾚｺｰﾄﾞｾｯﾄｵﾌﾞｼﾞｪｸﾄ生成
                w_Rs = General.paDBRecordSetOpen(w_Sql)

                '資格情報Ｆにﾃﾞｰﾀが存在するか ?
                If w_Rs.RecordCount <= 0 Then
                    'ﾃﾞｰﾀが存在しない場合

                Else
                    'ﾃﾞｰﾀがある場合

                    '*** WITH ｽﾃｰﾄﾒﾝﾄ開始 ***
                    With w_Rs
                        w_Tahyouka(w_Cnt1).TaisyouStaffBusyo = General.paGetDbFieldVal(.Fields("KINMUDEPTCD"), "")
                    End With
                End If

            Next w_Cnt1

            'ｵﾌﾞｼﾞｪｸﾄの解放
            If UBound(w_Tahyouka) > 0 Then
                w_Rs.Close()
            End If

            '---検索---------------------------------------------------------
            If cboKinmuBusyo.ListIndex >= 0 Then
                w_strTargetBusyoCD = m_KangoM(cboKinmuBusyo.ListIndex).BusyoCD
            Else
                w_strTargetBusyoCD = m_KangoM(cboKinmuBusyo.ListIndex + 1).BusyoCD
            End If

            If cboKikan.ListIndex >= 0 Then
                w_lngTargetFrom = m_Kikan(cboKikan.ListIndex).Fromdate
                w_lngTargetTo = m_Kikan(cboKikan.ListIndex).Todate
            Else
                w_lngTargetFrom = m_Kikan(cboKikan.ListIndex + 1).Fromdate
                w_lngTargetTo = m_Kikan(cboKikan.ListIndex + 1).Todate
            End If

            ReDim m_TaHyouka(0)
            For w_Cnt1 = 1 To UBound(w_Tahyouka)
                If "0000".Equals(w_strTargetBusyoCD) OrElse (w_strTargetBusyoCD).Equals(w_Tahyouka(w_Cnt1).TaisyouStaffBusyo) Then
                    If (w_lngTargetFrom = 0 AndAlso w_lngTargetTo = 99999999) OrElse (w_lngTargetFrom = w_Tahyouka(w_Cnt1).Fromdate AndAlso w_lngTargetTo = w_Tahyouka(w_Cnt1).Todate) Then

                        ReDim Preserve m_TaHyouka(UBound(m_TaHyouka) + 1)
                        m_TaHyouka(UBound(m_TaHyouka)) = w_Tahyouka(w_Cnt1)
                    End If
                End If
            Next w_Cnt1

        Catch ex As Exception
            Call General.paTrpMsg(Convert.ToString(Err.Number), W_SUBNAME)
        End Try
    End Sub

    Private Sub DispItemsOtherLadder()
        Const W_SUBNAME As String = "Nssl001 DispItemsOtherLadder"

        Try
            Dim clmX As System.Windows.Forms.ColumnHeader
            Dim itmX As System.Windows.Forms.ListViewItem
            Dim w_Cnt As Integer
            Dim w_Idx As Integer

            '自己評価Tab
            lvwMain.Columns.Clear()
            lvwMain.Items.Clear()
            'ｱｲｺﾝの整列方法
            lvwMain.Alignment = System.Windows.Forms.ListViewAlignment.Top
            'ﾘｽﾄﾋﾞｭｰﾀｲﾌﾟ設定
            lvwMain.View = System.Windows.Forms.View.Details
            'ﾘｽﾄﾋﾞｭｰのItemｸﾘｱｰ
            lvwMain.Columns.Clear()
            lvwMain.Items.Clear()
            lvwMain.Refresh()

            'ラベル編集不可
            lvwMain.LabelEdit = False

            'ｱｲｺﾝの整列方法
            lvwMain.Alignment = System.Windows.Forms.ListViewAlignment.Top
            'ﾘｽﾄﾋﾞｭｰﾀｲﾌﾟ設定
            lvwMain.View = System.Windows.Forms.View.Details
            lvwMain.LabelEdit = False
            'ｶﾗﾑﾍｯﾀﾞｰの追加
            clmX = lvwMain.Columns.Add("Kikan", "評価期間", Integer.Parse(General.paTwipsTopixels(1500)), System.Windows.Forms.HorizontalAlignment.Left, "") '評価期間
            clmX = lvwMain.Columns.Add("Name", "氏名", Integer.Parse(General.paTwipsTopixels(1500)), System.Windows.Forms.HorizontalAlignment.Left, "") '氏名
            clmX = lvwMain.Columns.Add("Level", "評価レベル", Integer.Parse(General.paTwipsTopixels(1500)), System.Windows.Forms.HorizontalAlignment.Left, "") '評価レベル
            clmX = lvwMain.Columns.Add("Date", "評価日", Integer.Parse(General.paTwipsTopixels(1500)), System.Windows.Forms.HorizontalAlignment.Left, "") '評価日
            clmX = lvwMain.Columns.Add("Progress", "進捗", Integer.Parse(General.paTwipsTopixels(1500)), System.Windows.Forms.HorizontalAlignment.Left, "") '進捗

            '配列のｿｰﾄ
            Call SortArrayOtherLadder()

            '表示時のﾘｽﾄｲﾝﾃﾞｯｸｽ変数 初期化
            w_Idx = 1

            '取得ﾃﾞｰﾀ数分ﾙｰﾌﾟ
            For w_Cnt = 1 To UBound(m_TaHyouka)
                If m_TaHyouka(w_Cnt).ProcFlg <> M_FlgDelete Then
                    '削除ﾃﾞｰﾀでない場合表示
                    '表示時のﾘｽﾄｲﾝﾃﾞｯｸｽｾｯﾄ
                    m_TaHyouka(w_Cnt).DispIndex = w_Idx
                    w_Idx = w_Idx + 1

                    itmX = lvwMain.Items.Add(m_TaHyouka(w_Cnt).HyoukaKikan)
                    If itmX.SubItems.Count > 1 Then
                        itmX.SubItems(1).Text = m_TaHyouka(w_Cnt).TaisyouStaffName
                    Else
                        itmX.SubItems.Insert(1, New System.Windows.Forms.ListViewItem.ListViewSubItem(Nothing, m_TaHyouka(w_Cnt).TaisyouStaffName))
                    End If

                    If itmX.SubItems.Count > 2 Then
                        itmX.SubItems(2).Text = m_TaHyouka(w_Cnt).HyoukaLvNM
                    Else
                        itmX.SubItems.Insert(2, New System.Windows.Forms.ListViewItem.ListViewSubItem(Nothing, m_TaHyouka(w_Cnt).HyoukaLvNM))
                    End If

                    If itmX.SubItems.Count > 3 Then
                        itmX.SubItems(3).Text = General.paGetDateStringFromInteger(m_TaHyouka(w_Cnt).JikoHyoukaDate)
                    Else
                        itmX.SubItems.Insert(3, New System.Windows.Forms.ListViewItem.ListViewSubItem(Nothing, General.paGetDateStringFromInteger(m_TaHyouka(w_Cnt).JikoHyoukaDate)))
                    End If

                    If itmX.SubItems.Count > 4 Then
                        itmX.SubItems(4).Text = m_TaHyouka(w_Cnt).Sintyoku
                    Else
                        itmX.SubItems.Insert(4, New System.Windows.Forms.ListViewItem.ListViewSubItem(Nothing, m_TaHyouka(w_Cnt).Sintyoku))
                    End If

                Else
                    '削除ﾃﾞｰﾀの場合
                    m_TaHyouka(w_Cnt).DispIndex = 0
                End If

            Next w_Cnt

            Call General.paSetFieldWidth(lvwMain, General.G_STRMAINKEY1 & "\NSC0000HA", m_strNodeKey, False)

            If lvwMain.Items.Count >= 1 Then
                lvwMain.FocusedItem = lvwMain.Items.Item(1)
                lvwMain.Items.Item(1).Selected = True
            End If

        Catch ex As Exception
            Call General.paTrpMsg(Convert.ToString(Err.Number), W_SUBNAME)
        End Try
    End Sub

    Private Sub SortArrayMyLadder()
        Const W_SUBNAME As String = "Nssl001 SortArrayMyLadder"

        Try
            Dim w_i As Integer
            Dim w_j As Integer

            Dim w_tmp212(0) As JikoHyouka_Type

            'ﾊﾞﾌﾞﾙｿｰﾄ
            For w_i = 1 To UBound(m_JikoHyouka)
                For w_j = 1 To (UBound(m_JikoHyouka) - w_i)
                    '期間の開始年月日を比較
                    If m_JikoHyouka(w_j).Fromdate < m_JikoHyouka(w_j + 1).Fromdate Then
                        '次が大きい場合入れ替える
                        w_tmp212(0) = m_JikoHyouka(w_j)
                        m_JikoHyouka(w_j) = m_JikoHyouka(w_j + 1)
                        m_JikoHyouka(w_j + 1) = w_tmp212(0)
                    ElseIf m_JikoHyouka(w_j).Fromdate = m_JikoHyouka(w_j + 1).Fromdate Then
                        '期間の開始年月日が一緒なら、評価年月日で並べる
                        If m_JikoHyouka(w_j).JikoHyoukaDate > m_JikoHyouka(w_j + 1).JikoHyoukaDate Then
                            '次が小さい場合入れ替える
                            w_tmp212(0) = m_JikoHyouka(w_j)
                            m_JikoHyouka(w_j) = m_JikoHyouka(w_j + 1)
                            m_JikoHyouka(w_j + 1) = w_tmp212(0)
                        End If
                    Else
                    End If
                Next w_j
            Next w_i

        Catch ex As Exception
            Call General.paTrpMsg(Convert.ToString(Err.Number), W_SUBNAME)
        End Try
    End Sub

    Private Sub SortArrayOtherLadder()
        Const W_SUBNAME As String = "Nssl001 SortArrayOtherLadder"

        Try
            Dim w_i As Integer
            Dim w_j As Integer

            Dim w_tmp213(0) As TaHyouka_Type

            'ﾊﾞﾌﾞﾙｿｰﾄ
            For w_i = 1 To UBound(m_TaHyouka)
                For w_j = 1 To (UBound(m_TaHyouka) - w_i)
                    '取得年月日を比較
                    If m_TaHyouka(w_j).Fromdate < m_TaHyouka(w_j + 1).Fromdate Then
                        '次が大きい場合入れ替える
                        w_tmp213(0) = m_TaHyouka(w_j)
                        m_TaHyouka(w_j) = m_TaHyouka(w_j + 1)
                        m_TaHyouka(w_j + 1) = w_tmp213(0)
                    ElseIf m_TaHyouka(w_j).Fromdate = m_TaHyouka(w_j + 1).Fromdate Then
                        '取得年月日が同じなら資格CDを比較
                        If m_TaHyouka(w_j).JikoHyoukaDate > m_TaHyouka(w_j + 1).JikoHyoukaDate Then
                            '次が小さい場合入れ替える
                            w_tmp213(0) = m_TaHyouka(w_j)
                            m_TaHyouka(w_j) = m_TaHyouka(w_j + 1)
                            m_TaHyouka(w_j + 1) = w_tmp213(0)
                        End If
                    Else
                    End If
                Next w_j
            Next w_i

        Catch ex As Exception
            Call General.paTrpMsg(Convert.ToString(Err.Number), W_SUBNAME)
        End Try
    End Sub

    'ロック情報更新（p_InsDelFlg：1=ロック,2=解除）
    Private Sub sUpdateOverKinmuLock(ByVal p_InsDelFlg As String)
        Try
            Dim w_PreErrorProc As String
            w_PreErrorProc = General.g_ErrorProc 'ﾌﾟﾛｼｰｼﾞｬ名の一時待避
            General.g_ErrorProc = "NSC0000HA sUpdateOverKinmuLock"

            Dim w_strSql As String
            Dim w_Rs As ADODB.Recordset
            Dim w_最終更新日時 As ADODB.Field
            Dim w_初回登録日時 As ADODB.Field

            Const W_INSERT As String = "1"

            Dim w_numFDate As Long
            Dim w_numSysDate As Long
            Dim w_numLDate As Long
            Dim w_lngLoop As Integer
            Dim w_lngCnt As Integer

            Dim w_lngNewIndex As Integer

            Dim w_strMsg() As String
            Dim w_MsgResult As MsgBoxResult

            w_numSysDate = Long.Parse(Format(Now, "yyyyMMddHHmmss"))
            w_lngNewIndex = 0

            w_lngCnt = UBound(m_udtOverKinmuLock)
            For w_lngLoop = 1 To w_lngCnt

                If m_udtOverKinmuLock(w_lngLoop).lngDate = General.paGetDateIntegerFromDate(m_CalDate) AndAlso
                    (General.g_strSelKinmuDeptCD).Equals(m_udtOverKinmuLock(w_lngLoop).strKinmuDeptCD) Then

                    w_numLDate = m_udtOverKinmuLock(w_lngLoop).dblLastUpdDate
                    w_lngNewIndex = w_lngLoop

                    Exit For

                End If

            Next w_lngLoop

            'ﾄﾗﾝｻﾞｸｼｮﾝ開始
            Call General.paBeginTrans()

            '---- 登録 ----
            If p_InsDelFlg = W_INSERT Then

                'お知らせ情報Fよりデータを取得
                w_strSql = "SELECT * "
                w_strSql = w_strSql & "  FROM  NS_OVERKINMULOCK_F "
                w_strSql = w_strSql & "  WHERE  HOSPITALCD  = '" & General.g_strHospitalCD & "' "
                w_strSql = w_strSql & "  AND    DATEF       = " & General.paGetDateStringFromDate(m_CalDate, General.G_DATE_ENUM.yyyyMMdd) & " "
                w_strSql = w_strSql & "  AND    KINMUDEPTCD = '" & General.g_strSelKinmuDeptCD & "' "

                w_Rs = General.paDBRecordSetOpenNoWait(w_strSql)

                With w_Rs
                    If w_Rs Is Nothing Then
                        Exit Sub
                    ElseIf .RecordCount <= 0 Then

                        'データが存在しない場合はInsert
                        w_strSql = "INSERT INTO NS_OVERKINMULOCK_F ("
                        w_strSql = w_strSql & "HOSPITALCD, DATEF, KINMUDEPTCD, DUEFLG, "
                        w_strSql = w_strSql & " REGISTFIRSTTIMEDATE, LASTUPDTIMEDATE, REGISTRANTID) "
                        w_strSql = w_strSql & "VALUES('" & General.g_strHospitalCD & "', "
                        w_strSql = w_strSql & General.paGetDateStringFromDate(m_CalDate, General.G_DATE_ENUM.yyyyMMdd) & ", '"
                        w_strSql = w_strSql & General.g_strSelKinmuDeptCD & "', '"
                        w_strSql = w_strSql & "1" & "', "
                        w_strSql = w_strSql & (w_numSysDate).ToString & ", " & (w_numSysDate).ToString & ", '" & General.g_strUserID & "') "

                        '更新実行
                        Call General.paDBExecute(w_strSql)

                        w_lngNewIndex = UBound(m_udtOverKinmuLock) + 1

                        ReDim Preserve m_udtOverKinmuLock(w_lngNewIndex)

                        m_udtOverKinmuLock(w_lngNewIndex).lngDate = General.paGetDateIntegerFromDate(m_CalDate)
                        m_udtOverKinmuLock(w_lngNewIndex).strKinmuDeptCD = General.g_strSelKinmuDeptCD
                        m_udtOverKinmuLock(w_lngNewIndex).blnLockFlg = True
                        m_udtOverKinmuLock(w_lngNewIndex).dblLastUpdDate = w_numSysDate

                    Else
                        .MoveLast()
                        w_lngCnt = .RecordCount
                        .MoveFirst()

                        w_初回登録日時 = .Fields.Item("REGISTFIRSTTIMEDATE")
                        w_最終更新日時 = .Fields.Item("LASTUPDTIMEDATE")
                        '排他ﾁｪｯｸ
                        If w_numLDate <> Long.Parse(General.paGetDbFieldVal(w_最終更新日時, 0)) Then
                            '*******ﾒｯｾｰｼﾞ***********************************
                            ReDim w_strMsg(0)
                            w_MsgResult = General.paMsgDsp("NS0045", w_strMsg)
                            '************************************************
                            Call General.paRollBack()
                            Exit Sub
                        End If
                        w_numFDate = Long.Parse(General.paGetDbFieldVal(w_初回登録日時, 0))

                        '更新
                        w_strSql = "UPDATE NS_OVERKINMULOCK_F SET "
                        w_strSql = w_strSql & "DUEFLG = '1' "
                        w_strSql = w_strSql & ",LASTUPDTIMEDATE = " & w_numSysDate & " "
                        w_strSql = w_strSql & ",REGISTRANTID    = '" & General.g_strUserID & "' "
                        w_strSql = w_strSql & "WHERE HOSPITALCD = '" & General.g_strHospitalCD & "' "
                        w_strSql = w_strSql & "AND DATEF        = " & General.paGetDateStringFromDate(m_CalDate, General.G_DATE_ENUM.yyyyMMdd) & " "
                        w_strSql = w_strSql & "AND KINMUDEPTCD  = '" & General.g_strSelKinmuDeptCD & "' "

                        '更新実行
                        Call General.paDBExecute(w_strSql)

                        m_udtOverKinmuLock(w_lngNewIndex).dblLastUpdDate = w_numSysDate

                    End If

                    .Close()
                End With
                w_Rs = Nothing

                '---- 削除 ----
            Else

                'お知らせ情報Fよりデータを取得
                w_strSql = "SELECT * "
                w_strSql = w_strSql & "  FROM  NS_OVERKINMULOCK_F "
                w_strSql = w_strSql & "  WHERE  HOSPITALCD  = '" & General.g_strHospitalCD & "' "
                w_strSql = w_strSql & "  AND    DATEF       = " & General.paGetDateStringFromDate(m_CalDate, General.G_DATE_ENUM.yyyyMMdd) & " "
                w_strSql = w_strSql & "  AND    KINMUDEPTCD = '" & General.g_strSelKinmuDeptCD & "' "

                w_Rs = General.paDBRecordSetOpenNoWait(w_strSql)

                With w_Rs
                    If w_Rs Is Nothing Then
                        Exit Sub
                    ElseIf .RecordCount <= 0 Then

                        '*******ﾒｯｾｰｼﾞ***********************************
                        ReDim w_strMsg(0)
                        w_MsgResult = General.paMsgDsp("NS0045", w_strMsg)
                        '************************************************
                        w_Rs.Close()
                        w_Rs = Nothing
                        Call General.paRollBack()
                        Exit Sub

                    Else
                        .MoveLast()
                        w_lngCnt = .RecordCount
                        .MoveFirst()

                        w_初回登録日時 = .Fields.Item("REGISTFIRSTTIMEDATE")
                        w_最終更新日時 = .Fields.Item("LASTUPDTIMEDATE")
                        '排他ﾁｪｯｸ
                        If w_numLDate <> Long.Parse(General.paGetDbFieldVal(w_最終更新日時, 0)) Then
                            '*******ﾒｯｾｰｼﾞ***********************************
                            ReDim w_strMsg(0)
                            w_MsgResult = General.paMsgDsp("NS0045", w_strMsg)
                            '************************************************
                            Call General.paRollBack()
                            Exit Sub
                        End If
                        w_numFDate = Long.Parse(General.paGetDbFieldVal(w_初回登録日時, 0))

                        '更新
                        w_strSql = "UPDATE NS_OVERKINMULOCK_F SET "
                        w_strSql = w_strSql & "DUEFLG = '0' "
                        w_strSql = w_strSql & ",LASTUPDTIMEDATE = " & w_numSysDate & " "
                        w_strSql = w_strSql & ",REGISTRANTID    = '" & General.g_strUserID & "' "
                        w_strSql = w_strSql & "WHERE HOSPITALCD = '" & General.g_strHospitalCD & "' "
                        w_strSql = w_strSql & "AND DATEF        = " & General.paGetDateStringFromDate(m_CalDate, General.G_DATE_ENUM.yyyyMMdd) & " "
                        w_strSql = w_strSql & "AND KINMUDEPTCD  = '" & General.g_strSelKinmuDeptCD & "' "

                        '更新実行
                        Call General.paDBExecute(w_strSql)

                        m_udtOverKinmuLock(w_lngNewIndex).dblLastUpdDate = w_numSysDate

                    End If

                    .Close()
                End With
                w_Rs = Nothing

            End If

            'ｺﾐｯﾄ
            Call General.paCommit()

            '時間外ロック取得
            Call sGetOverKinmuLock()

            General.g_ErrorProc = w_PreErrorProc '待避ﾌﾟﾛｼｰｼﾞｬ名を元に戻す

        Catch ex As Exception
            Throw
        End Try
    End Sub

    '====================================
    '日別時間外の承認情報を更新
    '====================================
    Private Sub sUpdApprovePersonalOver()
        Const W_SUBNAME As String = "NSC0000HA sUpdApprovePersonalOver"

        Try
            Dim w_lngLoop As Integer
            Dim w_blnUPDFlg As Boolean
            Dim w_blnErrorFlg As Boolean
            Dim w_blnOKFlg As Boolean
            Dim w_lngErrorCnt As Integer
            Dim w_strMsg() As String
            Const WC_MONTHRESOURCE As String = "NSW0020HA6"
            Dim w_intOutCnt As Integer
            Dim w_blnOutFlg As Boolean
            Dim w_blnLockMsgFlg As Boolean 'ロックがかかっていて承認できないメッセージを表示したか否か
            Dim w_blnLockMsgFlg2 As Boolean 'ロックがかかっていて承認できないメッセージを表示したか否か
            Dim w_strLockStaffMngID As String
            Dim w_lngLockLoop As Integer
            Dim w_lngLockCnt As Integer

            Dim w_updFlg As Boolean
            Dim w_procDate As String
            Dim w_updOvRuikeFlg As String
            Dim w_monthEndFlg As Boolean
            Dim w_monthEndDate As Integer

            w_strLockStaffMngID = ""
            w_lngLockCnt = UBound(m_udtOverKinmuLock)

            '★最初に勤務実績チェックや超勤入力可能勤務？もしくは時間年休登録可能勤務などを確認する
            '（入力画面と同じ処理）
            w_updOvRuikeFlg = General.paGetItemValue(General.G_STRMAINKEY3, General.G_STRSUBKEY13, "INSPECTIONUPDFLG", "0", General.g_strHospitalCD)
            w_updFlg = False
            w_monthEndFlg = False
            w_blnErrorFlg = False
            w_lngErrorCnt = 0
            w_blnOKFlg = False
            w_intOutCnt = 0

            With General.g_objSyouninData

                w_blnLockMsgFlg = False
                w_blnLockMsgFlg2 = False

                For w_lngLoop = 1 To lvwMain.Items.Count
                    w_blnOutFlg = False
                    If lvwMain.Items.Item(w_lngLoop - 1).Checked = True Then
                        If m_udtKinmuData(w_lngLoop).strIconStatus = M_OK_APPROVE Then
                            w_blnOutFlg = False
                            If GetShimekiri2(m_udtKinmuData(w_lngLoop).lngAppliDate) = 1 Then
                                '月の締切日を過ぎているとき→月締め後の操作権限があるか
                                If General.g_objSecurity.mGetResource(WC_MONTHRESOURCE) = False Then
                                    w_blnOutFlg = True
                                    w_intOutCnt = w_intOutCnt + 1
                                Else
                                    If String.IsNullOrEmpty(General.g_objSecurity.fR_UpdAuthRangeKbn) OrElse General.G_STRAUTHRANGENOTHING.Equals(General.g_objSecurity.fR_UpdAuthRangeKbn) Then

                                        w_blnOutFlg = True
                                        w_intOutCnt = w_intOutCnt + 1
                                    End If
                                End If
                            End If

                            If (m_udtKinmuData(w_lngLoop).strAppliStaffMngID).Equals(w_strLockStaffMngID) Then
                            Else
                                If General.g_objSecurity.mGetResource(M_APPRO_DAY_OVER_LOCK) = False Then

                                    If w_blnLockMsgFlg = False Then
                                        w_blnLockMsgFlg = True
                                    End If
                                Else
                                    If String.IsNullOrEmpty(General.g_objSecurity.fR_UpdAuthRangeKbn) OrElse General.G_STRAUTHRANGENOTHING.Equals(General.g_objSecurity.fR_UpdAuthRangeKbn) Then
                                        If w_blnLockMsgFlg = False Then
                                            w_blnLockMsgFlg = True
                                        End If

                                    Else
                                        If General.g_objSecurity.mCheckAuthRangeKbn(General.g_objSecurity.fR_UpdAuthRangeKbn, m_udtKinmuData(w_lngLoop).strAppliStaffMngID, General.g_strSelKinmuDeptCD) = True Then
                                        Else
                                            If w_blnLockMsgFlg = False Then
                                                w_blnLockMsgFlg = True
                                            End If
                                        End If
                                    End If
                                End If

                                w_strLockStaffMngID = m_udtKinmuData(w_lngLoop).strAppliStaffMngID
                            End If

                            'ロックを超える権限がない場合チェック
                            If w_blnLockMsgFlg = True Then
                                For w_lngLockLoop = 1 To w_lngLockCnt

                                    If m_udtOverKinmuLock(w_lngLockLoop).lngDate = m_udtKinmuData(w_lngLoop).lngAppliDate AndAlso m_udtOverKinmuLock(w_lngLockLoop).strKinmuDeptCD = General.g_strSelKinmuDeptCD AndAlso m_udtOverKinmuLock(w_lngLockLoop).blnLockFlg = True Then

                                        If w_blnLockMsgFlg2 = False Then
                                            ReDim w_strMsg(0)
                                            Call General.paMsgDsp("NS0285", w_strMsg)
                                            w_blnLockMsgFlg2 = True
                                        End If

                                        w_blnOutFlg = True

                                    End If

                                Next w_lngLockLoop
                            End If

                        Else
                            w_blnOutFlg = True
                        End If

                        If w_blnOutFlg = False Then
                            w_updFlg = True
                            If General.paRight(General.DateUtil.paGetDateStringFromDate(DateAdd(Microsoft.VisualBasic.DateInterval.Day, 1, General.DateUtil.paGetDateFromDateInteger(m_udtKinmuData(w_lngLoop).lngDate)), General.G_DATE_ENUM.yyyyMMdd), 2) = "01" Then
                                '月末が選択されている
                                w_monthEndFlg = True
                                w_monthEndDate = m_udtKinmuData(w_lngLoop).lngDate
                            End If

                            .pAppliCD = M_STRJIKANGAI '届出CD
                            .pAppliStaffMngID = m_udtKinmuData(w_lngLoop).strAppliStaffMngID '申請者の職員管理番号
                            .pAppliDate = m_udtKinmuData(w_lngLoop).lngAppliDate '申請日付
                            .pUniqueSeqNo = m_udtKinmuData(w_lngLoop).strUNIQUESEQNO 'UNIQUESEQNO
                            .pDispMode = "2" '表示ﾓｰﾄﾞ
                            .pSyoriKbn = "2" '処理区分
                            .pApproveStaffMngID = General.g_strUserMngID '承認者職員管理番号
                            .mApproveComment = ""
                            .mApproveClassLevel = m_udtKinmuData(w_lngLoop).lngApproveLevel
                            .mApproveStaffMngID = General.g_strUserMngID
                            .mLastUpdTimeDate = m_udtKinmuData(w_lngLoop).dblLastUpdDate
                            .mSyoriMode = "1" '1:承認 2:申請者に差戻 3:１つ前に差戻 4:保留

                            .pResourceCD = m_strDispMenu

                            '呼び出し側でコミット
                            Call General.paBeginTrans()

                            w_blnUPDFlg = .mApprove

                            '更新が異常の場合はロールバック
                            If w_blnUPDFlg = False Then
                                'ロールバック
                                Call General.paRollBack()
                                w_blnErrorFlg = True
                                w_lngErrorCnt = w_lngErrorCnt + 1
                            Else

                                If fncSaveOverKinmuAdjust(m_udtKinmuData(w_lngLoop).strAppliStaffMngID,
                                    m_udtKinmuData(w_lngLoop).strUNIQUESEQNO,
                                    m_udtKinmuData(w_lngLoop).lngApproveLevel,
                                    m_udtKinmuData(w_lngLoop).lngAppliDate) = False Then

                                    'ロールバック
                                    Call General.paRollBack()
                                    w_blnErrorFlg = True
                                    w_lngErrorCnt = w_lngErrorCnt + 1
                                Else
                                    'コミット
                                    Call General.paCommit()
                                    w_blnOKFlg = True
                                End If
                            End If

                        End If
                    End If
                Next w_lngLoop
            End With

            If w_updFlg = True AndAlso ("1").Equals(w_updOvRuikeFlg) Then
                '更新対象者なら時間外届出累計を更新
                w_procDate = General.paGetDateIntegerFromDate(m_CalDate, General.G_DATE_ENUM.yyyyMM)
                If w_monthEndFlg Then
                    w_procDate = w_procDate & ":" & judgeOvKinmDate(w_monthEndDate)
                End If
                'バッチ起動（フォーム非表示、個人起動）
                Call runOvKinmApprvRukei("0", "1", General.g_strHospitalCD, w_procDate, General.g_strUserID, g_strTargetStaffMngID, True)
            End If

            '異常が発生した場合
            If w_blnErrorFlg = True Then
                ReDim w_strMsg(1)
                w_strMsg(1) = Convert.ToString(w_lngErrorCnt)
                Call General.paMsgDsp("NS0144", w_strMsg)
            End If

            If w_intOutCnt > 0 Then
                ReDim w_strMsg(0)
                Call General.paMsgDsp("NS0282", w_strMsg)
            End If

            '1件でも更新があれば再表示
            If w_blnOKFlg = True Then
                Call sList_Personal()

                General.g_objGetData.pUniqueSeqNo = "" 'UNIQUESEQNO
            End If

        Catch ex As Exception
            Call General.paTrpMsg(Convert.ToString(Err.Number), W_SUBNAME)
        End Try
    End Sub


    Private Sub menuHelpVersion_Click(ByVal sender As System.Object, ByVal e As System.EventArgs) Handles menuHelpVersion.Click
        Const W_SUBNAME As String = "NSC0000HA menuHelpVersion_Click"

        Try
            Dim w_Form As frmNSC0000HN = New frmNSC0000HN

            'ﾊﾞｰｼﾞｮﾝ情報ﾀﾞｲｱﾛｸﾞﾎﾞｯｸｽ 表示
            w_Form.ShowDialog(Me)

            'ﾌｫｰﾑ ｵﾌﾞｼﾞｪｸﾄ 削除
            w_Form = Nothing

        Catch ex As Exception
            Call General.paTrpMsg(Convert.ToString(Err.Number), W_SUBNAME)
        End Try
    End Sub

    'メニューからの入力月変更
    Private Sub menuFileDateChange_Click(ByVal sender As System.Object, ByVal e As System.EventArgs) Handles menuFileDateChange.Click
        '入力月変更
        Call ChangeInputMonth()
    End Sub

    'メニューからの印刷
    Private Sub menuFilePrint_Click(ByVal sender As System.Object, ByVal e As System.EventArgs) Handles menuFilePrint.Click
        '印刷指示ﾒﾆｭｰ 表示
        Call RunPrint()
    End Sub

    'メニューからのログオフ
    Private Sub menuFileLogOff_Click(ByVal sender As System.Object, ByVal e As System.EventArgs) Handles menuFileLogOff.Click
        Const W_SUBNAME As String = "NSC0000HA menuHelpVersion_Click"

        Try
            m_LogOff_Chk = True

            Me.Close()

            If m_LogOff_Chk = True Then

                m_LogOff_Chk = False

                m_strSelChildMenu = ""

                m_strDispMenu = ""

                General.g_RetrieveObj = Nothing
                General.g_objSecurity = Nothing
                General.g_objGetData = Nothing
                General.g_objSelectDate = Nothing
                General.g_objSelectStaff = Nothing
                General.g_objGetMaster = Nothing
                General.g_objIdoData = Nothing
                General.g_objSelectDept = Nothing
                General.g_objSyouninData = Nothing
                General.g_objComCyokin = Nothing
                General.g_objDutyGroup = Nothing

                System.Windows.Forms.Application.DoEvents()

                g_Logoff_Flg = True

            End If

        Catch ex As Exception
            Call General.paTrpMsg(Convert.ToString(Err.Number), W_SUBNAME)
        End Try
    End Sub

    'メニューからの終了
    Private Sub menuFileEnd_Click(ByVal sender As System.Object, ByVal e As System.EventArgs) Handles menuFileEnd.Click
        Me.Close()

        g_End_Flg = True
    End Sub

    Private Function fncPopUpMenu_MouseUp(ByRef ObjectType As String, ByRef SelectObject As Object, ByRef Button As Integer, ByRef Shift As Integer, ByRef X As Double, ByRef Y As Double) As Boolean
        Const W_SUBNAME As String = "NSC0000HA fncPopUpMenu_MouseUp"


        Dim w_Width As Double
        Dim w_Height As Double
        Dim w_blnFLG As Boolean
        Dim w_Count As Integer
        Const W_OVER As String = "NSW0200P"
        Const W_PERSONAL As String = "NSS0010P"
        Dim w_strPrint As String
        Dim w_strSql As String
        Dim w_Rs As ADODB.Recordset
        Dim w_Name_F As ADODB.Field
        Dim w_Res_F As ADODB.Field
        Dim w_Object_F As ADODB.Field
        Dim w_blnPopFlg As Boolean

        Dim w_blnPopupDeleteV As Boolean
        Dim w_blnPopupDeleteE As Boolean
        Dim w_blnPopupPersonalTitleV As Boolean
        Dim w_blnPopupPersonalTitleE As Boolean
        Dim w_blnPopupPersonalPrintV As Boolean
        Dim w_blnPopupPersonalPrintE As Boolean
        Dim w_blnPopupPersonalPreviewV As Boolean
        Dim w_blnPopupPersonalPreviewE As Boolean
        Dim w_blnPopupOverTitleV As Boolean
        Dim w_blnPopupOverTitleE As Boolean
        Dim w_blnPopupOverPrintV As Boolean
        Dim w_blnPopupOverPrintE As Boolean
        Dim w_blnPopupOverPreviewV As Boolean
        Dim w_blnPopupOverPreviewE As Boolean
        Dim w_strPrintName As String = "個人カード"

        fncPopUpMenu_MouseUp = False
        Try

            '右クリック押下で開くコンテキストメニューの削除
            SelectObject.ContextMenu = Nothing

            If Button = MouseButtons.Left Then
                '左ﾎﾞﾀﾝの場合、処理抜け出し
                Exit Function
            End If

            'ListViewｺﾝﾄﾛｰﾙからﾏｳｽﾎﾟｲﾝﾀｰがはみ出ていたらﾎﾟｯﾌﾟｱｯﾌﾟﾒﾆｭｰを表示しない
            If X < 0 OrElse Y < 0 Then
                Exit Function
            End If
            w_Width = SelectObject.Width
            w_Height = SelectObject.Height
            If X > w_Width OrElse Y > w_Height Then
                Exit Function
            End If

            '職員管理の場合のみ、削除可能
            If (M_STAFFIDO_RESCD).Equals(g_MenuM(g_lngGroupIdx).ListBarMenu(g_lngListIdx).strResCD) Then

                If "1".Equals(m_DisplayMode) Then
                Else
                    Exit Function
                End If

                w_blnPopupPersonalTitleV = True '個人カードタイトル
                w_blnPopupPersonalTitleE = True '個人カードタイトル
                w_blnPopupPersonalPrintV = True '個人カード印刷
                w_blnPopupPersonalPrintE = True '個人カード印刷
                w_blnPopupPersonalPreviewV = True '個人カードプレビュー
                w_blnPopupPersonalPreviewE = True '個人カードプレビュー

                '削除使用判定
                If m_blnStaffDeleteFlg = True Then
                    w_blnPopupDeleteV = True '削除
                    w_blnPopupDeleteE = True '削除
                Else
                    w_blnPopupDeleteV = False '削除
                    w_blnPopupDeleteE = False '削除
                End If
                w_blnPopupOverTitleV = False '時間外タイトル
                w_blnPopupOverTitleE = False '時間外タイトル
                w_blnPopupOverPrintV = False '時間外印刷
                w_blnPopupOverPrintE = False '時間外印刷
                w_blnPopupOverPreviewV = False '時間外プレビュー
                w_blnPopupOverPreviewE = False '時間外プレビュー

                w_strPrint = W_PERSONAL

                '時間外の場合
            ElseIf (M_OVERKINMU_RESCD).Equals(g_MenuM(g_lngGroupIdx).ListBarMenu(g_lngListIdx).strResCD) Then

                w_blnPopupOverTitleV = True '時間外タイトル
                w_blnPopupOverTitleE = True '時間外タイトル
                w_blnPopupOverPrintV = True '時間外印刷
                w_blnPopupOverPrintE = True '時間外印刷
                w_blnPopupOverPreviewV = True '時間外プレビュー
                w_blnPopupOverPreviewE = True '時間外プレビュー
                w_blnPopupDeleteV = False '削除
                w_blnPopupDeleteE = False '削除
                w_blnPopupPersonalTitleV = False '個人カードタイトル
                w_blnPopupPersonalTitleE = False '個人カードタイトル
                w_blnPopupPersonalPrintV = False '個人カード印刷
                w_blnPopupPersonalPrintE = False '個人カード印刷
                w_blnPopupPersonalPreviewV = False '個人カードプレビュー
                w_blnPopupPersonalPreviewE = False '個人カードプレビュー

                w_strPrint = W_OVER

            Else
                Exit Function
            End If

            'オブジェクトタイプ別、判定
            w_blnFLG = False
            If ObjectType = M_LISTVIEW Then
                If SelectObject.Items.count <= 0 Then
                Else
                    w_blnFLG = True
                End If
            ElseIf ObjectType = M_SPREAD Then
                If String.IsNullOrEmpty(m_strSelHaichiStaffMngID) Then
                Else
                    w_blnFLG = True
                End If
            End If


            If w_blnFLG = False Then

                Exit Function
            Else
                '職員一覧に職員がいる場合

            End If

            w_blnPopFlg = False

            '帳票データ取得
            w_strSql = ""
            w_strSql = w_strSql & " SELECT PRINTNAME , RESOURCECD , OBJECTNAME"
            w_strSql = w_strSql & " FROM NS_PRINTNAME_M "
            w_strSql = w_strSql & " WHERE HOSPITALCD = '" & General.g_strHospitalCD & "' "
            w_strSql = w_strSql & " AND STARTEXE     = 'NSC0000H' "
            w_strSql = w_strSql & " AND GROUPCD      = '" & General.g_strUserGroupCD & "' "
            w_strSql = w_strSql & " AND PRINTID      = '" & w_strPrint & "' "
            w_strSql = w_strSql & " ORDER BY DISPNO "
            w_Rs = General.paDBRecordSetOpen(w_strSql)

            If w_Rs.RecordCount = 0 Then
                '帳票ﾏｽﾀが設定されていない場合

                If (W_OVER).Equals(w_strPrint) Then
                    '時間外はコンテキストメニュー非表示
                    Exit Function

                Else
                    w_blnPopupPersonalTitleE = False '個人カードタイトル
                    w_blnPopupPersonalPrintE = False '個人カード印刷
                    w_blnPopupPersonalPreviewE = False '個人カードプレビュー

                    If w_blnPopupDeleteE = False Then
                        w_blnPopFlg = False
                    Else
                        w_blnPopFlg = True
                    End If

                End If
            Else
                '帳票ﾏｽﾀに設定されていた場合
                With w_Rs
                    .MoveLast()
                    w_Count = .RecordCount
                    .MoveFirst()

                    'ﾌｨｰﾙﾄﾞ定義
                    w_Res_F = .Fields("RESOURCECD")
                    w_Name_F = .Fields("PRINTNAME")
                    w_Object_F = .Fields("OBJECTNAME")

                    m_strPrintData.PrintResCD = General.paGetDbFieldVal(w_Res_F, "")
                    m_strPrintData.PrintName = General.paGetDbFieldVal(w_Name_F, "")
                    m_strPrintData.PrintObject = General.paGetDbFieldVal(w_Object_F, "")
                    w_strPrintName = m_strPrintData.PrintName
                    w_blnPopFlg = True

                End With
            End If

            If w_blnPopFlg = False Then
                Exit Function
            Else
                m_lngSelectListIndex = lvwDeptInfo.Items.Item(lvwDeptInfo.FocusedItem.Index).Tag

                m_strSelectStaffMngID = Trim(m_udtStaffData(m_lngSelectListIndex).strStaffMngID)

                If Button = MouseButtons.Right Then
                    '右ﾎﾞﾀﾝならﾎﾟｯﾌﾟｱｯﾌﾟ表示
                    '追加
                    Dim w_objConTxtMenu As New ContextMenu()
                    Dim w_objMenuItem As New MenuItem

                    '削除
                    If w_blnPopupDeleteV = True Then
                        w_objMenuItem.Text = "削除"
                        w_objMenuItem.Name = M_POPUP_DELETE
                        w_objMenuItem.Enabled = w_blnPopupDeleteE
                        w_objConTxtMenu.MenuItems.Add(w_objMenuItem)
                        AddHandler w_objMenuItem.Click, AddressOf mnuToroku_Click
                    End If
                    '超過勤務命令簿兼報告書
                    If w_blnPopupOverTitleV = True Then
                        w_objMenuItem.Text = w_strPrintName
                        w_objMenuItem.Name = M_POPUP_OVERTITLE
                        w_objMenuItem.Enabled = w_blnPopupOverTitleE
                        w_objConTxtMenu.MenuItems.Add(w_objMenuItem)
                        AddHandler w_objMenuItem.Click, AddressOf mnuToroku_Click
                    End If
                    '印刷
                    If w_blnPopupOverPrintV = True Then
                        w_objMenuItem = New MenuItem
                        w_objMenuItem.Text = "○印刷"
                        w_objMenuItem.Name = M_POPUP_OVERPRINT
                        w_objMenuItem.Enabled = w_blnPopupOverPrintE
                        w_objConTxtMenu.MenuItems.Add(w_objMenuItem)
                        AddHandler w_objMenuItem.Click, AddressOf mnuToroku_Click
                    End If
                    'プレビュー
                    If w_blnPopupOverPreviewV = True Then
                        w_objMenuItem = New MenuItem
                        w_objMenuItem.Text = "○プレビュー"
                        w_objMenuItem.Name = M_POPUP_OVERPREVIEW
                        w_objMenuItem.Enabled = w_blnPopupOverPreviewE
                        w_objConTxtMenu.MenuItems.Add(w_objMenuItem)
                        AddHandler w_objMenuItem.Click, AddressOf mnuToroku_Click
                    End If
                    '個人カード
                    If w_blnPopupPersonalTitleV = True Then
                        w_objMenuItem = New MenuItem
                        w_objMenuItem.Text = w_strPrintName
                        w_objMenuItem.Name = M_POPUP_PERSONALTITLE
                        w_objMenuItem.Enabled = w_blnPopupPersonalTitleE
                        w_objConTxtMenu.MenuItems.Add(w_objMenuItem)
                        AddHandler w_objMenuItem.Click, AddressOf mnuToroku_Click
                    End If
                    '削除
                    If w_blnPopupPersonalPrintV = True Then
                        w_objMenuItem = New MenuItem
                        w_objMenuItem.Text = "○印刷"
                        w_objMenuItem.Name = M_POPUP_PERSONALPRINT
                        w_objMenuItem.Enabled = w_blnPopupPersonalPrintE
                        w_objConTxtMenu.MenuItems.Add(w_objMenuItem)
                        AddHandler w_objMenuItem.Click, AddressOf mnuToroku_Click
                    End If
                    'プレビュー
                    If w_blnPopupPersonalPreviewV = True Then
                        w_objMenuItem = New MenuItem
                        w_objMenuItem.Text = "○プレビュー"
                        w_objMenuItem.Name = M_POPUP_PERSONALPREVIEW
                        w_objMenuItem.Enabled = w_blnPopupPersonalPreviewE
                        w_objConTxtMenu.MenuItems.Add(w_objMenuItem)
                        AddHandler w_objMenuItem.Click, AddressOf mnuToroku_Click
                    End If

                    SelectObject.ContextMenu = w_objConTxtMenu

                End If
            End If

            fncPopUpMenu_MouseUp = True

        Catch ex As Exception
            Call General.paTrpMsg(Convert.ToString(Err.Number), W_SUBNAME)
        End Try
    End Function

    '印刷指示ﾒﾆｭｰ 表示
    Private Sub RunPrint()
        Const W_SUBNAME As String = "NSC0000HA RunPrint"

        Try
            Dim w_clsObj As Object

            'ｸﾗｽｵﾌﾞｼﾞｪｸﾄを生成
            w_clsObj = New NsAid_NSC0010H.clsNSC0010H

            'ﾌﾟﾛﾊﾟﾃｨ設定
            With w_clsObj
                'Inatalltype渡し
                .pInstallType = General.g_InstallType
                .pHospitalInfo(General.g_strHospitalCD) = General.g_strHospitalNm
                .pUserInfo(General.g_strUserID, General.g_strUserMngID) = General.g_strUserName
                .pUserGroupCD = General.g_strUserGroupCD
                .pSelectDate = General.paGetDateStringFromDate(m_CalDate, General.G_DATE_ENUM.yyyyMMdd)
                .pAccessModule = "NSC0000H"
                .pGetDataObj = General.g_objGetData
                .pSelectDateObj = General.g_objSelectDate
                .pGetMasterObj = General.g_objGetMaster
                .pSecurityObj = General.g_objSecurity
                .pSelectStaffObj = General.g_objSelectStaff
                .pIdoDataObj = General.g_objIdoData
                .pSelectDeptObj = General.g_objSelectDept
                .pSyouninDataObj = General.g_objSyouninData
                .pComCyokinObj = General.g_objComCyokin
                .pDutyGroupObj = General.g_objDutyGroup

                .pProcessObj = Me
                '共通情報ﾏｽﾀ画面表示
                .mShowWindow()
            End With

            w_clsObj = Nothing

        Catch ex As Exception
            Call General.paTrpMsg(Convert.ToString(Err.Number), W_SUBNAME)
        End Try
    End Sub

    ''' <summary>
    ''' カレンダー再描画時処理。
    ''' </summary>
    ''' <param name="sender"></param>
    ''' <param name="e"></param>
    Private Sub Calendar_Paint(ByVal sender As Object, ByVal e As System.Windows.Forms.PaintEventArgs)
        '選択している日付ラベルの線を変更
        AidGeneral.paLabel_BorderLinePaint(sender, e)
    End Sub

    Private Sub lvwDeptInfo_MouseMove(ByVal sender As System.Object, ByVal e As System.Windows.Forms.MouseEventArgs) Handles lvwDeptInfo.MouseMove
        If lvwDeptInfo.CheckBoxes = True Then
            m_objMouseMovePoint = e.Location
        End If
    End Sub

    Private Sub lvwDeptInfo_MouseDown(ByVal sender As System.Object, ByVal e As System.Windows.Forms.MouseEventArgs) Handles lvwDeptInfo.MouseDown
        If lvwDeptInfo.CheckBoxes = True Then
            m_blnCheckedChangedFlg = True
        End If
    End Sub

    Private Sub lvwDeptInfo_ItemChecked(ByVal sender As System.Object, ByVal e As System.Windows.Forms.ItemCheckedEventArgs) Handles lvwDeptInfo.ItemChecked
        Const W_SUBNAME As String = "NSC0000HA lvwDeptInfo_ItemChecked"

        Try
            If m_blnCheckedChangedFlg = True Then
                m_blnCheckedChangedFlg = False
                If lvwDeptInfo.CheckBoxes = True Then
                    If IsNothing(lvwDeptInfo.FocusedItem) = False Then
                        If m_objMouseMovePoint.X > 19 Then
                            If lvwDeptInfo.FocusedItem.Checked = True Then
                                lvwDeptInfo.FocusedItem.Checked = False
                            Else
                                lvwDeptInfo.FocusedItem.Checked = True
                            End If
                        End If
                    End If
                End If
            End If
        Catch ex As Exception
            Call General.paTrpMsg(Convert.ToString(Err.Number), W_SUBNAME)
        End Try

    End Sub


    Private Sub lvwMain_MouseMove(ByVal sender As System.Object, ByVal e As System.Windows.Forms.MouseEventArgs) Handles lvwMain.MouseMove
        If lvwMain.CheckBoxes = True Then
            m_objMouseMovePoint = e.Location
        End If
    End Sub

    Private Sub lvwMain_MouseDown(ByVal sender As System.Object, ByVal e As System.Windows.Forms.MouseEventArgs) Handles lvwMain.MouseDown
        If lvwMain.CheckBoxes = True Then
            m_blnCheckedChangedFlg = True
        End If
    End Sub

    Private Sub lvwMain_ItemChecked(ByVal sender As System.Object, ByVal e As System.Windows.Forms.ItemCheckedEventArgs) Handles lvwMain.ItemChecked
        Const W_SUBNAME As String = "NSC0000HA lvwMain_ItemChecked"

        Try
            If m_blnCheckedChangedFlg = True Then
                m_blnCheckedChangedFlg = False
                If lvwMain.CheckBoxes = True Then
                    If IsNothing(lvwMain.FocusedItem) = False Then
                        If m_objMouseMovePoint.X > 17 Then
                            If lvwMain.FocusedItem.Checked = True Then
                                lvwMain.FocusedItem.Checked = False
                            Else
                                lvwMain.FocusedItem.Checked = True
                            End If
                        End If
                    End If
                End If
            End If
        Catch ex As Exception
            Call General.paTrpMsg(Convert.ToString(Err.Number), W_SUBNAME)
        End Try

    End Sub
    Private Sub cmbSelectAppl_SelectedIndexChanged(ByVal sender As System.Object, ByVal e As System.EventArgs) Handles cmbSelectAppl.SelectedIndexChanged

        Const W_SUBNAME As String = "NSC0000HA cmbSelectAppl_SelectedIndexChanged"

        Try

            '未承認以外は処理を抜ける
            If g_MenuM(g_lngGroupIdx).ListBarMenu(g_lngListIdx).strResCD <> M_APPROVE_RESCD Then
                Exit Sub
            End If

            If m_strDispApplCD <> g_ApplMaster(cmbSelectAppl.SelectedIndex).strCD Then
                '未承認一覧
                Call sList_ApproveInfo()
            End If

            m_strDispApplCD = g_ApplMaster(cmbSelectAppl.SelectedIndex).strCD

        Catch ex As Exception
            Call General.paTrpMsg(Convert.ToString(Err.Number), W_SUBNAME)
        End Try

    End Sub

    Private Sub cmdAllCheck_Click(ByVal sender As System.Object, ByVal e As System.EventArgs) Handles cmdAllCheck.Click
        Dim w_numLvwDeptInfoCount As Integer = lvwDeptInfo.Items.Count

        If w_numLvwDeptInfoCount > 0 Then
            For i As Integer = 0 To w_numLvwDeptInfoCount - 1
                '※一度目のCheckedでTrueにならない場合があるため、2回処理を行う
                lvwDeptInfo.Items.Item(i).Checked = True
                lvwDeptInfo.Items.Item(i).Checked = True
            Next
        End If
    End Sub

    Private Sub cmdAllClear_Click(ByVal sender As System.Object, ByVal e As System.EventArgs) Handles cmdAllClear.Click
        Dim w_numLvwDeptInfoCount As Integer = lvwDeptInfo.Items.Count

        If w_numLvwDeptInfoCount > 0 Then
            For i As Integer = 0 To w_numLvwDeptInfoCount - 1
                '※一度目のCheckedでFalseにならない場合があるため、2回処理を行う
                lvwDeptInfo.Items.Item(i).Checked = False
                lvwDeptInfo.Items.Item(i).Checked = False
            Next
        End If
    End Sub

    ''' <summary>
    ''' カレンダ部年月選択ボタン描画処理
    ''' </summary>
    ''' <param name="sender"></param>
    ''' <param name="e"></param>
    ''' <remarks></remarks>
    Private Sub cmdSelMonth_Paint(ByVal sender As System.Object, ByVal e As System.Windows.Forms.PaintEventArgs) Handles cmdSelMonth.Paint
        Dim g As Graphics = e.Graphics

        ControlPaint.DrawBorder3D(g, sender.ClientRectangle, Border3DStyle.Etched)

    End Sub

    Private Sub lvwInformation_DoubleClick(ByVal sender As System.Object, ByVal e As System.EventArgs) Handles lvwInformation.DoubleClick
        Const W_SUBNAME As String = "NSC0000HA lvwInformation_DblClick"
        Dim w_clsObj As Object
        Dim w_str As String
        Dim w_numFocusIndex As Integer

        Try

            If UBound(m_udtInformation) <= 0 Then
                Exit Sub
            End If

            w_numFocusIndex = lvwInformation.FocusedItem.Index
            If String.IsNullOrEmpty(lvwInformation.FocusedItem.Name) Then
                Exit Sub
            End If

            If g_intUseNAVIFlg = 1 Then
                'NAVI有りの場合
                w_str = "1" & ":"
                w_str = w_str & General.g_strHospitalCD & ":"
                w_str = w_str & General.g_strUserID & ":"
                w_str = w_str & m_udtInformation(w_numFocusIndex + 1).strSEQ

                'ナースナビ起動スクリプトファイル呼び出し
                Call Shell("cscript " & System.IO.Path.GetDirectoryName(System.Reflection.Assembly.GetExecutingAssembly().Location) _
                    & "\NurseNAVIInfo.wsf " & w_str)

            Else

                w_clsObj = New NsAid_NSC0130H.clsNSC0130H

                With w_clsObj

                    .pDateInfo = Convert.ToString(m_udtInformation(w_numFocusIndex + 1).intDate \ 100)
                    .pHospitalInfo = General.g_strHospitalCD '施設情報
                    .pInstallType = General.g_InstallType 'インストールタイプ
                    .pSelectDateObj = General.g_objSelectDate 'カレンダー部品
                    .pUniqueSeq = m_udtInformation(w_numFocusIndex + 1).strSEQ

                    '更新権限がある場合
                    If m_InformationUpdKbn = "0" Then
                        .pUpdMode = "1"
                        'ない場合
                    Else
                        .pUpdMode = "2"
                    End If

                    .pUserInfo = General.g_strUserID '利用者情報

                    .pProcessObj = Me
                    .mShowWindow()

                    If .pEndStatus = True Then
                        If g_intUseNAVIFlg = 1 Then
                        Else
                            Call sGetInformation()
                            lvwInformation.Visible = True
                        End If
                    End If

                End With
            End If

        Catch ex As Exception
            Call General.paTrpMsg(Convert.ToString(Err.Number), W_SUBNAME)
        End Try

    End Sub
    '**********************************************************************
    '*  関数名      : startApprvRuike
    '*  概要        : 配列に格納されている文字列をファイルへ書き出し
    '*                時間外届出累計バッチを起動する。
    '*
    '*  @param      : p_tmp         配列（文字列）
    '*              : p_Date        対象日
    '**********************************************************************
    Private Sub startApprvRuike(ByRef p_tmp() As String, ByVal p_Date As String)
        Dim W_SUBNAME As String = "NSC0000HA startApprvRuike"

        Const WC_FOLDR_NAME As String = "TmpNSW0300B"
        Const WC_EXTEN As String = ".txt"

        Dim w_freeFile As Short
        Dim w_Path As String
        Dim w_fileNm As String
        Dim w_tmpFileNm As String
        Dim w_i As Integer

        Try
            'Exe Pathの取得
            w_Path = General.paGetIniSetting(General.G_STRININAME, General.G_STRSECTION1, "ExePath", "")
            w_Path = w_Path & WC_FOLDR_NAME
            w_fileNm = "0"

            If Dir(w_Path, FileAttribute.Directory) = "" Then
                Call MkDir(w_Path)
            End If

            '最初のファイル名取得
            w_tmpFileNm = Dir(w_Path & "\")
            'ファイル名を格納
            Do While w_tmpFileNm <> ""
                '拡張子を消去
                w_tmpFileNm = Replace(w_tmpFileNm, WC_EXTEN, "")
                If IsNumeric(w_tmpFileNm) Then
                    '連番で生成するため大小比較
                    If Double.Parse(w_fileNm) < Double.Parse(w_tmpFileNm) Then
                        w_fileNm = w_tmpFileNm
                    End If
                End If
                '次のファイルを取得
                w_tmpFileNm = Dir()
            Loop
            '最大値に＋1してファイル生成
            w_fileNm = Convert.ToString(Double.Parse(w_fileNm) + 1)
            w_fileNm = w_fileNm & WC_EXTEN

            'テキストファイルに書き込む
            w_freeFile = FreeFile()
            FileOpen(w_freeFile, w_Path & "\" & w_fileNm, OpenMode.Append)
            For w_i = 1 To UBound(p_tmp)
                PrintLine(w_freeFile, p_tmp(w_i))
            Next w_i
            FileClose(w_freeFile)

            '時間外届出累計バッチ起動（フォーム表示有り、ファイル起動）
            Call runOvKinmApprvRukei("1", "3", General.g_strHospitalCD, p_Date, General.g_strUserID, w_fileNm)

        Catch ex As Exception
            Call General.paTrpMsg(Convert.ToString(Err.Number), W_SUBNAME)
        End Try
    End Sub

    '**********************************************************************
    '*  関数名      : runOvKinmApprvRukei
    '*  概要        : 時間外届出累計バッチを起動する。
    '*
    '*  @param      : p_disp        フォーム表示フラグ（0：しない、1：する）
    '*              : p_Flg         起動フラグ（0：全体、1：個人、2部署：、3：ファイル）
    '*              : p_hospCd      病院コード
    '*              : p_Date        処理年月
    '*              : p_id          更新者ID
    '*              : p_Code        対象（対象者、部署、ファイル）
    '*              : p_with        同期を取る（EXE処理待ち）かどうか（True：とる、False：取らない）
    '**********************************************************************
    Private Sub runOvKinmApprvRukei(ByVal p_disp As String, ByVal p_Flg As String, ByVal p_hospCd As String, ByVal p_Date As String, ByVal p_id As String, ByVal p_Code As String, Optional ByRef p_with As Boolean = False)
        Dim W_SUBNAME As String = "NSC0000HA runOvKinmApprvRukei"

        Const W_300B As String = "NSW0300B"
        Dim w_strCmdLine As String
        Dim w_strExePath As String
        Dim lngProcessId As Integer
        Dim lngProcessHandle As Integer
        Dim lngWin32apiResultCode As Integer
        Dim lngProcessExitCode As Integer

        Try
            'コマンドライン引数設定
            w_strCmdLine = p_disp '画面表示
            w_strCmdLine = w_strCmdLine & "," & p_Flg 'フラグ（ファイル）
            w_strCmdLine = w_strCmdLine & "," & p_hospCd '病院コード
            w_strCmdLine = w_strCmdLine & "," & p_Date '処理年月
            w_strCmdLine = w_strCmdLine & "," & p_id '更新者ID
            w_strCmdLine = w_strCmdLine & "," & p_Code 'ファイル名
            'Exe Pathの取得
            w_strExePath = General.paGetIniSetting(General.G_STRININAME, General.G_STRSECTION1, "ExePath", "")

            'EXE起動
            If p_with = True Then
                '同期を取る（処理待ちをする）
                lngProcessId = Shell(w_strExePath & W_300B & " " & w_strCmdLine, AppWinStyle.NormalFocus)
                ' プロセスオブジェクトのハンドルを取得
                lngProcessHandle = OpenProcess(PROCESS_QUERY_INFORMATION, False, lngProcessId)
                ' 新しいプロセスを作成できたときは
                If lngProcessHandle <> 0 Then
                    Do
                        'プロセスの終了状態を取得
                        lngWin32apiResultCode = GetExitCodeProcess(lngProcessHandle, lngProcessExitCode)
                        'オペレーティングシステムに制御を渡す
                        System.Windows.Forms.Application.DoEvents()
                        'プロセスが終了していない間は
                    Loop While lngProcessExitCode = STILL_ACTIVE
                End If
                'プロセスオブジェクトのハンドルをクローズ
                lngWin32apiResultCode = CloseHandle(lngProcessHandle)
            Else
                '非同期
                Call Shell(w_strExePath & W_300B & " " & w_strCmdLine, AppWinStyle.NormalFocus)
            End If

            System.Windows.Forms.Application.DoEvents()
        Catch ex As Exception
            Call General.paTrpMsg(Convert.ToString(Err.Number), W_SUBNAME)
        End Try
    End Sub

    '**********************************************************************
    '*  関数名      : judgeOvKinmDate
    '*  概要        : 超勤日計上のとき、月末時点なら翌月を返す。
    '*
    '*  @param      : p_date        yyyymmdd型の日付
    '**********************************************************************
    Private Function judgeOvKinmDate(ByVal p_Date As Integer) As Integer
        Dim W_SUBNAME As String = "NSC0000HA judgeOvKinmDate"

        Dim w_judgeDate As String
        Dim w_date As Date
        Try

            judgeOvKinmDate = Integer.Parse(General.paLeftB(Convert.ToString(p_Date), 6))

            '計上日取得
            w_judgeDate = General.paGetItemValue(General.G_STRMAINKEY3, General.G_STRSUBKEY1, "DATEJUDGMENT", "0", General.g_strHospitalCD)

            w_date = General.DateUtil.paGetDateFromDateInteger(p_Date)

            If w_judgeDate = "1" And General.paRight(General.DateUtil.paGetDateStringFromDate(DateAdd(Microsoft.VisualBasic.DateInterval.Day, 1, w_date), General.G_DATE_ENUM.yyyyMMdd), 2) = "01" Then
                judgeOvKinmDate = General.DateUtil.paGetDateIntegerFromDate(DateAdd(Microsoft.VisualBasic.DateInterval.Month, 1, w_date), General.G_DATE_ENUM.yyyyMM)
            End If

        Catch ex As Exception
            Call General.paTrpMsg(Convert.ToString(Err.Number), W_SUBNAME)
        End Try
    End Function

    Private Sub cmbStatus_SelectedIndexChanged(ByVal sender As System.Object, ByVal e As System.EventArgs) Handles cmbStatus.SelectedIndexChanged
        Const W_SUBNAME As String = "NSC0000HA cmbStatus_Click"

        Try
            If m_strDispApplCD <> g_ApplMaster(cmbStatus.SelectedIndex).strCD Then
                '届出状況
                Call sList_Personal()
            End If

            m_strDispApplCD = g_ApplMaster(cmbStatus.SelectedIndex).strCD
        Catch ex As Exception
            Call General.paTrpMsg(Convert.ToString(Err.Number), W_SUBNAME)
        End Try
    End Sub

    Private Sub lvwMain_DoubleClick(ByVal eventSender As System.Object, ByVal eventArgs As System.EventArgs) Handles lvwMain.DoubleClick
        Const W_SUBNAME As String = "frmNSC0000HA lvwMain_DblClick"

        Try

            If lvwMain.Items.Count <= 0 Then Exit Sub

            If lvwMain.CheckBoxes = False OrElse m_objMouseMovePoint.X > 17 Then

                m_ListView_Main = m_ListView_Main + 1
                If m_ListView_Main <> 1 Then
                    Exit Sub
                End If

                If g_MenuM(g_lngGroupIdx).ListBarMenu(g_lngListIdx).strResCD = M_STAFFIDO_RESCD Then

                    If toolStrip.Items.Item(G_ToolBar_DataUpd).Enabled = True Then
                        '該当処理なし
                    End If
                    '本人
                ElseIf g_MenuM(g_lngGroupIdx).ListBarMenu(g_lngListIdx).strResCD = M_PERSONAL_RESCD Then
                    '実績状況が表示されている時
                    If m_strSelChildMenu = M_PER_JISSEKI_DSP Then
                        Call subMenuMainSetData(M_PER_JISSEKI_CHG)
                        '届出状況が表示されている時
                    ElseIf m_strSelChildMenu = M_PER_APPLI_DSP Then
                        Call subMenuMainSetData(M_PER_APPLI_CHG)
                    End If
                    '部署
                ElseIf g_MenuM(g_lngGroupIdx).ListBarMenu(g_lngListIdx).strResCD = M_DEPT_RESCD Then
                    '勤務状況が表示されている時
                    If m_strSelChildMenu = M_DEPT_KINMUINFO Then
                        Call subMenuMainSetData(M_PER_JISSEKI_CHG)
                    End If
                    '未承認
                ElseIf g_MenuM(g_lngGroupIdx).ListBarMenu(g_lngListIdx).strResCD = M_APPROVE_RESCD Then
                    '未承認or全表示が表示されている時
                    If m_strSelChildMenu = M_APPRO_DSP Or m_strSelChildMenu = M_APPRO_DSP Then
                        Call subMenuMainSetData(M_APPRO_APPLI_CHG)
                    End If
                    '出退勤
                ElseIf g_MenuM(g_lngGroupIdx).ListBarMenu(g_lngListIdx).strResCD = M_DAKOKU_RESCD Then
                    '出退勤状況表示orエラー表示が表示されている時
                    If m_strSelChildMenu = M_DAKOKU_DSP Or m_strSelChildMenu = M_DAKOKU_ERROR_DSP Then
                        Call subMenuMainSetData(M_DAKOKU_JISSEKI_DSP)
                    End If
                    '日当直
                ElseIf g_MenuM(g_lngGroupIdx).ListBarMenu(g_lngListIdx).strResCD = M_DUTY_RESCD Then
                    'ダブルクリック対応なし
                    '在院照会
                ElseIf g_MenuM(g_lngGroupIdx).ListBarMenu(g_lngListIdx).strResCD = M_ZAIIN_RESCD Then
                    'ダブルクリック対応なし
                    '時間外
                ElseIf g_MenuM(g_lngGroupIdx).ListBarMenu(g_lngListIdx).strResCD = M_OVERKINMU_RESCD Then
                    '勤務状況が表示されている時
                    If m_strOverKinmuDispType = M_STR_PERSONAL Then
                        Call subMenuMainSetData(M_APPRO_DAY_OVER_JISSEKI_CHG)
                    End If
                End If

                m_ListView_Main = 0
            End If

        Catch ex As Exception
            Call General.paTrpMsg(Convert.ToString(Err.Number), W_SUBNAME)
        End Try
    End Sub

    ''' <summary>
    ''' 時間外データ取得時、対象となるデータの存在チェック
    ''' </summary>
    ''' <returns></returns>
    ''' <remarks>
    ''' TreeViewのマーク（計画確定の有無）で実績の存在を判定している。
    ''' 計画確定のマーク用の文字を部署名称に使っている場合、判定が正常に行われない（処理が遅くなるだけで出力結果に差異は発生しない）
    ''' </remarks>
    Private Function fncChkJissekiExist()
        Dim w_result As Boolean = False

        If m_udtStaffData.Length > 1 Then
            If tvwKinmuDept.SelectedNode.Text.Contains(m_StarMark) Then
                w_result = False
            Else
                w_result = True
            End If
        End If
        Return w_result
    End Function

    Public Sub mnuToroku_Click(ByVal eventSender As System.Object, ByVal eventArgs As System.EventArgs)
        Dim Index As Integer = Integer.Parse(General.paRight(eventSender.Name, 1))

        Const W_SUBNAME As String = "NSC0000HA mnuToroku_Click"

        Try
            Select Case Index
                Case M_POPUP_DELETE '削除

                    '削除処理
                    Call Run_Delete()

                Case M_POPUP_OVERTITLE '時間外タイトル
                    '処理しない

                Case M_POPUP_OVERPRINT '時間外印刷
                    Call Print_PersonalInf(M_POPUP_OVERPRINT)

                Case M_POPUP_OVERPREVIEW '時間外プレビュー
                    Call Print_PersonalInf(M_POPUP_OVERPREVIEW)

                Case M_POPUP_PERSONALTITLE '個人カードタイトル
                    '処理しない

                Case M_POPUP_PERSONALPRINT '個人カード印刷
                    Call Print_PersonalInf(M_POPUP_PERSONALPRINT)

                Case M_POPUP_PERSONALPREVIEW '個人カードプレビュー
                    Call Print_PersonalInf(M_POPUP_PERSONALPREVIEW)

                Case Else 'その他

            End Select
        Catch ex As Exception
            Call General.paTrpMsg(Convert.ToString(Err.Number), W_SUBNAME)
        End Try
    End Sub

    Public Sub Run_Delete()
        Const W_SUBNAME As String = "NSC0000HA Run_Delete"

        Dim w_TableName() As String
        Dim w_i As Short
        Dim w_Sql As String
        Dim w_RtnMsg As Short
        Dim w_strDeleteStaffMngID As String
        Dim w_strDeleteStaffName As String
        Dim w_lngDeptLoop As Integer
        Dim w_lngDeptCnt As Integer
        Dim w_lngHaichiLoop As Integer
        Dim w_lngHaichiCnt As Integer

        Dim w_strMsg() As String

        Dim w_UseNaviFlg As String

        '職員管理番号がキーになっているテーブル
        '削除対象には◎をつけています
        'IF_NS_STAFFHISTORY_F               IFＮＳ職員歴Ｆ
        'NS_APPLIAPPROVE_F                  ＮＳ届出承認者Ｆ
        'NS_APPLI_F                         ＮＳ届出Ｆ
        'NS_DAIKYUMNG_F                     ＮＳ代休管理Ｆ
        'NS_DAKOKULOG_F                     ＮＳ打刻ログＦ
        'NS_DUTYGIDOINFO_F              ◎  ＮＳ日当直グループ異動情報Ｆ
        'NS_DUTY_F                          ＮＳ日当直Ｆ
        'NS_FAMILYINFO_F                ◎  ＮＳ家族情報Ｆ
        'NS_GENESCHHISINFO_F            ◎  ＮＳ一般学歴情報Ｆ
        'NS_IININFO_F                   ◎  ＮＳ委員情報Ｆ
        'NS_IMPORTWORK_F                    ＮＳインポートワークＦ
        'NS_JOBCAREERINFO_F             ◎  ＮＳ職歴情報Ｆ
        'NS_JOBIDOINFO_F                ◎  ＮＳ職種異動情報Ｆ
        'NS_KENMUINFO_F                 ◎  ＮＳ兼務情報Ｆ
        'NS_KINMUCHGHISTORY_F               ＮＳ勤務変更履歴Ｆ
        'NS_KINMUIDOINFO_F              ◎  ＮＳ勤務地異動情報Ｆ
        'NS_KINMUPLAN_F                     ＮＳ勤務予定Ｆ
        'NS_KINMURESULT_F                   ＮＳ勤務実績Ｆ
        'NS_LICENSEINFO_F               ◎  ＮＳ免許情報Ｆ
        'NS_LONGLEAVEINFO_F             ◎  ＮＳ長休情報Ｆ
        'NS_NENKYU_F                        ＮＳ年休Ｆ
        'NS_OUTPUTFILE_F                    ＮＳファイル出力Ｆ
        'NS_OVERKINMUADJUST_F               ＮＳ時間外調整Ｆ
        'NS_OVERKINMUDECISION_F             ＮＳ時間外確定Ｆ
        'NS_OVERKINMUDETAIL_F               ＮＳ時間外明細Ｆ
        'NS_OVERKINMU_F                     ＮＳ時間外Ｆ
        'NS_PERSONALKINMUCOND_F             ＮＳ個人別勤務条件Ｆ
        'NS_PERSONALKINMUCOND_F_WORK        ＮＳ個人別勤務条件Ｆ_work
        'NS_PERSONALPHOTO_F             ◎  ＮＳ個人写真Ｆ
        'NS_POSTIDOINFO_F               ◎  ＮＳ役職異動情報Ｆ
        'NS_QUALIFYINFO_F               ◎  ＮＳ資格情報Ｆ
        'NS_RUIKEITIME_F                    ＮＳ累計時間Ｆ
        'NS_SANKYUINFO_F                ◎  ＮＳ産休情報Ｆ
        'NS_SEARCH_F                        ＮＳ検索Ｆ
        'NS_SOCIETYINFO_F               ◎  ＮＳ協会情報Ｆ
        'NS_SPECSCHHISINFO_F            ◎  ＮＳ専門学歴情報Ｆ
        'NS_STAFFBASISINFO_F            ◎  ＮＳ職員基本情報Ｆ
        'NS_STAFFHISTORY_F                  ＮＳ職員歴Ｆ
        'NS_STAFFMNGHISTORY_F           ◎  ＮＳ職員履歴管理Ｆ
        'NS_STUDYAPPLI_F                ◎  ＮＳ研修申込Ｆ
        'NS_TOTALHOLIDAY_F                  ＮＳ休暇統計Ｆ
        'NS_USER_M                      ◎  ＮＳ利用者Ｍ
        'NS_VALUATIONCOMMENT_F          ◎  ＮＳ評価コメントF
        'NS_VALUATIONDETAIL_F           ◎  ＮＳ評価詳細Ｆ
        'NS_VALUATIONHIS_F              ◎  ＮＳ評価履歴Ｆ
        'NS_WARDIDOINFO_F               ◎  ＮＳ配属異動情報Ｆ

        '退職時の異動ﾃﾞｰﾀ対象ﾃｰﾌﾞﾙ名
        ''''''''''    w_TableName(1) = "WARDIDOINFO_F"
        ''''''''''    w_TableName(2) = "KINMUIDOINFO_F"
        ''''''''''    w_TableName(3) = "JOBIDOINFO_F"
        ''''''''''    w_TableName(4) = "POSTIDOINFO_F"
        ''''''''''    w_TableName(5) = "FAMILYINFO_F"
        ''''''''''    w_TableName(6) = "GENESCHHISINFO_F"
        ''''''''''    w_TableName(7) = "SPECSCHHISINFO_F"
        ''''''''''    w_TableName(8) = "JOBCAREERINFO_F"
        ''''''''''    w_TableName(9) = "IININFO_F"
        ''''''''''    w_TableName(10) = "WARDIDOINFO_F"
        ''''''''''    w_TableName(11) = "LICENSEINFO_F"
        ''''''''''    w_TableName(12) = "QUALIFYINFO_F"
        ''''''''''    w_TableName(13) = "KANGOSOCIETYINFO_F"
        ''''''''''    w_TableName(14) = "LONGLEAVEINFO_F"
        ''''''''''    w_TableName(15) = "SANKYUINFO_F"
        ''''''''''    w_TableName(16) = "STAFFBASISINFO_F"
        ''''''''''    w_TableName(17) = "PERSONALPHOTO_F"
        ''''''''''    w_TableName(18) = "HEALTHCONDHIS_F"
        ''''''''''    w_TableName(19) = "HBCHKHISINFO_F"
        ''''''''''    w_TableName(20) = "SALARYHISINFO_F"
        ''''''''''    w_TableName(21) = "STAFFMNGHISTORY_F"
        ''''''''''    w_TableName(22) = "STUDYAPPLI_F"

        Try
            w_UseNaviFlg = General.paGetItemValue(General.G_STRMAINKEY1, General.G_STRSUBKEY1, "USENAVIFLG", "", General.g_strHospitalCD)

            If w_UseNaviFlg = "1" Then
                ReDim w_TableName(28)
            Else
                ReDim w_TableName(25)
            End If

            w_TableName(1) = "DUTYGIDOINFO_F" 'ＮＳ日当直グループ異動情報Ｆ
            w_TableName(2) = "FAMILYINFO_F" 'ＮＳ家族情報Ｆ
            w_TableName(3) = "GENESCHHISINFO_F" 'ＮＳ一般学歴情報Ｆ
            w_TableName(4) = "IININFO_F" 'ＮＳ委員情報Ｆ
            w_TableName(5) = "JOBCAREERINFO_F" 'ＮＳ職歴情報Ｆ
            w_TableName(6) = "JOBIDOINFO_F" 'ＮＳ職種異動情報Ｆ
            w_TableName(7) = "KENMUINFO_F" 'ＮＳ兼務情報Ｆ
            w_TableName(8) = "KINMUIDOINFO_F" 'ＮＳ勤務地異動情報Ｆ
            w_TableName(9) = "LICENSEINFO_F" 'ＮＳ免許情報Ｆ
            w_TableName(10) = "LONGLEAVEINFO_F" 'ＮＳ長休情報Ｆ
            w_TableName(11) = "PERSONALPHOTO_F" 'ＮＳ個人写真Ｆ
            w_TableName(12) = "POSTIDOINFO_F" 'ＮＳ役職異動情報Ｆ
            w_TableName(13) = "QUALIFYINFO_F" 'ＮＳ資格情報Ｆ
            w_TableName(14) = "SANKYUINFO_F" 'ＮＳ産休情報Ｆ
            w_TableName(15) = "SOCIETYINFO_F" 'ＮＳ協会情報Ｆ
            w_TableName(16) = "SPECSCHHISINFO_F" 'ＮＳ専門学歴情報Ｆ
            w_TableName(17) = "STAFFBASISINFO_F" 'ＮＳ職員基本情報Ｆ
            w_TableName(18) = "STAFFMNGHISTORY_F" 'ＮＳ職員履歴管理Ｆ
            w_TableName(19) = "STUDYAPPLI_F" 'ＮＳ研修申込Ｆ
            w_TableName(20) = "USER_M" 'ＮＳ利用者Ｍ
            w_TableName(21) = "VALUATIONCOMMENT_F" 'ＮＳ評価コメントF
            w_TableName(22) = "VALUATIONDETAIL_F" 'ＮＳ評価詳細Ｆ
            w_TableName(23) = "VALUATIONHIS_F" 'ＮＳ評価履歴Ｆ
            w_TableName(24) = "WARDIDOINFO_F" 'ＮＳ配属異動情報Ｆ
            w_TableName(25) = "SAIKEIIDOINFO_F" 'ＮＳ再掲異動情報Ｆ

            If w_UseNaviFlg = "1" Then
                w_TableName(26) = "IDOSIMULATION_F"
                w_TableName(27) = "LADDERHISTINFO_F"
                w_TableName(28) = "INTRAVENOUSHISINFO_F"
            End If

            '部署選択の場合
            If m_strBusyoHaichi = M_DISP_BUSYO Then

                m_lngSelectListIndex = lvwDeptInfo.Items.Item(lvwDeptInfo.FocusedItem.Index).Tag

                m_strSelectStaffMngID = m_udtStaffData(m_lngSelectListIndex).strStaffMngID
                w_strDeleteStaffMngID = m_strSelectStaffMngID
                w_strDeleteStaffName = m_udtStaffData(m_lngSelectListIndex).strName

                'それ以外(配置表)の場合
            Else
                w_strDeleteStaffMngID = m_strSelHaichiStaffMngID
                w_lngDeptCnt = UBound(m_udtHaichiStaff)
                w_strDeleteStaffName = ""
                For w_lngDeptLoop = 1 To w_lngDeptCnt
                    w_lngHaichiCnt = UBound(m_udtHaichiStaff(w_lngDeptLoop).Staff)

                    For w_lngHaichiLoop = 1 To w_lngHaichiCnt
                        If m_udtHaichiStaff(w_lngDeptLoop).Staff(w_lngHaichiLoop).strStaffMngID = m_strSelHaichiStaffMngID Then
                            w_strDeleteStaffName = m_udtHaichiStaff(w_lngDeptLoop).Staff(w_lngHaichiLoop).strStaffName

                            Exit For
                        End If
                    Next w_lngHaichiLoop
                    If w_strDeleteStaffName <> "" Then
                        Exit For
                    End If
                Next w_lngDeptLoop

            End If

            ReDim w_strMsg(1)
            w_strMsg(1) = w_strDeleteStaffName

            w_RtnMsg = General.paMsgDsp("NS0197", w_strMsg)

            '★削除の選択に対して再確認する★
            If w_RtnMsg = MsgBoxResult.Yes Then
                w_RtnMsg = General.paMsgDsp("NS0023", w_strMsg)
                If w_RtnMsg = 1 Then w_RtnMsg = vbYes
            End If

            If w_RtnMsg = MsgBoxResult.Yes Then
                '退職確定処理

                Me.Cursor = System.Windows.Forms.Cursors.WaitCursor

                'ﾄﾗﾝｻﾞｸｼｮﾝ開始
                Call General.paBeginTrans()

                '基本情報以外のﾃﾞｰﾀを異動
                For w_i = 1 To UBound(w_TableName)

                    '元ﾃﾞｰﾀ削除
                    w_Sql = "Delete From NS_" & w_TableName(w_i)
                    w_Sql = w_Sql & " WHERE StaffMngID = '" & w_strDeleteStaffMngID & "' "
                    w_Sql = w_Sql & " AND HospitalCD = '" & General.g_strHospitalCD & "' "
                    '更新SQL 実行
                    Call General.paDBExecute(w_Sql)

                Next w_i

                w_Sql = " DELETE FROM NS_USER_M"
                w_Sql = w_Sql & " WHERE StaffMngID = '" & w_strDeleteStaffMngID & "'"
                w_Sql = w_Sql & " AND HospitalCD = '" & General.g_strHospitalCD & "'"
                '更新SQL 実行
                Call General.paDBExecute(w_Sql)

                'ｺﾐｯﾄ
                Call General.paCommit()


                '部署選択の場合
                If m_strBusyoHaichi = M_DISP_BUSYO Then
                    Call tvwKinmuDept_NodeClick(tvwKinmuDept, New System.Windows.Forms.TreeViewEventArgs(tvwKinmuDept.Nodes.Find(m_strRefreshList, True)(0)))
                    'それ以外(配置表)の場合                     
                Else
                    Call subObjectVisibleFalse()

                    Call sList_HaichiInfo()

                End If

                Me.Cursor = System.Windows.Forms.Cursors.Default

            End If
        Catch ex As Exception
            Call General.paRollBack()
            Call General.paTrpMsg(Convert.ToString(Err.Number), W_SUBNAME)
        End Try
    End Sub

    Private Sub Print_PersonalInf(ByVal p_PopUpMenu As Short)
        Const W_SUBNAME As String = "Nssa000a Print_PersonalInf"

        Dim w_obj As Object
        Const W_OVER As String = "NSW0200P"
        Const W_PERSONAL As String = "NSS0010P"

        Dim w_objPro As Object

        Try
            Select Case p_PopUpMenu
                Case M_POPUP_OVERPRINT '時間外印刷

                    w_obj = New NsAid_NSW0200P.clsNSW0200P

                    w_obj.pListInfo(W_OVER) = m_strPrintData.PrintName
                    w_obj.pPreviewFlg = General.G_INTPRINTOUT

                    w_obj.pStaffInfo = Trim(m_udtStaffData(m_lngSelectListIndex).strStaffMngID)

                Case M_POPUP_OVERPREVIEW '時間外プレビュー

                    w_obj = New NsAid_NSW0200P.clsNSW0200P

                    w_obj.pListInfo(W_OVER) = m_strPrintData.PrintName
                    w_obj.pPreviewFlg = General.G_INTPREVIEWSAVE

                    w_obj.pStaffInfo = Trim(m_udtStaffData(m_lngSelectListIndex).strStaffMngID)

                Case M_POPUP_PERSONALPRINT '個人カード印刷

                    w_obj = New NsAid_NSS0010P.clsNSS0010P

                    w_obj.pListInfo(W_PERSONAL) = m_strPrintData.PrintName
                    w_obj.pPreviewFlg = General.G_INTPRINTOUT

                    w_obj.pSelStaffNo = Trim(m_udtStaffData(m_lngSelectListIndex).strStaffMngID)
                    w_obj.pRightClick = True

                Case M_POPUP_PERSONALPREVIEW '個人カードプレビュー

                    w_obj = New NsAid_NSS0010P.clsNSS0010P

                    w_obj.pListInfo(W_PERSONAL) = m_strPrintData.PrintName
                    w_obj.pPreviewFlg = General.G_INTPREVIEWSAVE

                    w_obj.pSelStaffNo = Trim(m_udtStaffData(m_lngSelectListIndex).strStaffMngID)
                    w_obj.pRightClick = True

                Case Else 'その他

            End Select

            '各ﾌﾟﾛﾊﾟﾃｨを設定する
            With w_obj

                'Inatalltype渡し
                .pDeptStatus(m_strPrintData.PrintResCD) = "0"
                .pProcessObj = Me ' w_objPro
                .pHospitalInfo(General.g_strHospitalCD) = General.g_strHospitalNm
                .pKangoTaniInfo(General.g_strSelKinmuDeptCD) = General.g_strSelKinmuDeptNm
                .pUserInfo(General.g_strUserID, General.g_strUserMngID) = General.g_strUserName
                .pAccessModule = "NSC0000H"

            End With

            '出力ﾒｿｯﾄﾞを呼び出す
            w_obj.Load_PrintOut()

            w_obj = Nothing
            w_objPro = Nothing

            System.Windows.Forms.Cursor.Current = System.Windows.Forms.Cursors.Default

        Catch ex As Exception
            System.Windows.Forms.Cursor.Current = System.Windows.Forms.Cursors.Default
            Call General.paTrpMsg(Convert.ToString(Err.Number), W_SUBNAME)
        End Try
    End Sub

    ''' <summary>
    ''' 並列処理用、超勤職員データ取得前初期化処理
    ''' </summary>
    ''' <param name="p_lngBeforeDay"></param>
    ''' <param name="p_lngStandardDate"></param>
    ''' <param name="p_strInit"></param>
    ''' <remarks></remarks>
    Private Sub subOverKinmuInit(ByVal p_lngBeforeDay As Integer, ByVal p_lngStandardDate As Integer, ByVal p_strInit As String)
        With General.g_objComCyokin
            .p日付区分 = 1
            .p開始年月日 = p_lngBeforeDay
            .p終了年月日 = p_lngStandardDate

            If "2".Equals(p_strInit) Then
                p_strInit = "2"
            Else
                p_strInit = "0"
            End If
            If .mOverKinmuInit(p_strInit) = False Then
                '.pStopFlg = True
            End If
        End With
    End Sub

    Private Sub subSetOtherSearch(ByVal tabIndex As Integer)
        Dim w_WarddeptFlg As String

        vseCover.Visible = True
        vseCover.Left = albMenu.Left
        vseCover.Width = Me.Width
        vseCover.Top = 97 'albMenu.Top
        vseCover.Height = albMenu.Height
        fraDataGet.Left = vseCover.Width / 3
        fraDataGet.Top = vseCover.Height / 3

        Call vseCover.BringToFront()
        System.Windows.Forms.Application.DoEvents()

        'リストビューを初期化（勤務部署以外は初期表示はリストビューに何も表示されない）
        lvwDeptInfo.Clear()
        Call sSetListView()

        '●マスタ取得
        Call sGetMasterInfo(tabIndex)

        '配属部署設定フラグ取得
        w_WarddeptFlg = General.paGetItemValue(General.G_STRMAINKEY1, General.G_STRSECTION1, "WORDDEPTFLG", "0", General.g_strHospitalCD)

        '勤務部署＝配属部署
        If "1".Equals(w_WarddeptFlg) Then
            Select Case tabIndex
                Case 1
                    '●役職マスタ取得
                    Call sGetMasterInfo(2)
                    '●役職ツリービュー 作成
                    Call sSetPostTreeView()

                Case 2
                    '●職種マスタ取得
                    Call sGetMasterInfo(3)
                    '●職種ツリービュー 作成
                    Call sSetJobTreeView()

            End Select
        Else
            Select Case tabIndex
                Case 1
                    '●配属部署マスタ取得
                    Call sGetMasterInfo(tabIndex)
                    '●配属部署ツリービュー 作成
                    Call sSetWardDeptTreeView()

                Case 2
                    '●役職マスタ取得
                    Call sGetMasterInfo(tabIndex)
                    '●役職ツリービュー 作成
                    Call sSetPostTreeView()

                Case 3
                    '●職種マスタ取得
                    Call sGetMasterInfo(tabIndex)
                    '●職種ツリービュー 作成
                    Call sSetJobTreeView()

            End Select
        End If

        '各Paneの高さと幅を設定
        Call sSetControl()

        vseCover.Visible = False
        Try

        Catch ex As Exception

        End Try
    End Sub

    Private Sub frmNSC0000HA_Load(ByVal sender As System.Object, ByVal e As System.EventArgs) Handles MyBase.Load
        vseCover.Visible = False
    End Sub

    ''' <summary>
    ''' 対象：部　日付変更処理 時間外選択時
    ''' </summary>
    ''' <remarks></remarks>
    Private Sub subSetlblSearchData_DayOver()
        Dim w_lngDate As Integer = General.paGetDateIntegerFromDate(m_DayOverSelectDate)
        Dim w_str As String
        w_str = "未確認"
        lblSearchData.ForeColor = System.Drawing.Color.Red

        m_blnOverKinmuLockFlg = False
        For i As Integer = 1 To UBound(m_udtOverKinmuLock)

            If m_udtOverKinmuLock(i).blnLockFlg = True AndAlso (m_strSelBusyoCD).Equals(m_udtOverKinmuLock(i).strKinmuDeptCD) AndAlso m_udtOverKinmuLock(i).lngDate = w_lngDate Then

                w_str = "確認済"
                lblSearchData.ForeColor = System.Drawing.Color.Blue
                m_blnOverKinmuLockFlg = True
                Exit For
            End If
        Next i

        lblSearchData.Text = Format(m_DayOverSelectDate, "yyyy年MM月dd日") & "(" & General.paGetWeekName(m_DayOverSelectDate) & ")" & Space(2) & w_str
    End Sub
End Class
